module [0,1828]
    import_statement [0,15]
        import: import [0,6]
        dotted_name [7,15]
            identifier: tiktoken [7,15]
    function_definition [17,1828]
        identifier: num_tokens_from_messages [21,45]
        parameters [45,83]
            identifier: messages [46,54]
            default_parameter [56,82]
                identifier: model [56,61]
                string: "gpt-3.5-turbo-0301" [62,82]
        block [89,1828]
            expression_statement [89,151]
                string: """Returns the number of tokens used by a list of messages.""" [89,151]
            try_statement [156,362]
                try: try [156,159]
                block [169,214]
                    expression_statement [169,214]
                        assignment [169,214]
                            identifier: encoding [169,177]
                            assignment_operator_literal: = [178,179]
                            call [180,214]
                                attribute [180,207]
                                    identifier: tiktoken [180,188]
                                    identifier: encoding_for_model [189,207]
                                argument_list [207,214]
                                    identifier: model [208,213]
                except_clause [219,362]
                    except: except [219,225]
                    identifier: KeyError [226,234]
                    block [244,362]
                        expression_statement [244,306]
                            call [244,306]
                                identifier: print [244,249]
                                argument_list [249,306]
                                    string: "Warning: model not found. Using cl100k_base encoding." [250,305]
                        expression_statement [315,362]
                            assignment [315,362]
                                identifier: encoding [315,323]
                                assignment_operator_literal: = [324,325]
                                call [326,362]
                                    attribute [326,347]
                                        identifier: tiktoken [326,334]
                                        identifier: get_encoding [335,347]
                                    argument_list [347,362]
                                        string: "cl100k_base" [348,361]
            if_statement [367,1315]
                comparison_operator [370,394]
                    identifier: model [370,375]
                    comparison_operator_literal: == [376,378]
                    string: "gpt-3.5-turbo" [379,394]
                block [404,585]
                    expression_statement [404,507]
                        call [404,507]
                            identifier: print [404,409]
                            argument_list [409,507]
                                string: "Warning: gpt-3.5-turbo may change over time. Returning num tokens assuming gpt-3.5-turbo-0301." [410,506]
                    return_statement [516,585]
                        call [523,585]
                            identifier: num_tokens_from_messages [523,547]
                            argument_list [547,585]
                                identifier: messages [548,556]
                                keyword_argument [558,584]
                                    identifier: model [558,563]
                                    assignment_operator_literal: = [563,564]
                                    string: "gpt-3.5-turbo-0301" [564,584]
                elif_clause [590,778]
                    elif: elif [590,594]
                    comparison_operator [595,611]
                        identifier: model [595,600]
                        comparison_operator_literal: == [601,603]
                        string: "gpt-4" [604,611]
                    block [621,778]
                        expression_statement [621,708]
                            call [621,708]
                                identifier: print [621,626]
                                argument_list [626,708]
                                    string: "Warning: gpt-4 may change over time. Returning num tokens assuming gpt-4-0314." [627,707]
                        return_statement [717,778]
                            call [724,778]
                                identifier: num_tokens_from_messages [724,748]
                                argument_list [748,778]
                                    identifier: messages [749,757]
                                    keyword_argument [759,777]
                                        identifier: model [759,764]
                                        assignment_operator_literal: = [764,765]
                                        string: "gpt-4-0314" [765,777]
                elif_clause [783,986]
                    elif: elif [783,787]
                    comparison_operator [788,817]
                        identifier: model [788,793]
                        comparison_operator_literal: == [794,796]
                        string: "gpt-3.5-turbo-0301" [797,817]
                    block [827,986]
                        expression_statement [827,849]
                            assignment [827,849]
                                identifier: tokens_per_message [827,845]
                                assignment_operator_literal: = [846,847]
                                integer: 4 [848,849]
                        comment: # every message follows <|start|>{role/name}\n{content}<|end|>\n [851,915]
                        expression_statement [924,944]
                            assignment [924,944]
                                identifier: tokens_per_name [924,939]
                                assignment_operator_literal: = [940,941]
                                unary_operator [942,944]
                                    -: - [942,943]
                                    integer: 1 [943,944]
                        comment: # if there's a name, the role is omitted [946,986]
                elif_clause [991,1077]
                    elif: elif [991,995]
                    comparison_operator [996,1017]
                        identifier: model [996,1001]
                        comparison_operator_literal: == [1002,1004]
                        string: "gpt-4-0314" [1005,1017]
                    block [1027,1077]
                        expression_statement [1027,1049]
                            assignment [1027,1049]
                                identifier: tokens_per_message [1027,1045]
                                assignment_operator_literal: = [1046,1047]
                                integer: 3 [1048,1049]
                        expression_statement [1058,1077]
                            assignment [1058,1077]
                                identifier: tokens_per_name [1058,1073]
                                assignment_operator_literal: = [1074,1075]
                                integer: 1 [1076,1077]
                else_clause [1082,1315]
                    else: else [1082,1086]
                    block [1096,1315]
                        raise_statement [1096,1315]
                            raise: raise [1096,1101]
                            call [1102,1315]
                                identifier: NotImplementedError [1102,1121]
                                argument_list [1121,1315]
                                    string: f"""num_tokens_from_messages() is not implemented for model {model}. See https://github.com/openai/openai-python/blob/main/chatml.md for information on how messages are converted to tokens.""" [1122,1314]
            expression_statement [1320,1334]
                assignment [1320,1334]
                    identifier: num_tokens [1320,1330]
                    assignment_operator_literal: = [1331,1332]
                    integer: 0 [1333,1334]
            if_statement [1340,1806]
                comparison_operator [1343,1367]
                    call [1343,1357]
                        identifier: type [1343,1347]
                        argument_list [1347,1357]
                            identifier: messages [1348,1356]
                    comparison_operator_literal: == [1358,1360]
                    string: "list" [1361,1367]
                block [1377,1719]
                    for_statement [1377,1635]
                        identifier: message [1381,1388]
                        identifier: messages [1392,1400]
                        block [1414,1635]
                            expression_statement [1414,1446]
                                assignment [1414,1446]
                                    identifier: num_tokens [1414,1424]
                                    assignment_operator_literal: += [1425,1427]
                                    identifier: tokens_per_message [1428,1446]
                            for_statement [1459,1635]
                                pattern_list [1463,1473]
                                    identifier: key [1463,1466]
                                    identifier: value [1468,1473]
                                call [1477,1492]
                                    attribute [1477,1490]
                                        identifier: message [1477,1484]
                                        identifier: items [1485,1490]
                                    argument_list [1490,1492]
                                block [1510,1635]
                                    expression_statement [1510,1551]
                                        assignment [1510,1551]
                                            identifier: num_tokens [1510,1520]
                                            assignment_operator_literal: += [1521,1523]
                                            call [1524,1551]
                                                identifier: len [1524,1527]
                                                argument_list [1527,1551]
                                                    call [1528,1550]
                                                        attribute [1528,1543]
                                                            identifier: encoding [1528,1536]
                                                            identifier: encode [1537,1543]
                                                        argument_list [1543,1550]
                                                            identifier: value [1544,1549]
                                    if_statement [1568,1635]
                                        comparison_operator [1571,1584]
                                            identifier: key [1571,1574]
                                            comparison_operator_literal: == [1575,1577]
                                            string: "name" [1578,1584]
                                        block [1606,1635]
                                            expression_statement [1606,1635]
                                                assignment [1606,1635]
                                                    identifier: num_tokens [1606,1616]
                                                    assignment_operator_literal: += [1617,1619]
                                                    identifier: tokens_per_name [1620,1635]
                    expression_statement [1644,1659]
                        assignment [1644,1659]
                            identifier: num_tokens [1644,1654]
                            assignment_operator_literal: += [1655,1657]
                            integer: 3 [1658,1659]
                    comment: # every reply is primed with <|start|>assistant<|message|> [1661,1719]
                elif_clause [1724,1806]
                    elif: elif [1724,1728]
                    comparison_operator [1729,1752]
                        call [1729,1743]
                            identifier: type [1729,1733]
                            argument_list [1733,1743]
                                identifier: messages [1734,1742]
                        comparison_operator_literal: == [1744,1746]
                        string: "str" [1747,1752]
                    block [1762,1806]
                        expression_statement [1762,1806]
                            assignment [1762,1806]
                                identifier: num_tokens [1762,1772]
                                assignment_operator_literal: += [1773,1775]
                                call [1776,1806]
                                    identifier: len [1776,1779]
                                    argument_list [1779,1806]
                                        call [1780,1805]
                                            attribute [1780,1795]
                                                identifier: encoding [1780,1788]
                                                identifier: encode [1789,1795]
                                            argument_list [1795,1805]
                                                identifier: messages [1796,1804]
            return_statement [1811,1828]
                identifier: num_tokens [1818,1828]