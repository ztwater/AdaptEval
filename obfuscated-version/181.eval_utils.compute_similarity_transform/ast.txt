module [0,2801]
    function_definition [0,2801]
        identifier: procrustes [4,14]
        parameters [14,53]
            identifier: X [15,16]
            identifier: Y [18,19]
            default_parameter [21,33]
                identifier: scaling [21,28]
                true: True [29,33]
            default_parameter [35,52]
                identifier: reflection [35,45]
                string: 'best' [46,52]
        block [59,2801]
            expression_statement [59,1351]
                string:     
    A port of MATLAB's `procrustes` function to Numpy.

    Procrustes analysis determines a linear transformation (translation,
    reflection, orthogonal rotation and scaling) of the points in Y to best
    conform them to the points in matrix X, using the sum of squared errors
    as the goodness of fit criterion.

        d, Z, [tform] = procrustes(X, Y)

    Inputs:
    ------------
    X, Y    
        matrices of target and input coordinates. they must have equal
        numbers of  points (rows), but Y may have fewer dimensions
        (columns) than X.

    scaling 
        if False, the scaling component of the transformation is forced
        to 1

    reflection
        if 'best' (default), the transformation solution may or may not
        include a reflection component, depending on which fits the data
        best. setting reflection to True or False forces a solution with
        reflection or no reflection respectively.

    Outputs
    ------------
    d       
        the residual sum of squared errors, normalized according to a
        measure of the scale of X, ((X - X.mean(0))**2).sum()

    Z
        the matrix of transformed Y-values

    tform   
        a dict specifying the rotation, translation and scaling that
        maps X --> Y

    """ [59,1351]
            expression_statement [1357,1370]
                assignment [1357,1370]
                    pattern_list [1357,1360]
                        identifier: n [1357,1358]
                        identifier: m [1359,1360]
                    assignment_operator_literal: = [1361,1362]
                    attribute [1363,1370]
                        identifier: X [1363,1364]
                        identifier: shape [1365,1370]
            expression_statement [1375,1390]
                assignment [1375,1390]
                    pattern_list [1375,1380]
                        identifier: ny [1375,1377]
                        identifier: my [1378,1380]
                    assignment_operator_literal: = [1381,1382]
                    attribute [1383,1390]
                        identifier: Y [1383,1384]
                        identifier: shape [1385,1390]
            expression_statement [1396,1411]
                assignment [1396,1411]
                    identifier: muX [1396,1399]
                    assignment_operator_literal: = [1400,1401]
                    call [1402,1411]
                        attribute [1402,1408]
                            identifier: X [1402,1403]
                            identifier: mean [1404,1408]
                        argument_list [1408,1411]
                            integer: 0 [1409,1410]
            expression_statement [1416,1431]
                assignment [1416,1431]
                    identifier: muY [1416,1419]
                    assignment_operator_literal: = [1420,1421]
                    call [1422,1431]
                        attribute [1422,1428]
                            identifier: Y [1422,1423]
                            identifier: mean [1424,1428]
                        argument_list [1428,1431]
                            integer: 0 [1429,1430]
            expression_statement [1437,1449]
                assignment [1437,1449]
                    identifier: X0 [1437,1439]
                    assignment_operator_literal: = [1440,1441]
                    binary_operator [1442,1449]
                        identifier: X [1442,1443]
                        -: - [1444,1445]
                        identifier: muX [1446,1449]
            expression_statement [1454,1466]
                assignment [1454,1466]
                    identifier: Y0 [1454,1456]
                    assignment_operator_literal: = [1457,1458]
                    binary_operator [1459,1466]
                        identifier: Y [1459,1460]
                        -: - [1461,1462]
                        identifier: muY [1463,1466]
            expression_statement [1472,1492]
                assignment [1472,1492]
                    identifier: ssX [1472,1475]
                    assignment_operator_literal: = [1476,1477]
                    call [1478,1492]
                        attribute [1478,1490]
                            parenthesized_expression [1478,1486]
                                binary_operator [1479,1485]
                                    identifier: X0 [1479,1481]
                                    **: ** [1481,1483]
                                    float: 2. [1483,1485]
                            identifier: sum [1487,1490]
                        argument_list [1490,1492]
            expression_statement [1497,1517]
                assignment [1497,1517]
                    identifier: ssY [1497,1500]
                    assignment_operator_literal: = [1501,1502]
                    call [1503,1517]
                        attribute [1503,1515]
                            parenthesized_expression [1503,1511]
                                binary_operator [1504,1510]
                                    identifier: Y0 [1504,1506]
                                    **: ** [1506,1508]
                                    float: 2. [1508,1510]
                            identifier: sum [1512,1515]
                        argument_list [1515,1517]
            comment: # centred Frobenius norm [1523,1547]
            expression_statement [1552,1572]
                assignment [1552,1572]
                    identifier: normX [1552,1557]
                    assignment_operator_literal: = [1558,1559]
                    call [1560,1572]
                        attribute [1560,1567]
                            identifier: np [1560,1562]
                            identifier: sqrt [1563,1567]
                        argument_list [1567,1572]
                            identifier: ssX [1568,1571]
            expression_statement [1577,1597]
                assignment [1577,1597]
                    identifier: normY [1577,1582]
                    assignment_operator_literal: = [1583,1584]
                    call [1585,1597]
                        attribute [1585,1592]
                            identifier: np [1585,1587]
                            identifier: sqrt [1588,1592]
                        argument_list [1592,1597]
                            identifier: ssY [1593,1596]
            comment: # scale to equal (unit) norm [1603,1631]
            expression_statement [1636,1647]
                assignment [1636,1647]
                    identifier: X0 [1636,1638]
                    assignment_operator_literal: /= [1639,1641]
                    identifier: normX [1642,1647]
            expression_statement [1652,1663]
                assignment [1652,1663]
                    identifier: Y0 [1652,1654]
                    assignment_operator_literal: /= [1655,1657]
                    identifier: normY [1658,1663]
            if_statement [1669,1734]
                comparison_operator [1672,1678]
                    identifier: my [1672,1674]
                    comparison_operator_literal: < [1675,1676]
                    identifier: m [1677,1678]
                block [1688,1734]
                    expression_statement [1688,1734]
                        assignment [1688,1734]
                            identifier: Y0 [1688,1690]
                            assignment_operator_literal: = [1691,1692]
                            call [1693,1734]
                                attribute [1693,1707]
                                    identifier: np [1693,1695]
                                    identifier: concatenate [1696,1707]
                                argument_list [1707,1734]
                                    tuple [1708,1731]
                                        identifier: Y0 [1709,1711]
                                        call [1713,1730]
                                            attribute [1713,1721]
                                                identifier: np [1713,1715]
                                                identifier: zeros [1716,1721]
                                            argument_list [1721,1730]
                                                identifier: n [1722,1723]
                                                binary_operator [1725,1729]
                                                    identifier: m [1725,1726]
                                                    -: - [1726,1727]
                                                    identifier: my [1727,1729]
                                    integer: 0 [1732,1733]
            comment: # optimum rotation matrix of Y [1740,1770]
            expression_statement [1775,1795]
                assignment [1775,1795]
                    identifier: A [1775,1776]
                    assignment_operator_literal: = [1777,1778]
                    call [1779,1795]
                        attribute [1779,1785]
                            identifier: np [1779,1781]
                            identifier: dot [1782,1785]
                        argument_list [1785,1795]
                            attribute [1786,1790]
                                identifier: X0 [1786,1788]
                                identifier: T [1789,1790]
                            identifier: Y0 [1792,1794]
            expression_statement [1800,1845]
                assignment [1800,1845]
                    pattern_list [1800,1806]
                        identifier: U [1800,1801]
                        identifier: s [1802,1803]
                        identifier: Vt [1804,1806]
                    assignment_operator_literal: = [1807,1808]
                    call [1809,1845]
                        attribute [1809,1822]
                            attribute [1809,1818]
                                identifier: np [1809,1811]
                                identifier: linalg [1812,1818]
                            identifier: svd [1819,1822]
                        argument_list [1822,1845]
                            identifier: A [1823,1824]
                            keyword_argument [1825,1844]
                                identifier: full_matrices [1825,1838]
                                assignment_operator_literal: = [1838,1839]
                                false: False [1839,1844]
            expression_statement [1850,1858]
                assignment [1850,1858]
                    identifier: V [1850,1851]
                    assignment_operator_literal: = [1852,1853]
                    attribute [1854,1858]
                        identifier: Vt [1854,1856]
                        identifier: T [1857,1858]
            expression_statement [1863,1881]
                assignment [1863,1881]
                    identifier: T [1863,1864]
                    assignment_operator_literal: = [1865,1866]
                    call [1867,1881]
                        attribute [1867,1873]
                            identifier: np [1867,1869]
                            identifier: dot [1870,1873]
                        argument_list [1873,1881]
                            identifier: V [1874,1875]
                            attribute [1877,1880]
                                identifier: U [1877,1878]
                                identifier: T [1879,1880]
            if_statement [1887,2206]
                comparison_operator [1890,1910]
                    identifier: reflection [1890,1900]
                    comparison_operator_literal: != [1901,1903]
                    string: 'best' [1904,1910]
                comment: # does the current solution use a reflection? [1921,1966]
                block [1975,2206]
                    expression_statement [1975,2013]
                        assignment [1975,2013]
                            identifier: have_reflection [1975,1990]
                            assignment_operator_literal: = [1991,1992]
                            comparison_operator [1993,2013]
                                call [1993,2009]
                                    attribute [1993,2006]
                                        attribute [1993,2002]
                                            identifier: np [1993,1995]
                                            identifier: linalg [1996,2002]
                                        identifier: det [2003,2006]
                                    argument_list [2006,2009]
                                        identifier: T [2007,2008]
                                comparison_operator_literal: < [2010,2011]
                                integer: 0 [2012,2013]
                    comment: # if that's not what was specified, force another reflection [2023,2083]
                    if_statement [2092,2206]
                        comparison_operator [2095,2124]
                            identifier: reflection [2095,2105]
                            comparison_operator_literal: != [2106,2108]
                            identifier: have_reflection [2109,2124]
                        block [2138,2206]
                            expression_statement [2138,2151]
                                assignment [2138,2151]
                                    subscript [2138,2145]
                                        identifier: V [2138,2139]
                                        slice [2140,2141]
                                        unary_operator [2142,2144]
                                            -: - [2142,2143]
                                            integer: 1 [2143,2144]
                                    assignment_operator_literal: *= [2146,2148]
                                    unary_operator [2149,2151]
                                        -: - [2149,2150]
                                        integer: 1 [2150,2151]
                            expression_statement [2164,2175]
                                assignment [2164,2175]
                                    subscript [2164,2169]
                                        identifier: s [2164,2165]
                                        unary_operator [2166,2168]
                                            -: - [2166,2167]
                                            integer: 1 [2167,2168]
                                    assignment_operator_literal: *= [2170,2172]
                                    unary_operator [2173,2175]
                                        -: - [2173,2174]
                                        integer: 1 [2174,2175]
                            expression_statement [2188,2206]
                                assignment [2188,2206]
                                    identifier: T [2188,2189]
                                    assignment_operator_literal: = [2190,2191]
                                    call [2192,2206]
                                        attribute [2192,2198]
                                            identifier: np [2192,2194]
                                            identifier: dot [2195,2198]
                                        argument_list [2198,2206]
                                            identifier: V [2199,2200]
                                            attribute [2202,2205]
                                                identifier: U [2202,2203]
                                                identifier: T [2204,2205]
            expression_statement [2212,2229]
                assignment [2212,2229]
                    identifier: traceTA [2212,2219]
                    assignment_operator_literal: = [2220,2221]
                    call [2222,2229]
                        attribute [2222,2227]
                            identifier: s [2222,2223]
                            identifier: sum [2224,2227]
                        argument_list [2227,2229]
            if_statement [2235,2590]
                identifier: scaling [2238,2245]
                comment: # optimum scaling of Y [2256,2278]
                block [2287,2473]
                    expression_statement [2287,2314]
                        assignment [2287,2314]
                            identifier: b [2287,2288]
                            assignment_operator_literal: = [2289,2290]
                            binary_operator [2291,2314]
                                binary_operator [2291,2306]
                                    identifier: traceTA [2291,2298]
                                    *: * [2299,2300]
                                    identifier: normX [2301,2306]
                                /: / [2307,2308]
                                identifier: normY [2309,2314]
                    comment: # standarised distance between X and b*Y*T + c [2324,2370]
                    expression_statement [2379,2397]
                        assignment [2379,2397]
                            identifier: d [2379,2380]
                            assignment_operator_literal: = [2381,2382]
                            binary_operator [2383,2397]
                                integer: 1 [2383,2384]
                                -: - [2385,2386]
                                binary_operator [2387,2397]
                                    identifier: traceTA [2387,2394]
                                    **: ** [2394,2396]
                                    integer: 2 [2396,2397]
                    comment: # transformed coords [2407,2427]
                    expression_statement [2436,2473]
                        assignment [2436,2473]
                            identifier: Z [2436,2437]
                            assignment_operator_literal: = [2438,2439]
                            binary_operator [2440,2473]
                                binary_operator [2440,2467]
                                    binary_operator [2440,2453]
                                        identifier: normX [2440,2445]
                                        *: * [2445,2446]
                                        identifier: traceTA [2446,2453]
                                    *: * [2453,2454]
                                    call [2454,2467]
                                        attribute [2454,2460]
                                            identifier: np [2454,2456]
                                            identifier: dot [2457,2460]
                                        argument_list [2460,2467]
                                            identifier: Y0 [2461,2463]
                                            identifier: T [2465,2466]
                                +: + [2468,2469]
                                identifier: muX [2470,2473]
                else_clause [2479,2590]
                    else: else [2479,2483]
                    block [2493,2590]
                        expression_statement [2493,2498]
                            assignment [2493,2498]
                                identifier: b [2493,2494]
                                assignment_operator_literal: = [2495,2496]
                                integer: 1 [2497,2498]
                        expression_statement [2507,2552]
                            assignment [2507,2552]
                                identifier: d [2507,2508]
                                assignment_operator_literal: = [2509,2510]
                                binary_operator [2511,2552]
                                    binary_operator [2511,2522]
                                        integer: 1 [2511,2512]
                                        +: + [2513,2514]
                                        binary_operator [2515,2522]
                                            identifier: ssY [2515,2518]
                                            /: / [2518,2519]
                                            identifier: ssX [2519,2522]
                                    -: - [2523,2524]
                                    binary_operator [2525,2552]
                                        binary_operator [2525,2544]
                                            binary_operator [2525,2536]
                                                integer: 2 [2525,2526]
                                                *: * [2527,2528]
                                                identifier: traceTA [2529,2536]
                                            *: * [2537,2538]
                                            identifier: normY [2539,2544]
                                        /: / [2545,2546]
                                        identifier: normX [2547,2552]
                        expression_statement [2561,2590]
                            assignment [2561,2590]
                                identifier: Z [2561,2562]
                                assignment_operator_literal: = [2563,2564]
                                binary_operator [2565,2590]
                                    binary_operator [2565,2584]
                                        identifier: normY [2565,2570]
                                        *: * [2570,2571]
                                        call [2571,2584]
                                            attribute [2571,2577]
                                                identifier: np [2571,2573]
                                                identifier: dot [2574,2577]
                                            argument_list [2577,2584]
                                                identifier: Y0 [2578,2580]
                                                identifier: T [2582,2583]
                                    +: + [2585,2586]
                                    identifier: muX [2587,2590]
            comment: # transformation matrix [2596,2619]
            if_statement [2624,2655]
                comparison_operator [2627,2633]
                    identifier: my [2627,2629]
                    comparison_operator_literal: < [2630,2631]
                    identifier: m [2632,2633]
                block [2643,2655]
                    expression_statement [2643,2655]
                        assignment [2643,2655]
                            identifier: T [2643,2644]
                            assignment_operator_literal: = [2645,2646]
                            subscript [2647,2655]
                                identifier: T [2647,2648]
                                slice [2649,2652]
                                    identifier: my [2650,2652]
                                slice [2653,2654]
            expression_statement [2660,2686]
                assignment [2660,2686]
                    identifier: c [2660,2661]
                    assignment_operator_literal: = [2662,2663]
                    binary_operator [2664,2686]
                        identifier: muX [2664,2667]
                        -: - [2668,2669]
                        binary_operator [2670,2686]
                            identifier: b [2670,2671]
                            *: * [2671,2672]
                            call [2672,2686]
                                attribute [2672,2678]
                                    identifier: np [2672,2674]
                                    identifier: dot [2675,2678]
                                argument_list [2678,2686]
                                    identifier: muY [2679,2682]
                                    identifier: T [2684,2685]
            comment: #transformation values  [2696,2719]
            expression_statement [2724,2774]
                assignment [2724,2774]
                    identifier: tform [2724,2729]
                    assignment_operator_literal: = [2730,2731]
                    dictionary [2732,2774]
                        pair [2733,2745]
                            string: 'rotation' [2733,2743]
                            identifier: T [2744,2745]
                        pair [2747,2756]
                            string: 'scale' [2747,2754]
                            identifier: b [2755,2756]
                        pair [2758,2773]
                            string: 'translation' [2758,2771]
                            identifier: c [2772,2773]
            return_statement [2783,2801]
                expression_list [2790,2801]
                    identifier: d [2790,2791]
                    identifier: Z [2793,2794]
                    identifier: tform [2796,2801]