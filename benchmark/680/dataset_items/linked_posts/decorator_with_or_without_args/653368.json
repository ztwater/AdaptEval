{
    "items": [
        {
            "tags": [
                "python",
                "decorator"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 6358,
                        "reputation": 388738,
                        "user_id": 10661,
                        "user_type": "registered",
                        "accept_rate": 91,
                        "display_name": "S.Lott"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1237284886,
                    "post_id": 653368,
                    "comment_id": 466897,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters#comment466897_653368",
                    "body": "The default-looking <code>@redirect_output</code> is remarkably uninformative.  I&#39;d suggest that it&#39;s a bad idea.  Use the first form and simplify your life a lot."
                },
                {
                    "owner": {
                        "account_id": 18155,
                        "reputation": 6452,
                        "user_id": 41344,
                        "user_type": "registered",
                        "accept_rate": 75,
                        "display_name": "rog"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1237385626,
                    "post_id": 653368,
                    "comment_id": 471797,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters#comment471797_653368",
                    "body": "interesting question though - until i saw it and looked through the documentation, i&#39;d have assumed that @f was the same as @f(), and i still think it should be, to be honest (any provided arguments would just be tacked on to the function argument)"
                },
                {
                    "owner": {
                        "account_id": 1412466,
                        "reputation": 8603,
                        "user_id": 1338797,
                        "user_type": "registered",
                        "display_name": "Tomasz Gandor"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1625677514,
                    "post_id": 653368,
                    "comment_id": 120693091,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters#comment120693091_653368",
                    "body": "This decorator-factory/decorator pattern is nice, with first default argument <code>function=None</code>, I would go further, and make the remaining arguments thereafter keyword-only."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 22723,
                                "reputation": 226381,
                                "user_id": 56338,
                                "user_type": "registered",
                                "accept_rate": 44,
                                "display_name": "sth"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1237282003,
                            "post_id": 653379,
                            "comment_id": 466820,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653379#comment466820_653379",
                            "body": "If you say @dec(abc) the function is not passed directly to dec. dec(abc) returns something, and this return value is used as the decorator. So dec(abc) has to return a function, which then gets the decorated function passed as an parameter. (Also see thobes code)"
                        }
                    ],
                    "owner": {
                        "account_id": 22779,
                        "reputation": 130073,
                        "user_id": 56541,
                        "user_type": "registered",
                        "accept_rate": 81,
                        "display_name": "David Z"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": -3,
                    "last_activity_date": 1237277924,
                    "creation_date": 1237277924,
                    "answer_id": 653379,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653379#653379",
                    "body": "<p>Generally you can give default arguments in Python...</p>\n\n<pre><code>def redirect_output(fn, output = stderr):\n    # whatever\n</code></pre>\n\n<p>Not sure if that works with decorators as well, though. I don't know of any reason why it wouldn't.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 22186,
                        "reputation": 10639,
                        "user_id": 54486,
                        "user_type": "registered",
                        "display_name": "kquinn"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": -2,
                    "last_activity_date": 1237277976,
                    "creation_date": 1237277976,
                    "answer_id": 653381,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653381#653381",
                    "body": "<p>Have you tried keyword arguments with default values? Something like</p>\n\n<pre><code>def decorate_something(foo=bar, baz=quux):\n    pass\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 23980,
                                "reputation": 411,
                                "user_id": 60624,
                                "user_type": "registered",
                                "display_name": "ehabkost"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1302865116,
                            "post_id": 653433,
                            "comment_id": 6478878,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653433#comment6478878_653433",
                            "body": "this can&#39;t be used as a decorator like in the <code>@redirect_output(&quot;somewhere.log&quot;) def foo()</code> example in the question."
                        }
                    ],
                    "owner": {
                        "account_id": 18427,
                        "reputation": 15979,
                        "user_id": 42188,
                        "user_type": "registered",
                        "accept_rate": 79,
                        "display_name": "muhuk"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": -3,
                    "last_activity_date": 1237280037,
                    "creation_date": 1237280037,
                    "answer_id": 653433,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653433#653433",
                    "body": "<p>Building on vartec's answer:</p>\n\n<pre><code>imports sys\n\ndef redirect_output(func, output=None):\n    if output is None:\n        output = sys.stderr\n    if isinstance(output, basestring):\n        output = open(output, 'w') # etc...\n    # everything else...\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 1305761,
                                "reputation": 1543,
                                "user_id": 1254798,
                                "user_type": "registered",
                                "accept_rate": 60,
                                "display_name": "lum"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1335256750,
                            "post_id": 653478,
                            "comment_id": 13246168,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653478#comment13246168_653478",
                            "body": "What do you put in <code>your code here</code>? How do you call the function that is decorated? <code>fn(*args, **kwargs)</code> doesn&#39;t work."
                        },
                        {
                            "owner": {
                                "account_id": 7555048,
                                "reputation": 655,
                                "user_id": 5735038,
                                "user_type": "registered",
                                "display_name": "Omer Ben Haim"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1579444836,
                            "post_id": 653478,
                            "comment_id": 105760816,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653478#comment105760816_653478",
                            "body": "i think there is a much simpler answer, create a class which will the the decorator with optional arguments. create another function with the same arguments with defaults and return a new instance of the decorator classes. should look something like: <code>def f(a = 5):     return MyDecorator( a = a) </code> and  <code>class MyDecorator( object ):  def __init__( self, a = 5 ): ....  </code> sorry its hard writing it in a comment but i hope this is simple enough to understand"
                        }
                    ],
                    "owner": {
                        "account_id": 29255,
                        "reputation": 1593,
                        "user_id": 78921,
                        "user_type": "registered",
                        "display_name": "thobe"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 40,
                    "last_activity_date": 1237281199,
                    "creation_date": 1237281199,
                    "answer_id": 653478,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653478#653478",
                    "body": "<p>Using keyword arguments with default values (as suggested by kquinn) is a good idea, but will require you to include the parenthesis:</p>\n\n<pre><code>@redirect_output()\ndef foo():\n    ...\n</code></pre>\n\n<p>If you would like a version that works without the parenthesis on the decorator you will have to account both scenarios in your decorator code.</p>\n\n<p>If you were using Python 3.0 you could use keyword only arguments for this:</p>\n\n<pre><code>def redirect_output(fn=None,*,destination=None):\n  destination = sys.stderr if destination is None else destination\n  def wrapper(*args, **kwargs):\n    ... # your code here\n  if fn is None:\n    def decorator(fn):\n      return functools.update_wrapper(wrapper, fn)\n    return decorator\n  else:\n    return functools.update_wrapper(wrapper, fn)\n</code></pre>\n\n<p>In Python 2.x this can be emulated with varargs tricks:</p>\n\n<pre><code>def redirected_output(*fn,**options):\n  destination = options.pop('destination', sys.stderr)\n  if options:\n    raise TypeError(\"unsupported keyword arguments: %s\" % \n                    \",\".join(options.keys()))\n  def wrapper(*args, **kwargs):\n    ... # your code here\n  if fn:\n    return functools.update_wrapper(wrapper, fn[0])\n  else:\n    def decorator(fn):\n      return functools.update_wrapper(wrapper, fn)\n    return decorator\n</code></pre>\n\n<p>Any of these versions would allow you to write code like this:</p>\n\n<pre><code>@redirected_output\ndef foo():\n    ...\n\n@redirected_output(destination=\"somewhere.log\")\ndef bar():\n    ...\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 24044,
                        "reputation": 4266,
                        "user_id": 60868,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "Remy Blank"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 13,
                    "last_activity_date": 1237281942,
                    "creation_date": 1237281942,
                    "answer_id": 653511,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653511#653511",
                    "body": "<p>You need to detect both cases, for example using the type of the first argument, and accordingly return either the wrapper (when used without parameter) or a decorator (when used with arguments).</p>\n\n<pre><code>from functools import wraps\nimport inspect\n\ndef redirect_output(fn_or_output):\n    def decorator(fn):\n        @wraps(fn)\n        def wrapper(*args, **args):\n            # Redirect output\n            try:\n                return fn(*args, **args)\n            finally:\n                # Restore output\n        return wrapper\n\n    if inspect.isfunction(fn_or_output):\n        # Called with no parameter\n        return decorator(fn_or_output)\n    else:\n        # Called with a parameter\n        return decorator\n</code></pre>\n\n<p>When using the <code>@redirect_output(\"output.log\")</code> syntax, <code>redirect_output</code> is called with a single argument <code>\"output.log\"</code>, and it must return a decorator accepting the function to be decorated as an argument. When used as <code>@redirect_output</code>, it is called directly with the function to be decorated as an argument.</p>\n\n<p>Or in other words: the <code>@</code> syntax must be followed by an expression whose result is a function accepting a function to be decorated as its sole argument, and returning the decorated function. The expression itself can be a function call, which is the case with <code>@redirect_output(\"output.log\")</code>. Convoluted, but true :-)</p>\n"
                },
                {
                    "owner": {
                        "account_id": 18155,
                        "reputation": 6452,
                        "user_id": 41344,
                        "user_type": "registered",
                        "accept_rate": 75,
                        "display_name": "rog"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 8,
                    "last_activity_date": 1237282899,
                    "creation_date": 1237282899,
                    "answer_id": 653553,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/653553#653553",
                    "body": "<p>A python decorator is called in a fundamentally different way depending on whether you give it arguments or not. The decoration is actually just a (syntactically restricted) expression.</p>\n\n<p>In your first example:</p>\n\n<pre><code>@redirect_output(\"somewhere.log\")\ndef foo():\n    ....\n</code></pre>\n\n<p>the function <code>redirect_output</code> is called with the\ngiven argument, which is expected to return a decorator\nfunction, which itself is called with <code>foo</code> as an argument,\nwhich (finally!) is expected to return the final decorated function.</p>\n\n<p>The equivalent code looks like this:</p>\n\n<pre><code>def foo():\n    ....\nd = redirect_output(\"somewhere.log\")\nfoo = d(foo)\n</code></pre>\n\n<p>The equivalent code for your second example looks like:</p>\n\n<pre><code>def foo():\n    ....\nd = redirect_output\nfoo = d(foo)\n</code></pre>\n\n<p>So you <em>can</em> do what you'd like but not in a totally seamless way:</p>\n\n<pre><code>import types\ndef redirect_output(arg):\n    def decorator(file, f):\n        def df(*args, **kwargs):\n            print 'redirecting to ', file\n            return f(*args, **kwargs)\n        return df\n    if type(arg) is types.FunctionType:\n        return decorator(sys.stderr, arg)\n    return lambda f: decorator(arg, f)\n</code></pre>\n\n<p>This should be ok unless you wish to use a function as an\nargument to your decorator, in which case the decorator\nwill wrongly assume it has no arguments. It will also fail\nif this decoration is applied to another decoration that\ndoes not return a function type.</p>\n\n<p>An alternative method is just to require that the\ndecorator function is always called, even if it is with no arguments.\nIn this case, your second example would look like this:</p>\n\n<pre><code>@redirect_output()\ndef foo():\n    ....\n</code></pre>\n\n<p>The decorator function code would look like this:</p>\n\n<pre><code>def redirect_output(file = sys.stderr):\n    def decorator(file, f):\n        def df(*args, **kwargs):\n            print 'redirecting to ', file\n            return f(*args, **kwargs)\n        return df\n    return lambda f: decorator(file, f)\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 14854281,
                                "reputation": 720,
                                "user_id": 10727283,
                                "user_type": "registered",
                                "display_name": "Noam Nol"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1629904743,
                            "post_id": 14412901,
                            "comment_id": 121811960,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/14412901#comment121811960_14412901",
                            "body": "It will not work if the first parameter is a class. Instead of <code>callable(args[0])</code>, you can detect classes with: <code>isinstance(args[0], types.FunctionType)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 307540,
                                "reputation": 8113,
                                "user_id": 618895,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "bj0"
                            },
                            "reply_to_user": {
                                "account_id": 14854281,
                                "reputation": 720,
                                "user_id": 10727283,
                                "user_type": "registered",
                                "display_name": "Noam Nol"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1630008662,
                            "post_id": 14412901,
                            "comment_id": 121845687,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/14412901#comment121845687_14412901",
                            "body": "I mentioned that that was one of the assumptions in the example I provided.  For special cases like passing a class, you would need to modify it to fit your case."
                        }
                    ],
                    "owner": {
                        "account_id": 307540,
                        "reputation": 8113,
                        "user_id": 618895,
                        "user_type": "registered",
                        "accept_rate": 62,
                        "display_name": "bj0"
                    },
                    "comment_count": 2,
                    "is_accepted": true,
                    "score": 108,
                    "last_activity_date": 1358587441,
                    "creation_date": 1358587441,
                    "answer_id": 14412901,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/14412901#14412901",
                    "body": "<p>I know this question is old, but some of the comments are new, and while all of the viable solutions are essentially the same, most of them aren't very clean or easy to read.</p>\n\n<p>Like thobe's answer says, the only way to handle both cases is to check for both scenarios.  The easiest way is simply to check to see if there is a single argument and it is callabe (NOTE: extra checks will be necessary if your decorator only takes 1 argument and it happens to be a callable object):</p>\n\n<pre><code>def decorator(*args, **kwargs):\n    if len(args) == 1 and len(kwargs) == 0 and callable(args[0]):\n        # called as @decorator\n    else:\n        # called as @decorator(*args, **kwargs)\n</code></pre>\n\n<p>In the first case, you do what any normal decorator does, return a modified or wrapped version of the passed in function.</p>\n\n<p>In the second case, you return a 'new' decorator that somehow uses the information passed in with *args, **kwargs.</p>\n\n<p>This is fine and all, but having to write it out for every decorator you make can be pretty annoying and not as clean.  Instead, it would be nice to be able to automagically modify our decorators without having to re-write them... but that's what decorators are for!  </p>\n\n<p>Using the following decorator decorator, we can deocrate our decorators so that they can be used with or without arguments:</p>\n\n<pre><code>def doublewrap(f):\n    '''\n    a decorator decorator, allowing the decorator to be used as:\n    @decorator(with, arguments, and=kwargs)\n    or\n    @decorator\n    '''\n    @wraps(f)\n    def new_dec(*args, **kwargs):\n        if len(args) == 1 and len(kwargs) == 0 and callable(args[0]):\n            # actual decorated function\n            return f(args[0])\n        else:\n            # decorator arguments\n            return lambda realf: f(realf, *args, **kwargs)\n\n    return new_dec\n</code></pre>\n\n<p>Now, we can decorate our decorators with @doublewrap, and they will work with and without arguments, with one caveat:</p>\n\n<p>I noted above but should repeat here, the check in this decorator makes an assumption about the arguments that a decorator can receive (namely that it can't receive a single, callable argument).  Since we are making it applicable to any generator now, it needs to be kept in mind, or modified if it will be contradicted.</p>\n\n<p>The following demonstrates its use:</p>\n\n<pre><code>def test_doublewrap():\n    from util import doublewrap\n    from functools import wraps    \n\n    @doublewrap\n    def mult(f, factor=2):\n        '''multiply a function's return value'''\n        @wraps(f)\n        def wrap(*args, **kwargs):\n            return factor*f(*args,**kwargs)\n        return wrap\n\n    # try normal\n    @mult\n    def f(x, y):\n        return x + y\n\n    # try args\n    @mult(3)\n    def f2(x, y):\n        return x*y\n\n    # try kwargs\n    @mult(factor=5)\n    def f3(x, y):\n        return x - y\n\n    assert f(2,3) == 10\n    assert f2(2,5) == 30\n    assert f3(8,1) == 5*7\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 12234,
                                "reputation": 4146,
                                "user_id": 23972,
                                "user_type": "registered",
                                "accept_rate": 64,
                                "display_name": "Dustin Wyatt"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1596407955,
                            "post_id": 19017908,
                            "comment_id": 111794925,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/19017908#comment111794925_19017908",
                            "body": "Yeah, I like this method.  Do note that you <i>have</i> to use kwargs when calling the decorator otherwise the first positional arg is assigned to <code>function</code> and then things break because the decorator tries to call that first positional arg as if it were your decorated function."
                        },
                        {
                            "owner": {
                                "account_id": 1412466,
                                "reputation": 8603,
                                "user_id": 1338797,
                                "user_type": "registered",
                                "display_name": "Tomasz Gandor"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1625678004,
                            "post_id": 19017908,
                            "comment_id": 120693300,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/19017908#comment120693300_19017908",
                            "body": "Yes, the first argument is not a <code>kwarg</code>, it&#39;s a positional argument with a default. But you could make the rest of arguments keyword-only."
                        }
                    ],
                    "owner": {
                        "account_id": 217435,
                        "reputation": 16598,
                        "user_id": 473232,
                        "user_type": "registered",
                        "accept_rate": 91,
                        "display_name": "dgel"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 36,
                    "last_activity_date": 1484162822,
                    "last_edit_date": 1484162822,
                    "creation_date": 1380159352,
                    "answer_id": 19017908,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/19017908#19017908",
                    "body": "<p>I know this is an old question, but I really don't like any of the techniques proposed so I wanted to add another method. I saw that django uses a really clean method in their <a href=\"https://github.com/django/django/blob/1.5.4/django/contrib/auth/decorators.py#L44\" rel=\"noreferrer\"><code>login_required</code> decorator in <code>django.contrib.auth.decorators</code></a>. As you can see in the <a href=\"https://docs.djangoproject.com/en/1.5/topics/auth/default/#the-login-required-decorator\" rel=\"noreferrer\">decorator's docs</a>, it can be used alone as <code>@login_required</code> or with arguments, <code>@login_required(redirect_field_name='my_redirect_field')</code>.</p>\n\n<p>The way they do it is quite simple. They add a <code>kwarg</code> (<code>function=None</code>) before their decorator arguments. If the decorator is used alone, <code>function</code> will be the actual function it is decorating, whereas if it is called with arguments, <code>function</code> will be <code>None</code>.</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>from functools import wraps\n\ndef custom_decorator(function=None, some_arg=None, some_other_arg=None):\n    def actual_decorator(f):\n        @wraps(f)\n        def wrapper(*args, **kwargs):\n            # Do stuff with args here...\n            if some_arg:\n                print(some_arg)\n            if some_other_arg:\n                print(some_other_arg)\n            return f(*args, **kwargs)\n        return wrapper\n    if function:\n        return actual_decorator(function)\n    return actual_decorator\n</code></pre>\n\n<hr>\n\n<pre><code>@custom_decorator\ndef test1():\n    print('test1')\n\n&gt;&gt;&gt; test1()\ntest1\n</code></pre>\n\n<hr>\n\n<pre><code>@custom_decorator(some_arg='hello')\ndef test2():\n    print('test2')\n\n&gt;&gt;&gt; test2()\nhello\ntest2\n</code></pre>\n\n<hr>\n\n<pre><code>@custom_decorator(some_arg='hello', some_other_arg='world')\ndef test3():\n    print('test3')\n\n&gt;&gt;&gt; test3()\nhello\nworld\ntest3\n</code></pre>\n\n<p>I find this approach that django uses to be more elegant and easier to understand than any of the other techniques proposed here.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 3677225,
                        "reputation": 1547,
                        "user_id": 3453033,
                        "user_type": "registered",
                        "accept_rate": 75,
                        "display_name": "Ainz Titor"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1468694383,
                    "creation_date": 1468694383,
                    "answer_id": 38414401,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/38414401#38414401",
                    "body": "<p>In fact, the caveat case in @bj0's solution can be checked easily:</p>\n\n<pre><code>def meta_wrap(decor):\n    @functools.wraps(decor)\n    def new_decor(*args, **kwargs):\n        if len(args) == 1 and len(kwargs) == 0 and callable(args[0]):\n            # this is the double-decorated f. \n            # Its first argument should not be a callable\n            doubled_f = decor(args[0])\n            @functools.wraps(doubled_f)\n            def checked_doubled_f(*f_args, **f_kwargs):\n                if callable(f_args[0]):\n                    raise ValueError('meta_wrap failure: '\n                                'first positional argument cannot be callable.')\n                return doubled_f(*f_args, **f_kwargs)\n            return checked_doubled_f \n        else:\n            # decorator arguments\n            return lambda real_f: decor(real_f, *args, **kwargs)\n\n    return new_decor\n</code></pre>\n\n<p>Here are a few test cases for this fail-safe version of <code>meta_wrap</code>.</p>\n\n<pre><code>    @meta_wrap\n    def baddecor(f, caller=lambda x: -1*x):\n        @functools.wraps(f)\n        def _f(*args, **kwargs):\n            return caller(f(args[0]))\n        return _f\n\n    @baddecor  # used without arg: no problem\n    def f_call1(x):\n        return x + 1\n    assert f_call1(5) == -6\n\n    @baddecor(lambda x : 2*x) # bad case\n    def f_call2(x):\n        return x + 1\n    f_call2(5)  # raises ValueError\n\n    # explicit keyword: no problem\n    @baddecor(caller=lambda x : 100*x)\n    def f_call3(x):\n        return x + 1\n    assert f_call3(5) == 600\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 1736299,
                                "reputation": 2897,
                                "user_id": 1588795,
                                "user_type": "registered",
                                "accept_rate": 73,
                                "display_name": "n8henrie"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1630080165,
                            "post_id": 39335652,
                            "comment_id": 121866757,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/39335652#comment121866757_39335652",
                            "body": "I like this style the best, thanks for sharing. For others, I will note that if you try to mutate <code>foo</code> within <code>wrapper</code>, you may get an <code>UnboundLocalError</code>, in which case you should declare <code>nonlocal foo</code> (or perhaps choose a different local variable name, <code>bar</code>, and set <code>bar = foo</code>). See also: <a href=\"https://stackoverflow.com/a/57184656/1588795\">stackoverflow.com/a/57184656/1588795</a>"
                        },
                        {
                            "owner": {
                                "account_id": 53576,
                                "reputation": 76098,
                                "user_id": 160206,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "Bj&#246;rn Pollex"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1638534154,
                            "post_id": 39335652,
                            "comment_id": 124120216,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/39335652#comment124120216_39335652",
                            "body": "Note that this solution assumes that calling code always uses keyword arguments. In this case <code>@decorator(&#39;foo&#39;)</code> would not behave as expected."
                        },
                        {
                            "owner": {
                                "account_id": 9279256,
                                "reputation": 99505,
                                "user_id": 6890912,
                                "user_type": "registered",
                                "display_name": "blhsing"
                            },
                            "reply_to_user": {
                                "account_id": 53576,
                                "reputation": 76098,
                                "user_id": 160206,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "Bj&#246;rn Pollex"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1697682212,
                            "post_id": 39335652,
                            "comment_id": 136311486,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/39335652#comment136311486_39335652",
                            "body": "@Bj&#246;rnPollex Just change <code>if func is None:</code> to <code>if not callable(func):</code> if you want it to support positional arguments."
                        }
                    ],
                    "owner": {
                        "account_id": 1842579,
                        "reputation": 713,
                        "user_id": 2601179,
                        "user_type": "registered",
                        "display_name": "henrywallace"
                    },
                    "comment_count": 3,
                    "is_accepted": false,
                    "score": 22,
                    "last_activity_date": 1665712754,
                    "last_edit_date": 1665712754,
                    "creation_date": 1473098370,
                    "answer_id": 39335652,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/39335652#39335652",
                    "body": "<p>Several answers here already address your problem nicely. With respect to style, however, I prefer solving this decorator predicament using <code>functools.partial</code>, as suggested in David Beazley's <em>Python Cookbook 3</em>:</p>\n<pre><code>from functools import partial, wraps\n\ndef decorator(func=None, foo='spam'):\n    if func is None:\n         return partial(decorator, foo=foo)\n\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        # do something with `func` and `foo`, if you're so inclined\n        pass\n    \n    return wrapper\n</code></pre>\n<p>While yes, you can just do</p>\n<pre><code>@decorator()\ndef f(*args, **kwargs):\n    pass\n</code></pre>\n<p>without funky workarounds, I find it strange looking, and I like having the option of simply decorating with <code>@decorator</code>.</p>\n<p>As for the secondary mission objective, redirecting a function's output is addressed in this <a href=\"https://stackoverflow.com/questions/4675728/redirect-stdout-to-a-file-in-python\">Stack Overflow post</a>.</p>\n<hr />\n<p>If you want to dive deeper, check out Chapter 9 (Metaprogramming) in <em>Python Cookbook 3</em>, which is freely available to be <a href=\"http://chimera.labs.oreilly.com/books/1230000000393/ch09.html\" rel=\"noreferrer\">read online</a>.</p>\n<p>Some of that material is live demoed (plus more!) in Beazley's awesome YouTube video <a href=\"https://youtu.be/sPiWg5jSoZI\" rel=\"noreferrer\">Python 3 Metaprogramming</a>.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 4815,
                                "reputation": 379779,
                                "user_id": 7432,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "Bryan Oakley"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1611336819,
                            "post_id": 58325523,
                            "comment_id": 116428016,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/58325523#comment116428016_58325523",
                            "body": "&quot;than the above&quot; isn&#39;t a useful phrase in stackoverflow. Different people will see answers in different orders over time. It&#39;s impossible to know what answer you&#39;re referring to."
                        },
                        {
                            "owner": {
                                "account_id": 9800827,
                                "reputation": 4858,
                                "user_id": 7262247,
                                "user_type": "registered",
                                "display_name": "smarie"
                            },
                            "reply_to_user": {
                                "account_id": 4815,
                                "reputation": 379779,
                                "user_id": 7432,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "Bryan Oakley"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1611569736,
                            "post_id": 58325523,
                            "comment_id": 116484827,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/58325523#comment116484827_58325523",
                            "body": "Thanks for spotting this @BryanOakley. Indeed, if you had found it useful and voted it up there would have been less messages above. I edited the message accordingly"
                        }
                    ],
                    "owner": {
                        "account_id": 9800827,
                        "reputation": 4858,
                        "user_id": 7262247,
                        "user_type": "registered",
                        "display_name": "smarie"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1665712609,
                    "last_edit_date": 1665712609,
                    "creation_date": 1570718460,
                    "answer_id": 58325523,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/58325523#58325523",
                    "body": "<p>To complete the other answers:</p>\n<blockquote>\n<p>&quot;Is there a way to build a decorator that can be used both with and without arguments ?&quot;</p>\n</blockquote>\n<p><strong>No</strong> there is no generic way because there is currently something missing in the python language to detect the two different use cases.</p>\n<p>However <strong>Yes</strong> as already pointed out by other answers such as <a href=\"https://stackoverflow.com/a/14412901/7262247\"><code>bj0</code>s</a>, there is a <strong>clunky workaround</strong> that is to check the type and value of the first positional argument received (and to check if no other arguments have non-default value). If you are guaranteed that users will <strong>never</strong> pass a callable as first argument of your decorator, then you can use this workaround. Note that this is the same for class decorators (replace callable by class in the previous sentence).</p>\n<p>To be sure of the above, I did quite a bit of research out there and even implemented a library named <a href=\"https://smarie.github.io/python-decopatch/\" rel=\"nofollow noreferrer\"><code>decopatch</code></a> that uses a combination of all strategies cited above (and many more, including introspection) to perform &quot;whatever is the most intelligent workaround&quot; depending on your need. It comes bundled with two modes: nested and flat.</p>\n<p>In &quot;nested mode&quot; you always return a function</p>\n<pre><code>from decopatch import function_decorator\n\n@function_decorator\ndef add_tag(tag='hi!'):\n    &quot;&quot;&quot;\n    Example decorator to add a 'tag' attribute to a function. \n    :param tag: the 'tag' value to set on the decorated function (default 'hi!).\n    &quot;&quot;&quot;\n    def _apply_decorator(f):\n        &quot;&quot;&quot;\n        This is the method that will be called when `@add_tag` is used on a \n        function `f`. It should return a replacement for `f`.\n        &quot;&quot;&quot;\n        setattr(f, 'tag', tag)\n        return f\n    return _apply_decorator\n</code></pre>\n<p>while in &quot;flat mode&quot; your method is directly the code that will be executed when the decorator is applied. It is injected with the decorated function object <code>f</code>:</p>\n<pre><code>from decopatch import function_decorator, DECORATED\n\n@function_decorator\ndef add_tag(tag='hi!', f=DECORATED):\n    &quot;&quot;&quot;\n    Example decorator to add a 'tag' attribute to a function.\n    :param tag: the 'tag' value to set on the decorated function (default 'hi!).\n    &quot;&quot;&quot;\n    setattr(f, 'tag', tag)\n    return f\n</code></pre>\n<p>But frankly the best would be not to need any library here and to get that feature straight from the python language. If, like myself, you think that it is a pity that the python language is not as of today capable of providing a neat answer to this question, <strong>do not hesitate to support this idea in the python bugtracker</strong>: <a href=\"https://bugs.python.org/issue36553\" rel=\"nofollow noreferrer\">https://bugs.python.org/issue36553</a> !</p>\n"
                },
                {
                    "owner": {
                        "account_id": 8520925,
                        "reputation": 2830,
                        "user_id": 6387880,
                        "user_type": "registered",
                        "display_name": "j4hangir"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1584922393,
                    "creation_date": 1584922393,
                    "answer_id": 60806456,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/60806456#60806456",
                    "body": "<p>This does the job without no fuss:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>from functools import wraps\n\ndef memoize(fn=None, hours=48.0):\n  def deco(fn):\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n      return fn(*args, **kwargs)\n    return wrapper\n\n  if callable(fn): return deco(fn)\n  return deco\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 14195650,
                        "reputation": 344,
                        "user_id": 10255036,
                        "user_type": "registered",
                        "display_name": "Majo"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1692262884,
                    "last_edit_date": 1692262884,
                    "creation_date": 1604071177,
                    "answer_id": 64611147,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/64611147#64611147",
                    "body": "<p>Since no one mentioned this, there is also a solution utilizing callable class which I find more elegant, especially in cases where the decorator is complex and one may wish to split it to multiple methods(functions). This solution utilizes <code>__new__</code> magic method to do essentially what others have pointed out. First detect how the decorator was used than adjust return appropriately.</p>\n<pre class=\"lang-py prettyprint-override\"><code>class decorator_with_arguments(object):\n\n    def __new__(cls, decorated_function=None, **kwargs):\n\n        self = super().__new__(cls)\n        self._init(**kwargs)\n\n        if not decorated_function:\n            return self\n        else:\n            return self.__call__(decorated_function)\n\n    def _init(self, arg1=&quot;default&quot;, arg2=&quot;default&quot;, arg3=&quot;default&quot;):\n        self.arg1 = arg1\n        self.arg2 = arg2\n        self.arg3 = arg3\n\n    def __call__(self, decorated_function):\n\n        def wrapped_f(*args):\n            print(&quot;Decorator arguments:&quot;, self.arg1, self.arg2, self.arg3)\n            print(&quot;decorated_function arguments:&quot;, *args)\n            decorated_function(*args)\n\n        return wrapped_f\n\n@decorator_with_arguments(arg1=5)\ndef sayHello(a1, a2, a3, a4):\n    print('sayHello arguments:', a1, a2, a3, a4)\n\n@decorator_with_arguments()\ndef sayHello(a1, a2, a3, a4):\n    print('sayHello arguments:', a1, a2, a3, a4)\n\n@decorator_with_arguments\ndef sayHello(a1, a2, a3, a4):\n    print('sayHello arguments:', a1, a2, a3, a4)\n</code></pre>\n<p>If the decorator is used with arguments, than this equals:</p>\n<pre class=\"lang-py prettyprint-override\"><code>result = decorator_with_arguments(arg1=5)(sayHello)(a1, a2, a3, a4)\n</code></pre>\n<p>One can see that the arguments <code>arg1</code> are correctly passed to the constructor and the decorated function is passed to <code>__call__</code></p>\n<p>But if the decorator is used without arguments, than this equals:</p>\n<pre class=\"lang-py prettyprint-override\"><code>result = decorator_with_arguments(sayHello)(a1, a2, a3, a4)\n</code></pre>\n<p>You see that in this case the decorated function is passed directly to the constructor and call to <code>__call__</code> is entirely omitted. That is why we need to employ logic to take care of this case in <code>__new__</code> magic method.</p>\n<p>Why can't we use <code>__init__</code> instead of <code>__new__</code>? The reason is simple: python prohibits returning any other values than None from <code>__init__</code></p>\n<p><strong>WARNINGS</strong></p>\n<p>This approach has two side effects.</p>\n<ul>\n<li>It will not preserve function signature</li>\n<li>Type checkers will be confused. For example mypy allows returning only instance of the same class from <code>__new__</code> and not anything else. See <a href=\"https://github.com/python/mypy/issues/15182\" rel=\"nofollow noreferrer\">here</a>.</li>\n</ul>\n"
                },
                {
                    "owner": {
                        "account_id": 8025402,
                        "reputation": 11,
                        "user_id": 6052567,
                        "user_type": "registered",
                        "display_name": "WangShengguang"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1631856714,
                    "last_edit_date": 1631856714,
                    "creation_date": 1631804114,
                    "answer_id": 69210737,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/69210737#69210737",
                    "body": "<p>this work for me:</p>\n<pre><code>def redirect_output(func=None, /, *, output_log='./output.log'):\n    def out_wrapper(func):\n        def wrapper(*args, **kwargs):\n            res = func(*args, **kwargs)\n            print(f&quot;{func.__name__} finished, output_log:{output_log}&quot;)\n            return res\n\n        return wrapper\n\n    if func is None:\n        return out_wrapper  # @redirect_output()\n    return out_wrapper(func)  # @redirect_output\n\n\n@redirect_output\ndef test1():\n    print(&quot;running test 1&quot;)\n\n\n@redirect_output(output_log=&quot;new.log&quot;)\ndef test2():\n    print(&quot;running test 2&quot;)\n\ntest1()\nprint('-----')\ntest2()\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 3926947,
                        "reputation": 1,
                        "user_id": 3247006,
                        "user_type": "registered",
                        "display_name": "Super Kai - Kazuya Ito"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1669304471,
                    "last_edit_date": 1669304471,
                    "creation_date": 1669303594,
                    "answer_id": 74563026,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/74563026#74563026",
                    "body": "<p>The example code <code>multiply()</code> below can accept one argument or no parentheses from the decorator and <code>sum()</code> below can sum 2 numbers:</p>\n<pre class=\"lang-py prettyprint-override\"><code>from numbers import Number\n\ndef multiply(num):\n    def _multiply(func):\n        def core(*args, **kwargs):\n            result = func(*args, **kwargs)\n            if isinstance(num, Number):\n                return result * num\n            else:\n                return result\n        return core\n    if callable(num):\n        return _multiply(num)\n    else:\n        return _multiply\n\ndef sum(num1, num2):\n    return num1 + num2\n</code></pre>\n<p>So, if you put <code>@multiply(5)</code> on <code>sum()</code>, then call <code>sum(4, 6)</code> as shown below:</p>\n<pre class=\"lang-py prettyprint-override\"><code># (4 + 6) x 5 = 50\n\n@multiply(5) # Here\ndef sum(num1, num2):\n    return num1 + num2\n\nresult = sum(4, 6)\nprint(result)\n</code></pre>\n<p>You can get the result below:</p>\n<pre class=\"lang-none prettyprint-override\"><code>50\n</code></pre>\n<p>And, if you put <code>@multiply</code> on <code>sum()</code>, then call <code>sum(4, 6)</code> as shown below:</p>\n<pre class=\"lang-py prettyprint-override\"><code># 4 + 6 = 10\n\n@multiply # Here\ndef sum(num1, num2):\n    return num1 + num2\n    \nresult = sum(4, 6)\nprint(result)\n</code></pre>\n<p>You can get the result below:</p>\n<pre class=\"lang-none prettyprint-override\"><code>10\n</code></pre>\n<p>But, if you put <code>@multiply()</code> on <code>sum()</code>, then call <code>sum(4, 6)</code> as shown below:</p>\n<pre class=\"lang-py prettyprint-override\"><code>@multiply() # Here\ndef sum(num1, num2):\n    return num1 + num2\n    \nresult = sum(4, 6)\nprint(result)\n</code></pre>\n<p>The error below occurs:</p>\n<blockquote>\n<p>TypeError: multiply() missing 1 required positional argument: 'num'</p>\n</blockquote>\n<p>So, if you want <code>@multiply()</code> to run without error, you need to add <strong>the default value <code>1</code></strong> to <code>num</code> as shown below:</p>\n<pre class=\"lang-py prettyprint-override\"><code>from numbers import Number\n             # Here\ndef multiply(num=1):\n    def _multiply(func):\n        def core(*args, **kwargs):\n# ...\n</code></pre>\n<p>Then, if you put <code>@multiply()</code> on <code>sum()</code>, then call <code>sum(4, 6)</code> as shown below:</p>\n<pre class=\"lang-py prettyprint-override\"><code># (4 + 6) x 1 = 10\n\n@multiply() # Here\ndef sum(num1, num2):\n    return num1 + num2\n    \nresult = sum(4, 6)\nprint(result)\n</code></pre>\n<p>You can get the result below:</p>\n<pre class=\"lang-none prettyprint-override\"><code>10\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 27447179,
                        "reputation": 13,
                        "user_id": 20940588,
                        "user_type": "registered",
                        "display_name": "Lucas Napon"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1674610295,
                    "creation_date": 1674610295,
                    "answer_id": 75228936,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/75228936#75228936",
                    "body": "<p>Because I did not find an easy to digest explanation for these solutions on the internet, I'll try to demonstrate visually what happened on them.</p>\n<p>Firstly, let's see the difference between what <code>@decorator</code> and <code>@decorator()</code> does.</p>\n<p><code>@decorator</code> without parenthesis:</p>\n<pre><code>def decorator(func=None):\n    if func:\n        print('success')\n        return func\n    else:\n        print('failure')\n        return print\n\n\n@decorator\ndef hello():\n    print('hello')\n    return\n\n\nhello()  # &lt;- result bellow\n</code></pre>\n<pre><code>success\nhello\n\nProcess finished with exit code 0\n</code></pre>\n<p>Now <code>@decorator()</code> with parenthesis:</p>\n<pre><code>def decorator(func=None):\n    if func:\n        print('success')\n        return func\n    else:\n        print('failure')\n        return print\n\n\n@decorator()\ndef hello():\n    print('hello')\n    return\n\n\nhello()\n</code></pre>\n<pre><code>failure\n&lt;function hello at 0x00000170FEC889A0&gt;\nTraceback (most recent call last):\n  File &quot;C:\\Users\\User\\PycharmProjects\\stackoverflow\\answer_1.py&quot;, line 41, in &lt;module&gt;\n    hello()\nTypeError: 'NoneType' object is not callable\n\nProcess finished with exit code 1\n</code></pre>\n<p><code>&lt;function hello at 0x00000170FEC889A0&gt;</code> is the same as <code>print(hello)</code></p>\n<p>Apparently, when the decorator is called with parenthesis, the function bellow is ignored (as seen in other answers). But when it returns a function (e.g. <code>print</code>), it takes as argument <code>hello</code> as seen.</p>\n<p>Another example:</p>\n<pre><code>def decorator(func=None, arg=None):\n    if func:\n        print('success')\n        return func\n    else:\n        print('failure')\n        if arg:\n            print(arg)\n        return print\n\n\n@decorator('i am an str')\ndef hello():\n    print('hello')\n    return\n\n\nhello()\n</code></pre>\n<pre><code>Traceback (most recent call last):\n  File &quot;C:\\Users\\User\\PycharmProjects\\stackoverflow_question_1\\answer_1.py&quot;, line 37, in &lt;module&gt;\n    @decorator('i am an str')\n     ^^^^^^^^^^^^^^^^^^^^^^\nTypeError: 'str' object is not callable\nsuccess\n\nProcess finished with exit code 1\n</code></pre>\n<p>Here the decorator tries to call a <code>str</code>, which passed as the <code>func</code> parameter (because the console printed <strong>success</strong>), being the first and only argument inside the parenthesis.</p>\n<p>If you know how a decorator works you probably already figured it out.</p>\n<p>When we call <code>@decorator</code> to <code>def hello</code>, we get <code>hello</code> as:</p>\n<pre><code>hello = decorator(hello)  # if hello is already defined\n</code></pre>\n<p>When we call <code>@decorator()</code> instead we get:</p>\n<pre><code>hello = decorator()(hello)\n# this is calling the return value of decorator().\n</code></pre>\n<p>Python made the decorator syntax code <em><strong>as simple as possible</strong></em>, like anything you put in the line after @ will get called with the bellow definition as the sole argument.\n<code>@12341234</code> is the same as <code>... = 12341234(...)</code>. Since int it's not callable, <code>@12341234</code> will get a TypeError.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 12787713,
                        "reputation": 583,
                        "user_id": 9253363,
                        "user_type": "registered",
                        "display_name": "Karolius"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1681307690,
                    "creation_date": 1681307690,
                    "answer_id": 75996315,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/75996315#75996315",
                    "body": "<p>Simple decorator for other decorators:</p>\n<pre><code>from functools import wraps, partial\n\ndef with_optional_params(decorator):\n    return wraps(decorator)(\n        lambda func=None, /, **kwargs: partial(decorator, **kwargs)\n        if func is None\n        else decorator(func, **kwargs)\n    )\n\n@with_optional_params\ndef printed(func, *, pre=True, post=True):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        if pre:\n            print('pre')\n        result = func(*args, **kwargs)\n        if post:\n            print('post')\n        return result\n    return wrapper\n\n@printed\ndef foo(): pass\n\n@printed(post=False)\ndef foo(): pass\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": -1,
                                "reputation": 1,
                                "user_id": -1,
                                "user_type": "moderator",
                                "display_name": "Community"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1686150081,
                            "post_id": 76424531,
                            "comment_id": 134760262,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/76424531#comment134760262_76424531",
                            "body": "Your answer could be improved with additional supporting information. Please <a href=\"https://stackoverflow.com/posts/76424531/edit\">edit</a> to add further details, such as citations or documentation, so that others can confirm that your answer is correct. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>."
                        },
                        {
                            "owner": {
                                "account_id": 3210846,
                                "reputation": 813,
                                "user_id": 2870922,
                                "user_type": "registered",
                                "display_name": "Chenmunka"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1686750852,
                            "post_id": 76424531,
                            "comment_id": 134842306,
                            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/76424531#comment134842306_76424531",
                            "body": "While this link may answer the question, it is better to include the essential parts of the answer here and provide the link for reference.  Link-only answers can become invalid if the linked page changes. - <a href=\"/review/late-answers/34512103\">From Review</a>"
                        }
                    ],
                    "owner": {
                        "account_id": 6725460,
                        "reputation": 43,
                        "user_id": 5183623,
                        "user_type": "registered",
                        "display_name": "Ramon Rosa"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1694477078,
                    "last_edit_date": 1694477078,
                    "creation_date": 1686148932,
                    "answer_id": 76424531,
                    "question_id": 653368,
                    "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters/76424531#76424531",
                    "body": "<p>I wrote this gist with a decorator to enable decorators to use optional keyword arguments. It may be an elegant solution for this issue.</p>\n<p><a href=\"https://gist.github.com/ramonrosa/402af55633e9b6c273882ac074760426\" rel=\"nofollow noreferrer\">https://gist.github.com/ramonrosa/402af55633e9b6c273882ac074760426</a></p>\n<pre><code>from functools import partial, wraps\nfrom inspect import signature\nfrom typing import Callable\n\n\ndef decorator_with_kwargs(decorator: Callable) -&gt; Callable:\n    &quot;&quot;&quot;Decorator factory to give decorated decorators the skill to receive\n    optional keyword arguments.\n\n    If a decorator &quot;some_decorator&quot; is decorated with this function:\n\n        @decorator_with_kwargs\n        def some_decorator(decorated_function, kwarg1=1, kwarg2=2):\n            def wrapper(*decorated_function_args, **decorated_function_kwargs):\n                '''Modifies the behavior of decorated_function according\n                to the value of kwarg1 and kwarg2'''\n                ...\n            return wrapper\n\n    It will be usable in the following ways:\n\n        @some_decorator\n        def func(x):\n            ...\n\n        @some_decorator()\n        def func(x):\n            ...\n\n        @some_decorator(kwarg1=3)  # or other combinations of kwargs\n        def func(x, y):\n            ...\n\n    :param decorator: decorator to be given optional kwargs-handling skills\n    :type decorator: Callable\n    :raises TypeError: if the decorator does not receive a single Callable or\n        keyword arguments\n    :raises TypeError: if the signature of the decorated decorator does not\n        conform to: Callable, **keyword_arguments\n    :return: modified decorator\n    :rtype: Callable\n    &quot;&quot;&quot;\n    @wraps(decorator)\n    def decorator_wrapper(*args, **kwargs):\n        if (len(kwargs) == 0) and (len(args) == 1) and callable(args[0]):\n            return decorator(args[0])\n        if len(args) == 0:\n            return partial(decorator, **kwargs)\n        raise TypeError(\n            f'{decorator.__name__} expects either a single Callable '\n            'or keyword arguments'\n        )\n\n    signature_values = signature(decorator).parameters.values()\n    signature_args = [\n        param.name for param in signature_values\n        if param.default == param.empty\n    ]\n\n    if len(signature_args) != 1:\n        raise TypeError(\n            f'{decorator.__name__} signature should be of the form:\\n'\n            f'{decorator.__name__}(function: typing.Callable, '\n            'kwarg_1=default_1, kwarg_2=default_2, ...) -&gt; Callable'\n        )\n\n    return decorator_wrapper\n\n\n# EXAMPLE USE CASES:\n\n@decorator_with_kwargs\ndef multiple_runs(function, num_times=2):\n    @wraps(function)\n    def wrapper(*args, **kwargs):\n        for _ in range(num_times):\n            function(*args, **kwargs)\n    return wrapper\n\n\n# Decorator factory not being called directly\n@multiple_runs\ndef func(x):\n    print(x, end='')\nfunc('a')\n# &gt; aa\n\n\n# Decorator factory called without arguments\n@multiple_runs()\ndef func(x):\n    print(x, end='')\nfunc('a')\n# &gt; aa\n\n\n# Decorator factory called with keyword arguments\n@multiple_runs(num_times=5)\ndef func(x):\n    print(x, end='')\nfunc('a')\n# &gt; aaaaa\n\n\n# Expect TypeError:\n# unexpected keyword argument\n@multiple_runs(xpto=1)\ndef func(x):\n    print(x, end='')\nfunc('a')\n# &gt; TypeError: multiple_runs() got an unexpected keyword argument 'xpto'\n\n\n# Expect TypeError:\n# passing a non callable positional argument for the decorator:\n@multiple_runs(1)\ndef func(x):\n    print(x, end='')\nfunc('a')\n# &gt; TypeError: multiple_runs expects either a single Callable or keyword arguments\n\n\n# Expect TyeError:\n# passing two positional arguments for the decorator:\n@multiple_runs(1, 2)\ndef func(x):\n    print(x, end='')   \nfunc('a')\n# &gt; TypeError: multiple_runs expects either a single Callable or keyword arguments\n\n\n# Expect TyeError:\n# no workaround for something like this:\n@multiple_runs(lambda x: x)\ndef func(x):\n    print(x, end='')    \nfunc('a')\n# &gt; TypeError: 'NoneType' object is not callable\n\n\n# Expect TyeError:\n# decorator with incorrect signature\n@decorator_with_kwargs\ndef decorator_with_incorrect_signature(function, other_arg, x=1):\n    pass\n# &gt; TypeError: decorator_with_incorrect_signature signature should be of the form:\n# &gt; decorator_with_incorrect_signature(function: typing.Callable, kwarg_1=default_1, kwarg_2=default_2, ...) -&gt; Callable\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 8397,
                "reputation": 7485,
                "user_id": 15109,
                "user_type": "registered",
                "accept_rate": 69,
                "display_name": "elifiner"
            },
            "comment_count": 3,
            "is_answered": true,
            "accepted_answer_id": 14412901,
            "answer_count": 18,
            "score": 128,
            "last_activity_date": 1694477078,
            "creation_date": 1237277419,
            "last_edit_date": 1644609637,
            "question_id": 653368,
            "link": "https://stackoverflow.com/questions/653368/how-to-create-a-decorator-that-can-be-used-either-with-or-without-parameters",
            "title": "How to create a decorator that can be used either with or without parameters?",
            "body": "<p>I'd like to create a Python decorator that can be used either with parameters:</p>\n\n<pre><code>@redirect_output(\"somewhere.log\")\ndef foo():\n    ....\n</code></pre>\n\n<p>or without them (for instance to redirect the output to stderr by default):</p>\n\n<pre><code>@redirect_output\ndef foo():\n    ....\n</code></pre>\n\n<p>Is that at all possible?</p>\n\n<p>Note that I'm not looking for a different solution to the problem of redirecting output, it's just an example of the syntax I'd like to achieve.</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 8800
}