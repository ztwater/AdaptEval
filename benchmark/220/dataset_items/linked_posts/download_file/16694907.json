{
    "items": [
        {
            "tags": [
                "python",
                "download",
                "stream",
                "python-requests"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 11676912,
                        "reputation": 71,
                        "user_id": 8550137,
                        "user_type": "registered",
                        "display_name": "user8550137"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1683129875,
                    "post_id": 16694907,
                    "comment_id": 134320216,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests#comment134320216_16694907",
                    "body": "The requests library is nice, but not intended for this purpose.  I would suggest using a different library such as urlib3. <a href=\"https://stackoverflow.com/questions/17285464/whats-the-best-way-to-download-file-using-urllib3\" title=\"whats the best way to download file using urllib3\">stackoverflow.com/questions/17285464/&hellip;</a>"
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1369236163,
                            "post_id": 16695277,
                            "comment_id": 24029151,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16695277#comment24029151_16695277",
                            "body": "I use System Monitor in Kubuntu. It shows me that python process memory increases (up to 1.5gb from 25kb)."
                        },
                        {
                            "owner": {
                                "account_id": 80767,
                                "reputation": 19995,
                                "user_id": 228152,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "danodonovan"
                            },
                            "reply_to_user": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1369237199,
                            "post_id": 16695277,
                            "comment_id": 24029870,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16695277#comment24029870_16695277",
                            "body": "That memory bloat sucks, maybe <code>f.flush(); os.fsync()</code> might force a write an memory free."
                        },
                        {
                            "owner": {
                                "account_id": 4545625,
                                "reputation": 1047,
                                "user_id": 3692322,
                                "user_type": "registered",
                                "display_name": "sebdelsol"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1412984411,
                            "post_id": 16695277,
                            "comment_id": 41286575,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16695277#comment41286575_16695277",
                            "body": "it&#39;s <code>os.fsync(f.fileno())</code>"
                        },
                        {
                            "owner": {
                                "account_id": 87876,
                                "reputation": 6232,
                                "user_id": 243442,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "Hut8"
                            },
                            "edited": false,
                            "score": 39,
                            "creation_date": 1431295177,
                            "post_id": 16695277,
                            "comment_id": 48421240,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16695277#comment48421240_16695277",
                            "body": "You need to use stream=True in the requests.get() call. That&#39;s what&#39;s causing the memory bloat."
                        },
                        {
                            "owner": {
                                "account_id": 5097637,
                                "reputation": 507,
                                "user_id": 4088397,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "Aubrey"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1483544607,
                            "post_id": 16695277,
                            "comment_id": 70140971,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16695277#comment70140971_16695277",
                            "body": "minor typo: you miss a colon (&#39;:&#39;) after <code>def DownloadFile(url)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 6715526,
                                "reputation": 409,
                                "user_id": 5201707,
                                "user_type": "registered",
                                "accept_rate": 69,
                                "display_name": "shzyincu"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1624890413,
                            "post_id": 16695277,
                            "comment_id": 120473957,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16695277#comment120473957_16695277",
                            "body": "What if i don&#39;t want to save it as a file but in BytesIO ???"
                        }
                    ],
                    "owner": {
                        "account_id": 80767,
                        "reputation": 19995,
                        "user_id": 228152,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "danodonovan"
                    },
                    "comment_count": 6,
                    "is_accepted": false,
                    "score": 46,
                    "last_activity_date": 1493333750,
                    "last_edit_date": 1495535490,
                    "creation_date": 1369234969,
                    "answer_id": 16695277,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16695277#16695277",
                    "body": "<p>Your chunk size could be too large, have you tried dropping that - maybe 1024 bytes at a time? (also, you could use <code>with</code> to tidy up the syntax)</p>\n\n<pre><code>def DownloadFile(url):\n    local_filename = url.split('/')[-1]\n    r = requests.get(url)\n    with open(local_filename, 'wb') as f:\n        for chunk in r.iter_content(chunk_size=1024): \n            if chunk: # filter out keep-alive new chunks\n                f.write(chunk)\n    return \n</code></pre>\n\n<p>Incidentally, how are you deducing that the response has been loaded into memory?</p>\n\n<p>It sounds as if python isn't flushing the data to file, from other <a href=\"https://stackoverflow.com/questions/7127075/what-exactly-the-pythons-file-flush-is-doing\">SO questions</a> you could try <code>f.flush()</code> and <code>os.fsync()</code> to force the file write and free memory;</p>\n\n<pre><code>    with open(local_filename, 'wb') as f:\n        for chunk in r.iter_content(chunk_size=1024): \n            if chunk: # filter out keep-alive new chunks\n                f.write(chunk)\n                f.flush()\n                os.fsync(f.fileno())\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 464876,
                                "reputation": 4052,
                                "user_id": 2052889,
                                "user_type": "registered",
                                "accept_rate": 36,
                                "display_name": "Shuman"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1400068514,
                            "post_id": 16696317,
                            "comment_id": 36329898,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment36329898_16696317",
                            "body": "@Shuman This code successfully downloads files which are bigger then 1.5Gb. Can you download the file via any browser successfully?"
                        },
                        {
                            "owner": {
                                "account_id": 464876,
                                "reputation": 4052,
                                "user_id": 2052889,
                                "user_type": "registered",
                                "accept_rate": 36,
                                "display_name": "Shuman"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1400075880,
                            "post_id": 16696317,
                            "comment_id": 36335570,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment36335570_16696317",
                            "body": "yes in firefox if i download manually, it successfully saves out a 1.5GB .zip file"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 464876,
                                "reputation": 4052,
                                "user_id": 2052889,
                                "user_type": "registered",
                                "accept_rate": 36,
                                "display_name": "Shuman"
                            },
                            "edited": false,
                            "score": 9,
                            "creation_date": 1400091322,
                            "post_id": 16696317,
                            "comment_id": 36346356,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment36346356_16696317",
                            "body": "@Shuman As I see you resolved the issue when switched from http:// to https:// (<a href=\"https://github.com/kennethreitz/requests/issues/2043\" rel=\"nofollow noreferrer\">github.com/kennethreitz/requests/issues/2043</a>). Can you please update or delete your comments because people may think that there are issues with the code for files bigger 1024Mb"
                        },
                        {
                            "owner": {
                                "account_id": 2040391,
                                "reputation": 8033,
                                "user_id": 1821749,
                                "user_type": "registered",
                                "accept_rate": 86,
                                "display_name": "Eduard Gamonal"
                            },
                            "edited": false,
                            "score": 22,
                            "creation_date": 1427288778,
                            "post_id": 16696317,
                            "comment_id": 46715663,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment46715663_16696317",
                            "body": "the <code>chunk_size</code> is crucial. by default it&#39;s 1 (1 byte). that means that for 1MB it&#39;ll make 1 milion iterations. <a href=\"http://docs.python-requests.org/en/latest/api/#requests.Response.iter_content\" rel=\"nofollow noreferrer\">docs.python-requests.org/en/latest/api/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 1188098,
                                "reputation": 465,
                                "user_id": 1161622,
                                "user_type": "registered",
                                "display_name": "Rovin Bhandari"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1430912814,
                            "post_id": 16696317,
                            "comment_id": 48264837,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment48264837_16696317",
                            "body": "Is it possible to parallelize the iter_content() part somehow to speed up the download? Thanks!"
                        },
                        {
                            "owner": {
                                "account_id": 1535400,
                                "reputation": 3749,
                                "user_id": 1431598,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "Fernando Freitas Alves"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1431719531,
                            "post_id": 16696317,
                            "comment_id": 48635162,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment48635162_16696317",
                            "body": "@RomanPodlinov, do you mind telling me why are you using the flush?"
                        },
                        {
                            "owner": {
                                "account_id": 200340,
                                "reputation": 5163,
                                "user_id": 446140,
                                "user_type": "registered",
                                "accept_rate": 83,
                                "display_name": "reox"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1432726039,
                            "post_id": 16696317,
                            "comment_id": 49040784,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment49040784_16696317",
                            "body": "you could use url.rsplit(&#39;/&#39;, 1)[1] as well, which will not split the whole url but only the last part of it."
                        },
                        {
                            "owner": {
                                "account_id": 3021,
                                "reputation": 408304,
                                "user_id": 4279,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "jfs"
                            },
                            "reply_to_user": {
                                "account_id": 1188098,
                                "reputation": 465,
                                "user_id": 1161622,
                                "user_type": "registered",
                                "display_name": "Rovin Bhandari"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1443404058,
                            "post_id": 16696317,
                            "comment_id": 53465719,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment53465719_16696317",
                            "body": "@RovinBhandari: to parallelize, <a href=\"http://stackoverflow.com/q/13973188/4279\">find out whether there is support for bytes range http header in <code>requests</code></a>"
                        },
                        {
                            "owner": {
                                "account_id": 3021,
                                "reputation": 408304,
                                "user_id": 4279,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "jfs"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1443404121,
                            "post_id": 16696317,
                            "comment_id": 53465730,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment53465730_16696317",
                            "body": "<code>url.split(&#39;&#47;&#39;)[-1]</code> might be too simplistic e.g., see <a href=\"https://gist.github.com/zed/c2168b9c52b032b5fb7d\" rel=\"nofollow noreferrer\"><code>url2filename()</code></a>"
                        },
                        {
                            "owner": {
                                "account_id": 3021,
                                "reputation": 408304,
                                "user_id": 4279,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "jfs"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1443404454,
                            "post_id": 16696317,
                            "comment_id": 53465800,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment53465800_16696317",
                            "body": "<code>f.flush()</code> seems unnecessary. What are you trying to accomplish using it? (your memory usage won&#39;t be 1.5gb if you drop it). <code>f.write(b&#39;&#39;)</code> (if <code>iter_content()</code> may return an empty string) should be harmless and therefore <code>if chunk</code> could  be dropped too."
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 3021,
                                "reputation": 408304,
                                "user_id": 4279,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "jfs"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1443465062,
                            "post_id": 16696317,
                            "comment_id": 53494851,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment53494851_16696317",
                            "body": "@J.F.Sebastian agree url2filename is better. About flash. The idea is flush data into physical file on drive. If you see that the code works good without flash() just remove it."
                        },
                        {
                            "owner": {
                                "account_id": 3021,
                                "reputation": 408304,
                                "user_id": 4279,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "jfs"
                            },
                            "edited": false,
                            "score": 13,
                            "creation_date": 1443467328,
                            "post_id": 16696317,
                            "comment_id": 53495938,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment53495938_16696317",
                            "body": "@RomanPodlinov: <code>f.flush()</code> doesn&#39;t flush data to physical disk. It transfers the data to OS. Usually, it is enough unless there is a power failure. <code>f.flush()</code> makes the code slower here for no reason. The flush happens when the correponding file buffer (inside app) is full. If you need more frequent writes; pass buf.size parameter to <code>open()</code>."
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 3021,
                                "reputation": 408304,
                                "user_id": 4279,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "jfs"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1444140736,
                            "post_id": 16696317,
                            "comment_id": 53769322,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment53769322_16696317",
                            "body": "@J.F.Sebastian Thank you I commented the flush row in the code"
                        },
                        {
                            "owner": {
                                "account_id": 263886,
                                "reputation": 641,
                                "user_id": 549765,
                                "user_type": "registered",
                                "display_name": "y0prst"
                            },
                            "edited": false,
                            "score": 6,
                            "creation_date": 1456551322,
                            "post_id": 16696317,
                            "comment_id": 59012115,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment59012115_16696317",
                            "body": "<code>if chunk: # filter out keep-alive new chunks</code> \u2013 it is redundant, isn&#39;t it? Since <code>iter_content()</code> always yields string and never yields <code>None</code>, it looks like premature optimization. I also doubt it can ever yield empty string (I cannot imagine any reason for this)."
                        },
                        {
                            "owner": {
                                "account_id": 479351,
                                "reputation": 1893,
                                "user_id": 891975,
                                "user_type": "registered",
                                "display_name": "\u041f\u0430\u0432\u0435\u043b \u0418\u0432\u0430\u043d\u043e\u0432"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1463472987,
                            "post_id": 16696317,
                            "comment_id": 62067337,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment62067337_16696317",
                            "body": "In the case you use dropbox links, it will save your file with a name like &quot;Banner_apus_1.23.zip?dl=1&quot;"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 479351,
                                "reputation": 1893,
                                "user_id": 891975,
                                "user_type": "registered",
                                "display_name": "\u041f\u0430\u0432\u0435\u043b \u0418\u0432\u0430\u043d\u043e\u0432"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1463485370,
                            "post_id": 16696317,
                            "comment_id": 62075644,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment62075644_16696317",
                            "body": "@paus Double check what you provide as a link. If Dropbox adds something into url (or redirect to other url) you can easy remove it. Just change how you set  local_filename  variable."
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 263886,
                                "reputation": 641,
                                "user_id": 549765,
                                "user_type": "registered",
                                "display_name": "y0prst"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1463485785,
                            "post_id": 16696317,
                            "comment_id": 62075933,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment62075933_16696317",
                            "body": "@y0prst Plz put your attention on the comment &quot;filter out keep-alive new chunks&quot; for this line. If you download file with size in several GBs it makes total sense."
                        },
                        {
                            "owner": {
                                "account_id": 263886,
                                "reputation": 641,
                                "user_id": 549765,
                                "user_type": "registered",
                                "display_name": "y0prst"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1463812763,
                            "post_id": 16696317,
                            "comment_id": 62233729,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment62233729_16696317",
                            "body": "@RomanPodlinov I&#39;m not familiar with the term &quot;keep-alive new chunks&quot;. Can you explain it a bit further? There are keep-alive (persistent) connections (when several HTTP requests are contained in a single TCP connection) and chunked responses (when there is not Content-Length header and content is divided into chunks, the last one is zero-length). AFAIK, these two features are independent, they have nothing in common."
                        },
                        {
                            "owner": {
                                "account_id": 263886,
                                "reputation": 641,
                                "user_id": 549765,
                                "user_type": "registered",
                                "display_name": "y0prst"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1463813493,
                            "post_id": 16696317,
                            "comment_id": 62233889,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment62233889_16696317",
                            "body": "@RomanPodlinov Another point: iter_content() always yields string. There is nothing wrong with writing an empty string to file, right. So, why we should check the length?"
                        },
                        {
                            "owner": {
                                "account_id": 263886,
                                "reputation": 641,
                                "user_id": 549765,
                                "user_type": "registered",
                                "display_name": "y0prst"
                            },
                            "edited": false,
                            "score": 6,
                            "creation_date": 1463813953,
                            "post_id": 16696317,
                            "comment_id": 62233981,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment62233981_16696317",
                            "body": "@RomanPodlinov And one more point, sorry :) After reading iter_content() sources I&#39;ve concluded that it cannot ever yield an empty string: there are emptiness checks everywhere. The main logic here: <a href=\"https://github.com/kennethreitz/requests/blob/master/requests/packages/urllib3/response.py#L332\" rel=\"nofollow noreferrer\">requests/packages/urllib3/response.py</a>."
                        },
                        {
                            "owner": {
                                "account_id": 6838505,
                                "reputation": 395,
                                "user_id": 5279817,
                                "user_type": "registered",
                                "display_name": "stek29"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1471426341,
                            "post_id": 16696317,
                            "comment_id": 65337608,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment65337608_16696317",
                            "body": "But why not <code>shutil.copyfileobj</code>?"
                        },
                        {
                            "owner": {
                                "account_id": 1264173,
                                "reputation": 1916,
                                "user_id": 1221842,
                                "user_type": "registered",
                                "display_name": "Reishin"
                            },
                            "reply_to_user": {
                                "account_id": 6838505,
                                "reputation": 395,
                                "user_id": 5279817,
                                "user_type": "registered",
                                "display_name": "stek29"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1474367850,
                            "post_id": 16696317,
                            "comment_id": 66492547,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment66492547_16696317",
                            "body": "@stek29 coz response and response.iter_content is not file-like object?"
                        },
                        {
                            "owner": {
                                "account_id": 1264173,
                                "reputation": 1916,
                                "user_id": 1221842,
                                "user_type": "registered",
                                "display_name": "Reishin"
                            },
                            "reply_to_user": {
                                "account_id": 6838505,
                                "reputation": 395,
                                "user_id": 5279817,
                                "user_type": "registered",
                                "display_name": "stek29"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1474369383,
                            "post_id": 16696317,
                            "comment_id": 66493530,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment66493530_16696317",
                            "body": "@stek29 Example with <code>shutil.copyfileobj</code> is below by using Response.raw"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 263886,
                                "reputation": 641,
                                "user_id": 549765,
                                "user_type": "registered",
                                "display_name": "y0prst"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1475334844,
                            "post_id": 16696317,
                            "comment_id": 66907693,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment66907693_16696317",
                            "body": "@y0prst  &quot;I&#39;m not familiar with the term &quot;keep-alive new chunks&quot;.&quot; On the one hand I don&#39;t know who added this comment into thew code, on the other hand you change my words. This line of code removes empty chunks which appears from time to time probably because of keep-alive requests during download"
                        },
                        {
                            "owner": {
                                "account_id": 4893053,
                                "reputation": 1267,
                                "user_id": 3943552,
                                "user_type": "registered",
                                "accept_rate": 63,
                                "display_name": "jkarimi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1495844012,
                            "post_id": 16696317,
                            "comment_id": 75435526,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment75435526_16696317",
                            "body": "@RomanPodlinov in regards to the &quot;keep-alive chunks&quot; check that you and y0prst were discussing; was the conclusion that it is unnecessary because requests never returns an empty string thanks to internal checks?"
                        },
                        {
                            "owner": {
                                "account_id": 4893053,
                                "reputation": 1267,
                                "user_id": 3943552,
                                "user_type": "registered",
                                "accept_rate": 63,
                                "display_name": "jkarimi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1495844552,
                            "post_id": 16696317,
                            "comment_id": 75435616,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment75435616_16696317",
                            "body": "@RomanPodlinov this line seems to suggest so at least in the case of &#39;file-like objects&#39;: <a href=\"https://github.com/kennethreitz/requests/blob/84099eea9f99168b73ff48270dcab24e5a1ee959/requests/models.py#L750\" rel=\"nofollow noreferrer\">github.com/kennethreitz/requests/blob/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 4292949,
                                "reputation": 905,
                                "user_id": 3508811,
                                "user_type": "registered",
                                "accept_rate": 30,
                                "display_name": "user3508811"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1538613338,
                            "post_id": 16696317,
                            "comment_id": 92207765,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment92207765_16696317",
                            "body": "@for a 5GB file above code is taking forever, what would be the ideal chunk size to use in this case?anything we can do to improve the speed of downloading"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 4292949,
                                "reputation": 905,
                                "user_id": 3508811,
                                "user_type": "registered",
                                "accept_rate": 30,
                                "display_name": "user3508811"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1539859421,
                            "post_id": 16696317,
                            "comment_id": 92657958,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment92657958_16696317",
                            "body": "@user3508811 In your case I recommend to use my small lib <a href=\"https://github.com/keepitsimple/pyFTPclient\" rel=\"nofollow noreferrer\">github.com/keepitsimple/pyFTPclient</a> it can reconnect and use multiple simultaneous connections for download. I used this small lib for downloading files of size 1-10 GBs"
                        },
                        {
                            "owner": {
                                "account_id": 4292949,
                                "reputation": 905,
                                "user_id": 3508811,
                                "user_type": "registered",
                                "accept_rate": 30,
                                "display_name": "user3508811"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1540749640,
                            "post_id": 16696317,
                            "comment_id": 92969093,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment92969093_16696317",
                            "body": "@RomanPodlinov - I couldn&#39;t;t adapt pyFTPclien to download from a link, lets say <code>https:&#47;&#47;hostname.company.com&#47;ui&#47;containers&#47;9888577</code> ,how would the following lines change  to download from a link <code>obj = PyFTPclient(&#39;192.168.0.59&#39;, 2121, &#39;test&#39;, &#39;testftp&#39;)     obj.DownloadFile(&#39;USAHD-8974-20131013-0300-0330.ts&#39;)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 4292949,
                                "reputation": 905,
                                "user_id": 3508811,
                                "user_type": "registered",
                                "accept_rate": 30,
                                "display_name": "user3508811"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1541786848,
                            "post_id": 16696317,
                            "comment_id": 93349059,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment93349059_16696317",
                            "body": "@user3508811 pyFTPclient was implemented for FTP protocol."
                        },
                        {
                            "owner": {
                                "account_id": 3101115,
                                "reputation": 469,
                                "user_id": 2625222,
                                "user_type": "registered",
                                "display_name": "synweap15"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1544601948,
                            "post_id": 16696317,
                            "comment_id": 94329599,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment94329599_16696317",
                            "body": "And remember flush after the writing to a file with <code>stream=True</code> if you&#39;re trying to get hash / size of the files right after the download - you may be missing a few (hundreds) bytes if you don&#39;t ."
                        },
                        {
                            "owner": {
                                "account_id": 3482858,
                                "reputation": 607,
                                "user_id": 2914451,
                                "user_type": "registered",
                                "accept_rate": 45,
                                "display_name": "newbie"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1545774144,
                            "post_id": 16696317,
                            "comment_id": 94693105,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment94693105_16696317",
                            "body": "How do you know this is not occupying lots of memory? Looking at the process monitor? When I run:  import sys print(sys.getsizeof(r.text))  I get the same size outputted whether I use your stream code above or not"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1546534786,
                            "post_id": 16696317,
                            "comment_id": 94889604,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment94889604_16696317",
                            "body": "@newbieI don&#39;t know what OS do you use. I use <code>htop</code> under Linux or <code>Process Monitor</code> from SysInternals.com under Windows"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "reply_to_user": {
                                "account_id": 1644473,
                                "reputation": 13383,
                                "user_id": 2456263,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "0xcaff"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1588757622,
                            "post_id": 16696317,
                            "comment_id": 109018651,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment109018651_16696317",
                            "body": "to @0xcaff &quot;Don&#39;t forget to close the connection with r.close()&quot; - No. it&#39;s wrong. <code>with</code> will close connection automatically"
                        },
                        {
                            "owner": {
                                "account_id": 1644473,
                                "reputation": 13383,
                                "user_id": 2456263,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "0xcaff"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1588792314,
                            "post_id": 16696317,
                            "comment_id": 109039188,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment109039188_16696317",
                            "body": "@RomanPodlinov It was not using <code>with</code> when I made this comment."
                        },
                        {
                            "owner": {
                                "account_id": 13774587,
                                "reputation": 2956,
                                "user_id": 11814996,
                                "user_type": "registered",
                                "display_name": "Naveen Reddy Marthala"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1592714673,
                            "post_id": 16696317,
                            "comment_id": 110520930,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment110520930_16696317",
                            "body": "I can&#39;t download a zip file of 221MB. The downloaded file size maxes out at 219KB every time i tried this code."
                        },
                        {
                            "owner": {
                                "account_id": 1091241,
                                "reputation": 3800,
                                "user_id": 1085848,
                                "user_type": "registered",
                                "accept_rate": 47,
                                "display_name": "TomSawyer"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1599723273,
                            "post_id": 16696317,
                            "comment_id": 112862934,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment112862934_16696317",
                            "body": "what if i use <code>f=requests.get(url, stream=True)</code> then <code>for chunk in f.iter_content(chunk_size=8192)</code> without using <code>with</code>, would it work?"
                        },
                        {
                            "owner": {
                                "account_id": 3396564,
                                "reputation": 417,
                                "user_id": 3112791,
                                "user_type": "registered",
                                "accept_rate": 0,
                                "display_name": "Pavel Angel Mendoza Villafane"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1609176748,
                            "post_id": 16696317,
                            "comment_id": 115768786,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment115768786_16696317",
                            "body": "@RomanPodlinov is it right to write directly to disk?. That is, 8192 or 512*1024 bytes are not so bigger then for a 100mb file this will do too much &quot;write&quot; operations.. could be this an issue? how can I handle it?"
                        },
                        {
                            "owner": {
                                "account_id": 16901071,
                                "reputation": 175,
                                "user_id": 12222439,
                                "user_type": "registered",
                                "display_name": "Jis Mathew"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1614278207,
                            "post_id": 16696317,
                            "comment_id": 117344063,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment117344063_16696317",
                            "body": "how can i write the same for post method"
                        },
                        {
                            "owner": {
                                "account_id": 8213620,
                                "reputation": 919,
                                "user_id": 6180818,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "hellojoshhhy"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1647571901,
                            "post_id": 16696317,
                            "comment_id": 126410609,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment126410609_16696317",
                            "body": "i would suggest <code>os.path.basename(url)</code> to get filename"
                        },
                        {
                            "owner": {
                                "account_id": 2840516,
                                "reputation": 1,
                                "user_id": 7512445,
                                "user_type": "registered",
                                "display_name": "deadcow"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1674674675,
                            "post_id": 16696317,
                            "comment_id": 132767420,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#comment132767420_16696317",
                            "body": "so <code>if &#39;transfer-encoding&#39; in r.headers.keys():    if &#39;chunked&#39; in r.headers[&#39;transer-encoding&#39;]: chunk_size = none</code>"
                        }
                    ],
                    "owner": {
                        "account_id": 188633,
                        "reputation": 24406,
                        "user_id": 427457,
                        "user_type": "registered",
                        "accept_rate": 58,
                        "display_name": "Roman Podlinov"
                    },
                    "comment_count": 41,
                    "is_accepted": true,
                    "score": 979,
                    "last_activity_date": 1610650972,
                    "last_edit_date": 1610650972,
                    "creation_date": 1369237960,
                    "answer_id": 16696317,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/16696317#16696317",
                    "body": "<p>With the following streaming code, the Python memory usage is restricted regardless of the size of the downloaded file:</p>\n<pre><code>def download_file(url):\n    local_filename = url.split('/')[-1]\n    # NOTE the stream=True parameter below\n    with requests.get(url, stream=True) as r:\n        r.raise_for_status()\n        with open(local_filename, 'wb') as f:\n            for chunk in r.iter_content(chunk_size=8192): \n                # If you have chunk encoded response uncomment if\n                # and set chunk_size parameter to None.\n                #if chunk: \n                f.write(chunk)\n    return local_filename\n</code></pre>\n<p>Note that the number of bytes returned using <code>iter_content</code> is not exactly the <code>chunk_size</code>; it's expected to be a random number that is often far bigger, and is expected to be different in every iteration.</p>\n<p>See <a href=\"https://requests.readthedocs.io/en/latest/user/advanced/#body-content-workflow\" rel=\"noreferrer\">body-content-workflow</a> and <a href=\"https://requests.readthedocs.io/en/latest/api/#requests.Response.iter_content\" rel=\"noreferrer\">Response.iter_content</a> for further reference.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 479704,
                                "reputation": 5882,
                                "user_id": 892534,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "ChrisP"
                            },
                            "edited": false,
                            "score": 21,
                            "creation_date": 1475111727,
                            "post_id": 39217788,
                            "comment_id": 66815596,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment66815596_39217788",
                            "body": "Note that you may need to adjust when <a href=\"https://github.com/kennethreitz/requests/issues/2155\" rel=\"nofollow noreferrer\">streaming gzipped responses</a> per issue 2155."
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1475335058,
                            "post_id": 39217788,
                            "comment_id": 66907782,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment66907782_39217788",
                            "body": "Have you tested this code for big files download &gt;1gb?"
                        },
                        {
                            "owner": {
                                "account_id": 188633,
                                "reputation": 24406,
                                "user_id": 427457,
                                "user_type": "registered",
                                "accept_rate": 58,
                                "display_name": "Roman Podlinov"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1482955799,
                            "post_id": 39217788,
                            "comment_id": 69939590,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment69939590_39217788",
                            "body": "Yes I did. most of files were &gt; 1GB. the code was downloading a bunch of video files on daily basis"
                        },
                        {
                            "owner": {
                                "account_id": 3148491,
                                "reputation": 503,
                                "user_id": 2662454,
                                "user_type": "registered",
                                "display_name": "visoft"
                            },
                            "edited": false,
                            "score": 82,
                            "creation_date": 1499843123,
                            "post_id": 39217788,
                            "comment_id": 77074794,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment77074794_39217788",
                            "body": "THIS should be the correct answer! The <a href=\"https://stackoverflow.com/a/16696317/2662454\">accepted</a> answer gets you up to 2-3MB/s. Using copyfileobj gets you to ~40MB/s. Curl downloads (same machines, same url, etc) with ~50-55 MB/s."
                        },
                        {
                            "owner": {
                                "account_id": 9146111,
                                "reputation": 4459,
                                "user_id": 6802252,
                                "user_type": "registered",
                                "accept_rate": 79,
                                "display_name": "Moondra"
                            },
                            "reply_to_user": {
                                "account_id": 3148491,
                                "reputation": 503,
                                "user_id": 2662454,
                                "user_type": "registered",
                                "display_name": "visoft"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1505921068,
                            "post_id": 39217788,
                            "comment_id": 79612759,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment79612759_39217788",
                            "body": "@visoft how did you check the download speeds?"
                        },
                        {
                            "owner": {
                                "account_id": 3148491,
                                "reputation": 503,
                                "user_id": 2662454,
                                "user_type": "registered",
                                "display_name": "visoft"
                            },
                            "reply_to_user": {
                                "account_id": 9146111,
                                "reputation": 4459,
                                "user_id": 6802252,
                                "user_type": "registered",
                                "accept_rate": 79,
                                "display_name": "Moondra"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1506242014,
                            "post_id": 39217788,
                            "comment_id": 79733941,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment79733941_39217788",
                            "body": "@Moondra From python, dividing the download time vs the file size. I used fairily larg files (100M-2G) over a gigabit connection. The server was more or less in the same network/datacenter."
                        },
                        {
                            "owner": {
                                "account_id": 10631529,
                                "reputation": 2004,
                                "user_id": 7829525,
                                "user_type": "registered",
                                "accept_rate": 20,
                                "display_name": "Eric Cousineau"
                            },
                            "edited": false,
                            "score": 7,
                            "creation_date": 1513472593,
                            "post_id": 39217788,
                            "comment_id": 82667110,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment82667110_39217788",
                            "body": "A small caveat for using <code>.raw</code> is that it does not handle decoding. Mentioned in the docs here: <a href=\"http://docs.python-requests.org/en/master/user/quickstart/#raw-response-content\" rel=\"nofollow noreferrer\">docs.python-requests.org/en/master/user/quickstart/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 2114516,
                                "reputation": 14072,
                                "user_id": 1879101,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Vitaly Zdanevich"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1523375545,
                            "post_id": 39217788,
                            "comment_id": 86530960,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment86530960_39217788",
                            "body": "Is it possible to stream to stdout through the <code>print</code>?"
                        },
                        {
                            "owner": {
                                "account_id": 3057,
                                "reputation": 244987,
                                "user_id": 4323,
                                "user_type": "registered",
                                "accept_rate": 82,
                                "display_name": "John Zwinck"
                            },
                            "reply_to_user": {
                                "account_id": 2114516,
                                "reputation": 14072,
                                "user_id": 1879101,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Vitaly Zdanevich"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1523415573,
                            "post_id": 39217788,
                            "comment_id": 86547101,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment86547101_39217788",
                            "body": "@VitalyZdanevich: Try <code>shutil.copyfileobj(r.raw, sys.stdout)</code>."
                        },
                        {
                            "owner": {
                                "account_id": 387856,
                                "reputation": 532,
                                "user_id": 746453,
                                "user_type": "registered",
                                "accept_rate": 67,
                                "display_name": "Jan Benes"
                            },
                            "reply_to_user": {
                                "account_id": 3148491,
                                "reputation": 503,
                                "user_id": 2662454,
                                "user_type": "registered",
                                "display_name": "visoft"
                            },
                            "edited": false,
                            "score": 6,
                            "creation_date": 1533907028,
                            "post_id": 39217788,
                            "comment_id": 90532010,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment90532010_39217788",
                            "body": "@visoft I was able to match the download speeds between <code>raw</code> and <code>iter_content</code> after I increased <code>chunk_size</code> from <code>1024</code> to <code>10*1024</code> (debian ISO, regular connection)"
                        },
                        {
                            "owner": {
                                "account_id": 2495633,
                                "reputation": 241,
                                "user_id": 2172133,
                                "user_type": "registered",
                                "display_name": "theferrit32"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1547579705,
                            "post_id": 39217788,
                            "comment_id": 95237583,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment95237583_39217788",
                            "body": "The issue with the accepted answer is the chunk size. If you have a sufficiently fast connection, 1KiB is too small, you spend too much time on overhead compared to transferring data. <code>shutil.copyfileobj</code> defaults to 16KiB chunks. Increasing the chunk size from 1KiB will almost certainly increase download rate, but don&#39;t increase too much. I am using 1MiB chunks and it works well, it approaches full bandwidth usage. You could try to monitor connection rate and adjust chunk size based on it, but beware premature optimization."
                        },
                        {
                            "owner": {
                                "account_id": 4661280,
                                "reputation": 5118,
                                "user_id": 3775493,
                                "user_type": "registered",
                                "display_name": "Nuno Andr&#233;"
                            },
                            "reply_to_user": {
                                "account_id": 10631529,
                                "reputation": 2004,
                                "user_id": 7829525,
                                "user_type": "registered",
                                "accept_rate": 20,
                                "display_name": "Eric Cousineau"
                            },
                            "edited": false,
                            "score": 13,
                            "creation_date": 1548592795,
                            "post_id": 39217788,
                            "comment_id": 95588469,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment95588469_39217788",
                            "body": "@EricCousineau You can patch up this behaviour <a href=\"https://github.com/requests/requests/issues/2155#issuecomment-50771010\" rel=\"nofollow noreferrer\">replacing the <code>read</code> method: <code>response.raw.read = functools.partial(response.raw.read, decode_content=True)</code></a>"
                        },
                        {
                            "owner": {
                                "account_id": 441885,
                                "reputation": 60711,
                                "user_id": 832230,
                                "user_type": "registered",
                                "display_name": "Asclepius"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1549926033,
                            "post_id": 39217788,
                            "comment_id": 96072742,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment96072742_39217788",
                            "body": "Is there any way to limit the streaming read here to a max value, say 128 KiB?"
                        },
                        {
                            "owner": {
                                "account_id": 10200,
                                "reputation": 24503,
                                "user_id": 19163,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "vog"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1559826913,
                            "post_id": 39217788,
                            "comment_id": 99547090,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment99547090_39217788",
                            "body": "Meanwhile it&#39;s 2019. I took the freedom to edit the missing @with requests.get(url, stream=True) as r:@ into the answer. There&#39;s no reason not to use it."
                        },
                        {
                            "owner": {
                                "account_id": 6793418,
                                "reputation": 1745,
                                "user_id": 5229658,
                                "user_type": "registered",
                                "display_name": "Max"
                            },
                            "reply_to_user": {
                                "account_id": 10200,
                                "reputation": 24503,
                                "user_id": 19163,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "vog"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1560202751,
                            "post_id": 39217788,
                            "comment_id": 99650823,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment99650823_39217788",
                            "body": "@vog, the source code (at least, in the latest requests) already includes the with statement <code>with sessions.Session() as session: return session.request(method=method, url=url, **kwargs)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 3781739,
                                "reputation": 5134,
                                "user_id": 3140992,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "citynorman"
                            },
                            "edited": false,
                            "score": 5,
                            "creation_date": 1581114441,
                            "post_id": 39217788,
                            "comment_id": 106335324,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment106335324_39217788",
                            "body": "Adding length param got me better download speeds <code>shutil.copyfileobj(r.raw, f, length=16*1024*1024)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 84539,
                                "reputation": 9616,
                                "user_id": 236247,
                                "user_type": "registered",
                                "accept_rate": 86,
                                "display_name": "demongolem"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1586879702,
                            "post_id": 39217788,
                            "comment_id": 108288320,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment108288320_39217788",
                            "body": "For me, I got back an appropriate sized object, but my machine told me the file was corrupt.  I am working with pdf files and no application can open what I just downloaded."
                        },
                        {
                            "owner": {
                                "account_id": 6638887,
                                "reputation": 1216,
                                "user_id": 5125264,
                                "user_type": "registered",
                                "accept_rate": 71,
                                "display_name": "Matt"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1592844014,
                            "post_id": 39217788,
                            "comment_id": 110564179,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment110564179_39217788",
                            "body": "just gonna bump this because this was so FAST and simple to download multiple 1GB+ files compared to others"
                        },
                        {
                            "owner": {
                                "account_id": 1361091,
                                "reputation": 6051,
                                "user_id": 1298461,
                                "user_type": "registered",
                                "accept_rate": 89,
                                "display_name": "KIC"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1613126794,
                            "post_id": 39217788,
                            "comment_id": 116985999,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment116985999_39217788",
                            "body": "for me this results in an invalid tarball: <code>gzip: stdin: not in gzip format</code> but if I download it via browser the tar format is gzip."
                        },
                        {
                            "owner": {
                                "account_id": 206944,
                                "reputation": 11114,
                                "user_id": 456550,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "Christian Long"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1620426984,
                            "post_id": 39217788,
                            "comment_id": 119206719,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment119206719_39217788",
                            "body": "Updated link to github <a href=\"https://github.com/psf/requests/issues/2155\" rel=\"nofollow noreferrer\">issue 2155</a> about streaming gzipped responses (the link in ChrisP&#39;s answer no longer works)."
                        },
                        {
                            "owner": {
                                "account_id": 439526,
                                "reputation": 1488,
                                "user_id": 1295595,
                                "user_type": "registered",
                                "accept_rate": 55,
                                "display_name": "craq"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1633998624,
                            "post_id": 39217788,
                            "comment_id": 122903513,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment122903513_39217788",
                            "body": "it seems to me that <code>shutil.copyfileobj</code> is returning before the download is complete. Is there a way of blocking until the file has completely downloaded?"
                        },
                        {
                            "owner": {
                                "account_id": 3057,
                                "reputation": 244987,
                                "user_id": 4323,
                                "user_type": "registered",
                                "accept_rate": 82,
                                "display_name": "John Zwinck"
                            },
                            "reply_to_user": {
                                "account_id": 439526,
                                "reputation": 1488,
                                "user_id": 1295595,
                                "user_type": "registered",
                                "accept_rate": 55,
                                "display_name": "craq"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1634262567,
                            "post_id": 39217788,
                            "comment_id": 122983764,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment122983764_39217788",
                            "body": "@craq Are you perhaps seeing some delay in your filesystem?  <code>shutil.copyfileobj</code> doesn&#39;t exactly return before completion, but your filesystem may have some delay before readers observe the file being completely written."
                        },
                        {
                            "owner": {
                                "account_id": 439526,
                                "reputation": 1488,
                                "user_id": 1295595,
                                "user_type": "registered",
                                "accept_rate": 55,
                                "display_name": "craq"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1634274228,
                            "post_id": 39217788,
                            "comment_id": 122985670,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment122985670_39217788",
                            "body": "@JohnZwinck yes that could be it. I couldn&#39;t figure out an elegant way to check that the full file had been written, but I haven&#39;t seen any issues since I added a simple sleep."
                        },
                        {
                            "owner": {
                                "account_id": 3277873,
                                "reputation": 1153,
                                "user_id": 2759316,
                                "user_type": "registered",
                                "accept_rate": 53,
                                "display_name": "Source Matters"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1650516084,
                            "post_id": 39217788,
                            "comment_id": 127136909,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment127136909_39217788",
                            "body": "I like this approach better, but how would I implement tqdm with this one?"
                        },
                        {
                            "owner": {
                                "account_id": 3057,
                                "reputation": 244987,
                                "user_id": 4323,
                                "user_type": "registered",
                                "accept_rate": 82,
                                "display_name": "John Zwinck"
                            },
                            "reply_to_user": {
                                "account_id": 3277873,
                                "reputation": 1153,
                                "user_id": 2759316,
                                "user_type": "registered",
                                "accept_rate": 53,
                                "display_name": "Source Matters"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1650693456,
                            "post_id": 39217788,
                            "comment_id": 127185069,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#comment127185069_39217788",
                            "body": "@SourceMatters: if a progress bar is important to you, this solution won&#39;t be the most straightforward."
                        }
                    ],
                    "owner": {
                        "account_id": 3057,
                        "reputation": 244987,
                        "user_id": 4323,
                        "user_type": "registered",
                        "accept_rate": 82,
                        "display_name": "John Zwinck"
                    },
                    "comment_count": 25,
                    "is_accepted": false,
                    "score": 544,
                    "last_activity_date": 1666956688,
                    "last_edit_date": 1666956688,
                    "creation_date": 1472523198,
                    "answer_id": 39217788,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/39217788#39217788",
                    "body": "<p>It's much easier if you use <a href=\"https://requests.readthedocs.io/en/latest/api/#requests.Response.raw\" rel=\"noreferrer\"><code>Response.raw</code></a> and <a href=\"https://docs.python.org/3/library/shutil.html#shutil.copyfileobj\" rel=\"noreferrer\"><code>shutil.copyfileobj()</code></a>:</p>\n<pre><code>import requests\nimport shutil\n\ndef download_file(url):\n    local_filename = url.split('/')[-1]\n    with requests.get(url, stream=True) as r:\n        with open(local_filename, 'wb') as f:\n            shutil.copyfileobj(r.raw, f)\n\n    return local_filename\n</code></pre>\n<p>This streams the file to disk without using excessive memory, and the code is simple.</p>\n<p>Note: According to the <a href=\"https://requests.readthedocs.io/en/latest/user/quickstart/#raw-response-content\" rel=\"noreferrer\">documentation</a>, <code>Response.raw</code> will <em>not</em> decode <code>gzip</code> and <code>deflate</code> transfer-encodings, so you will need to do this manually.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 980790,
                                "reputation": 8206,
                                "user_id": 1000551,
                                "user_type": "registered",
                                "display_name": "Vadim Kotov"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1523283575,
                            "post_id": 44378512,
                            "comment_id": 86484181,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/44378512#comment86484181_44378512",
                            "body": "For Python 2.x, use <code>from urllib import urlretrieve</code>"
                        },
                        {
                            "owner": {
                                "account_id": 158078,
                                "reputation": 5163,
                                "user_id": 376454,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "Wok"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1649417333,
                            "post_id": 44378512,
                            "comment_id": 126875892,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/44378512#comment126875892_44378512",
                            "body": "This function &quot;might become deprecated at some point in the future.&quot; cf. <a href=\"https://docs.python.org/3/library/urllib.request.html#legacy-interface\" rel=\"nofollow noreferrer\">docs.python.org/3/library/urllib.request.html#legacy-interfa&zwnj;&#8203;ce</a>"
                        }
                    ],
                    "owner": {
                        "account_id": 21554,
                        "reputation": 17750,
                        "user_id": 52499,
                        "user_type": "registered",
                        "accept_rate": 83,
                        "display_name": "x-yuri"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 114,
                    "last_activity_date": 1654043404,
                    "last_edit_date": 1654043404,
                    "creation_date": 1496700825,
                    "answer_id": 44378512,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/44378512#44378512",
                    "body": "<p>Not exactly what OP was asking, but... it's ridiculously easy to do that with <code>urllib</code>:</p>\n<pre><code>from urllib.request import urlretrieve\n\nurl = 'http://mirror.pnl.gov/releases/16.04.2/ubuntu-16.04.2-desktop-amd64.iso'\ndst = 'ubuntu-16.04.2-desktop-amd64.iso'\nurlretrieve(url, dst)\n</code></pre>\n<p>Or this way, if you want to save it to a temporary file:</p>\n<pre><code>from urllib.request import urlopen\nfrom shutil import copyfileobj\nfrom tempfile import NamedTemporaryFile\n\nurl = 'http://mirror.pnl.gov/releases/16.04.2/ubuntu-16.04.2-desktop-amd64.iso'\nwith urlopen(url) as fsrc, NamedTemporaryFile(delete=False) as fdst:\n    copyfileobj(fsrc, fdst)\n</code></pre>\n<p>I watched the process:</p>\n<pre><code>watch 'ps -p 18647 -o pid,ppid,pmem,rsz,vsz,comm,args; ls -al *.iso'\n</code></pre>\n<p>And I saw the file growing, but memory usage stayed at 17 MB. Am I missing something?</p>\n"
                },
                {
                    "owner": {
                        "account_id": 4148725,
                        "reputation": 196,
                        "user_id": 3401771,
                        "user_type": "registered",
                        "display_name": "Ben Moskovitch"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 10,
                    "last_activity_date": 1593969342,
                    "creation_date": 1593969342,
                    "answer_id": 62743933,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/62743933#62743933",
                    "body": "<p>Based on the Roman's most upvoted comment above, here is my implementation,\nIncluding &quot;download as&quot; and &quot;retries&quot; mechanism:</p>\n<pre><code>def download(url: str, file_path='', attempts=2):\n    &quot;&quot;&quot;Downloads a URL content into a file (with large file support by streaming)\n\n    :param url: URL to download\n    :param file_path: Local file name to contain the data downloaded\n    :param attempts: Number of attempts\n    :return: New file path. Empty string if the download failed\n    &quot;&quot;&quot;\n    if not file_path:\n        file_path = os.path.realpath(os.path.basename(url))\n    logger.info(f'Downloading {url} content to {file_path}')\n    url_sections = urlparse(url)\n    if not url_sections.scheme:\n        logger.debug('The given url is missing a scheme. Adding http scheme')\n        url = f'http://{url}'\n        logger.debug(f'New url: {url}')\n    for attempt in range(1, attempts+1):\n        try:\n            if attempt &gt; 1:\n                time.sleep(10)  # 10 seconds wait time between downloads\n            with requests.get(url, stream=True) as response:\n                response.raise_for_status()\n                with open(file_path, 'wb') as out_file:\n                    for chunk in response.iter_content(chunk_size=1024*1024):  # 1MB chunks\n                        out_file.write(chunk)\n                logger.info('Download finished successfully')\n                return file_path\n        except Exception as ex:\n            logger.error(f'Attempt #{attempt} failed with error: {ex}')\n    return ''\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 452570,
                                "reputation": 8406,
                                "user_id": 849076,
                                "user_type": "registered",
                                "accept_rate": 77,
                                "display_name": "leo"
                            },
                            "edited": false,
                            "score": 11,
                            "creation_date": 1670416671,
                            "post_id": 64421052,
                            "comment_id": 131870945,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/64421052#comment131870945_64421052",
                            "body": "This is a very old an unmaitained module."
                        },
                        {
                            "owner": {
                                "account_id": 5296,
                                "reputation": 15123,
                                "user_id": 8438,
                                "user_type": "registered",
                                "accept_rate": 84,
                                "display_name": "shacker"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1686097232,
                            "post_id": 64421052,
                            "comment_id": 134751609,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/64421052#comment134751609_64421052",
                            "body": "The OP is specifically asking how to do it in python with requests. Jumping out of python space is not usually an option."
                        }
                    ],
                    "owner": {
                        "user_type": "does_not_exist",
                        "display_name": "user14475672"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 12,
                    "last_activity_date": 1603080585,
                    "creation_date": 1603080585,
                    "answer_id": 64421052,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/64421052#64421052",
                    "body": "<p>use <code>wget</code> module of python instead. Here is a snippet</p>\n<pre><code>import wget\nwget.download(url)\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 2307073,
                                "reputation": 411,
                                "user_id": 4558755,
                                "user_type": "registered",
                                "display_name": "tuxillo"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1650579485,
                            "post_id": 69419526,
                            "comment_id": 127158739,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/69419526#comment127158739_69419526",
                            "body": "I&#39;m curious what&#39;s the advantange of using this instead of a higher level (and well tested) method from libs like requests?"
                        },
                        {
                            "owner": {
                                "account_id": 20030933,
                                "reputation": 441,
                                "user_id": 14683725,
                                "user_type": "registered",
                                "display_name": "r1v3n"
                            },
                            "reply_to_user": {
                                "account_id": 2307073,
                                "reputation": 411,
                                "user_id": 4558755,
                                "user_type": "registered",
                                "display_name": "tuxillo"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1651957254,
                            "post_id": 69419526,
                            "comment_id": 127490857,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/69419526#comment127490857_69419526",
                            "body": "Libs like requests are full of abstraction above the native sockets. That&#39;s not the best algorithm, but it could be faster because of no abstraction at all."
                        },
                        {
                            "owner": {
                                "account_id": 2774185,
                                "reputation": 1768,
                                "user_id": 2388094,
                                "user_type": "registered",
                                "display_name": "rayzinnz"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1683738610,
                            "post_id": 69419526,
                            "comment_id": 134414200,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/69419526#comment134414200_69419526",
                            "body": "It appears this loads the whole content into memory in the &quot;image&quot; variable, then writes it to a file. How does this work for large files with local memory constraints?"
                        },
                        {
                            "owner": {
                                "account_id": 20030933,
                                "reputation": 441,
                                "user_id": 14683725,
                                "user_type": "registered",
                                "display_name": "r1v3n"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1685608713,
                            "post_id": 69419526,
                            "comment_id": 134684799,
                            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/69419526#comment134684799_69419526",
                            "body": "Yeah, you can just modify this if you want. For example: change the last part with <code>image</code> variable and write to file itself instead of variable"
                        }
                    ],
                    "owner": {
                        "account_id": 20030933,
                        "reputation": 441,
                        "user_id": 14683725,
                        "user_type": "registered",
                        "display_name": "r1v3n"
                    },
                    "comment_count": 4,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1633202343,
                    "creation_date": 1633202343,
                    "answer_id": 69419526,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/69419526#69419526",
                    "body": "<h2><code>requests</code> is good, but how about <code>socket</code> solution?</h2>\n<pre class=\"lang-py prettyprint-override\"><code>def stream_(host):\n    import socket\n    import ssl\n    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:\n        context = ssl.create_default_context(Purpose.CLIENT_AUTH)\n        with context.wrap_socket(sock, server_hostname=host) as wrapped_socket:\n            wrapped_socket.connect((socket.gethostbyname(host), 443))\n            wrapped_socket.send(\n                &quot;GET / HTTP/1.1\\r\\nHost:thiscatdoesnotexist.com\\r\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\r\\n\\r\\n&quot;.encode())\n\n            resp = b&quot;&quot;\n            while resp[-4:-1] != b&quot;\\r\\n\\r&quot;:\n                resp += wrapped_socket.recv(1)\n            else:\n                resp = resp.decode()\n                content_length = int(&quot;&quot;.join([tag.split(&quot; &quot;)[1] for tag in resp.split(&quot;\\r\\n&quot;) if &quot;content-length&quot; in tag.lower()]))\n                image = b&quot;&quot;\n                while content_length &gt; 0:\n                    data = wrapped_socket.recv(2048)\n                    if not data:\n                        print(&quot;EOF&quot;)\n                        break\n                    image += data\n                    content_length -= len(data)\n                with open(&quot;image.jpeg&quot;, &quot;wb&quot;) as file:\n                    file.write(image)\n\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 16805802,
                        "reputation": 562,
                        "user_id": 12150026,
                        "user_type": "registered",
                        "display_name": "J.M."
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1659362033,
                    "creation_date": 1659362033,
                    "answer_id": 73194807,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/73194807#73194807",
                    "body": "<p>Here is additional approach for the use-case of <strong>async chunked download</strong>, without reading all the file content to memory.<br />\nIt means that both read from the URL and the write to file are implemented with <code>asyncio</code> libraries (<code>aiohttp</code> to read from the URL and <code>aiofiles</code> to write the file).</p>\n<p>The following code should work on <code>Python 3.7</code> and later.<br />\nJust edit <code>SRC_URL</code> and <code>DEST_FILE</code> variables before copy and paste.</p>\n<pre><code>import aiofiles\nimport aiohttp\nimport asyncio\n\nasync def async_http_download(src_url, dest_file, chunk_size=65536):\n    async with aiofiles.open(dest_file, 'wb') as fd:\n        async with aiohttp.ClientSession() as session:\n            async with session.get(src_url) as resp:\n                async for chunk in resp.content.iter_chunked(chunk_size):\n                    await fd.write(chunk)\n\nSRC_URL = &quot;/path/to/url&quot;\nDEST_FILE = &quot;/path/to/file/on/local/machine&quot;\n\nasyncio.run(async_http_download(SRC_URL, DEST_FILE))\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 2774185,
                        "reputation": 1768,
                        "user_id": 2388094,
                        "user_type": "registered",
                        "display_name": "rayzinnz"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1683746567,
                    "last_edit_date": 1683746567,
                    "creation_date": 1683746192,
                    "answer_id": 76221896,
                    "question_id": 16694907,
                    "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests/76221896#76221896",
                    "body": "<p>Yet another option for downloading large files. This will allow you to stop and continue later (press the <kbd>Enter</kbd> key to stop), and continue from where you left off if your connection gets dropped otherwise.</p>\n<pre><code>import datetime\nimport os\nimport requests\nimport threading as th\n\nkeep_going = True\ndef key_capture_thread():\n    global keep_going\n    input()\n    keep_going = False\npkey_capture = th.Thread(target=key_capture_thread, args=(), name='key_capture_process', daemon=True).start()\n\ndef download_file(url, local_filepath):\n    #assumptions:\n    #  headers contain Content-Length:\n    #  headers contain Accept-Ranges: bytes\n    #  stream is not encoded (otherwise start bytes are not known, unless this is stored seperately)\n    \n    chunk_size = 1048576 #1MB\n    # chunk_size = 8096 #8KB\n    # chunk_size = 1024 #1KB\n    decoded_bytes_downloaded_this_session = 0\n    start_time = datetime.datetime.now()\n    if os.path.exists(local_filepath):\n        decoded_bytes_downloaded = os.path.getsize(local_filepath)\n    else:\n        decoded_bytes_downloaded = 0\n    with requests.Session() as s:\n        with s.get(url, stream=True) as r:\n            #check for required headers:\n            if 'Content-Length' not in r.headers:\n                print('STOP: request headers do not contain Content-Length')\n                return\n            if ('Accept-Ranges','bytes') not in r.headers.items():\n                print('STOP: request headers do not contain Accept-Ranges: bytes')\n                with s.get(url) as r:\n                    print(str(r.content, encoding='iso-8859-1'))\n                return\n        content_length = int(r.headers['Content-Length'])\n        if decoded_bytes_downloaded&gt;=content_length:\n                print('STOP: file already downloaded. decoded_bytes_downloaded&gt;=r.headers[Content-Length]; {}&gt;={}'.format(decoded_bytes_downloaded,r.headers['Content-Length']))\n                return\n        if decoded_bytes_downloaded&gt;0:\n            s.headers['Range'] = 'bytes={}-{}'.format(decoded_bytes_downloaded, content_length-1) #range is inclusive\n            print('Retrieving byte range (inclusive) {}-{}'.format(decoded_bytes_downloaded, content_length-1))\n        with s.get(url, stream=True) as r:\n            r.raise_for_status()\n            with open(local_filepath, mode='ab') as fwrite:\n                for chunk in r.iter_content(chunk_size=chunk_size):\n                    decoded_bytes_downloaded+=len(chunk)\n                    decoded_bytes_downloaded_this_session+=len(chunk)\n                    time_taken:datetime.timedelta = (datetime.datetime.now() - start_time)\n                    seconds_per_byte = time_taken.total_seconds()/decoded_bytes_downloaded_this_session\n                    remaining_bytes = content_length-decoded_bytes_downloaded\n                    remaining_seconds = seconds_per_byte * remaining_bytes\n                    remaining_time = datetime.timedelta(seconds=remaining_seconds)\n                    #print updated statistics here\n                    fwrite.write(chunk)\n                    if not keep_going:\n                        break\n\noutput_folder = '/mnt/HDD1TB/DownloadsBIG'\n\n# url = 'https://file-examples.com/storage/fea508993d645be1b98bfcf/2017/10/file_example_JPG_100kB.jpg'\n# url = 'https://file-examples.com/storage/fe563fce08645a90397f28d/2017/10/file_example_JPG_2500kB.jpg'\nurl = 'https://ftp.ncbi.nlm.nih.gov/blast/db/nr.00.tar.gz'\n\nlocal_filepath = os.path.join(output_folder, os.path.split(url)[-1])\n\ndownload_file(url, local_filepath)\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 188633,
                "reputation": 24406,
                "user_id": 427457,
                "user_type": "registered",
                "accept_rate": 58,
                "display_name": "Roman Podlinov"
            },
            "comment_count": 1,
            "is_answered": true,
            "accepted_answer_id": 16696317,
            "answer_count": 9,
            "score": 622,
            "last_activity_date": 1683746567,
            "creation_date": 1369234057,
            "last_edit_date": 1652998511,
            "question_id": 16694907,
            "link": "https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests",
            "title": "Download large file in python with requests",
            "body": "<p><a href=\"https://requests.readthedocs.io/\" rel=\"noreferrer\">Requests</a> is a really nice library. I'd like to use it for downloading big files (&gt;1GB).\nThe problem is it's not possible to keep whole file in memory; I need to read it in chunks. And this is a problem with the following code:</p>\n<pre><code>import requests\n\ndef DownloadFile(url)\n    local_filename = url.split('/')[-1]\n    r = requests.get(url)\n    f = open(local_filename, 'wb')\n    for chunk in r.iter_content(chunk_size=512 * 1024): \n        if chunk: # filter out keep-alive new chunks\n            f.write(chunk)\n    f.close()\n    return \n</code></pre>\n<p>For some reason it doesn't work this way; it still loads the response into memory before it is saved to a file.</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 9657
}