{
    "items": [
        {
            "tags": [
                "python",
                "scipy",
                "interpolation",
                "spline",
                "cubic-spline"
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 2501194,
                                "reputation": 56,
                                "user_id": 2822179,
                                "user_type": "registered",
                                "display_name": "cwhy"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1481288103,
                            "post_id": 31544486,
                            "comment_id": 69328272,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/31544486#comment69328272_31544486",
                            "body": "You can avoid calculate the spline every time you call the function by moving <code>tck = interpolate.splrep(x_points, y_points)</code> and the two lines above outside of f(x)."
                        },
                        {
                            "owner": {
                                "account_id": 332245,
                                "reputation": 16679,
                                "user_id": 657427,
                                "user_type": "registered",
                                "accept_rate": 67,
                                "display_name": "Christophe Roussy"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1482251453,
                            "post_id": 31544486,
                            "comment_id": 69693993,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/31544486#comment69693993_31544486",
                            "body": "Numpy <code>np</code> is unused"
                        },
                        {
                            "owner": {
                                "account_id": 12522890,
                                "reputation": 2531,
                                "user_id": 9113679,
                                "user_type": "registered",
                                "display_name": "Pedro Delfino"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1536446377,
                            "post_id": 31544486,
                            "comment_id": 91428588,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/31544486#comment91428588_31544486",
                            "body": "Good answer. Just a doubt, why did you choose &quot;tck&quot;? Where does this initial come from?"
                        },
                        {
                            "owner": {
                                "account_id": 6629862,
                                "reputation": 462,
                                "user_id": 5322720,
                                "user_type": "registered",
                                "display_name": "icemtel"
                            },
                            "reply_to_user": {
                                "account_id": 12522890,
                                "reputation": 2531,
                                "user_id": 9113679,
                                "user_type": "registered",
                                "display_name": "Pedro Delfino"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1560428479,
                            "post_id": 31544486,
                            "comment_id": 99738457,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/31544486#comment99738457_31544486",
                            "body": "@PedroDelfino the same notation, <code>tck</code> is used in documentation <a href=\"https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.splrep.html#scipy.interpolate.splrep\" rel=\"nofollow noreferrer\">docs.scipy.org/doc/scipy/reference/generated/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 1476477,
                                "reputation": 429,
                                "user_id": 1386750,
                                "user_type": "registered",
                                "display_name": "AstroFloyd"
                            },
                            "reply_to_user": {
                                "account_id": 2501194,
                                "reputation": 56,
                                "user_id": 2822179,
                                "user_type": "registered",
                                "display_name": "cwhy"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1584194416,
                            "post_id": 31544486,
                            "comment_id": 107364522,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/31544486#comment107364522_31544486",
                            "body": "@cwhy In other words, ditch the function and do <code>print(interpolate.splev(1.25, tck))</code>  ;-)"
                        },
                        {
                            "owner": {
                                "account_id": 16731167,
                                "reputation": 57,
                                "user_id": 12093470,
                                "user_type": "registered",
                                "display_name": "Anson"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1668328373,
                            "post_id": 31544486,
                            "comment_id": 131374916,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/31544486#comment131374916_31544486",
                            "body": "So I tried to use the method on treasury curve. If I change x_points[0] to 0.5 such that the tenor is half year, then the value (15-extrapolation) is very different compared to the standard scipy.interpolate.CubicSpline(x_points, y_points, bc_type = &#39;natuaral&#39;)(15).  Why is that? Thank you!"
                        }
                    ],
                    "owner": {
                        "account_id": 3268833,
                        "reputation": 830,
                        "user_id": 2796082,
                        "user_type": "registered",
                        "display_name": "youngmit"
                    },
                    "comment_count": 6,
                    "is_accepted": true,
                    "score": 49,
                    "last_activity_date": 1562937784,
                    "last_edit_date": 1562937784,
                    "creation_date": 1437495591,
                    "answer_id": 31544486,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/31544486#31544486",
                    "body": "<p><strong>Short answer:</strong></p>\n\n<pre><code>from scipy import interpolate\n\ndef f(x):\n    x_points = [ 0, 1, 2, 3, 4, 5]\n    y_points = [12,14,22,39,58,77]\n\n    tck = interpolate.splrep(x_points, y_points)\n    return interpolate.splev(x, tck)\n\nprint(f(1.25))\n</code></pre>\n\n<p><strong>Long answer:</strong></p>\n\n<p>scipy separates the steps involved in spline interpolation into two operations, most likely for computational efficiency.</p>\n\n<ol>\n<li><p>The coefficients describing the spline curve are computed,\nusing splrep(). splrep returns an array of tuples containing the\ncoefficients.</p></li>\n<li><p>These coefficients are passed into splev() to actually\nevaluate the spline at the desired point <code>x</code> (in this example 1.25).\n<code>x</code> can also be an array. Calling <code>f([1.0, 1.25, 1.5])</code> returns the\ninterpolated points at <code>1</code>, <code>1.25</code>, and <code>1,5</code>, respectively.</p></li>\n</ol>\n\n<p>This approach is admittedly inconvenient for single evaluations, but since the most common use case is to start with a handful of function evaluation points, then to repeatedly use the spline to find interpolated values, it is usually quite useful in practice.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 332245,
                        "reputation": 16679,
                        "user_id": 657427,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "Christophe Roussy"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1482250284,
                    "last_edit_date": 1482250284,
                    "creation_date": 1482249973,
                    "answer_id": 41246552,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/41246552#41246552",
                    "body": "<p>Minimal python3 code:</p>\n\n<pre><code>from scipy import interpolate\n\nif __name__ == '__main__':\n    x = [ 0, 1, 2, 3, 4, 5]\n    y = [12,14,22,39,58,77]\n\n    # tck : tuple (t,c,k) a tuple containing the vector of knots,\n    # the B-spline coefficients, and the degree of the spline.\n    tck = interpolate.splrep(x, y)\n\n    print(interpolate.splev(1.25, tck)) # Prints 15.203125000000002\n    print(interpolate.splev(...other_value_here..., tck))\n</code></pre>\n\n<p>Based on comment of cwhy and answer by youngmit</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 16515,
                                "reputation": 3915,
                                "user_id": 36061,
                                "user_type": "registered",
                                "accept_rate": 71,
                                "display_name": "masher"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1620009674,
                            "post_id": 48085583,
                            "comment_id": 119066870,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/48085583#comment119066870_48085583",
                            "body": "This is great!  There is an error if x0 is a float. You can make it work by passing a single element list, [x0]."
                        },
                        {
                            "owner": {
                                "account_id": 24267148,
                                "reputation": 323,
                                "user_id": 18215856,
                                "user_type": "registered",
                                "display_name": "palloc"
                            },
                            "reply_to_user": {
                                "account_id": 16515,
                                "reputation": 3915,
                                "user_id": 36061,
                                "user_type": "registered",
                                "accept_rate": 71,
                                "display_name": "masher"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1647280751,
                            "post_id": 48085583,
                            "comment_id": 126326999,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/48085583#comment126326999_48085583",
                            "body": "@masher there is other problem with it if <code>x = [-8,-4.19,-3.54,-3.31,-2.56,-2.31,-1.66,-0.96,-0.22,0.62,1.2&zwnj;&#8203;1,3] y = [-0.01,0.01,0.03,0.04,0.07,0.09,0.16,0.28,0.45,0.65,0.77,1]</code> then it is not working, if you change <code>-8</code> to <code>-5</code> in the <code>x</code> array it is working"
                        }
                    ],
                    "owner": {
                        "account_id": 9593079,
                        "reputation": 431,
                        "user_id": 7123223,
                        "user_type": "registered",
                        "display_name": "raphael valentin"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 43,
                    "last_activity_date": 1515017315,
                    "last_edit_date": 1515017315,
                    "creation_date": 1515016021,
                    "answer_id": 48085583,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/48085583#48085583",
                    "body": "<p>In case, scipy is not installed:</p>\n\n<pre><code>import numpy as np\nfrom math import sqrt\n\ndef cubic_interp1d(x0, x, y):\n    \"\"\"\n    Interpolate a 1-D function using cubic splines.\n      x0 : a float or an 1d-array\n      x : (N,) array_like\n          A 1-D array of real/complex values.\n      y : (N,) array_like\n          A 1-D array of real values. The length of y along the\n          interpolation axis must be equal to the length of x.\n\n    Implement a trick to generate at first step the cholesky matrice L of\n    the tridiagonal matrice A (thus L is a bidiagonal matrice that\n    can be solved in two distinct loops).\n\n    additional ref: www.math.uh.edu/~jingqiu/math4364/spline.pdf \n    \"\"\"\n    x = np.asfarray(x)\n    y = np.asfarray(y)\n\n    # remove non finite values\n    # indexes = np.isfinite(x)\n    # x = x[indexes]\n    # y = y[indexes]\n\n    # check if sorted\n    if np.any(np.diff(x) &lt; 0):\n        indexes = np.argsort(x)\n        x = x[indexes]\n        y = y[indexes]\n\n    size = len(x)\n\n    xdiff = np.diff(x)\n    ydiff = np.diff(y)\n\n    # allocate buffer matrices\n    Li = np.empty(size)\n    Li_1 = np.empty(size-1)\n    z = np.empty(size)\n\n    # fill diagonals Li and Li-1 and solve [L][y] = [B]\n    Li[0] = sqrt(2*xdiff[0])\n    Li_1[0] = 0.0\n    B0 = 0.0 # natural boundary\n    z[0] = B0 / Li[0]\n\n    for i in range(1, size-1, 1):\n        Li_1[i] = xdiff[i-1] / Li[i-1]\n        Li[i] = sqrt(2*(xdiff[i-1]+xdiff[i]) - Li_1[i-1] * Li_1[i-1])\n        Bi = 6*(ydiff[i]/xdiff[i] - ydiff[i-1]/xdiff[i-1])\n        z[i] = (Bi - Li_1[i-1]*z[i-1])/Li[i]\n\n    i = size - 1\n    Li_1[i-1] = xdiff[-1] / Li[i-1]\n    Li[i] = sqrt(2*xdiff[-1] - Li_1[i-1] * Li_1[i-1])\n    Bi = 0.0 # natural boundary\n    z[i] = (Bi - Li_1[i-1]*z[i-1])/Li[i]\n\n    # solve [L.T][x] = [y]\n    i = size-1\n    z[i] = z[i] / Li[i]\n    for i in range(size-2, -1, -1):\n        z[i] = (z[i] - Li_1[i-1]*z[i+1])/Li[i]\n\n    # find index\n    index = x.searchsorted(x0)\n    np.clip(index, 1, size-1, index)\n\n    xi1, xi0 = x[index], x[index-1]\n    yi1, yi0 = y[index], y[index-1]\n    zi1, zi0 = z[index], z[index-1]\n    hi1 = xi1 - xi0\n\n    # calculate cubic\n    f0 = zi0/(6*hi1)*(xi1-x0)**3 + \\\n         zi1/(6*hi1)*(x0-xi0)**3 + \\\n         (yi1/hi1 - zi1*hi1/6)*(x0-xi0) + \\\n         (yi0/hi1 - zi0*hi1/6)*(xi1-x0)\n    return f0\n\nif __name__ == '__main__':\n    import matplotlib.pyplot as plt\n    x = np.linspace(0, 10, 11)\n    y = np.sin(x)\n    plt.scatter(x, y)\n\n    x_new = np.linspace(0, 10, 201)\n    plt.plot(x_new, cubic_interp1d(x_new, x, y))\n\n    plt.show()\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 4429887,
                                "reputation": 8160,
                                "user_id": 3607273,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "S Meaden"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1528744981,
                            "post_id": 48731552,
                            "comment_id": 88615391,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/48731552#comment88615391_48731552",
                            "body": "This maybe the simplest answer but is the best, the SciPy library already has a CubicSpline class and @nexayq has identified it!"
                        }
                    ],
                    "owner": {
                        "account_id": 2854189,
                        "reputation": 616,
                        "user_id": 2450748,
                        "user_type": "registered",
                        "display_name": "nexayq"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 22,
                    "last_activity_date": 1518688199,
                    "last_edit_date": 1518688199,
                    "creation_date": 1518352651,
                    "answer_id": 48731552,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/48731552#48731552",
                    "body": "<p>If you have scipy version >= 0.18.0 installed you can use CubicSpline function from scipy.interpolate for cubic spline interpolation.</p>\n\n<p>You can check scipy version by running following commands in python:</p>\n\n<pre><code>#!/usr/bin/env python3\nimport scipy\nscipy.version.version\n</code></pre>\n\n<p>If your scipy version is >= 0.18.0 you can run following example code for cubic spline interpolation:</p>\n\n<pre><code>#!/usr/bin/env python3\n\nimport numpy as np\nfrom scipy.interpolate import CubicSpline\n\n# calculate 5 natural cubic spline polynomials for 6 points\n# (x,y) = (0,12) (1,14) (2,22) (3,39) (4,58) (5,77)\nx = np.array([0, 1, 2, 3, 4, 5])\ny = np.array([12,14,22,39,58,77])\n\n# calculate natural cubic spline polynomials\ncs = CubicSpline(x,y,bc_type='natural')\n\n# show values of interpolation function at x=1.25\nprint('S(1.25) = ', cs(1.25))\n\n## Aditional - find polynomial coefficients for different x regions\n\n# if you want to print polynomial coefficients in form\n# S0(0&lt;=x&lt;=1) = a0 + b0(x-x0) + c0(x-x0)^2 + d0(x-x0)^3\n# S1(1&lt; x&lt;=2) = a1 + b1(x-x1) + c1(x-x1)^2 + d1(x-x1)^3\n# ...\n# S4(4&lt; x&lt;=5) = a4 + b4(x-x4) + c5(x-x4)^2 + d5(x-x4)^3\n# x0 = 0; x1 = 1; x4 = 4; (start of x region interval)\n\n# show values of a0, b0, c0, d0, a1, b1, c1, d1 ...\ncs.c\n\n# Polynomial coefficients for 0 &lt;= x &lt;= 1\na0 = cs.c.item(3,0)\nb0 = cs.c.item(2,0)\nc0 = cs.c.item(1,0)\nd0 = cs.c.item(0,0)\n\n# Polynomial coefficients for 1 &lt; x &lt;= 2\na1 = cs.c.item(3,1)\nb1 = cs.c.item(2,1)\nc1 = cs.c.item(1,1)\nd1 = cs.c.item(0,1)\n\n# ...\n\n# Polynomial coefficients for 4 &lt; x &lt;= 5\na4 = cs.c.item(3,4)\nb4 = cs.c.item(2,4)\nc4 = cs.c.item(1,4)\nd4 = cs.c.item(0,4)\n\n# Print polynomial equations for different x regions\nprint('S0(0&lt;=x&lt;=1) = ', a0, ' + ', b0, '(x-0) + ', c0, '(x-0)^2  + ', d0, '(x-0)^3')\nprint('S1(1&lt; x&lt;=2) = ', a1, ' + ', b1, '(x-1) + ', c1, '(x-1)^2  + ', d1, '(x-1)^3')\nprint('...')\nprint('S5(4&lt; x&lt;=5) = ', a4, ' + ', b4, '(x-4) + ', c4, '(x-4)^2  + ', d4, '(x-4)^3')\n\n# So we can calculate S(1.25) by using equation S1(1&lt; x&lt;=2)\nprint('S(1.25) = ', a1 + b1*0.25 + c1*(0.25**2) + d1*(0.25**3))\n\n# Cubic spline interpolation calculus example\n    #  https://www.youtube.com/watch?v=gT7F3TWihvk\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 14974757,
                                "reputation": 300,
                                "user_id": 10810503,
                                "user_type": "registered",
                                "display_name": "Chryfi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1622124973,
                            "post_id": 67363851,
                            "comment_id": 119705754,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/67363851#comment119705754_67363851",
                            "body": "Your code gives a math domain error at  Li[0]   = sqrt(2*xdiff[0])"
                        },
                        {
                            "owner": {
                                "account_id": 16515,
                                "reputation": 3915,
                                "user_id": 36061,
                                "user_type": "registered",
                                "accept_rate": 71,
                                "display_name": "masher"
                            },
                            "reply_to_user": {
                                "account_id": 14974757,
                                "reputation": 300,
                                "user_id": 10810503,
                                "user_type": "registered",
                                "display_name": "Chryfi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1622603467,
                            "post_id": 67363851,
                            "comment_id": 119836442,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/67363851#comment119836442_67363851",
                            "body": "@Chryfi can you share the code you used that made the error?"
                        },
                        {
                            "owner": {
                                "account_id": 14974757,
                                "reputation": 300,
                                "user_id": 10810503,
                                "user_type": "registered",
                                "display_name": "Chryfi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1622721448,
                            "post_id": 67363851,
                            "comment_id": 119876170,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/67363851#comment119876170_67363851",
                            "body": "alright, I uploaded it on google drive, thanks for looking into it: <a href=\"https://drive.google.com/file/d/1qMMBWYCXHnp7Vb2t0_wfRopauO1xkyB8/view?usp=sharing\" rel=\"nofollow noreferrer\">drive.google.com/file/d/1qMMBWYCXHnp7Vb2t0_wfRopauO1xkyB8/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 16515,
                                "reputation": 3915,
                                "user_id": 36061,
                                "user_type": "registered",
                                "accept_rate": 71,
                                "display_name": "masher"
                            },
                            "reply_to_user": {
                                "account_id": 14974757,
                                "reputation": 300,
                                "user_id": 10810503,
                                "user_type": "registered",
                                "display_name": "Chryfi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1623406358,
                            "post_id": 67363851,
                            "comment_id": 120076088,
                            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/67363851#comment120076088_67363851",
                            "body": "@Chryfi the x array needs to be in strictly increasing order"
                        }
                    ],
                    "owner": {
                        "account_id": 16515,
                        "reputation": 3915,
                        "user_id": 36061,
                        "user_type": "registered",
                        "accept_rate": 71,
                        "display_name": "masher"
                    },
                    "comment_count": 4,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1620019465,
                    "creation_date": 1620019465,
                    "answer_id": 67363851,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/67363851#67363851",
                    "body": "<p>Just putting this here if you want a dependency-free solution.</p>\n<p>Code taken from an answer above: <a href=\"https://stackoverflow.com/a/48085583/36061\">https://stackoverflow.com/a/48085583/36061</a></p>\n<pre class=\"lang-py prettyprint-override\"><code>def my_cubic_interp1d(x0, x, y):\n    &quot;&quot;&quot;\n    Interpolate a 1-D function using cubic splines.\n      x0 : a 1d-array of floats to interpolate at\n      x : a 1-D array of floats sorted in increasing order\n      y : A 1-D array of floats. The length of y along the\n          interpolation axis must be equal to the length of x.\n\n    Implement a trick to generate at first step the cholesky matrice L of\n    the tridiagonal matrice A (thus L is a bidiagonal matrice that\n    can be solved in two distinct loops).\n\n    additional ref: www.math.uh.edu/~jingqiu/math4364/spline.pdf \n    # original function code at: https://stackoverflow.com/a/48085583/36061\n    \n    \n    This function is licenced under: Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\n    https://creativecommons.org/licenses/by-sa/3.0/\n    Original Author raphael valentin\n    Date 3 Jan 2018\n    \n    \n    Modifications made to remove numpy dependencies:\n        -all sub-functions by MR\n        \n    This function, and all sub-functions, are licenced under: Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)        \n        \n    Mod author: Matthew Rowles\n    Date 3 May 2021\n    \n    &quot;&quot;&quot;\n    def diff(lst):\n        &quot;&quot;&quot;\n        numpy.diff with default settings\n        &quot;&quot;&quot;\n        size = len(lst)-1\n        r = [0]*size\n        for i in range(size):\n            r[i] = lst[i+1] - lst[i] \n        return r\n    \n    def list_searchsorted(listToInsert, insertInto):\n        &quot;&quot;&quot;\n        numpy.searchsorted with default settings\n        &quot;&quot;&quot;\n        def float_searchsorted(floatToInsert, insertInto):\n            for i in range(len(insertInto)):\n                if floatToInsert &lt;= insertInto[i]:\n                    return i\n            return len(insertInto)\n        return [float_searchsorted(i, insertInto) for i in listToInsert]\n    \n    def clip(lst, min_val, max_val, inPlace = False):    \n        &quot;&quot;&quot;\n        numpy.clip\n        &quot;&quot;&quot;\n        if not inPlace:\n            lst = lst[:]  \n        for i in range(len(lst)):\n            if lst[i] &lt; min_val:\n                lst[i] = min_val\n            elif lst[i] &gt; max_val:\n                lst[i] = max_val  \n        return lst\n    \n    def subtract(a,b):\n        &quot;&quot;&quot;\n        returns a - b\n        &quot;&quot;&quot;\n        return a - b\n    \n    size = len(x)\n\n    xdiff = diff(x)\n    ydiff = diff(y)\n\n    # allocate buffer matrices\n    Li   = [0]*size\n    Li_1 = [0]*(size-1)\n    z    = [0]*(size)\n\n    # fill diagonals Li and Li-1 and solve [L][y] = [B]\n    Li[0]   = sqrt(2*xdiff[0])\n    Li_1[0] = 0.0\n    B0      = 0.0 # natural boundary\n    z[0]    = B0 / Li[0]\n\n    for i in range(1, size-1, 1):\n        Li_1[i] = xdiff[i-1] / Li[i-1]\n        Li[i] = sqrt(2*(xdiff[i-1]+xdiff[i]) - Li_1[i-1] * Li_1[i-1])\n        Bi = 6*(ydiff[i]/xdiff[i] - ydiff[i-1]/xdiff[i-1])\n        z[i] = (Bi - Li_1[i-1]*z[i-1])/Li[i]\n\n    i = size - 1\n    Li_1[i-1] = xdiff[-1] / Li[i-1]\n    Li[i]     = sqrt(2*xdiff[-1] - Li_1[i-1] * Li_1[i-1])\n    Bi        = 0.0 # natural boundary\n    z[i]      = (Bi - Li_1[i-1]*z[i-1])/Li[i]\n\n    # solve [L.T][x] = [y]\n    i = size-1\n    z[i] = z[i] / Li[i]\n    for i in range(size-2, -1, -1):\n        z[i] = (z[i] - Li_1[i-1]*z[i+1])/Li[i]\n\n    # find index\n    index = list_searchsorted(x0,x)\n    index = clip(index, 1, size-1)\n\n    xi1 = [x[num]   for num in index]\n    xi0 = [x[num-1] for num in index]\n    yi1 = [y[num]   for num in index]\n    yi0 = [y[num-1] for num in index]\n    zi1 = [z[num]   for num in index]\n    zi0 = [z[num-1] for num in index]\n    hi1 = list( map(subtract, xi1, xi0) )\n\n    # calculate cubic - all element-wise multiplication\n    f0 = [0]*len(hi1)\n    for j in range(len(f0)):\n        f0[j] = zi0[j]/(6*hi1[j])*(xi1[j]-x0[j])**3 + \\\n                zi1[j]/(6*hi1[j])*(x0[j]-xi0[j])**3 + \\\n                (yi1[j]/hi1[j] - zi1[j]*hi1[j]/6)*(x0[j]-xi0[j]) + \\\n                (yi0[j]/hi1[j] - zi0[j]*hi1[j]/6)*(xi1[j]-x0[j])        \n    \n    return f0\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 24267148,
                        "reputation": 323,
                        "user_id": 18215856,
                        "user_type": "registered",
                        "display_name": "palloc"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1647348020,
                    "last_edit_date": 1647348020,
                    "creation_date": 1647283384,
                    "answer_id": 71472732,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/71472732#71472732",
                    "body": "<p>If you want to get the value</p>\n<pre><code>from scipy.interpolate import CubicSpline\nimport numpy as np\n\nx = [-5,-4.19,-3.54,-3.31,-2.56,-2.31,-1.66,-0.96,-0.22,0.62,1.21,3]\ny = [-0.01,0.01,0.03,0.04,0.07,0.09,0.16,0.28,0.45,0.65,0.77,1]\nvalue = 2\n\n#ascending order\nif np.any(np.diff(x) &lt; 0):\n    indexes = np.argsort(x).astype(int)\n    x = np.array(x)[indexes]\n    y = np.array(y)[indexes]\n\nf = CubicSpline(x, y, bc_type='natural')\nspecificVal = f(value).item(0) #f(value) is numpy.ndarray!!\nprint(specificVal)\n</code></pre>\n<p>If you want to plot the interpolated function.</p>\n<p><code>np.linspace</code> third parameter increase the &quot;accuracy&quot;.</p>\n<pre><code>from scipy.interpolate import CubicSpline\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nx = [-5,-4.19,-3.54,-3.31,-2.56,-2.31,-1.66,-0.96,-0.22,0.62,1.21,3]\ny = [-0.01,0.01,0.03,0.04,0.07,0.09,0.16,0.28,0.45,0.65,0.77,1]\n\n#ascending order\nif np.any(np.diff(x) &lt; 0):\n    indexes = np.argsort(x).astype(int)\n    x = np.array(x)[indexes]\n    y = np.array(y)[indexes]\n\nf = CubicSpline(x, y, bc_type='natural')\nx_new = np.linspace(min(x), max(x), 100)\ny_new = f(x_new)\n\nplt.plot(x_new, y_new)\nplt.scatter(x, y)\nplt.title('Cubic Spline Interpolation')\nplt.show()\n</code></pre>\n<p>output:</p>\n<p><a href=\"https://i.stack.imgur.com/SoBpv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SoBpv.png\" alt=\"enter image description here\" /></a></p>\n"
                },
                {
                    "owner": {
                        "account_id": 24645832,
                        "reputation": 61,
                        "user_id": 18543510,
                        "user_type": "registered",
                        "display_name": "raphael valentin"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 6,
                    "last_activity_date": 1648216578,
                    "last_edit_date": 1648216578,
                    "creation_date": 1648202900,
                    "answer_id": 71615189,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/71615189#71615189",
                    "body": "<p>In my previous post, I wrote a code based on a Cholesky development to solve the matrix generated by the cubic algorithm. Unfortunately, due to the square root function, it may perform badly on some sets of points (typically a non-uniform set of points).\nIn the same spirit than previously, there is another idea using the Thomas algorithm (TDMA) (see <a href=\"https://en.wikipedia.org/wiki/Tridiagonal_matrix_algorithm\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/Tridiagonal_matrix_algorithm</a>) to solve partially the tridiagonal matrix during its definition loop. However, the condition to use TDMA is that it requires at least that the matrix shall be diagonally dominant. However, in our case, it shall be true since <code>|bi| &gt; |ai| + |ci|</code> with <code>ai = h[i]</code>, <code>bi = 2*(h[i]+h[i+1])</code>, <code>ci = h[i+1]</code>, with <code>h[i]</code> unconditionally positive. (see <a href=\"https://www.cfd-online.com/Wiki/Tridiagonal_matrix_algorithm_-_TDMA_(Thomas_algorithm)\" rel=\"noreferrer\">https://www.cfd-online.com/Wiki/Tridiagonal_matrix_algorithm_-<em>TDMA</em>(Thomas_algorithm)</a></p>\n<p>I refer again to the document from jingqiu (see my previous post, unfortunately the link is broken, but it is still possible to find it in the cache of the web).</p>\n<p>An optimized version of the TDMA solver can be described as follows:</p>\n<pre><code>def TDMAsolver(a,b,c,d):\n&quot;&quot;&quot; This function is licenced under: Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\n    https://creativecommons.org/licenses/by-sa/3.0/\n    Author raphael valentin\n    Date 25 Mar 2022\n    ref. https://www.cfd-online.com/Wiki/Tridiagonal_matrix_algorithm_-_TDMA_(Thomas_algorithm)\n&quot;&quot;&quot;\nn = len(d)\n\nw = np.empty(n-1,float)\ng = np.empty(n, float)\n\nw[0] = c[0]/b[0]\ng[0] = d[0]/b[0]\n\nfor i in range(1, n-1):\n    m = b[i] - a[i-1]*w[i-1]\n    w[i] = c[i] / m\n    g[i] = (d[i] - a[i-1]*g[i-1]) / m\ng[n-1] = (d[n-1] - a[n-2]*g[n-2]) / (b[n-1] - a[n-2]*w[n-2])\n\nfor i in range(n-2, -1, -1):\n    g[i] = g[i] - w[i]*g[i+1]\n\nreturn g\n</code></pre>\n<p>When it is possible to get each individual for <code>ai</code>, <code>bi</code>, <code>ci</code>, <code>di</code>, it becomes easy to combine the definitions of the natural cubic spline interpolator function within these 2 single loops.</p>\n<pre><code>def cubic_interpolate(x0, x, y):\n&quot;&quot;&quot; Natural cubic spline interpolate function\n    This function is licenced under: Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0)\n    https://creativecommons.org/licenses/by-sa/3.0/\n    Author raphael valentin\n    Date 25 Mar 2022\n&quot;&quot;&quot;\nxdiff = np.diff(x)\ndydx = np.diff(y)\ndydx /= xdiff\n\nn = size = len(x)\n\nw = np.empty(n-1, float)\nz = np.empty(n, float)\n\nw[0] = 0.\nz[0] = 0.\nfor i in range(1, n-1):\n    m = xdiff[i-1] * (2 - w[i-1]) + 2 * xdiff[i]\n    w[i] = xdiff[i] / m\n    z[i] = (6*(dydx[i] - dydx[i-1]) - xdiff[i-1]*z[i-1]) / m\nz[-1] = 0.\n\nfor i in range(n-2, -1, -1):\n    z[i] = z[i] - w[i]*z[i+1]\n\n# find index (it requires x0 is already sorted)\nindex = x.searchsorted(x0)\nnp.clip(index, 1, size-1, index)\n\nxi1, xi0 = x[index], x[index-1]\nyi1, yi0 = y[index], y[index-1]\nzi1, zi0 = z[index], z[index-1]\nhi1 = xi1 - xi0\n\n# calculate cubic\nf0 = zi0/(6*hi1)*(xi1-x0)**3 + \\\n    zi1/(6*hi1)*(x0-xi0)**3 + \\\n    (yi1/hi1 - zi1*hi1/6)*(x0-xi0) + \\\n    (yi0/hi1 - zi0*hi1/6)*(xi1-x0)\nreturn f0\n</code></pre>\n<p>This function gives the same results as the function/class <code>CubicSpline</code> from <code>scipy.interpolate</code>, as we can see in the next plot.\n<a href=\"https://i.stack.imgur.com/aHDai.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/aHDai.png\" alt=\"https://i.stack.imgur.com/aHDai.png\" /></a></p>\n<p>It is possible to implement as well the first and second analytical derivatives that can be described such way:</p>\n<pre><code>f1p = -zi0/(2*hi1)*(xi1-x0)**2 + zi1/(2*hi1)*(x0-xi0)**2 + (yi1/hi1 - zi1*hi1/6) + (yi0/hi1 - zi0*hi1/6)\nf2p = zi0/hi1 * (xi1-x0) + zi1/hi1 * (x0-xi0)\n</code></pre>\n<p>Then, it is easy to verify that f2p[0] and f2p[-1] are equal to 0, then that the interpolator function yields natural splines.</p>\n<p>An additional reference concerning natural spline:\n<a href=\"https://faculty.ksu.edu.sa/sites/default/files/numerical_analysis_9th.pdf#page=167\" rel=\"noreferrer\">https://faculty.ksu.edu.sa/sites/default/files/numerical_analysis_9th.pdf#page=167</a></p>\n<p>An example of use:</p>\n<pre><code>import matplotlib.pyplot as plt\nimport numpy as np\nx = [-8,-4.19,-3.54,-3.31,-2.56,-2.31,-1.66,-0.96,-0.22,0.62,1.21,3]\ny = [-0.01,0.01,0.03,0.04,0.07,0.09,0.16,0.28,0.45,0.65,0.77,1]\nx = np.asfarray(x)\ny = np.asfarray(y)\n\nplt.scatter(x, y)\nx_new= np.linspace(min(x), max(x), 10000)\ny_new = cubic_interpolate(x_new, x, y)\nplt.plot(x_new, y_new)\n\nfrom scipy.interpolate import CubicSpline\nf = CubicSpline(x, y, bc_type='natural')\nplt.plot(x_new, f(x_new), label='ref')\nplt.legend()\nplt.show()\n</code></pre>\n<p>In a conclusion, this updated algorithm shall perform interpolation with better stability and faster than the previous code (O(n)). Associated with numba or cython, it shall be even very fast. Finally, it is totally independent of Scipy.\nImportant, note that as most of algorithms, it is sometimes useful to normalize the data (e.g. against large or small number values) to get the best results. As well, in this code, I do not check <code>nan</code> values or ordered data.</p>\n<p>Whatever, this update was a good lesson learning for me and I hope it can help someone. Let me know if you find something strange.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 84915,
                        "reputation": 33138,
                        "user_id": 237105,
                        "user_type": "registered",
                        "accept_rate": 52,
                        "display_name": "Antony Hatchkins"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1660934101,
                    "creation_date": 1660934101,
                    "answer_id": 73420973,
                    "question_id": 31543775,
                    "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python/73420973#73420973",
                    "body": "<p>Yes, as others have already noted, it should be as simple as</p>\n<pre class=\"lang-py prettyprint-override\"><code>&gt;&gt;&gt; from scipy.interpolate import CubicSpline\n\n&gt;&gt;&gt; CubicSpline(x,y)(u)\narray(15.203125) \n</code></pre>\n<p><em>(you can, for example, convert it to float to get the value from a 0d NumPy array)</em></p>\n<p>What has not been described yet is boundary conditions: the default \u2018not-a-knot\u2019 boundary conditions work best if you have zero knowledge about the data you\u2019re going to interpolate.</p>\n<p>If you see the following \u2018features\u2019 on the plot, you can fine-tune the boundary conditions to get a better result:</p>\n<ul>\n<li>the first derivative vanishes at boundaries =&gt; <code>bc_type=\u2018clamped\u2019</code></li>\n<li>the second derivative vanishes at boundaries =&gt; <code>bc_type='natural'</code></li>\n<li>the function is periodic =&gt; <code>bc_type='periodic'</code></li>\n</ul>\n<p><a href=\"https://i.stack.imgur.com/nh1cL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nh1cL.png\" alt=\"enter image description here\" /></a></p>\n<p>See my <a href=\"https://betterprogramming.pub/python-spline-interpolation-how-to-ef059c214d28?sk=533401d8775bcea491307a386ce36fcc\" rel=\"nofollow noreferrer\">article</a> for more details and an interactive demo.</p>\n"
                }
            ],
            "owner": {
                "account_id": 3668755,
                "reputation": 521,
                "user_id": 3320424,
                "user_type": "registered",
                "display_name": "user112829"
            },
            "comment_count": 0,
            "is_answered": true,
            "accepted_answer_id": 31544486,
            "answer_count": 8,
            "score": 36,
            "last_activity_date": 1666289186,
            "creation_date": 1437493477,
            "question_id": 31543775,
            "link": "https://stackoverflow.com/questions/31543775/how-to-perform-cubic-spline-interpolation-in-python",
            "title": "How to perform cubic spline interpolation in python?",
            "body": "<p>I have two lists to describe the function y(x):</p>\n\n<pre><code>x = [0,1,2,3,4,5]\ny = [12,14,22,39,58,77]\n</code></pre>\n\n<p>I would like to perform cubic spline interpolation so that given some value u in the domain of x, e.g.</p>\n\n<pre><code>u = 1.25\n</code></pre>\n\n<p>I can find y(u).</p>\n\n<p>I found <a href=\"http://docs.scipy.org/doc/scipy/reference/tutorial/interpolate.html\" rel=\"noreferrer\">this in SciPy but I am not sure how to use it.</a></p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 8289
}