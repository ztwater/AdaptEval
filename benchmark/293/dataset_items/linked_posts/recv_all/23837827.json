{
    "items": [
        {
            "tags": [
                "python",
                "multithreading",
                "tcp"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 405282,
                        "reputation": 22330,
                        "user_id": 774078,
                        "user_type": "registered",
                        "accept_rate": 94,
                        "display_name": "Sterling Archer"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1400876755,
                    "post_id": 23837827,
                    "comment_id": 36680182,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage#comment36680182_23837827",
                    "body": "You should post this on code review, as it appears to be functional code."
                },
                {
                    "owner": {
                        "account_id": 2890538,
                        "reputation": 456,
                        "user_id": 2479434,
                        "user_type": "registered",
                        "accept_rate": 33,
                        "display_name": "jteezy14"
                    },
                    "reply_to_user": {
                        "account_id": 405282,
                        "reputation": 22330,
                        "user_id": 774078,
                        "user_type": "registered",
                        "accept_rate": 94,
                        "display_name": "Sterling Archer"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1400876859,
                    "post_id": 23837827,
                    "comment_id": 36680226,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage#comment36680226_23837827",
                    "body": "I wasn&#39;t aware of code review. Should I remove this post then?"
                },
                {
                    "owner": {
                        "account_id": 405282,
                        "reputation": 22330,
                        "user_id": 774078,
                        "user_type": "registered",
                        "accept_rate": 94,
                        "display_name": "Sterling Archer"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1400876904,
                    "post_id": 23837827,
                    "comment_id": 36680247,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage#comment36680247_23837827",
                    "body": "I&#39;m not 100% sure, may want to ask the meta chat"
                },
                {
                    "owner": {
                        "account_id": 2019513,
                        "reputation": 5265,
                        "user_id": 2382792,
                        "user_type": "registered",
                        "accept_rate": 87,
                        "display_name": "\u03c1ss"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1400877035,
                    "post_id": 23837827,
                    "comment_id": 36680313,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage#comment36680313_23837827",
                    "body": "I am sure that the hardware properties would be different on Win 7 machine and the server. That&#39;s why they have different performances!"
                },
                {
                    "owner": {
                        "account_id": 2019513,
                        "reputation": 5265,
                        "user_id": 2382792,
                        "user_type": "registered",
                        "accept_rate": 87,
                        "display_name": "\u03c1ss"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1400877172,
                    "post_id": 23837827,
                    "comment_id": 36680365,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage#comment36680365_23837827",
                    "body": "I tested your code on Windows 8 64-bit, core i5 6GB ram, the CPU usage never goes above 32% in my case!"
                },
                {
                    "owner": {
                        "account_id": 1575107,
                        "reputation": 42569,
                        "user_id": 3555845,
                        "user_type": "registered",
                        "display_name": "Daniel"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1400879261,
                    "post_id": 23837827,
                    "comment_id": 36681259,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage#comment36681259_23837827",
                    "body": "<code>recv</code> recieves up to 1024 bytes, so it&#39;s possible to read a partial utf8-sequence, which leads to decoding errors."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 2890538,
                                "reputation": 456,
                                "user_id": 2479434,
                                "user_type": "registered",
                                "accept_rate": 33,
                                "display_name": "jteezy14"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1400877732,
                            "post_id": 23838001,
                            "comment_id": 36680606,
                            "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage/23838001#comment36680606_23838001",
                            "body": "You are right. Thank you so much! The cpu usage is negligible now."
                        }
                    ],
                    "owner": {
                        "account_id": 226783,
                        "reputation": 4393,
                        "user_id": 488012,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "pmoleri"
                    },
                    "comment_count": 1,
                    "is_accepted": true,
                    "score": 6,
                    "last_activity_date": 1400877517,
                    "creation_date": 1400877517,
                    "answer_id": 23838001,
                    "question_id": 23837827,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage/23838001#23838001",
                    "body": "<p>You are using <code>setblocking(0)</code>, that means your socket is not blocking. What you are doing is called <code>polling</code> and will use as much CPU as it can.</p>\n\n<p>When you use threading you don't need to poll. Just remove the <code>setblocking(0)</code> line and it should work properly.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 5817067,
                        "reputation": 192,
                        "user_id": 4586329,
                        "user_type": "registered",
                        "display_name": "rsy"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1484853094,
                    "creation_date": 1484853094,
                    "answer_id": 41749820,
                    "question_id": 23837827,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage/41749820#41749820",
                    "body": "<p>The problem is the infinite while loop (while 1). Please include a few microsecond delay (time.sleep(0.001)), this brings the CPU usage drastically down.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 4123837,
                        "reputation": 144,
                        "user_id": 3383496,
                        "user_type": "registered",
                        "display_name": "Robert \u0160pendl"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1542648917,
                    "creation_date": 1542648917,
                    "answer_id": 53379920,
                    "question_id": 23837827,
                    "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage/53379920#53379920",
                    "body": "<p>To low reputation to just comment on rsy's answer.\nIn your particular case, when you receive data with \"conn.recv\", just setting setblocking(1) solves the problem, as pmoleri has answered.</p>\n\n<p>But if you do polling in a loop with \"select\" statement, just setblocking(1) has no effect and rsy's solution with a short delay (time.delay(0.01)) is the way to go.</p>\n"
                }
            ],
            "owner": {
                "account_id": 2890538,
                "reputation": 456,
                "user_id": 2479434,
                "user_type": "registered",
                "accept_rate": 33,
                "display_name": "jteezy14"
            },
            "comment_count": 6,
            "is_answered": true,
            "accepted_answer_id": 23838001,
            "answer_count": 3,
            "score": 7,
            "last_activity_date": 1542648917,
            "creation_date": 1400876666,
            "last_edit_date": 1484942907,
            "question_id": 23837827,
            "link": "https://stackoverflow.com/questions/23837827/python-server-program-has-high-cpu-usage",
            "title": "Python server program has high cpu usage",
            "body": "<p>I am experimenting with a python tcp server (I've just recently discovered the awesomeness that is python). Anyway, the server runs just fine and prints data the way I would expect, but when I look at the CPU usage in the windows task manager it shows that python.exe is consuming 97%-99% of the CPU.</p>\n\n<p>Just to see what would happen, I ran it again on a different computer and it only used about 50% of the cpu. </p>\n\n<p>Here is what I am wondering:</p>\n\n<ol>\n<li><p>Why is the cpu usage so high?</p></li>\n<li><p>Why would I see a difference running on two different machines (one is Windows 7 the other is server 2008, could that matter)?</p></li>\n<li><p>I am creating a new thread for each connnection, and running a while loop that is always true, but I have a \"break\" when there is no longer a connection.  Is this thread getting destroyed correctly?</p></li>\n</ol>\n\n<p>Thanks in advance for any help!</p>\n\n<pre><code>import socket\nimport threading\nimport logging\nimport time\n\nTCP_IP = \"127.0.0.1\"\nTCP_PORT = 10000\nBUFFER_SIZE = 1024\nSOCKET_TIMEOUT = 2\n\n\ndef handler(conn):\n    while 1:\n        try:\n            data = conn.recv(BUFFER_SIZE)\n            if data:\n                dataS = data.decode(encoding = 'UTF-8')\n                print (\"received data: \")\n                print (dataS)\n                logging.getLogger(\"TestLogger\").critical(dataS)\n\n        except socket.error as e:\n            print(\"connection closed\")\n            conn.close()\n            break\n\ntry:    \n    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    s.bind((TCP_IP, TCP_PORT))\n    s.setblocking(0)\n    s.listen(5)\n\nexcept Exception as e:\n    print(e)\n\n\nwhile 1:\n    try:\n        conn, addr = s.accept()\n    except Exception as e:\n        continue\n    print ('Connection address:')\n    print (addr)\n    conn.settimeout(SOCKET_TIMEOUT)\n    connThread = threading.Thread(target = handler, args = (conn,))\n    connThread.start()\n</code></pre>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 9557
}