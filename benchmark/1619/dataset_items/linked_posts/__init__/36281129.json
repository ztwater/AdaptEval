{
    "items": [
        {
            "tags": [
                "tensorflow",
                "tensorflow-serving"
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 4859465,
                                "reputation": 1860,
                                "user_id": 3919542,
                                "user_type": "registered",
                                "accept_rate": 46,
                                "display_name": "kkk"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1459261912,
                            "post_id": 36282423,
                            "comment_id": 60200266,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36282423#comment60200266_36282423",
                            "body": "Thanks for your answer yaroslav ."
                        }
                    ],
                    "owner": {
                        "account_id": 183635,
                        "reputation": 57455,
                        "user_id": 419116,
                        "user_type": "registered",
                        "accept_rate": 78,
                        "display_name": "Yaroslav Bulatov"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1459249213,
                    "creation_date": 1459249213,
                    "answer_id": 36282423,
                    "question_id": 36281129,
                    "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36282423#36282423",
                    "body": "<p>You are creating a new session in <code>In[17]</code> which wipes your variables. Also, you don't need to use <code>with</code> blocks if you only have one default graph and one default session, you can instead do something like this</p>\n\n<pre><code>sess = tf.InteractiveSession()\nlayer1_weights = tf.Variable(tf.truncated_normal(\n  [patch_size, patch_size, num_channels, depth], stddev=0.1),name=\"layer1_weights\")\ntf.train.Saver().restore(sess, \"/tmp/model.ckpt\")\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 4859465,
                                "reputation": 1860,
                                "user_id": 3919542,
                                "user_type": "registered",
                                "accept_rate": 46,
                                "display_name": "kkk"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1459261814,
                            "post_id": 36286136,
                            "comment_id": 60200183,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#comment60200183_36286136",
                            "body": "Thanks mrry for your answer , How can i now pass my image to this model which hence classifies my image , does the code that i have tried to write in the second python file(file in which i was restoring my variables) is correct or does it need modification to be done"
                        },
                        {
                            "owner": {
                                "account_id": 4382979,
                                "reputation": 125978,
                                "user_id": 3574081,
                                "user_type": "registered",
                                "display_name": "mrry"
                            },
                            "reply_to_user": {
                                "account_id": 4859465,
                                "reputation": 1860,
                                "user_id": 3919542,
                                "user_type": "registered",
                                "accept_rate": 46,
                                "display_name": "kkk"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1459262125,
                            "post_id": 36286136,
                            "comment_id": 60200444,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#comment60200444_36286136",
                            "body": "You could try feeding the image data to <code>tf_valid_dataset</code> and fetching <code>valid_prediction</code>. (It would be easier if <code>tf_valid_dataset</code> were a <code>tf.placeholder()</code> so you could feed inputs of any size to that tensor.)"
                        },
                        {
                            "owner": {
                                "account_id": 4859465,
                                "reputation": 1860,
                                "user_id": 3919542,
                                "user_type": "registered",
                                "accept_rate": 46,
                                "display_name": "kkk"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1459262797,
                            "post_id": 36286136,
                            "comment_id": 60200941,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#comment60200941_36286136",
                            "body": "could you please provide a code snippet for the same , Actually i am completely new to Tensorflow and thus facing these small difficulties ."
                        },
                        {
                            "owner": {
                                "account_id": 4859465,
                                "reputation": 1860,
                                "user_id": 3919542,
                                "user_type": "registered",
                                "accept_rate": 46,
                                "display_name": "kkk"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1459271007,
                            "post_id": 36286136,
                            "comment_id": 60206609,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#comment60206609_36286136",
                            "body": "can u please provide a code snippet , i have tried passing a grayscale image but i am not able to create a 4D Tensor of the image that i have to pass . Please do help me with this"
                        },
                        {
                            "owner": {
                                "account_id": 4382979,
                                "reputation": 125978,
                                "user_id": 3574081,
                                "user_type": "registered",
                                "display_name": "mrry"
                            },
                            "reply_to_user": {
                                "account_id": 4859465,
                                "reputation": 1860,
                                "user_id": 3919542,
                                "user_type": "registered",
                                "accept_rate": 46,
                                "display_name": "kkk"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1459272054,
                            "post_id": 36286136,
                            "comment_id": 60207205,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#comment60207205_36286136",
                            "body": "Happy to help with this, but it&#39;s not relevant to the current question. Feel free to add a new question with a snippet of what you&#39;ve tried, and any error message, and I&#39;ll answer."
                        },
                        {
                            "owner": {
                                "account_id": 4195672,
                                "reputation": 5409,
                                "user_id": 6546694,
                                "user_type": "registered",
                                "accept_rate": 57,
                                "display_name": "figs_and_nuts"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1550922031,
                            "post_id": 36286136,
                            "comment_id": 96455816,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#comment96455816_36286136",
                            "body": "@mrry - This is very old but, How does one restore the model for use in production in case of multiple graphs. Do i need to pickle the relevant tf.train.Saver() and use it in production?"
                        },
                        {
                            "owner": {
                                "account_id": 4038832,
                                "reputation": 11933,
                                "user_id": 3322273,
                                "user_type": "registered",
                                "accept_rate": 73,
                                "display_name": "SomethingSomething"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1578405850,
                            "post_id": 36286136,
                            "comment_id": 105421774,
                            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#comment105421774_36286136",
                            "body": "<code>AttributeError: &#39;Graph&#39; object has no attribute &#39;all_variables&#39;</code>"
                        }
                    ],
                    "owner": {
                        "account_id": 4382979,
                        "reputation": 125978,
                        "user_id": 3574081,
                        "user_type": "registered",
                        "display_name": "mrry"
                    },
                    "comment_count": 7,
                    "is_accepted": true,
                    "score": 39,
                    "last_activity_date": 1459258971,
                    "last_edit_date": 1495535490,
                    "creation_date": 1459258971,
                    "answer_id": 36286136,
                    "question_id": 36281129,
                    "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow/36286136#36286136",
                    "body": "<p>The error here is quite subtle. In <code>In[8]</code> you create a <a href=\"https://www.tensorflow.org/versions/r0.7/api_docs/python/framework.html#Graph\" rel=\"noreferrer\"><code>tf.Graph</code></a> called <code>graph</code> and set it as default for the <a href=\"https://www.tensorflow.org/versions/r0.7/api_docs/python/framework.html#Graph.as_default\" rel=\"noreferrer\"><code>with graph.as_default():</code></a> block. This means that all of the variables are created in <code>graph</code>, and if you print <code>graph.all_variables()</code> you should see a list of your variables.</p>\n\n<p><strong>However</strong>, you exit the <code>with</code> block before creating (i) the <a href=\"https://www.tensorflow.org/versions/r0.7/api_docs/python/client.html#Session\" rel=\"noreferrer\"><code>tf.Session</code></a>, and (ii) the <a href=\"https://www.tensorflow.org/versions/r0.7/api_docs/python/state_ops.html#Saver\" rel=\"noreferrer\"><code>tf.train.Saver</code></a>. This means that the session and saver are created in a <strong>different graph</strong> (the global default <code>tf.Graph</code> that is used when you don't explicitly create one and set it as default), which doesn't contain any variables&mdash;or any nodes at all.</p>\n\n<p>There are at least two solutions:</p>\n\n<ol>\n<li><p>As <a href=\"https://stackoverflow.com/a/36282423/3574081\">Yaroslav suggests</a>, you can write your program without using the <code>with graph.as_default():</code> block, which avoids the confusion with multiple graphs. However, this can lead to name collisions between different cells in your IPython notebook, which is awkward when using the <code>tf.train.Saver</code>, since it uses the <code>name</code> property of a <code>tf.Variable</code> as the key in the checkpoint file.</p></li>\n<li><p>You can create the saver <em>inside</em> the <code>with graph.as_default():</code> block, and create the <code>tf.Session</code> with an explicit graph, as follows:</p>\n\n<pre><code>with graph.as_default():\n    # [Variable and model creation goes here.]\n\n    saver = tf.train.Saver()  # Gets all variables in `graph`.\n\nwith tf.Session(graph=graph) as sess:\n    saver.restore(sess)\n    # Do some work with the model....\n</code></pre>\n\n<p>Alternatively, you can create the <code>tf.Session</code> <em>inside</em> the <code>with graph.as_default():</code> block, in which case it will use <code>graph</code> for all of its operations.</p></li>\n</ol>\n"
                }
            ],
            "owner": {
                "account_id": 4859465,
                "reputation": 1860,
                "user_id": 3919542,
                "user_type": "registered",
                "accept_rate": 46,
                "display_name": "kkk"
            },
            "comment_count": 0,
            "is_answered": true,
            "accepted_answer_id": 36286136,
            "answer_count": 2,
            "score": 22,
            "last_activity_date": 1459258971,
            "creation_date": 1459245728,
            "question_id": 36281129,
            "link": "https://stackoverflow.com/questions/36281129/no-variable-to-save-error-in-tensorflow",
            "title": "No variable to save error in Tensorflow",
            "body": "<p>I am trying to save the model and then reuse it for classifying my images but unfortunately i am getting errors in restoring the model that i have saved.</p>\n\n<p><strong>The code in which model has been created</strong> :</p>\n\n<pre><code># Deep Learning\n# =============\n# \n# Assignment 4\n# ------------\n\n# In[25]:\n\n# These are all the modules we'll be using later. Make sure you can import them\n# before proceeding further.\nfrom __future__ import print_function\nimport numpy as np\nimport tensorflow as tf\nfrom six.moves import cPickle as pickle\nfrom six.moves import range\n\n\n# In[37]:\n\npickle_file = 'notMNIST.pickle'\n\nwith open(pickle_file, 'rb') as f:\n  save = pickle.load(f)\n  train_dataset = save['train_dataset']\n  train_labels = save['train_labels']\n  valid_dataset = save['valid_dataset']\n  valid_labels = save['valid_labels']\n  test_dataset = save['test_dataset']\n  test_labels = save['test_labels']\n  del save  # hint to help gc free up memory\n  print('Training set', train_dataset.shape, train_labels.shape)\n  print('Validation set', valid_dataset.shape, valid_labels.shape)\n  print('Test set', test_dataset.shape, test_labels.shape)\n  print(test_labels)\n\n\n# Reformat into a TensorFlow-friendly shape:\n# - convolutions need the image data formatted as a cube (width by height by #channels)\n# - labels as float 1-hot encodings.\n\n# In[38]:\n\nimage_size = 28\nnum_labels = 10\nnum_channels = 1 # grayscale\n\nimport numpy as np\n\ndef reformat(dataset, labels):\n  dataset = dataset.reshape(\n    (-1, image_size, image_size, num_channels)).astype(np.float32)\n  #print(np.arange(num_labels))\n  labels = (np.arange(num_labels) == labels[:,None]).astype(np.float32)\n  #print(labels[0,:])\n  print(labels[0])\n  return dataset, labels\ntrain_dataset, train_labels = reformat(train_dataset, train_labels)\nvalid_dataset, valid_labels = reformat(valid_dataset, valid_labels)\ntest_dataset, test_labels = reformat(test_dataset, test_labels)\nprint('Training set', train_dataset.shape, train_labels.shape)\nprint('Validation set', valid_dataset.shape, valid_labels.shape)\nprint('Test set', test_dataset.shape, test_labels.shape)\n#print(labels[0])\n\n\n# In[39]:\n\ndef accuracy(predictions, labels):\n  return (100.0 * np.sum(np.argmax(predictions, 1) == np.argmax(labels, 1))\n          / predictions.shape[0])\n\n\n# Let's build a small network with two convolutional layers, followed by one fully connected layer. Convolutional networks are more expensive computationally, so we'll limit its depth and number of fully connected nodes.\n\n# In[47]:\n\nbatch_size = 16\npatch_size = 5\ndepth = 16\nnum_hidden = 64\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n\n  # Input data.\n  tf_train_dataset = tf.placeholder(\n    tf.float32, shape=(batch_size, image_size, image_size, num_channels))\n  tf_train_labels = tf.placeholder(tf.float32, shape=(batch_size, num_labels))\n  tf_valid_dataset = tf.constant(valid_dataset)\n  tf_test_dataset = tf.constant(test_dataset)\n\n  # Variables.\n  layer1_weights = tf.Variable(tf.truncated_normal(\n      [patch_size, patch_size, num_channels, depth], stddev=0.1),name=\"layer1_weights\")\n  layer1_biases = tf.Variable(tf.zeros([depth]),name = \"layer1_biases\")\n  layer2_weights = tf.Variable(tf.truncated_normal(\n      [patch_size, patch_size, depth, depth], stddev=0.1),name = \"layer2_weights\")\n  layer2_biases = tf.Variable(tf.constant(1.0, shape=[depth]),name =\"layer2_biases\")\n  layer3_weights = tf.Variable(tf.truncated_normal(\n      [image_size // 4 * image_size // 4 * depth, num_hidden], stddev=0.1),name=\"layer3_biases\")\n  layer3_biases = tf.Variable(tf.constant(1.0, shape=[num_hidden]),name = \"layer3_biases\")\n  layer4_weights = tf.Variable(tf.truncated_normal(\n      [num_hidden, num_labels], stddev=0.1),name = \"layer4_weights\")\n  layer4_biases = tf.Variable(tf.constant(1.0, shape=[num_labels]),name = \"layer4_biases\")\n\n  # Model.\n  def model(data):\n    conv = tf.nn.conv2d(data, layer1_weights, [1, 2, 2, 1], padding='SAME')\n    hidden = tf.nn.relu(conv + layer1_biases)\n    conv = tf.nn.conv2d(hidden, layer2_weights, [1, 2, 2, 1], padding='SAME')\n    hidden = tf.nn.relu(conv + layer2_biases)\n    shape = hidden.get_shape().as_list()\n    reshape = tf.reshape(hidden, [shape[0], shape[1] * shape[2] * shape[3]])\n    hidden = tf.nn.relu(tf.matmul(reshape, layer3_weights) + layer3_biases)\n    return tf.matmul(hidden, layer4_weights) + layer4_biases\n\n  # Training computation.\n  logits = model(tf_train_dataset)\n  loss = tf.reduce_mean(\n    tf.nn.softmax_cross_entropy_with_logits(logits, tf_train_labels))\n\n  # Optimizer.\n  optimizer = tf.train.GradientDescentOptimizer(0.05).minimize(loss)\n\n  # Predictions for the training, validation, and test data.\n  train_prediction = tf.nn.softmax(logits)\n  valid_prediction = tf.nn.softmax(model(tf_valid_dataset))\n  test_prediction = tf.nn.softmax(model(tf_test_dataset))\n\n\n# In[48]:\n\nnum_steps = 1001\n#saver = tf.train.Saver()\nwith tf.Session(graph=graph) as session:\n  tf.initialize_all_variables().run()\n  print('Initialized')\n  for step in range(num_steps):\n    offset = (step * batch_size) % (train_labels.shape[0] - batch_size)\n    batch_data = train_dataset[offset:(offset + batch_size), :, :, :]\n    batch_labels = train_labels[offset:(offset + batch_size), :]\n    feed_dict = {tf_train_dataset : batch_data, tf_train_labels : batch_labels}\n    _, l, predictions = session.run(\n      [optimizer, loss, train_prediction], feed_dict=feed_dict)\n    if (step % 50 == 0):\n      print('Minibatch loss at step %d: %f' % (step, l))\n      print('Minibatch accuracy: %.1f%%' % accuracy(predictions, batch_labels))\n      print('Validation accuracy: %.1f%%' % accuracy(\n        valid_prediction.eval(), valid_labels))\n  print('Test accuracy: %.1f%%' % accuracy(test_prediction.eval(), test_labels))\n  save_path = tf.train.Saver().save(session, \"/tmp/model.ckpt\")\n  print(\"Model saved in file: %s\" % save_path)\n</code></pre>\n\n<p>Everything works fine and the model is stored in the respective folder .</p>\n\n<p><strong>I have created one more python file where i have tried restoring the model but getting an error there</strong></p>\n\n<pre><code># In[1]:\nfrom __future__ import print_function\nimport numpy as np\nimport tensorflow as tf\nfrom six.moves import cPickle as pickle\nfrom six.moves import range\n\n\n# In[3]:\n\nimage_size = 28\nnum_labels = 10\nnum_channels = 1 # grayscale\nimport numpy as np\n\n\n# In[4]:\n\ndef accuracy(predictions, labels):\n  return (100.0 * np.sum(np.argmax(predictions, 1) == np.argmax(labels, 1))\n          / predictions.shape[0])\n\n\n# In[8]:\n\nbatch_size = 16\npatch_size = 5\ndepth = 16\nnum_hidden = 64\n\ngraph = tf.Graph()\n\nwith graph.as_default():\n\n  '''# Input data.\n  tf_train_dataset = tf.placeholder(\n    tf.float32, shape=(batch_size, image_size, image_size, num_channels))\n  tf_train_labels = tf.placeholder(tf.float32, shape=(batch_size, num_labels))\n  tf_valid_dataset = tf.constant(valid_dataset)\n  tf_test_dataset = tf.constant(test_dataset)'''\n\n  # Variables.\n  layer1_weights = tf.Variable(tf.truncated_normal(\n      [patch_size, patch_size, num_channels, depth], stddev=0.1),name=\"layer1_weights\")\n  layer1_biases = tf.Variable(tf.zeros([depth]),name = \"layer1_biases\")\n  layer2_weights = tf.Variable(tf.truncated_normal(\n      [patch_size, patch_size, depth, depth], stddev=0.1),name = \"layer2_weights\")\n  layer2_biases = tf.Variable(tf.constant(1.0, shape=[depth]),name =\"layer2_biases\")\n  layer3_weights = tf.Variable(tf.truncated_normal(\n      [image_size // 4 * image_size // 4 * depth, num_hidden], stddev=0.1),name=\"layer3_biases\")\n  layer3_biases = tf.Variable(tf.constant(1.0, shape=[num_hidden]),name = \"layer3_biases\")\n  layer4_weights = tf.Variable(tf.truncated_normal(\n      [num_hidden, num_labels], stddev=0.1),name = \"layer4_weights\")\n  layer4_biases = tf.Variable(tf.constant(1.0, shape=[num_labels]),name = \"layer4_biases\")\n\n  # Model.\n  def model(data):\n    conv = tf.nn.conv2d(data, layer1_weights, [1, 2, 2, 1], padding='SAME')\n    hidden = tf.nn.relu(conv + layer1_biases)\n    conv = tf.nn.conv2d(hidden, layer2_weights, [1, 2, 2, 1], padding='SAME')\n    hidden = tf.nn.relu(conv + layer2_biases)\n    shape = hidden.get_shape().as_list()\n    reshape = tf.reshape(hidden, [shape[0], shape[1] * shape[2] * shape[3]])\n    hidden = tf.nn.relu(tf.matmul(reshape, layer3_weights) + layer3_biases)\n    return tf.matmul(hidden, layer4_weights) + layer4_biases\n\n  '''# Training computation.\n  logits = model(tf_train_dataset)\n  loss = tf.reduce_mean(\n    tf.nn.softmax_cross_entropy_with_logits(logits, tf_train_labels))\n\n  # Optimizer.\n  optimizer = tf.train.GradientDescentOptimizer(0.05).minimize(loss)'''\n\n  # Predictions for the training, validation, and test data.\n  #train_prediction = tf.nn.softmax(logits)\n  #valid_prediction = tf.nn.softmax(model(tf_valid_dataset))\n  #test_prediction = tf.nn.softmax(model(tf_test_dataset))\n\n# In[17]:\n\n#saver = tf.train.Saver()\nwith tf.Session() as sess:\n  # Restore variables from disk.\n  tf.train.Saver().restore(sess, \"/tmp/model.ckpt\")\n  print(\"Model restored.\")\n  # Do some work with the model\n</code></pre>\n\n<p>error that i am getting is :</p>\n\n<p><strong><em>No variables to save</em></strong> </p>\n\n<p>Any help would be appreciated</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 6883
}