{
    "items": [
        {
            "tags": [
                "python-3.x",
                "image",
                "numpy",
                "python-imaging-library"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 3580374,
                        "reputation": 111083,
                        "user_id": 2988730,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Mad Physicist"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1537850458,
                    "post_id": 52490653,
                    "comment_id": 91922069,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment91922069_52490653",
                    "body": "What&#39;s the problem with your code?"
                },
                {
                    "owner": {
                        "account_id": 13540458,
                        "reputation": 5001,
                        "user_id": 9768291,
                        "user_type": "registered",
                        "display_name": "payne"
                    },
                    "reply_to_user": {
                        "account_id": 3580374,
                        "reputation": 111083,
                        "user_id": 2988730,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Mad Physicist"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1537850528,
                    "post_id": 52490653,
                    "comment_id": 91922087,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment91922087_52490653",
                    "body": "It won&#39;t let me save images when the values of the numpy_arrays are floats."
                },
                {
                    "owner": {
                        "account_id": 4908325,
                        "reputation": 7099,
                        "user_id": 3954379,
                        "user_type": "registered",
                        "accept_rate": 20,
                        "display_name": "Lucas"
                    },
                    "edited": false,
                    "score": 2,
                    "creation_date": 1537851341,
                    "post_id": 52490653,
                    "comment_id": 91922293,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment91922293_52490653",
                    "body": "See this <a href=\"https://stackoverflow.com/a/30946248/3954379\">answer</a>, maybe is what you need"
                },
                {
                    "owner": {
                        "account_id": 300328,
                        "reputation": 112936,
                        "user_id": 1217358,
                        "user_type": "registered",
                        "display_name": "Warren Weckesser"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1537851391,
                    "post_id": 52490653,
                    "comment_id": 91922308,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment91922308_52490653",
                    "body": "What format are you trying to use?  The PNG format can only store integers."
                },
                {
                    "owner": {
                        "account_id": 13540458,
                        "reputation": 5001,
                        "user_id": 9768291,
                        "user_type": "registered",
                        "display_name": "payne"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1537851491,
                    "post_id": 52490653,
                    "comment_id": 91922336,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment91922336_52490653",
                    "body": "Which format should I use? I thought I should avoid <code>JPG</code> and so that <code>PNG</code> would be a good pick. I didn&#39;t know it only supported integers. I need to preserve the 3 dimensions of colors (RGB, which I eventually plan on changing to YCbCr)."
                },
                {
                    "owner": {
                        "account_id": 300328,
                        "reputation": 112936,
                        "user_id": 1217358,
                        "user_type": "registered",
                        "display_name": "Warren Weckesser"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1537851854,
                    "post_id": 52490653,
                    "comment_id": 91922446,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment91922446_52490653",
                    "body": "PNG supports up to 16 bits per channel.  Scaling up floating point values from the range [0, 1] to [0, 2**16-1] gives a floating point resolution of about 1.5e-5.  You&#39;ll lose information in the conversion to integers, but only you can decide if the loss is too  much.  Alternatively, TIFF supports floating point; take a look at the <a href=\"https://pypi.org/project/tifffile/\" rel=\"nofollow noreferrer\"><code>tifffile</code></a> package."
                },
                {
                    "owner": {
                        "account_id": 2360785,
                        "reputation": 11678,
                        "user_id": 2067492,
                        "user_type": "registered",
                        "display_name": "matt"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1537876835,
                    "post_id": 52490653,
                    "comment_id": 91935698,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment91935698_52490653",
                    "body": "You start with 8 bits then go to 32 bits then going back to 8 or 16 bits. So there really isn&#39;t any guarantee that you don&#39;t lose information. But, you can check <code>all(int((i&#47;255.0)*255)==i for i in range(256))</code>"
                },
                {
                    "owner": {
                        "account_id": 13540458,
                        "reputation": 5001,
                        "user_id": 9768291,
                        "user_type": "registered",
                        "display_name": "payne"
                    },
                    "reply_to_user": {
                        "account_id": 3379153,
                        "reputation": 201117,
                        "user_id": 2836621,
                        "user_type": "registered",
                        "display_name": "Mark Setchell"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1538513165,
                    "post_id": 52490653,
                    "comment_id": 92166570,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment92166570_52490653",
                    "body": "@MarkSetchell With my university courses, I haven&#39;t had much time to work on the project much. I think the TIFF solution seems decent, though I&#39;m unsure if anyone can just visualize a TIFF image without installing extra software. The numpy solution probably will not work (for the same reason I just mentioned for TIFF). Sorry for my lack of feedback, I&#39;m very occupied out here. I will try out the TIFF method eventually. My model some times pops out negative numbers as values for the image: is there a way to clip values when saving to TIFF ?"
                },
                {
                    "owner": {
                        "account_id": 4600819,
                        "reputation": 4950,
                        "user_id": 3731622,
                        "user_type": "registered",
                        "accept_rate": 36,
                        "display_name": "user3731622"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1539293526,
                    "post_id": 52490653,
                    "comment_id": 92461123,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images#comment92461123_52490653",
                    "body": "What packages/libraries besides tifffile support saving floating point images?"
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 13540458,
                                "reputation": 5001,
                                "user_id": 9768291,
                                "user_type": "registered",
                                "display_name": "payne"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1537873687,
                            "post_id": 52493743,
                            "comment_id": 91933769,
                            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#comment91933769_52493743",
                            "body": "I forgot to mention: as part of the requirements, people should generally be able to visualize the image saved on their computer, and as an enormous bonus <code>matplotlib</code> should be able to display the saved image. The <code>np.save</code> avenue is quite interesting, but can it be visualize directly?"
                        },
                        {
                            "owner": {
                                "account_id": 3379153,
                                "reputation": 201117,
                                "user_id": 2836621,
                                "user_type": "registered",
                                "display_name": "Mark Setchell"
                            },
                            "reply_to_user": {
                                "account_id": 13540458,
                                "reputation": 5001,
                                "user_id": 9768291,
                                "user_type": "registered",
                                "display_name": "payne"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1537874567,
                            "post_id": 52493743,
                            "comment_id": 91934302,
                            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#comment91934302_52493743",
                            "body": "In that case, you are probably better going with a floating point TIFF - I have added some demo code. <b>ImageMagick</b> can still convert and display such TIFFs."
                        },
                        {
                            "owner": {
                                "account_id": 13540458,
                                "reputation": 5001,
                                "user_id": 9768291,
                                "user_type": "registered",
                                "display_name": "payne"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1537874879,
                            "post_id": 52493743,
                            "comment_id": 91934487,
                            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#comment91934487_52493743",
                            "body": "And should my decision change in case the loaded dataset is already in PNG ?"
                        },
                        {
                            "owner": {
                                "account_id": 3379153,
                                "reputation": 201117,
                                "user_id": 2836621,
                                "user_type": "registered",
                                "display_name": "Mark Setchell"
                            },
                            "reply_to_user": {
                                "account_id": 13540458,
                                "reputation": 5001,
                                "user_id": 9768291,
                                "user_type": "registered",
                                "display_name": "payne"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1537875163,
                            "post_id": 52493743,
                            "comment_id": 91934644,
                            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#comment91934644_52493743",
                            "body": "It depends on your needs and design. You could check the type of your input array inside your function and switch formats accordingly, by looking at <code>np_img.dtype</code>"
                        },
                        {
                            "owner": {
                                "account_id": 9938133,
                                "reputation": 50612,
                                "user_id": 7355741,
                                "user_type": "registered",
                                "display_name": "fmw42"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1537892268,
                            "post_id": 52493743,
                            "comment_id": 91945861,
                            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#comment91945861_52493743",
                            "body": "Just a small point, but -normalize will clip a the high and low end of the histogram, which is not good if you are trying to visualize your data unchanged. If you want to view it, I would suggest using -auto-level to do the stretch from floats to visual range of integers."
                        },
                        {
                            "owner": {
                                "account_id": 3379153,
                                "reputation": 201117,
                                "user_id": 2836621,
                                "user_type": "registered",
                                "display_name": "Mark Setchell"
                            },
                            "reply_to_user": {
                                "account_id": 9938133,
                                "reputation": 50612,
                                "user_id": 7355741,
                                "user_type": "registered",
                                "display_name": "fmw42"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1537893511,
                            "post_id": 52493743,
                            "comment_id": 91946526,
                            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#comment91946526_52493743",
                            "body": "@fmw42 Fred, yes, that&#39;s a better idea and I have edited it in. I was just trying to avoid the inevitable <i>&quot;my image is black&quot;</i> issue. Thank you."
                        },
                        {
                            "owner": {
                                "account_id": 13540458,
                                "reputation": 5001,
                                "user_id": 9768291,
                                "user_type": "registered",
                                "display_name": "payne"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1539318004,
                            "post_id": 52493743,
                            "comment_id": 92466338,
                            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#comment92466338_52493743",
                            "body": "@MarkSetchell I&#39;ve had a little bit of time to work on this. As suggested ins ome other comments, I tried this and it seemed to work fine: <code>plt.imsave(&#39;my_image.png&#39;, image_to_save, cmap=plt.cm.gray)</code>. Is there anything wrong with it in regards to my requirements ?"
                        }
                    ],
                    "owner": {
                        "account_id": 3379153,
                        "reputation": 201117,
                        "user_id": 2836621,
                        "user_type": "registered",
                        "display_name": "Mark Setchell"
                    },
                    "comment_count": 7,
                    "is_accepted": false,
                    "score": 11,
                    "last_activity_date": 1537893414,
                    "last_edit_date": 1537893414,
                    "creation_date": 1537864041,
                    "answer_id": 52493743,
                    "question_id": 52490653,
                    "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images/52493743#52493743",
                    "body": "<p>You can save and read back <code>numpy</code> arrays of floats losslessly and natively without any libraries being required:</p>\n\n<pre><code>import numpy as np\n\n# Create 10 random floats in range 0..1 in array \"b\"\nb = np.random.random_sample((10,)).astype(np.float32)\n\n# Save to file\nnp.save('BunchOfFloats.npy',b)\n\n# Read back into different array \"r\"\nr = np.load('BunchOfFloats.npy')\n\n# Inspect b \narray([0.26565347, 0.7193414 , 0.19435954, 0.58980538, 0.28096624,\n   0.88655137, 0.84847042, 0.80156026, 0.94315194, 0.76888901])\n\n# Inspect r\narray([0.26565347, 0.7193414 , 0.19435954, 0.58980538, 0.28096624,\n   0.88655137, 0.84847042, 0.80156026, 0.94315194, 0.76888901])\n</code></pre>\n\n<p>Documentation is available <a href=\"https://docs.scipy.org/doc/numpy-1.14.5/reference/generated/numpy.save.html\" rel=\"noreferrer\">here</a>.</p>\n\n<hr>\n\n<p>Alternatively, as suggested in the comments by @WarrenWekesser you could use a TIFF file which can store floats, and even doubles.</p>\n\n<pre><code>import numpy as np\nfrom tifffile import imsave\n\n# Generate float data\nb=np.random.random_sample((768,1024,3)).astype(np.float32)\n\n# Save as TIF - when reading, use \"data = imread('file.tif')\"\nimsave('result.tif',b)\n</code></pre>\n\n<hr>\n\n<p>Yet another option is a <code>PFM</code> file, described <a href=\"http://www.pauldebevec.com/Research/HDR/PFM/\" rel=\"noreferrer\">here</a> and <a href=\"http://netpbm.sourceforge.net/doc/pfm.html\" rel=\"noreferrer\">here</a>.</p>\n\n<p>This is a very simple format that you could write and read yourself, and has the benefit that other packages such as <strong>ImageMagick</strong> and <strong>GIMP</strong> understand it, so you could save your data as a <code>PFM</code> file and then convert at the command line with <strong>ImageMagick</strong> to <code>JPEG</code> or <code>PNG</code> for viewing:</p>\n\n<pre><code>magick image.pfm -auto-level result.png\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 13540458,
                "reputation": 5001,
                "user_id": 9768291,
                "user_type": "registered",
                "display_name": "payne"
            },
            "comment_count": 9,
            "is_answered": true,
            "answer_count": 1,
            "score": 7,
            "last_activity_date": 1617016673,
            "creation_date": 1537850239,
            "last_edit_date": 1537851140,
            "question_id": 52490653,
            "link": "https://stackoverflow.com/questions/52490653/saving-float-numpy-images",
            "title": "Saving &#39;float&#39; numpy images",
            "body": "<p>Here is the code I am currently using:</p>\n\n<pre><code>from PIL import Image\nimport numpy as np\n\ndef save_np_img(np_img, path, name):\n    \"\"\"\n    To save the image.\n    :param np_img: numpy_array type image\n    :param path: string type of the existing path where to save the image\n    :param name: string type that includes the format (ex:\"bob.png\")\n    :return: numpy array\n    \"\"\"\n\n    assert isinstance(path, str), 'Path of wrong type! (Must be String)'\n    assert isinstance(name, str), 'Name of wrong type! (Must be String)'\n\n    im = Image.fromarray(np_img)\n    im.save(path + name)\n\n    return np_img\n</code></pre>\n\n<p>I would like to be able to save images which contain <code>float</code> values, just like I can currently save <code>int</code> valued-images.</p>\n\n<p>I get a <code>TypeError</code> message when I try to save my images which have been transformed through <code>np.divide(img, 255.)</code>, and thus when trying to save numpy_arrays which contain floats.</p>\n\n<p>(You can suggest other librairies, too.)</p>\n\n<p><strong>NOTE:</strong> The values, when not integers between 0 and 255, are floats between 0 and 1. It is crucial for me to remain as lossless as possible. My initial thought was that I could simply use <code>np.multiply(img, 255)</code> but I wasn't sure if that would lose some precision (nor if it would return integers, actually).</p>\n\n<p><strong>EDIT:</strong> Basically, is <a href=\"https://stackoverflow.com/a/47292141/9768291\">this</a> method a lossless convertion? That is, if I had a numpy_array of <code>ints</code>, divided it by <code>255.</code>, and then reconverted into <code>ints</code>, am I losing information? If so, how to avoid that?</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 6900
}