{
    "items": [
        {
            "tags": [
                "python",
                "fastapi",
                "pydantic"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 915658,
                        "reputation": 12424,
                        "user_id": 949890,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "Samuel Colvin"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1581173128,
                    "post_id": 60127234,
                    "comment_id": 106345727,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi#comment106345727_60127234",
                    "body": "Well looks like the body is empty, or at least <code>form_data</code> is missing. But impossible to help more without seeing what you&#39;re submitting."
                },
                {
                    "owner": {
                        "account_id": 6163255,
                        "reputation": 4439,
                        "user_id": 4804108,
                        "user_type": "registered",
                        "accept_rate": 50,
                        "display_name": "shanmuga"
                    },
                    "reply_to_user": {
                        "account_id": 915658,
                        "reputation": 12424,
                        "user_id": 949890,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "Samuel Colvin"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1581185808,
                    "post_id": 60127234,
                    "comment_id": 106349231,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi#comment106349231_60127234",
                    "body": "In the above code GET request gives a HTML form, I click submit on that. I get error for all values i give."
                },
                {
                    "owner": {
                        "account_id": 915658,
                        "reputation": 12424,
                        "user_id": 949890,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "Samuel Colvin"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1581336973,
                    "post_id": 60127234,
                    "comment_id": 106386138,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi#comment106386138_60127234",
                    "body": "The first step to working out what&#39;s going wrong is to inspect the POST request and see what&#39;s being submitted."
                },
                {
                    "owner": {
                        "account_id": 6163255,
                        "reputation": 4439,
                        "user_id": 4804108,
                        "user_type": "registered",
                        "accept_rate": 50,
                        "display_name": "shanmuga"
                    },
                    "reply_to_user": {
                        "account_id": 915658,
                        "reputation": 12424,
                        "user_id": 949890,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "Samuel Colvin"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1581417415,
                    "post_id": 60127234,
                    "comment_id": 106417638,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi#comment106417638_60127234",
                    "body": "The request body contains <code>no=1&amp;nm=abcd</code>"
                },
                {
                    "owner": {
                        "account_id": 23863113,
                        "reputation": 26947,
                        "user_id": 17865804,
                        "user_type": "registered",
                        "display_name": "Chris"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1651323510,
                    "post_id": 60127234,
                    "comment_id": 127340240,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi#comment127340240_60127234",
                    "body": "Please have a look at <a href=\"https://stackoverflow.com/a/71439821/17865804\">this</a> and <a href=\"https://stackoverflow.com/a/70640522/17865804\">this</a> answer as well."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 6163255,
                                "reputation": 4439,
                                "user_id": 4804108,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "shanmuga"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1581503577,
                            "post_id": 60177123,
                            "comment_id": 106453603,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60177123#comment106453603_60177123",
                            "body": "Thanks for the answer but this doesn&#39;t help. I am asking for specific usage. I am trying to avoid any extra code adding complexity. Also I plan to mix this with other simple variables/files submitted from form. Similar to what can be done using <code>Path</code> or <code>Body</code>"
                        }
                    ],
                    "owner": {
                        "account_id": 7137303,
                        "reputation": 69,
                        "user_id": 5456408,
                        "user_type": "registered",
                        "display_name": "Includeamin"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1581454070,
                    "creation_date": 1581454070,
                    "answer_id": 60177123,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60177123#60177123",
                    "body": "<p>you can use data-form like below:</p>\n\n<pre><code>@app.post(\"/form\", response_model=SimpleModel)\ndef form_post(no: int = Form(...),nm: str = Form(...)):\n    return SimpleModel(no=no,nm=nm)\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 6163255,
                                "reputation": 4439,
                                "user_id": 4804108,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "shanmuga"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1584536196,
                            "post_id": 60670614,
                            "comment_id": 107465595,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60670614#comment107465595_60670614",
                            "body": "Not sure how this is helpful. Can you give a short working example."
                        },
                        {
                            "owner": {
                                "account_id": 16596864,
                                "reputation": 927,
                                "user_id": 11993534,
                                "user_type": "registered",
                                "display_name": "Nikita Davydov"
                            },
                            "reply_to_user": {
                                "account_id": 6163255,
                                "reputation": 4439,
                                "user_id": 4804108,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "shanmuga"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1584537451,
                            "post_id": 60670614,
                            "comment_id": 107466231,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60670614#comment107466231_60670614",
                            "body": "Check it out now"
                        },
                        {
                            "owner": {
                                "account_id": 12671520,
                                "reputation": 18972,
                                "user_id": 9208887,
                                "user_type": "registered",
                                "display_name": "The Fool"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1641335749,
                            "post_id": 60670614,
                            "comment_id": 124778070,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60670614#comment124778070_60670614",
                            "body": "how is the body model named in the swagger ui using this? Thats the only reason I want to use a Pydantic class."
                        },
                        {
                            "owner": {
                                "account_id": 16890576,
                                "reputation": 83,
                                "user_id": 12214381,
                                "user_type": "registered",
                                "display_name": "oholimoli"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1693558761,
                            "post_id": 60670614,
                            "comment_id": 135779985,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60670614#comment135779985_60670614",
                            "body": "this solution isn&#39;t working with fastapi 0.103.0"
                        },
                        {
                            "owner": {
                                "account_id": 10054421,
                                "reputation": 91,
                                "user_id": 7433128,
                                "user_type": "registered",
                                "display_name": "julia uss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1694792289,
                            "post_id": 60670614,
                            "comment_id": 135942253,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60670614#comment135942253_60670614",
                            "body": "Solution for fastapi 0.103.1: <a href=\"https://stackoverflow.com/a/77113651/7433128\">stackoverflow.com/a/77113651/7433128</a>"
                        }
                    ],
                    "owner": {
                        "account_id": 16596864,
                        "reputation": 927,
                        "user_id": 11993534,
                        "user_type": "registered",
                        "display_name": "Nikita Davydov"
                    },
                    "comment_count": 5,
                    "is_accepted": true,
                    "score": 70,
                    "last_activity_date": 1662970524,
                    "last_edit_date": 1662970524,
                    "creation_date": 1584103056,
                    "answer_id": 60670614,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/60670614#60670614",
                    "body": "<p>I found a solution that can help us to use Pydantic with FastAPI forms :)</p>\n<p>My code:</p>\n<pre><code>class AnyForm(BaseModel):\n    any_param: str\n    any_other_param: int = 1\n\n    @classmethod\n    def as_form(\n        cls,\n        any_param: str = Form(...),\n        any_other_param: int = Form(1)\n    ) -&gt; AnyForm:\n        return cls(any_param=any_param, any_other_param=any_other_param)\n\n@router.post('')\nasync def any_view(form_data: AnyForm = Depends(AnyForm.as_form)):\n        ...\n</code></pre>\n<p>It's shown in the Swagger as a usual form.</p>\n<p>It can be more generic as a decorator:</p>\n<pre><code>import inspect\nfrom typing import Type\n\nfrom fastapi import Form\nfrom pydantic import BaseModel\nfrom pydantic.fields import ModelField\n\ndef as_form(cls: Type[BaseModel]):\n    new_parameters = []\n\n    for field_name, model_field in cls.__fields__.items():\n        model_field: ModelField  # type: ignore\n\n        new_parameters.append(\n             inspect.Parameter(\n                 model_field.alias,\n                 inspect.Parameter.POSITIONAL_ONLY,\n                 default=Form(...) if model_field.required else Form(model_field.default),\n                 annotation=model_field.outer_type_,\n             )\n         )\n\n    async def as_form_func(**data):\n        return cls(**data)\n\n    sig = inspect.signature(as_form_func)\n    sig = sig.replace(parameters=new_parameters)\n    as_form_func.__signature__ = sig  # type: ignore\n    setattr(cls, 'as_form', as_form_func)\n    return cls\n</code></pre>\n<p>And the usage looks like</p>\n<pre><code>@as_form\nclass Test(BaseModel):\n    param: str\n    a: int = 1\n    b: str = '2342'\n    c: bool = False\n    d: Optional[float] = None\n\n\n@router.post('/me', response_model=Test)\nasync def me(request: Request, form: Test = Depends(Test.as_form)):\n    return form\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 968863,
                        "reputation": 4803,
                        "user_id": 991805,
                        "user_type": "registered",
                        "accept_rate": 79,
                        "display_name": "Kassym Dorsel"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1590412333,
                    "last_edit_date": 1590412333,
                    "creation_date": 1586917499,
                    "answer_id": 61220305,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/61220305#61220305",
                    "body": "<p>If you're only looking at abstracting the form data into a class you can do it with a plain class</p>\n\n<pre><code>from fastapi import Form, Depends\n\nclass AnyForm:\n    def __init__(self, any_param: str = Form(...), any_other_param: int = Form(1)):\n        self.any_param = any_param\n        self.any_other_param = any_other_param\n\n    def __str__(self):\n        return \"AnyForm \" + str(self.__dict__)\n\n@app.post('/me')\nasync def me(form: AnyForm = Depends()):\n    print(form)\n    return form\n</code></pre>\n\n<p>And it can also be turned into a Pydantic Model</p>\n\n<pre><code>from uuid import UUID, uuid4\nfrom fastapi import Form, Depends\nfrom pydantic import BaseModel\n\nclass AnyForm(BaseModel):\n    id: UUID\n    any_param: str\n    any_other_param: int\n\n    def __init__(self, any_param: str = Form(...), any_other_param: int = Form(1)):\n        id = uuid4()\n        super().__init__(id, any_param, any_other_param)\n\n@app.post('/me')\nasync def me(form: AnyForm = Depends()):\n    print(form)\n    return form\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 503196,
                        "reputation": 91,
                        "user_id": 1957555,
                        "user_type": "registered",
                        "display_name": "stefanlsd"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 9,
                    "last_activity_date": 1653421073,
                    "last_edit_date": 1653421073,
                    "creation_date": 1609658698,
                    "answer_id": 65547551,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/65547551#65547551",
                    "body": "<p>I implemented the solution found here <a href=\"https://github.com/tiangolo/fastapi/issues/1989\" rel=\"noreferrer\">Mause solution</a> and it seemed to work</p>\n<pre><code>from fastapi.testclient import TestClient\nfrom fastapi import FastAPI, Depends, Form\nfrom pydantic import BaseModel\n\n\napp = FastAPI()\n\n\ndef form_body(cls):\n    cls.__signature__ = cls.__signature__.replace(\n        parameters=[\n            arg.replace(default=Form(...))\n            for arg in cls.__signature__.parameters.values()\n        ]\n    )\n    return cls\n\n\n@form_body\nclass Item(BaseModel):\n    name: str\n    another: str\n\n\n@app.post('/test', response_model=Item)\ndef endpoint(item: Item = Depends(Item)):\n    return item\n\n\ntc = TestClient(app)\n\n\nr = tc.post('/test', data={'name': 'name', 'another': 'another'})\n\nassert r.status_code == 200\nassert r.json() == {'name': 'name', 'another': 'another'}\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": -1,
                                "reputation": 1,
                                "user_id": -1,
                                "user_type": "moderator",
                                "display_name": "Community"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1653523818,
                            "post_id": 72384428,
                            "comment_id": 127876120,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/72384428#comment127876120_72384428",
                            "body": "Your answer could be improved with additional supporting information. Please <a href=\"https://stackoverflow.com/posts/72384428/edit\">edit</a> to add further details, such as citations or documentation, so that others can confirm that your answer is correct. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>."
                        }
                    ],
                    "owner": {
                        "account_id": 24489647,
                        "reputation": 113,
                        "user_id": 18406890,
                        "user_type": "registered",
                        "display_name": "artemonsh"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1655534340,
                    "last_edit_date": 1655534340,
                    "creation_date": 1653514677,
                    "answer_id": 72384428,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/72384428#72384428",
                    "body": "<p>Create the class this way:</p>\n<pre class=\"lang-py prettyprint-override\"><code>from fastapi import Form\n\nclass SomeForm:\n\n    def __init__(\n        self,\n        username: str = Form(...),\n        password: str = Form(...),\n        authentication_code: str = Form(...)\n    ):\n        self.username = username\n        self.password = password\n        self.authentication_code = authentication_code\n\n\n@app.post(&quot;/login&quot;, tags=['Auth &amp; Users'])\nasync def auth(\n        user: SomeForm = Depends()\n):\n    # return something / set cookie\n</code></pre>\n<p>Result:</p>\n<p><img src=\"https://i.stack.imgur.com/XCdYd.png\" alt=\"Result\" /></p>\n<p>If you want then to make an http request from javascript you must use FormData to construct the request:</p>\n<pre class=\"lang-js prettyprint-override\"><code>const fd = new FormData()\nfd.append('username', username)\nfd.append('password', password)\n\naxios.post(`/login`, fd)\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 15831513,
                                "reputation": 843,
                                "user_id": 11422689,
                                "user_type": "registered",
                                "display_name": "William Le"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1664558204,
                            "post_id": 73612388,
                            "comment_id": 130507137,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/73612388#comment130507137_73612388",
                            "body": "This solution is the cleanest looking but is it the fastest approach in terms of data validation speed?"
                        },
                        {
                            "owner": {
                                "account_id": 14390209,
                                "reputation": 2465,
                                "user_id": 10394971,
                                "user_type": "registered",
                                "display_name": "Irfanuddin"
                            },
                            "reply_to_user": {
                                "account_id": 15831513,
                                "reputation": 843,
                                "user_id": 11422689,
                                "user_type": "registered",
                                "display_name": "William Le"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1664585426,
                            "post_id": 73612388,
                            "comment_id": 130512407,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/73612388#comment130512407_73612388",
                            "body": "Interesting, I\u2019ll do a comparison between this and Pydantic Dataclass on the speed and make an update."
                        },
                        {
                            "owner": {
                                "account_id": 291103,
                                "reputation": 17789,
                                "user_id": 593047,
                                "user_type": "registered",
                                "accept_rate": 60,
                                "display_name": "ron rothman"
                            },
                            "edited": false,
                            "score": 5,
                            "creation_date": 1680718625,
                            "post_id": 73612388,
                            "comment_id": 133947432,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/73612388#comment133947432_73612388",
                            "body": "Data validation speed, really? Do you really care about shaving a few milliseconds off of your HTTP requests? I&#39;m familiar with only very few use cases where that would matter."
                        },
                        {
                            "owner": {
                                "account_id": 152716,
                                "reputation": 388,
                                "user_id": 6172158,
                                "user_type": "registered",
                                "display_name": "Ted Stresen-Reuter"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1695199300,
                            "post_id": 73612388,
                            "comment_id": 135990816,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/73612388#comment135990816_73612388",
                            "body": "Just wondering, is there any advantage to inheriting the BaseModel pydantic class?"
                        },
                        {
                            "owner": {
                                "account_id": 14390209,
                                "reputation": 2465,
                                "user_id": 10394971,
                                "user_type": "registered",
                                "display_name": "Irfanuddin"
                            },
                            "reply_to_user": {
                                "account_id": 152716,
                                "reputation": 388,
                                "user_id": 6172158,
                                "user_type": "registered",
                                "display_name": "Ted Stresen-Reuter"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1695576948,
                            "post_id": 73612388,
                            "comment_id": 136039793,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/73612388#comment136039793_73612388",
                            "body": "@TedStresen-Reuter, yes there are few advantages like faster serialization, support for certain data types, data validation that Pydantic offers, etc."
                        }
                    ],
                    "owner": {
                        "account_id": 14390209,
                        "reputation": 2465,
                        "user_id": 10394971,
                        "user_type": "registered",
                        "display_name": "Irfanuddin"
                    },
                    "comment_count": 5,
                    "is_accepted": false,
                    "score": 16,
                    "last_activity_date": 1662395818,
                    "creation_date": 1662395818,
                    "answer_id": 73612388,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/73612388#73612388",
                    "body": "<p>You can do this even simpler using dataclasses</p>\n<pre class=\"lang-py prettyprint-override\"><code>from dataclasses import dataclass\nfrom fastapi import FastAPI, Form, Depends\nfrom starlette.responses import HTMLResponse\n\napp = FastAPI()\n\n\n@app.get(&quot;/form&quot;, response_class=HTMLResponse)\ndef form_get():\n    return '''&lt;form method=&quot;post&quot;&gt; \n    &lt;input type=&quot;text&quot; name=&quot;no&quot; value=&quot;1&quot;/&gt; \n    &lt;input type=&quot;text&quot; name=&quot;nm&quot; value=&quot;abcd&quot;/&gt; \n    &lt;input type=&quot;submit&quot;/&gt; \n    &lt;/form&gt;'''\n\n\n@dataclass\nclass SimpleModel:\n    no: int = Form(...)\n    nm: str = Form(...)\n\n\n@app.post(&quot;/form&quot;)\ndef form_post(form_data: SimpleModel = Depends()):\n    return form_data\n\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 13068523,
                        "reputation": 452,
                        "user_id": 9442957,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "Zak Stucke"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1669045167,
                    "last_edit_date": 1669045167,
                    "creation_date": 1669044683,
                    "answer_id": 74521269,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/74521269#74521269",
                    "body": "<p><strong>Tldr</strong>: a mypy compliant, inheritable version of other solutions that produces the correct generated OpenAPI schema field types rather than any/unknown types.</p>\n<p>Existing solutions set the FastAPI params to <code>typing.Any</code> to prevent the validation from occurring twice and failing, this causes the generated API spec to have any/unknown param types for these form fields.</p>\n<p>This solution temporarily injects the correct annotations to the routes before schema generation, and resets them in line with other solutions afterwards.</p>\n<pre class=\"lang-py prettyprint-override\"><code># Example usage\nclass ExampleForm(FormBaseModel):\n    name: str\n    age: int\n\n@api.post(&quot;/test&quot;)\nasync def endpoint(form: ExampleForm = Depends(ExampleForm.as_form)):\n    return form.dict()\n</code></pre>\n<p><code>form_utils.py</code></p>\n<pre class=\"lang-py prettyprint-override\"><code>import inspect\nfrom pydantic import BaseModel, ValidationError\nfrom fastapi import Form\nfrom fastapi.exceptions import RequestValidationError\n\nclass FormBaseModel(BaseModel):\n\n    def __init_subclass__(cls, *args, **kwargs):\n        field_default = Form(...)\n        new_params = []\n        schema_params = []\n        for field in cls.__fields__.values():\n            new_params.append(\n                inspect.Parameter(\n                    field.alias,\n                    inspect.Parameter.POSITIONAL_ONLY,\n                    default=Form(field.default) if not field.required else field_default,\n                    annotation=inspect.Parameter.empty,\n                )\n            )\n            schema_params.append(\n                inspect.Parameter(\n                    field.alias,\n                    inspect.Parameter.POSITIONAL_ONLY,\n                    default=Form(field.default) if not field.required else field_default,\n                    annotation=field.annotation,\n                )\n            )\n\n        async def _as_form(**data):\n            try:\n                return cls(**data)\n            except ValidationError as e:\n                raise RequestValidationError(e.raw_errors)\n\n        async def _schema_mocked_call(**data):\n            &quot;&quot;&quot;\n            A fake version which is given the actual annotations, rather than typing.Any,\n            this version is used to generate the API schema, then the routes revert back to the original afterwards.\n            &quot;&quot;&quot;\n            pass\n\n        _as_form.__signature__ = inspect.signature(_as_form).replace(parameters=new_params)  # type: ignore\n        setattr(cls, &quot;as_form&quot;, _as_form)\n        _schema_mocked_call.__signature__ = inspect.signature(_schema_mocked_call).replace(parameters=schema_params)  # type: ignore\n        # Set the schema patch func as an attr on the _as_form func so it can be accessed later from the route itself:\n        setattr(_as_form, &quot;_schema_mocked_call&quot;, _schema_mocked_call)\n\n    @staticmethod\n    def as_form(parameters=[]) -&gt; &quot;FormBaseModel&quot;:\n        raise NotImplementedError\n</code></pre>\n<p><code># asgi.py</code></p>\n<pre class=\"lang-py prettyprint-override\"><code>from fastapi.routing import APIRoute\nfrom fastapi import FastAPI\nfrom fastapi.openapi.utils import get_openapi\nfrom fastapi.dependencies.utils import get_dependant, get_body_field\n\napi = FastAPI()\n\n\ndef custom_openapi():\n    if api.openapi_schema:\n        return api.openapi_schema\n\n    def create_reset_callback(route, deps, body_field):\n        def reset_callback():\n            route.dependant.dependencies = deps\n            route.body_field = body_field\n\n        return reset_callback\n\n    # The functions to call after schema generation to reset the routes to their original state:\n    reset_callbacks = []\n\n    for route in api.routes:\n        if isinstance(route, APIRoute):\n            orig_dependencies = list(route.dependant.dependencies)\n            orig_body_field = route.body_field\n\n            is_modified = False\n            for dep_index, dependency in enumerate(route.dependant.dependencies):\n                # If it's a form dependency, set the annotations to their true values:\n                if dependency.call.__name__ == &quot;_as_form&quot;:  # type: ignore\n                    is_modified = True\n                    route.dependant.dependencies[dep_index] = get_dependant(\n                        path=dependency.path if dependency.path else route.path,\n                        # This mocked func was set as an attribute on the original, correct function,\n                        # replace it here temporarily:\n                        call=dependency.call._schema_mocked_call,  # type: ignore\n                        name=dependency.name,\n                        security_scopes=dependency.security_scopes,\n                        use_cache=False,  # Overriding, so don't want cached actual version.\n                    )\n\n            if is_modified:\n                route.body_field = get_body_field(dependant=route.dependant, name=route.unique_id)\n\n                reset_callbacks.append(\n                    create_reset_callback(route, orig_dependencies, orig_body_field)\n                )\n\n    openapi_schema = get_openapi(\n        title=&quot;foo&quot;,\n        version=&quot;bar&quot;,\n        routes=api.routes,\n    )\n\n    for callback in reset_callbacks:\n        callback()\n\n    api.openapi_schema = openapi_schema\n    return api.openapi_schema\n\n\napi.openapi = custom_openapi  # type: ignore[assignment]\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 1917464,
                                "reputation": 495,
                                "user_id": 1729759,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "EanX"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1696239107,
                            "post_id": 77113651,
                            "comment_id": 136123080,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/77113651#comment136123080_77113651",
                            "body": "I tried your suggested solution but I get: <code>SyntaxError: invalid syntax. Perhaps you forgot a comma?</code>. in as_form definition."
                        },
                        {
                            "owner": {
                                "account_id": 10054421,
                                "reputation": 91,
                                "user_id": 7433128,
                                "user_type": "registered",
                                "display_name": "julia uss"
                            },
                            "reply_to_user": {
                                "account_id": 1917464,
                                "reputation": 495,
                                "user_id": 1729759,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "EanX"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1696593366,
                            "post_id": 77113651,
                            "comment_id": 136176452,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/77113651#comment136176452_77113651",
                            "body": "I don&#39;t see where there could be a comma. I works in python 3.11"
                        },
                        {
                            "owner": {
                                "account_id": 1148231,
                                "reputation": 55,
                                "user_id": 1130517,
                                "user_type": "registered",
                                "display_name": "Pat David"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1696784983,
                            "post_id": 77113651,
                            "comment_id": 136194661,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/77113651#comment136194661_77113651",
                            "body": "pyflakes reported the same <code>pyflakes:Error:invalid syntax. Perhaps you forgot a comma?</code> On line: <code>annotation=Annotated[model_field.annotation, *model_field.metadata, Form()]</code>  However, it still works as expected. :)"
                        },
                        {
                            "owner": {
                                "account_id": 10054421,
                                "reputation": 91,
                                "user_id": 7433128,
                                "user_type": "registered",
                                "display_name": "julia uss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1701239782,
                            "post_id": 77113651,
                            "comment_id": 136749599,
                            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/77113651#comment136749599_77113651",
                            "body": "Yes, it is the comma at the end of line. It was added by black. You can remove it."
                        }
                    ],
                    "owner": {
                        "account_id": 10054421,
                        "reputation": 91,
                        "user_id": 7433128,
                        "user_type": "registered",
                        "display_name": "julia uss"
                    },
                    "comment_count": 4,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1694792222,
                    "creation_date": 1694792222,
                    "answer_id": 77113651,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/77113651#77113651",
                    "body": "<p>I changed a bit <a href=\"https://stackoverflow.com/a/60670614/7433128\">proposal of Nikita Davydov</a> for validators to work in Pydatic2 and FastAPI 0.103.1</p>\n<pre><code>def as_form(cls):\n    new_params = [\n        inspect.Parameter(\n            field_name,\n            inspect.Parameter.POSITIONAL_ONLY,\n            default=model_field.default,\n            annotation=Annotated[model_field.annotation, *model_field.metadata, Form()],\n        )\n        for field_name, model_field in cls.model_fields.items()\n    ]\n\n    cls.__signature__ = cls.__signature__.replace(parameters=new_params)\n\n    return cls\n</code></pre>\n<p>The usage:</p>\n<pre><code>def before_validate_int(value: int) -&gt; int:\n    raise ValueError('before int')\n\n\nMyInt = Annotated[int, BeforeValidator(before_validate_int)]\n\n\n@as_form\nclass User(BaseModel):\n    age: MyInt\n\n\n@app.post(&quot;/postdata&quot;)\ndef postdata(user: User = Depends()):\n    return {&quot;age&quot;: user.age}\n</code></pre>\n<p>When trying to post data validation error is returned as expected:</p>\n<pre><code>{\n  &quot;detail&quot;: [\n    {\n      &quot;type&quot;: &quot;value_error&quot;,\n      &quot;loc&quot;: [\n        &quot;body&quot;,\n        &quot;age&quot;\n      ],\n      &quot;msg&quot;: &quot;Value error, before int&quot;,\n      &quot;input&quot;: &quot;12&quot;,\n      &quot;ctx&quot;: {\n        &quot;error&quot;: {}\n      },\n      &quot;url&quot;: &quot;https://errors.pydantic.dev/2.3/v/value_error&quot;\n    }\n  ]\n}\n\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 44009,
                        "reputation": 1239,
                        "user_id": 128899,
                        "user_type": "registered",
                        "display_name": "Roger Collins"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1695923528,
                    "last_edit_date": 1695923528,
                    "creation_date": 1695828642,
                    "answer_id": 77188913,
                    "question_id": 60127234,
                    "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi/77188913#77188913",
                    "body": "<p>Updated the answer from <a href=\"https://stackoverflow.com/a/74521269/128899\">Zac Stucke</a> for his solution to work in Pydantic2 (and mypy support)</p>\n<p><code># form_utils.py</code></p>\n<pre class=\"lang-py prettyprint-override\"><code>from typing import Any\nimport inspect\n\nfrom pydantic import BaseModel, ValidationError\nfrom fastapi import Form\nfrom fastapi.exceptions import RequestValidationError\n\napi = FastAPI()\n\nclass FormBaseModel(BaseModel):\n    @classmethod\n    def __pydantic_init_subclass__(cls, *args: Any, **kwargs: Any) -&gt; None:\n        super().__pydantic_init_subclass__(*args, **kwargs)\n        new_params = []\n        schema_params = []\n        for field_name, field in cls.model_fields.items():\n            field_default = Form(...)\n            new_params.append(\n                inspect.Parameter(\n                    field_name,\n                    inspect.Parameter.POSITIONAL_ONLY,\n                    default=Form(field.default) if not field.is_required() else field_default,\n                    annotation=inspect.Parameter.empty,\n                )\n            )\n            schema_params.append(\n                inspect.Parameter(\n                    field_name,\n                    inspect.Parameter.POSITIONAL_ONLY,\n                    default=Form(field.default) if not field.is_required() else field_default,\n                    annotation=field.annotation,\n                )\n            )\n\n        async def _as_form(**data: dict[str, Any]) -&gt; BaseModel:\n            try:\n                return cls(**data)\n            except ValidationError as e:\n                raise RequestValidationError(e.raw_errors)\n\n        async def _schema_mocked_call(**data: dict[str, Any]) -&gt; None:\n            &quot;&quot;&quot;\n            A fake version which is given the actual annotations, rather than typing.Any,\n            this version is used to generate the API schema, then the routes revert back to the original afterwards.\n            &quot;&quot;&quot;\n            pass\n\n        _as_form.__signature__ = inspect.signature(_as_form).replace(parameters=new_params)  # type: ignore\n        setattr(cls, &quot;as_form&quot;, _as_form)\n        _schema_mocked_call.__signature__ = inspect.signature(_schema_mocked_call).replace(  # type: ignore\n            parameters=schema_params\n        )\n        # Set the schema patch func as an attr on the _as_form func so it can be accessed later from the route itself:\n        setattr(_as_form, &quot;_schema_mocked_call&quot;, _schema_mocked_call)\n\n    @staticmethod\n    def as_form(parameters: list[str] = []) -&gt; &quot;FormBaseModel&quot;:\n        raise NotImplementedError\n\napi.openapi = custom_openapi  # type: ignore[assignment]\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 6163255,
                "reputation": 4439,
                "user_id": 4804108,
                "user_type": "registered",
                "accept_rate": 50,
                "display_name": "shanmuga"
            },
            "comment_count": 5,
            "is_answered": true,
            "accepted_answer_id": 60670614,
            "answer_count": 9,
            "score": 52,
            "last_activity_date": 1700099469,
            "creation_date": 1581168588,
            "last_edit_date": 1632369593,
            "question_id": 60127234,
            "link": "https://stackoverflow.com/questions/60127234/how-to-use-a-pydantic-model-with-form-data-in-fastapi",
            "title": "How to use a Pydantic model with Form data in FastAPI?",
            "body": "<p>I am trying to submit data from HTML forms and validate it with a Pydantic model.</p>\n<p>Using this code</p>\n<pre><code>from fastapi import FastAPI, Form\nfrom pydantic import BaseModel\nfrom starlette.responses import HTMLResponse\n\n\napp = FastAPI()\n\n@app.get(&quot;/form&quot;, response_class=HTMLResponse)\ndef form_get():\n    return '''&lt;form method=&quot;post&quot;&gt; \n    &lt;input type=&quot;text&quot; name=&quot;no&quot; value=&quot;1&quot;/&gt; \n    &lt;input type=&quot;text&quot; name=&quot;nm&quot; value=&quot;abcd&quot;/&gt; \n    &lt;input type=&quot;submit&quot;/&gt; \n    &lt;/form&gt;'''\n\n\nclass SimpleModel(BaseModel):\n    no: int\n    nm: str = &quot;&quot;\n\n@app.post(&quot;/form&quot;, response_model=SimpleModel)\ndef form_post(form_data: SimpleModel = Form(...)):\n    return form_data\n</code></pre>\n<p>However, I get the HTTP error: &quot;<code>422</code> Unprocessable Entity&quot;</p>\n<pre><code>{\n    &quot;detail&quot;: [\n        {\n            &quot;loc&quot;: [\n                &quot;body&quot;,\n                &quot;form_data&quot;\n            ],\n            &quot;msg&quot;: &quot;field required&quot;,\n            &quot;type&quot;: &quot;value_error.missing&quot;\n        }\n    ]\n}\n</code></pre>\n<p>The equivalent curl command (generated by Firefox) is</p>\n<pre class=\"lang-none prettyprint-override\"><code>curl 'http://localhost:8001/form' -H 'Content-Type: application/x-www-form-urlencoded' --data 'no=1&amp;nm=abcd'\n</code></pre>\n<p>Here the request body contains <code>no=1&amp;nm=abcd</code>.</p>\n<p>What am I doing wrong?</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 5806
}