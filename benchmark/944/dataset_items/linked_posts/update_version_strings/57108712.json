{
    "items": [
        {
            "tags": [
                "python",
                "regex",
                "string",
                "replace"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 10734404,
                        "reputation": 1060,
                        "user_id": 7899430,
                        "user_type": "registered",
                        "accept_rate": 50,
                        "display_name": "PySaad"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1563526375,
                    "post_id": 57108712,
                    "comment_id": 100737347,
                    "link": "https://stackoverflow.com/questions/57108712/replace-updated-version-strings-in-files-via-python#comment100737347_57108712",
                    "body": "Are you doing this for releasing sdist/bdist and update version on each release?"
                },
                {
                    "owner": {
                        "account_id": 3151407,
                        "reputation": 2113,
                        "user_id": 2664780,
                        "user_type": "registered",
                        "display_name": "Justin Mayer"
                    },
                    "reply_to_user": {
                        "account_id": 10734404,
                        "reputation": 1060,
                        "user_id": 7899430,
                        "user_type": "registered",
                        "accept_rate": 50,
                        "display_name": "PySaad"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1563527099,
                    "post_id": 57108712,
                    "comment_id": 100737778,
                    "link": "https://stackoverflow.com/questions/57108712/replace-updated-version-strings-in-files-via-python#comment100737778_57108712",
                    "body": "I am using Poetry to increment the version in <code>pyproject.toml</code>, but I also want to increment version strings in other files since Poetry cannot currently do that. I understand that there are numerous CLI tools that can increment version strings, but for this use case I want to avoid adding another dependency and prefer to increment these extra version strings within the existing code environment."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3151407,
                                "reputation": 2113,
                                "user_id": 2664780,
                                "user_type": "registered",
                                "display_name": "Justin Mayer"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1563537270,
                            "post_id": 57109070,
                            "comment_id": 100742766,
                            "link": "https://stackoverflow.com/questions/57108712/replace-updated-version-strings-in-files-via-python/57109070#comment100742766_57109070",
                            "body": "This functions as expected but has unearthed another problem: the version strings are only replaced when the version string is the first line in the file. Sometimes that is true (as currently in <code>__init__.py</code>), but in files such as <code>setup.py</code> there are many other lines before and after the version string line. I have updated the example contents of <code>setup.py</code> in my original question to reflect this. Might you know how to modify this function such that <i>any</i> lines containing version strings are appropriately updated?"
                        }
                    ],
                    "owner": {
                        "account_id": 3842961,
                        "reputation": 92163,
                        "user_id": 3185459,
                        "user_type": "registered",
                        "display_name": "RomanPerekhrest"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1563527125,
                    "creation_date": 1563527125,
                    "answer_id": 57109070,
                    "question_id": 57108712,
                    "link": "https://stackoverflow.com/questions/57108712/replace-updated-version-strings-in-files-via-python/57109070#57109070",
                    "body": "<p>Use the following approach for <em>two different version string formats</em> (it also covers single/double quotes):</p>\n\n<pre><code>def update_version_strings(file_path, new_version):\n    version_regex = re.compile(r\"(^_*?version_*?\\s*=\\s*['\\\"])(\\d+\\.\\d+\\.\\d+)\")\n    with open(file_path, \"r+\") as f:\n        content = f.read()\n        f.seek(0)\n        f.write(\n            re.sub(\n                version_regex,\n                lambda match: '{}{}'.format(match.group(1), new_version),\n                content,\n            )\n        )\n        f.truncate()\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 3151407,
                        "reputation": 2113,
                        "user_id": 2664780,
                        "user_type": "registered",
                        "display_name": "Justin Mayer"
                    },
                    "comment_count": 0,
                    "is_accepted": true,
                    "score": 0,
                    "last_activity_date": 1563688514,
                    "creation_date": 1563688514,
                    "answer_id": 57130686,
                    "question_id": 57108712,
                    "link": "https://stackoverflow.com/questions/57108712/replace-updated-version-strings-in-files-via-python/57130686#57130686",
                    "body": "<p>In files with multiple lines, the key to matching the beginning/end of a line is the <code>re.M</code> or <a href=\"https://docs.python.org/3/library/re.html#re.MULTILINE\" rel=\"nofollow noreferrer\"><code>re.MULTILINE</code></a> directive. The following function replaces version numbers for both <code>version = \"0.1.3\"</code> and <code>__version__ = '0.1.3'</code> string formats \u2014 covering both single and double quotation marks \u2014 in files that may have multiple lines:</p>\n\n<pre><code>def update_version_strings(file_path, new_version):\n    version_regex = re.compile(r\"(^_*?version_*?\\s*=\\s*['\\\"])(\\d+\\.\\d+\\.\\d+)\", re.M)\n    with open(file_path, \"r+\") as f:\n        content = f.read()\n        f.seek(0)\n        f.write(\n            re.sub(\n                version_regex,\n                lambda match: \"{}{}\".format(match.group(1), new_version),\n                content,\n            )\n        )\n        f.truncate()\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 3151407,
                "reputation": 2113,
                "user_id": 2664780,
                "user_type": "registered",
                "display_name": "Justin Mayer"
            },
            "comment_count": 2,
            "is_answered": true,
            "accepted_answer_id": 57130686,
            "answer_count": 2,
            "score": 2,
            "last_activity_date": 1563688514,
            "creation_date": 1563525820,
            "last_edit_date": 1563536734,
            "question_id": 57108712,
            "link": "https://stackoverflow.com/questions/57108712/replace-updated-version-strings-in-files-via-python",
            "title": "Replace updated version strings in files via Python",
            "body": "<p>I want to use Python to replace version strings in <code>foopkg/__init__.py</code>:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>__version__ = \"0.1.3\"\n</code></pre>\n\n<p>\u2026\u00a0and in <code>setup.py</code>:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>#!/usr/bin/env python\nfrom os.path import join\nfrom setuptools import find_packages, setup\n\n\nversion = \"0.1.3\"\n\nentry_points = {\n    \"console_scripts\": [\n        \"say-foo = fooproj.foo:foo\"\n    ]\n}\n\n[...]\n</code></pre>\n\n<p>The absolute paths to these two files, and the new version number, are passed to the following function via the <code>file_path</code> and <code>new_version</code> arguments, respectively:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def update_version_strings(file_path, new_version):\n    VERSION_REGEX = re.compile(\n        r\"(^(__)?version(__)?\\s*=\\s*\\\")(?P&lt;version&gt;\\d+\\.\\d+\\.\\d+)\\\"$\"\n    )\n    with open(file_path, \"r+\") as f:\n        content = f.read()\n        f.seek(0)\n        f.write(\n            re.sub(\n                VERSION_REGEX,\n                lambda match: '{}{}\"'.format(match.group(1), new_version),\n                content,\n            )\n        )\n        f.truncate()\n</code></pre>\n\n<p>Invoking this function via:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>update_version_strings(\"/path/to/foopkg/__init__.py\", \"0.1.4\")\n</code></pre>\n\n<p>\u2026 correctly replaces the version number line in <code>foopkg/__init__.py</code> to <code>__version__ = \"0.1.4\"</code>, but <code>update_version_strings(\"/path/to/setup.py\", \"0.1.4\")</code> yields no change to the <code>setup.py</code> file.</p>\n\n<p>I imagine that the fault lies with some combination of <code>VERSION_REGEX</code> and the <code>lambda match</code> directives. I am admittedly not well versed in regular expressions and have almost certainly done this in a less-than-optimal fashion.</p>\n\n<p>What is the optimal way to replace these two different version string formats and write the changes to the respective files?</p>\n\n<p><em>Bonus points</em>: It would be great to also support single-quote-style, such that version numbers in <code>__version__ = '0.1.3'</code> and <code>version = '0.1.3'</code> strings would also be properly replaced.  (^_^)</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 8244
}