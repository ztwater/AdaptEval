{
    "items": [
        {
            "tags": [
                "python",
                "caching",
                "bottle"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 1518370,
                        "reputation": 9072,
                        "user_id": 1418794,
                        "user_type": "registered",
                        "display_name": "doru"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1404993901,
                    "post_id": 24672996,
                    "comment_id": 38257937,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control#comment38257937_24672996",
                    "body": "Try using <code>response.set_header()</code> instead of <code>response.headers</code> as they say in the <a href=\"http://bottlepy.org/docs/dev/tutorial.html?highlight=cache-control\" rel=\"nofollow noreferrer\">docs</a>. Something like this <code>response.set_header(&#39;Cache-Control&#39;, &#39;max-age=3600,public&#39;)</code>"
                },
                {
                    "owner": {
                        "account_id": 3837361,
                        "reputation": 379,
                        "user_id": 3289453,
                        "user_type": "registered",
                        "accept_rate": 70,
                        "display_name": "Sfinos"
                    },
                    "reply_to_user": {
                        "account_id": 1518370,
                        "reputation": 9072,
                        "user_id": 1418794,
                        "user_type": "registered",
                        "display_name": "doru"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1404994919,
                    "post_id": 24672996,
                    "comment_id": 38258621,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control#comment38258621_24672996",
                    "body": "@doru I&#39;ve already tried it but in network tab in Chrome Developer Tools I have the same thing (Cache-Control:max-age=0). And every static file seems to load in every refresh"
                },
                {
                    "owner": {
                        "account_id": 291103,
                        "reputation": 17789,
                        "user_id": 593047,
                        "user_type": "registered",
                        "accept_rate": 60,
                        "display_name": "ron rothman"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1405035078,
                    "post_id": 24672996,
                    "comment_id": 38280687,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control#comment38280687_24672996",
                    "body": "Please try with <code>wget</code> or <code>curl</code> instead of Chrome, and let us know what you see."
                },
                {
                    "owner": {
                        "account_id": 3837361,
                        "reputation": 379,
                        "user_id": 3289453,
                        "user_type": "registered",
                        "accept_rate": 70,
                        "display_name": "Sfinos"
                    },
                    "reply_to_user": {
                        "account_id": 291103,
                        "reputation": 17789,
                        "user_id": 593047,
                        "user_type": "registered",
                        "accept_rate": 60,
                        "display_name": "ron rothman"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1405118605,
                    "post_id": 24672996,
                    "comment_id": 38318080,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control#comment38318080_24672996",
                    "body": "@ron.rothman I don&#39;t have wget neither curl on winders. I made a Headers request through Python and urllib2 and here is the result: <code>{&#39;date&#39;: &#39;Fri, 11 Jul 2014 22:39:58 GMT&#39;, &#39;content-length&#39;: &#39;30458&#39;, &#39;content-type&#39;: &#39;text&#47;html; charset=UTF-8&#39;, &#39;server&#39;: &#39;WSGIServer&#47;0.1 Python&#47;2.7.6&#39;}</code>"
                },
                {
                    "owner": {
                        "account_id": 291103,
                        "reputation": 17789,
                        "user_id": 593047,
                        "user_type": "registered",
                        "accept_rate": 60,
                        "display_name": "ron rothman"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1405125220,
                    "post_id": 24672996,
                    "comment_id": 38319712,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control#comment38319712_24672996",
                    "body": "Did you notice that there&#39;s no <code>Cache-control</code> header in your response?"
                },
                {
                    "owner": {
                        "account_id": 291103,
                        "reputation": 17789,
                        "user_id": 593047,
                        "user_type": "registered",
                        "accept_rate": 60,
                        "display_name": "ron rothman"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1405125294,
                    "post_id": 24672996,
                    "comment_id": 38319721,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control#comment38319721_24672996",
                    "body": "P.S., <a href=\"http://curl.haxx.se/download.html\" rel=\"nofollow noreferrer\">curl.haxx.se/download.html</a>"
                },
                {
                    "owner": {
                        "account_id": 3837361,
                        "reputation": 379,
                        "user_id": 3289453,
                        "user_type": "registered",
                        "accept_rate": 70,
                        "display_name": "Sfinos"
                    },
                    "reply_to_user": {
                        "account_id": 291103,
                        "reputation": 17789,
                        "user_id": 593047,
                        "user_type": "registered",
                        "accept_rate": 60,
                        "display_name": "ron rothman"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1405152224,
                    "post_id": 24672996,
                    "comment_id": 38324556,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control#comment38324556_24672996",
                    "body": "@ron.rothman I saw it. Same thing in Chrome. Sometimes there isn&#39;t anything there too."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 5336994,
                                "reputation": 4495,
                                "user_id": 4255615,
                                "user_type": "registered",
                                "accept_rate": 89,
                                "display_name": "tleb"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1470872753,
                            "post_id": 24748094,
                            "comment_id": 65131072,
                            "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control/24748094#comment65131072_24748094",
                            "body": "For those wondering, 604800 is the number of seconds in a week. <code>604800 &#47; 60 &#47; 60 &#47; 24 = 7</code>. Curiosity is weird, sometimes."
                        }
                    ],
                    "owner": {
                        "account_id": 151249,
                        "reputation": 18880,
                        "user_id": 364980,
                        "user_type": "registered",
                        "display_name": "James Mills"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 22,
                    "last_activity_date": 1405383652,
                    "creation_date": 1405383652,
                    "answer_id": 24748094,
                    "question_id": 24672996,
                    "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control/24748094#24748094",
                    "body": "<p>I had a look at the <a href=\"https://github.com/defnull/bottle/blob/master/bottle.py#L2325\">source code</a> for <code>static_file()</code> and found the solution.</p>\n\n<p>You need to assign the result of <code>static_file(...)</code> to a variable and call <code>set_header()</code> on the resulting <code>HTTPResponse</code> object.</p>\n\n<pre><code>#!/usr/bin/env python\n\nimport bottle\n\n\n@bottle.get(\"/static/js/&lt;filename:re:.*\\.js&gt;\")\ndef javascripts(filename):\n    response = bottle.static_file(filename, root=\"./static/js/\")\n    response.set_header(\"Cache-Control\", \"public, max-age=604800\")\n    return response\n\nbottle.run(host=\"localhost\", port=8000, debug=True)\n</code></pre>\n\n<p>Basically <code>static_file(...)</code> creates a brand new <code>HTTPResponse</code> object and your modification to <code>bottle.response</code> has no effect here.</p>\n\n<p>This does preicesly what you're after:</p>\n\n<pre><code>$ curl -v -o - http://localhost:8000/static/js/test.js\n* Adding handle: conn: 0x7f8ffa003a00\n* Adding handle: send: 0\n* Adding handle: recv: 0\n* Curl_addHandleToPipeline: length: 1\n* - Conn 0 (0x7f8ffa003a00) send_pipe: 1, recv_pipe: 0\n* About to connect() to localhost port 8000 (#0)\n*   Trying ::1...\n*   Trying fe80::1...\n*   Trying 127.0.0.1...\n* Connected to localhost (127.0.0.1) port 8000 (#0)\n&gt; GET /static/js/test.js HTTP/1.1\n&gt; User-Agent: curl/7.30.0\n&gt; Host: localhost:8000\n&gt; Accept: */*\n&gt;\n* HTTP 1.0, assume close after body\n&lt; HTTP/1.0 200 OK\n&lt; Date: Tue, 15 Jul 2014 00:19:11 GMT\n&lt; Server: WSGIServer/0.1 Python/2.7.6\n&lt; Last-Modified: Tue, 15 Jul 2014 00:07:22 GMT\n&lt; Content-Length: 69\n&lt; Content-Type: application/javascript\n&lt; Accept-Ranges: bytes\n&lt; Cache-Control: public, max-age=604800\n&lt;\n$(document).ready(function () {\n    console.log(\"Hello World!\");\n});\n* Closing connection 0\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 3837361,
                "reputation": 379,
                "user_id": 3289453,
                "user_type": "registered",
                "accept_rate": 70,
                "display_name": "Sfinos"
            },
            "comment_count": 7,
            "is_answered": true,
            "answer_count": 1,
            "score": 11,
            "last_activity_date": 1405383652,
            "creation_date": 1404984703,
            "last_edit_date": 1404987458,
            "question_id": 24672996,
            "link": "https://stackoverflow.com/questions/24672996/python-bottle-and-cache-control",
            "title": "Python Bottle and Cache-Control",
            "body": "<p>I have an application with Python Bottle and I want to add Cache-Control in static files. I am new on this so forgive me if I have done something wrong.</p>\n\n<p>Here is the function and how I serve static files:</p>\n\n<pre><code>@bottle.get('/static/js/&lt;filename:re:.*\\.js&gt;')\ndef javascripts(filename):\n   return bottle.static_file(filename, root='./static/js/')\n</code></pre>\n\n<p>To add Cache-Control I have included one more line (I saw it in a tutorial)</p>\n\n<pre><code>@bottle.get('/static/js/&lt;filename:re:.*\\.js&gt;')\ndef javascripts(filename):\n   bottle.response.headers['Cache-Control'] = 'public, max-age=604800'\n   return bottle.static_file(filename, root='./static/js/')\n</code></pre>\n\n<p>But when I check the headers from Developer tools on Chrome: I have either <code>Cache-Control:max-age=0</code> or <code>Cache-Control:no-cache</code></p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 9935
}