{
    "items": [
        {
            "tags": [
                "php",
                "mysql",
                "postgresql",
                "laravel",
                "laravel-5"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 40721,
                        "reputation": 358704,
                        "user_id": 118068,
                        "user_type": "registered",
                        "display_name": "Marc B"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1466605240,
                    "post_id": 37970743,
                    "comment_id": 63387771,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const#comment63387771_37970743",
                    "body": "you don&#39;t have a users_pkey in your insert, and most likely didn&#39;t make it an auto-incrementing value in the DB, so it gets a default value, which happens to already exist elsewhere in the table, causing your error."
                },
                {
                    "owner": {
                        "account_id": 5663168,
                        "reputation": 56942,
                        "user_id": 4480164,
                        "user_type": "registered",
                        "accept_rate": 73,
                        "display_name": "code-8"
                    },
                    "reply_to_user": {
                        "account_id": 40721,
                        "reputation": 358704,
                        "user_id": 118068,
                        "user_type": "registered",
                        "display_name": "Marc B"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1466605431,
                    "post_id": 37970743,
                    "comment_id": 63387939,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const#comment63387939_37970743",
                    "body": "It must be the diff between psql vs. mysql again."
                },
                {
                    "owner": {
                        "account_id": 5663168,
                        "reputation": 56942,
                        "user_id": 4480164,
                        "user_type": "registered",
                        "accept_rate": 73,
                        "display_name": "code-8"
                    },
                    "reply_to_user": {
                        "account_id": 40721,
                        "reputation": 358704,
                        "user_id": 118068,
                        "user_type": "registered",
                        "display_name": "Marc B"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1466605466,
                    "post_id": 37970743,
                    "comment_id": 63387969,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const#comment63387969_37970743",
                    "body": "How can I make/user my <code>id</code> as my pkey ? is it possible ?"
                },
                {
                    "owner": {
                        "account_id": 2427888,
                        "reputation": 741,
                        "user_id": 2119450,
                        "user_type": "registered",
                        "display_name": "wazelin"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1466605595,
                    "post_id": 37970743,
                    "comment_id": 63388089,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const#comment63388089_37970743",
                    "body": "<a href=\"https://www.postgresql.org/docs/8.1/static/datatype.html#DATATYPE-SERIAL\" rel=\"nofollow noreferrer\">postgresql.org/docs/8.1/static/datatype.html#DATATYPE-SERIAL</a>"
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 5663168,
                                "reputation": 56942,
                                "user_id": 4480164,
                                "user_type": "registered",
                                "accept_rate": 73,
                                "display_name": "code-8"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1466614516,
                            "post_id": 37972960,
                            "comment_id": 63394387,
                            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/37972960#comment63394387_37972960",
                            "body": "You&#39;re 100% correct, after I provided the id manually, now it works <code>perfectly</code> fine."
                        },
                        {
                            "owner": {
                                "account_id": 1900648,
                                "reputation": 3952,
                                "user_id": 1716574,
                                "user_type": "registered",
                                "accept_rate": 0,
                                "display_name": "Picard"
                            },
                            "edited": false,
                            "score": 8,
                            "creation_date": 1528151648,
                            "post_id": 37972960,
                            "comment_id": 88389030,
                            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/37972960#comment88389030_37972960",
                            "body": "Great explanation, unfortunately the code almost worked for me - it set the pointer to the last inserted element but not the next after the last so it still didn&#39;t work since PostgreSQL tried to add a new row using the last used id - so there should be probably <code>max(id)+1</code>, but before testing this suggestion I used another solution found elsewhere that worked for me: <code>SELECT setval(&#39;users_id_seq&#39;, (SELECT MAX(id) from &quot;users&quot;));</code>"
                        },
                        {
                            "owner": {
                                "account_id": 2966695,
                                "reputation": 1526,
                                "user_id": 2519704,
                                "user_type": "registered",
                                "accept_rate": 25,
                                "display_name": "Martin Naughton"
                            },
                            "edited": false,
                            "score": 6,
                            "creation_date": 1570391439,
                            "post_id": 37972960,
                            "comment_id": 102890103,
                            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/37972960#comment102890103_37972960",
                            "body": "that is the best answer I have ever gotten on Stack overflow. 100% correct. great detail"
                        },
                        {
                            "owner": {
                                "account_id": 4396232,
                                "reputation": 61058,
                                "user_id": 3583182,
                                "user_type": "registered",
                                "display_name": "patricus"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1595280802,
                            "post_id": 37972960,
                            "comment_id": 111415123,
                            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/37972960#comment111415123_37972960",
                            "body": "I added in the <code>+1</code> to the max id. When the third parameter to <code>setval()</code> is false, the next call to the sequence will return the value set by <code>setval()</code>. If you change the third param to <code>true</code>, or remove it, the next call to the sequence will return the value after the one one set by <code>setval()</code>. Since we&#39;re ensuring a default of 1 when there are no rows, we want the next call to the sequence to return what we pass into <code>setval()</code>, so we need to pass in the <code>max(id)+1</code> and the third param as <code>false</code>."
                        },
                        {
                            "owner": {
                                "account_id": 5645953,
                                "reputation": 320,
                                "user_id": 4468044,
                                "user_type": "registered",
                                "accept_rate": 40,
                                "display_name": "stingMantis"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1600135921,
                            "post_id": 37972960,
                            "comment_id": 112985520,
                            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/37972960#comment112985520_37972960",
                            "body": "This is a really great answer and I was doing exactly this. Migrating from mySQL to Postgres. I was singing the latter&#39;s praises but this feature/bug is more than a nuisance. If i have concurrent connections all incrementing the memberId field that means i&#39;d have to lock the db, get the next val and use that one. I feel like this defeats the whole purpose of auto incrementing/serial numbers. It&#39;s awful actually."
                        }
                    ],
                    "owner": {
                        "account_id": 4396232,
                        "reputation": 61058,
                        "user_id": 3583182,
                        "user_type": "registered",
                        "display_name": "patricus"
                    },
                    "comment_count": 5,
                    "is_accepted": true,
                    "score": 142,
                    "last_activity_date": 1595280438,
                    "last_edit_date": 1595280438,
                    "creation_date": 1466610820,
                    "answer_id": 37972960,
                    "question_id": 37970743,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/37972960#37972960",
                    "body": "<p>Postgres handles auto incrementing a little differently than MySQL does. In Postgres, when you create the <code>serial</code> field, you are also creating a sequence field that is keeping track of the id to use. This sequence field is going to start out with a value of 1.</p>\n<p>When you insert a new record into the table, if you don't specify the <code>id</code> field, it will use the value of the sequence, and then increment the sequence. However, if you do specify the <code>id</code> field, then the sequence is not used, and it is not updated, either.</p>\n<p>I'm assuming that when you moved over to Postgres, you seeded or imported some existing users, along with their existing ids. When you created these user records with their ids, the sequence was not used, and therefore it was never updated.</p>\n<p>So, if, for example, you imported 10 users, you have users with ids 1-10, but your sequence is still at 1. When you attempt to create a new user without specifying the id, it pulls the value from the sequence (1), and you get a unique violation because you already have a user with id 1.</p>\n<p>To resolve the issue, you need to set your <code>users_id_seq</code> sequence value to the MAX(id) of your existing users. You can read <a href=\"https://stackoverflow.com/questions/244243/how-to-reset-postgres-primary-key-sequence-when-it-falls-out-of-sync\">this question/answer</a> for more information on resetting the sequence, but you can also try something like (untested):</p>\n<pre><code>SELECT setval(pg_get_serial_sequence('users', 'id'), coalesce(max(id)+1, 1), false) FROM users;\n</code></pre>\n<hr />\n<p>FYI, this is not an issue in MySQL because MySQL automatically updates the auto increment sequence to the largest column value when a value is manually inserted into the auto incrementing field.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 8358911,
                                "reputation": 4994,
                                "user_id": 6278060,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "codedge"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1588239362,
                            "post_id": 61517705,
                            "comment_id": 108824701,
                            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/61517705#comment108824701_61517705",
                            "body": "Providing just plain code is not a good idea as it is hard to follow why this code should be the solution to the problem. Please explain in detail how your answer is going to solve the problem."
                        },
                        {
                            "owner": {
                                "account_id": 10869812,
                                "reputation": 3084,
                                "user_id": 7992070,
                                "user_type": "registered",
                                "display_name": "Coola"
                            },
                            "reply_to_user": {
                                "account_id": 8358911,
                                "reputation": 4994,
                                "user_id": 6278060,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "codedge"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1611154682,
                            "post_id": 61517705,
                            "comment_id": 116360178,
                            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/61517705#comment116360178_61517705",
                            "body": "@codedge I edited the answer and provided context with comments per line. The answer seems to be good for the tool which the OP is using i.e. Laravel (PHP). I hope this helps others as it did me."
                        }
                    ],
                    "owner": {
                        "account_id": 17849229,
                        "reputation": 109,
                        "user_id": 12965308,
                        "user_type": "registered",
                        "display_name": "hamed baftam"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 10,
                    "last_activity_date": 1611152336,
                    "last_edit_date": 1611152336,
                    "creation_date": 1588230389,
                    "answer_id": 61517705,
                    "question_id": 37970743,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/61517705#61517705",
                    "body": "<p>The following code provides a way to do this in Laravel which is what the OP is using.</p>\n<pre class=\"lang-php prettyprint-override\"><code>// Get all the tables from your database\n$tables = \\DB::select('SELECT table_name FROM information_schema.tables WHERE table_schema = \\'public\\' ORDER BY table_name;'); \n\n// Set the tables in the database you would like to ignore\n$ignores = array('admin_setting', 'model_has_permissions', 'model_has_roles', 'password_resets', 'role_has_permissions', 'sessions'); \n\n//loop through the tables\nforeach ($tables as $table) { \n\n   // if the table is not to be ignored then:\n   if (!in_array($table-&gt;table_name, $ignores)) { \n\n       //Get the max id from that table and add 1 to it\n       $seq = \\DB::table($table-&gt;table_name)-&gt;max('id') + 1; \n\n       // alter the sequence to now RESTART WITH the new sequence index from above        \n       \\DB::select('ALTER SEQUENCE ' . $table-&gt;table_name . '_id_seq RESTART WITH ' . $seq); \n\n    }\n\n}\n</code></pre>\n<p>Note - Using ALTER SEQUENCE &quot;blocks concurrent transactions&quot;. Consider using the SQL statement from alternative solution provided above if this is not desired.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 13508595,
                        "reputation": 63,
                        "user_id": 9745735,
                        "user_type": "registered",
                        "display_name": "AirwaveQ"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1629556634,
                    "creation_date": 1629556634,
                    "answer_id": 68873968,
                    "question_id": 37970743,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/68873968#68873968",
                    "body": "<p>You can also edit every table sequence in PostgreSQL with DB management software. For example I use pgAdmin4. Just check what is the latest primary key for that table and then go to your DB -&gt; Schemas -&gt; 1.3 Sequences -&gt; <em>table</em> -&gt; Properties -&gt; Definition and edit field Current value.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 7763723,
                        "reputation": 122,
                        "user_id": 5875576,
                        "user_type": "registered",
                        "display_name": "\u0130brahim"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1630919883,
                    "creation_date": 1630919883,
                    "answer_id": 69072112,
                    "question_id": 37970743,
                    "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const/69072112#69072112",
                    "body": "<p>This error usually occurs when you export a table and import it into a different database.</p>\n<p>The above methods work, but unfortunately they don't work on my system, The system I use is laravel and postgres.</p>\n<p>I solved my problem by emptying my table</p>\n<pre><code>TRUNCATE TABLE table_name;\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 5663168,
                "reputation": 56942,
                "user_id": 4480164,
                "user_type": "registered",
                "accept_rate": 73,
                "display_name": "code-8"
            },
            "comment_count": 4,
            "is_answered": true,
            "accepted_answer_id": 37972960,
            "answer_count": 4,
            "score": 46,
            "last_activity_date": 1630919883,
            "creation_date": 1466605023,
            "last_edit_date": 1593440765,
            "question_id": 37970743,
            "link": "https://stackoverflow.com/questions/37970743/postgresql-unique-violation-7-error-duplicate-key-value-violates-unique-const",
            "title": "PostgreSQL: Unique violation: 7 ERROR: duplicate key value violates unique constraint &quot;users_pkey&quot;",
            "body": "<p>I'm using psql in my Laravel App.\nI'm trying to create my user, and I keep getting this error</p>\n<blockquote>\n<p>Unique violation: 7 ERROR: duplicate key value violates unique constraint &quot;users_pkey&quot;</p>\n</blockquote>\n<hr />\n<h1>Here what I did to store my user</h1>\n<pre><code>$user = User::where('account_id','=',$id)-&gt;first();\n$user-&gt;email = $account-&gt;email_address;\n$user-&gt;fb_email = '';\n$user-&gt;tw_email = '';\n$user-&gt;fb_access_token = '';\n$user-&gt;fb_profile_id = '';\n$user-&gt;fb_page_id = '';\n$user-&gt;fb_username = '';\n$user-&gt;save();\n</code></pre>\n<hr />\n<h1>Here is how I created my users table</h1>\n<pre><code>CREATE TABLE &quot;users&quot; (\n    &quot;id&quot; serial NOT NULL ,\n    &quot;account_id&quot; varchar(255) NOT NULL ,\n    &quot;email&quot; varchar(255) NOT NULL ,\n    &quot;fb_email&quot; varchar(255) NOT NULL ,\n    &quot;tw_email&quot; varchar(255) NOT NULL ,\n    &quot;created_at&quot; timestamp(0) without time zone,\n    &quot;updated_at&quot; timestamp(0) without time zone,\n    &quot;fb_access_token&quot; varchar(255) NOT NULL ,\n    &quot;fb_profile_id&quot; varchar(255) NOT NULL ,\n    &quot;fb_page_id&quot; varchar(255) NOT NULL ,\n    &quot;fb_username&quot; varchar(255) NOT NULL ,\n    PRIMARY KEY (&quot;id&quot;)\n\n);\n</code></pre>\n<p>Did I do anything that I'm <code>not</code> suppose to?</p>\n<p>What I am having right now used to work when I hook my app with <code>MySQL</code>.</p>\n<p>Any hints / suggestions will mean a lot to me.</p>\n<hr />\n<h1>Screenshot</h1>\n<p><a href=\"https://i.stack.imgur.com/yemz9.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/yemz9.png\" alt=\"enter image description here\" /></a></p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 9932
}