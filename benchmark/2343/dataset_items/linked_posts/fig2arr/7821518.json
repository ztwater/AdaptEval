{
    "items": [
        {
            "tags": [
                "python",
                "numpy",
                "matplotlib"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 6543038,
                        "reputation": 1153,
                        "user_id": 5059838,
                        "user_type": "registered",
                        "display_name": "bedbad"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1705432079,
                    "post_id": 7821518,
                    "comment_id": 137205980,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array#comment137205980_7821518",
                    "body": "All the answers below don&#39;t offer the full solution - firstly one needs to prevent pyplot displaying when plotting it - which is the step before figure can be aqcuired"
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 56518,
                                "reputation": 6780,
                                "user_id": 169275,
                                "user_type": "registered",
                                "accept_rate": 70,
                                "display_name": "mirosval"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1394032038,
                            "post_id": 7821917,
                            "comment_id": 33703715,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment33703715_7821917",
                            "body": "Is this only supported on certain backend? Does not seem to be working with <code>macosx</code> backend (<code>tostring_rgb</code>) not found."
                        },
                        {
                            "owner": {
                                "account_id": 56518,
                                "reputation": 6780,
                                "user_id": 169275,
                                "user_type": "registered",
                                "accept_rate": 70,
                                "display_name": "mirosval"
                            },
                            "edited": false,
                            "score": 6,
                            "creation_date": 1394033928,
                            "post_id": 7821917,
                            "comment_id": 33705125,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment33705125_7821917",
                            "body": "Works on Agg, add <code>matplotlib.use(&#39;agg&#39;)</code> before <code>import matplotlib.pyplot as plt</code> to use it."
                        },
                        {
                            "owner": {
                                "account_id": 1264267,
                                "reputation": 34783,
                                "user_id": 1221924,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "Dan Allan"
                            },
                            "edited": false,
                            "score": 13,
                            "creation_date": 1413302472,
                            "post_id": 7821917,
                            "comment_id": 41387908,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment41387908_7821917",
                            "body": "With images, the canvas adds a big margin, so I found it useful to insert <code>fig.tight_layout(pad=0)</code> before drawing."
                        },
                        {
                            "owner": {
                                "account_id": 1583769,
                                "reputation": 1339,
                                "user_id": 1468566,
                                "user_type": "registered",
                                "display_name": "kmader"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1478171586,
                            "post_id": 7821917,
                            "comment_id": 68049965,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment68049965_7821917",
                            "body": "For figures with lines and text, it can also be important to turn antialiasing off. For lines <code>plt.setp([ax.get_xticklines() + ax.get_yticklines() + ax.get_xgridlines() + ax.get_ygridlines()],antialiased=False)</code> and for text <code>mpl.rcParams[&#39;text.antialiased&#39;]=False</code>"
                        },
                        {
                            "owner": {
                                "account_id": 7434822,
                                "reputation": 708,
                                "user_id": 6614288,
                                "user_type": "registered",
                                "accept_rate": 81,
                                "display_name": "J.Down"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1494679787,
                            "post_id": 7821917,
                            "comment_id": 74938040,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment74938040_7821917",
                            "body": "is it possible to store the the figure into to the same shape as the input dataset?"
                        },
                        {
                            "owner": {
                                "account_id": 2204690,
                                "reputation": 2213,
                                "user_id": 1948204,
                                "user_type": "registered",
                                "display_name": "JASON G PETERSON"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1519493457,
                            "post_id": 7821917,
                            "comment_id": 84937030,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment84937030_7821917",
                            "body": "There will be padding around figure. Various answers around for turning it off, but you can also just crop out the white from the resulting arrays with: data = data[:, np.where(~np.all(data==255, axis = 0))[0]] #cut all white rows     data = data[np.where(~np.all(data==255, axis = 1,))[0], :] #and all white columns"
                        },
                        {
                            "owner": {
                                "account_id": 2922774,
                                "reputation": 8213,
                                "user_id": 2504700,
                                "user_type": "registered",
                                "display_name": "OriolAbril"
                            },
                            "edited": false,
                            "score": 15,
                            "creation_date": 1528475553,
                            "post_id": 7821917,
                            "comment_id": 88537406,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment88537406_7821917",
                            "body": "@JoeKington <code>np.fromstring</code> with <code>sep=&#39;&#39;</code> is deprecated since version 1.14. It should be replaced with <code>data = np.frombuffer(fig.canvas.tostring_rgb(), dtype=np.uint8)</code> in future versions"
                        },
                        {
                            "owner": {
                                "account_id": 291944,
                                "reputation": 3338,
                                "user_id": 5339857,
                                "user_type": "registered",
                                "display_name": "Roy Shilkrot"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1550706453,
                            "post_id": 7821917,
                            "comment_id": 96371892,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment96371892_7821917",
                            "body": "In case you run into <code>&#39;FigureCanvasGTKAgg&#39; object has no attribute &#39;renderer&#39;</code>, remember to <code>matplotlib.use(&#39;Agg&#39;)</code>: <a href=\"https://stackoverflow.com/a/35407794/5339857\">stackoverflow.com/a/35407794/5339857</a>"
                        },
                        {
                            "owner": {
                                "account_id": 3049648,
                                "reputation": 559,
                                "user_id": 2584518,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "loknar"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1585424375,
                            "post_id": 7821917,
                            "comment_id": 107755913,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment107755913_7821917",
                            "body": "instead <code>matplotlib.use(&#39;agg&#39;)</code> you can do <code>plt.switch_backend(&#39;agg&#39;)</code>, with this approach you won&#39;t have to run .use before <code>import matplotlib.pyplot as plt</code>"
                        },
                        {
                            "owner": {
                                "account_id": 1025180,
                                "reputation": 818,
                                "user_id": 1034648,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "MyCarta"
                            },
                            "reply_to_user": {
                                "account_id": 3049648,
                                "reputation": 559,
                                "user_id": 2584518,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "loknar"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1590508070,
                            "post_id": 7821917,
                            "comment_id": 109702834,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment109702834_7821917",
                            "body": "I accidentally unvoted my upvote to @loknar &#39;s comment, but that is what I used in the end"
                        },
                        {
                            "owner": {
                                "account_id": 1136641,
                                "reputation": 352,
                                "user_id": 1121582,
                                "user_type": "registered",
                                "display_name": "CircaLucid"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1608135771,
                            "post_id": 7821917,
                            "comment_id": 115491759,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment115491759_7821917",
                            "body": "Is print_to_buffer better than tostring_rgb? <a href=\"https://matplotlib.org/3.1.1/gallery/user_interfaces/canvasagg.html\" rel=\"nofollow noreferrer\">matplotlib.org/3.1.1/gallery/user_interfaces/canvasagg.html</a>"
                        },
                        {
                            "owner": {
                                "account_id": 6839398,
                                "reputation": 915,
                                "user_id": 5324819,
                                "user_type": "registered",
                                "accept_rate": 83,
                                "display_name": "Marat Zakirov"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1627464767,
                            "post_id": 7821917,
                            "comment_id": 121161313,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment121161313_7821917",
                            "body": "This does not work data = data.reshape(fig.canvas.get_width_height()[::-1] + (3,))  Wrong shape"
                        },
                        {
                            "owner": {
                                "account_id": 929856,
                                "reputation": 1137,
                                "user_id": 959926,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "Epimetheus"
                            },
                            "reply_to_user": {
                                "account_id": 6839398,
                                "reputation": 915,
                                "user_id": 5324819,
                                "user_type": "registered",
                                "accept_rate": 83,
                                "display_name": "Marat Zakirov"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1642495722,
                            "post_id": 7821917,
                            "comment_id": 125079193,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment125079193_7821917",
                            "body": "@MaratZakirov see my answer for a solution."
                        },
                        {
                            "owner": {
                                "account_id": 4812682,
                                "reputation": 1758,
                                "user_id": 3885696,
                                "user_type": "registered",
                                "accept_rate": 57,
                                "display_name": "Nir"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1653930152,
                            "post_id": 7821917,
                            "comment_id": 127966403,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#comment127966403_7821917",
                            "body": "For some reason without the <code>fig.canvas.draw()</code> there are sizes mismatch, this was also mentioned by @Fabian Hertwig on Jonan Gueorguiev&#39;s answer"
                        }
                    ],
                    "owner": {
                        "account_id": 128012,
                        "reputation": 280396,
                        "user_id": 325565,
                        "user_type": "registered",
                        "display_name": "Joe Kington"
                    },
                    "comment_count": 14,
                    "is_accepted": false,
                    "score": 109,
                    "last_activity_date": 1639423074,
                    "last_edit_date": 1639423074,
                    "creation_date": 1319030375,
                    "answer_id": 7821917,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/7821917#7821917",
                    "body": "<p>This is a handy trick for unit tests and the like, when you need to do a pixel-to-pixel comparison with a saved plot.</p>\n<p>One way is to use <code>fig.canvas.tostring_rgb</code> and then <code>numpy.fromstring</code> with the approriate dtype.  There are other ways as well, but this is the one I tend to use.</p>\n<p>E.g.</p>\n<pre><code>import matplotlib.pyplot as plt\nimport numpy as np\n\n# Make a random plot...\nfig = plt.figure()\nfig.add_subplot(111)\n\n# If we haven't already shown or saved the plot, then we need to\n# draw the figure first...\nfig.canvas.draw()\n\n# Now we can save it to a numpy array.\ndata = np.frombuffer(fig.canvas.tostring_rgb(), dtype=np.uint8)\ndata = data.reshape(fig.canvas.get_width_height()[::-1] + (3,))\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 5446333,
                                "reputation": 772,
                                "user_id": 4332742,
                                "user_type": "registered",
                                "display_name": "Anshul Rai"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1574034899,
                            "post_id": 58641662,
                            "comment_id": 104075386,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/58641662#comment104075386_58641662",
                            "body": "I suggest adding the import statements along with the function."
                        },
                        {
                            "owner": {
                                "account_id": 11069845,
                                "reputation": 351,
                                "user_id": 8128376,
                                "user_type": "registered",
                                "display_name": "JUN_NETWORKS"
                            },
                            "reply_to_user": {
                                "account_id": 5446333,
                                "reputation": 772,
                                "user_id": 4332742,
                                "user_type": "registered",
                                "display_name": "Anshul Rai"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1574258304,
                            "post_id": 58641662,
                            "comment_id": 104167751,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/58641662#comment104167751_58641662",
                            "body": "@AnshulRai Thanks for your great advice!! I&#39;ve added code about import, plot, and how to use the function."
                        },
                        {
                            "owner": {
                                "account_id": 5831054,
                                "reputation": 899,
                                "user_id": 4595522,
                                "user_type": "registered",
                                "accept_rate": 31,
                                "display_name": "Sarvagya Gupta"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1662352346,
                            "post_id": 58641662,
                            "comment_id": 129977667,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/58641662#comment129977667_58641662",
                            "body": "Hey, I was wondering if there&#39;s a way I could get rid of x and y axis labels and just get the plot?"
                        }
                    ],
                    "owner": {
                        "account_id": 11069845,
                        "reputation": 351,
                        "user_id": 8128376,
                        "user_type": "registered",
                        "display_name": "JUN_NETWORKS"
                    },
                    "comment_count": 3,
                    "is_accepted": false,
                    "score": 23,
                    "last_activity_date": 1582359948,
                    "last_edit_date": 1582359948,
                    "creation_date": 1572518793,
                    "answer_id": 58641662,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/58641662#58641662",
                    "body": "<p>Some people propose a method which is like this</p>\n\n<pre><code>np.fromstring(fig.canvas.tostring_rgb(), dtype=np.uint8, sep='')\n</code></pre>\n\n<p>Ofcourse, this code work. But, output numpy array image is so low resolution.</p>\n\n<p>My proposal code is this.</p>\n\n<pre><code>import io\nimport cv2\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# plot sin wave\nfig = plt.figure()\nax = fig.add_subplot(111)\n\nx = np.linspace(-np.pi, np.pi)\n\nax.set_xlim(-np.pi, np.pi)\nax.set_xlabel(\"x\")\nax.set_ylabel(\"y\")\n\nax.plot(x, np.sin(x), label=\"sin\")\n\nax.legend()\nax.set_title(\"sin(x)\")\n\n\n# define a function which returns an image as numpy array from figure\ndef get_img_from_fig(fig, dpi=180):\n    buf = io.BytesIO()\n    fig.savefig(buf, format=\"png\", dpi=dpi)\n    buf.seek(0)\n    img_arr = np.frombuffer(buf.getvalue(), dtype=np.uint8)\n    buf.close()\n    img = cv2.imdecode(img_arr, 1)\n    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)\n\n    return img\n\n# you can get a high-resolution image as numpy array!!\nplot_img_np = get_img_from_fig(fig)\n</code></pre>\n\n<p>This code works well.<br>\nYou can get a high-resolution image as a numpy array if you set a large number on the dpi argument.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 5569597,
                                "reputation": 1035,
                                "user_id": 4415482,
                                "user_type": "registered",
                                "display_name": "jrieke"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1604447651,
                            "post_id": 61443397,
                            "comment_id": 114349981,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment114349981_61443397",
                            "body": "I think this answer is far superior to the ones above: 1) It produces high-res images and 2) doesn&#39;t rely on external packages like cv2."
                        },
                        {
                            "owner": {
                                "account_id": 3040177,
                                "reputation": 1102,
                                "user_id": 2577416,
                                "user_type": "registered",
                                "display_name": "Fabian Hertwig"
                            },
                            "edited": false,
                            "score": 10,
                            "creation_date": 1613673592,
                            "post_id": 61443397,
                            "comment_id": 117155188,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment117155188_61443397",
                            "body": "I get a reshape error &quot;cannot reshape array of size 3981312 into shape (480,640,newaxis)&quot;. Any ideas?"
                        },
                        {
                            "owner": {
                                "account_id": 6186692,
                                "reputation": 1084,
                                "user_id": 4820605,
                                "user_type": "registered",
                                "display_name": "duburcqa"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1615107912,
                            "post_id": 61443397,
                            "comment_id": 117584968,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment117584968_61443397",
                            "body": "Indeed this answer is exactly what I was looking for ! Thank you !"
                        },
                        {
                            "owner": {
                                "account_id": 328792,
                                "reputation": 1186,
                                "user_id": 651945,
                                "user_type": "registered",
                                "display_name": "Jonan Gueorguiev"
                            },
                            "reply_to_user": {
                                "account_id": 3040177,
                                "reputation": 1102,
                                "user_id": 2577416,
                                "user_type": "registered",
                                "display_name": "Fabian Hertwig"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1616316981,
                            "post_id": 61443397,
                            "comment_id": 117959144,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment117959144_61443397",
                            "body": "@FabianHertwig - make sure that not only the number of pixels, but also the number of (color) channels match."
                        },
                        {
                            "owner": {
                                "account_id": 3435180,
                                "reputation": 349,
                                "user_id": 2878460,
                                "user_type": "registered",
                                "accept_rate": 83,
                                "display_name": "Zen3515"
                            },
                            "reply_to_user": {
                                "account_id": 3040177,
                                "reputation": 1102,
                                "user_id": 2577416,
                                "user_type": "registered",
                                "display_name": "Fabian Hertwig"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1621326760,
                            "post_id": 61443397,
                            "comment_id": 119455101,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment119455101_61443397",
                            "body": "@FabianHertwig I have the same problem, and here is the fix.   When you create the fig you have to set dpi to be the same when you saved it  <code>fig = plt.figure(figsize=(16, 4), dpi=128)</code> then <code>fig.savefig(io_buf, format=&#39;raw&#39;, dpi=128)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 6393007,
                                "reputation": 131,
                                "user_id": 4958437,
                                "user_type": "registered",
                                "display_name": "Manish"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1623757760,
                            "post_id": 61443397,
                            "comment_id": 120164229,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment120164229_61443397",
                            "body": "How to read this in 3 channel i.e. rgb,  something like (128, 128, 3). Right now it is coming as (128,128,4) ?"
                        },
                        {
                            "owner": {
                                "account_id": 558141,
                                "reputation": 368,
                                "user_id": 920689,
                                "user_type": "registered",
                                "display_name": "Mr.Epic Fail"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1627639775,
                            "post_id": 61443397,
                            "comment_id": 121215667,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment121215667_61443397",
                            "body": "This worked for me when omitting the <code>dpi</code> parameter, i.e. <code>fig.savefig(io_buf, format=&#39;raw&#39;)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 11540487,
                                "reputation": 492,
                                "user_id": 8456383,
                                "user_type": "registered",
                                "display_name": "Hersh Joshi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1659481909,
                            "post_id": 61443397,
                            "comment_id": 129304318,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#comment129304318_61443397",
                            "body": "for anyone trying this method. It is very problematic (saving the image as &#39;raw&#39; and to the io_buffer yields a shape that makes no sense). The top answer works far better"
                        }
                    ],
                    "owner": {
                        "account_id": 328792,
                        "reputation": 1186,
                        "user_id": 651945,
                        "user_type": "registered",
                        "display_name": "Jonan Gueorguiev"
                    },
                    "comment_count": 8,
                    "is_accepted": false,
                    "score": 53,
                    "last_activity_date": 1587915100,
                    "creation_date": 1587915100,
                    "answer_id": 61443397,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/61443397#61443397",
                    "body": "<p>There is a bit simpler option for @JUN_NETWORKS's answer. Instead of saving the figure in <code>png</code>, one can use other format, like <code>raw</code> or <code>rgba</code> and skip the <code>cv2</code> decoding step.</p>\n\n<p>In other words the actual plot-to-numpy conversion boils down to:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>io_buf = io.BytesIO()\nfig.savefig(io_buf, format='raw', dpi=DPI)\nio_buf.seek(0)\nimg_arr = np.reshape(np.frombuffer(io_buf.getvalue(), dtype=np.uint8),\n                     newshape=(int(fig.bbox.bounds[3]), int(fig.bbox.bounds[2]), -1))\nio_buf.close()\n\n</code></pre>\n\n<p>Hope, this helps.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 4060371,
                        "reputation": 7027,
                        "user_id": 3337089,
                        "user_type": "registered",
                        "accept_rate": 86,
                        "display_name": "Nagabhushan S N"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 6,
                    "last_activity_date": 1609601479,
                    "creation_date": 1609601479,
                    "answer_id": 65540835,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/65540835#65540835",
                    "body": "<p>In case somebody wants a plug and play solution, without modifying any prior code (getting the reference to pyplot figure and all), the below worked for me. Just add this after all <code>pyplot</code> statements i.e. just before <code>pyplot.show()</code></p>\n<pre><code>canvas = pyplot.gca().figure.canvas\ncanvas.draw()\ndata = numpy.frombuffer(canvas.tostring_rgb(), dtype=numpy.uint8)\nimage = data.reshape(canvas.get_width_height()[::-1] + (3,))\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 929856,
                                "reputation": 1137,
                                "user_id": 959926,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "Epimetheus"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1642495777,
                            "post_id": 67823421,
                            "comment_id": 125079211,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/67823421#comment125079211_67823421",
                            "body": "Why do so many stackoverflowers obsess about benchmarks?"
                        },
                        {
                            "owner": {
                                "account_id": 6602766,
                                "reputation": 296,
                                "user_id": 5100532,
                                "user_type": "registered",
                                "display_name": "Hassan Kanso"
                            },
                            "reply_to_user": {
                                "account_id": 929856,
                                "reputation": 1137,
                                "user_id": 959926,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "Epimetheus"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1651352466,
                            "post_id": 67823421,
                            "comment_id": 127346032,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/67823421#comment127346032_67823421",
                            "body": "@Epimetheus, isn&#39;t it self-explanatory? the world only cares about speed and results&#39; quality, a fast method can save companies."
                        },
                        {
                            "owner": {
                                "account_id": 50160,
                                "reputation": 3925,
                                "user_id": 149506,
                                "user_type": "registered",
                                "accept_rate": 61,
                                "display_name": "darda"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1654286143,
                            "post_id": 67823421,
                            "comment_id": 128063229,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/67823421#comment128063229_67823421",
                            "body": "Is this not missing a <code>fig.canvas.draw()</code> in the other two functions?"
                        },
                        {
                            "owner": {
                                "account_id": 3383624,
                                "reputation": 658,
                                "user_id": 2840134,
                                "user_type": "registered",
                                "accept_rate": 82,
                                "display_name": "dizcza"
                            },
                            "reply_to_user": {
                                "account_id": 50160,
                                "reputation": 3925,
                                "user_id": 149506,
                                "user_type": "registered",
                                "accept_rate": 61,
                                "display_name": "darda"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1654411178,
                            "post_id": 67823421,
                            "comment_id": 128081354,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/67823421#comment128081354_67823421",
                            "body": "@darda no, it&#39;s not needed in plot2 and plot3. Do you see an empty picture?"
                        }
                    ],
                    "owner": {
                        "account_id": 3383624,
                        "reputation": 658,
                        "user_id": 2840134,
                        "user_type": "registered",
                        "accept_rate": 82,
                        "display_name": "dizcza"
                    },
                    "comment_count": 4,
                    "is_accepted": false,
                    "score": 18,
                    "last_activity_date": 1623178135,
                    "last_edit_date": 1623178135,
                    "creation_date": 1622730734,
                    "answer_id": 67823421,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/67823421#67823421",
                    "body": "<p>Time to benchmark your solutions.</p>\n<pre class=\"lang-py prettyprint-override\"><code>import io\nimport matplotlib\nmatplotlib.use('agg')  # turn off interactive backend\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nfig, ax = plt.subplots()\nax.plot(range(10))\n\n\ndef plot1():\n    fig.canvas.draw()\n    data = np.frombuffer(fig.canvas.tostring_rgb(), dtype=np.uint8)\n    w, h = fig.canvas.get_width_height()\n    im = data.reshape((int(h), int(w), -1))\n\n\ndef plot2():\n    with io.BytesIO() as buff:\n        fig.savefig(buff, format='png')\n        buff.seek(0)\n        im = plt.imread(buff)\n\n\ndef plot3():\n    with io.BytesIO() as buff:\n        fig.savefig(buff, format='raw')\n        buff.seek(0)\n        data = np.frombuffer(buff.getvalue(), dtype=np.uint8)\n    w, h = fig.canvas.get_width_height()\n    im = data.reshape((int(h), int(w), -1))\n</code></pre>\n<pre><code>&gt;&gt;&gt; %timeit plot1()\n34 ms \u00b1 4.16 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n&gt;&gt;&gt; %timeit plot2()\n50.2 ms \u00b1 234 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n&gt;&gt;&gt; %timeit plot3()\n16.4 ms \u00b1 36 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n</code></pre>\n<p>Under this scenario, IO raw buffers are the fastest to convert a matplotlib figure to a numpy array.</p>\n<p>Additional remarks:</p>\n<ul>\n<li><p>if you don't have an access to the figure, you can always extract it from the axes:</p>\n<p><code>fig = ax.figure</code></p>\n</li>\n<li><p>if you need the array in the <code>channel x height x width</code> format, do</p>\n<p><code>im = im.transpose((2, 0, 1))</code>.</p>\n</li>\n</ul>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3064700,
                                "reputation": 442,
                                "user_id": 2596672,
                                "user_type": "registered",
                                "accept_rate": 11,
                                "display_name": "Toren"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1654731995,
                            "post_id": 69762932,
                            "comment_id": 128164687,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/69762932#comment128164687_69762932",
                            "body": "As the shortest working solution Daniel Giger should get more upvotes."
                        },
                        {
                            "owner": {
                                "account_id": 4060371,
                                "reputation": 7027,
                                "user_id": 3337089,
                                "user_type": "registered",
                                "accept_rate": 86,
                                "display_name": "Nagabhushan S N"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1677706646,
                            "post_id": 69762932,
                            "comment_id": 133393470,
                            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/69762932#comment133393470_69762932",
                            "body": "But it requires installing another package :("
                        }
                    ],
                    "owner": {
                        "account_id": 8448473,
                        "reputation": 2333,
                        "user_id": 6338179,
                        "user_type": "registered",
                        "display_name": "Daniel Giger"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 7,
                    "last_activity_date": 1635474445,
                    "creation_date": 1635474445,
                    "answer_id": 69762932,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/69762932#69762932",
                    "body": "<p><a href=\"https://pypi.org/project/moviepy/\" rel=\"noreferrer\">MoviePy</a> makes converting a figure to a numpy array quite simple.  It has a built-in function for this called <code>mplfig_to_npimage()</code>.  You can use it like this:</p>\n<pre><code>from moviepy.video.io.bindings import mplfig_to_npimage\nimport matplotlib.pyplot as plt\n\nfig = plt.figure()  # make a figure\nnumpy_fig = mplfig_to_npimage(fig)  # convert it to a numpy array\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 929856,
                        "reputation": 1137,
                        "user_id": 959926,
                        "user_type": "registered",
                        "accept_rate": 62,
                        "display_name": "Epimetheus"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1642495649,
                    "creation_date": 1642495649,
                    "answer_id": 70752653,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/70752653#70752653",
                    "body": "<p>As Joe Kington has pointed out, one way is to draw on the canvas, convert the canvas to a byte string and then reshape it into the correct shape.</p>\n<pre class=\"lang-py prettyprint-override\"><code>import matplotlib.pyplot as plt\nimport numpy as np\nimport math\n\nplt.switch_backend('Agg')\n\n\ndef canvas2rgb_array(canvas):\n    &quot;&quot;&quot;Adapted from: https://stackoverflow.com/a/21940031/959926&quot;&quot;&quot;\n    canvas.draw()\n    buf = np.frombuffer(canvas.tostring_rgb(), dtype=np.uint8)\n    ncols, nrows = canvas.get_width_height()\n    scale = round(math.sqrt(buf.size / 3 / nrows / ncols))\n    return buf.reshape(scale * nrows, scale * ncols, 3)\n\n\n# Make a simple plot to test with\nt = np.arange(0.0, 2.0, 0.01)\ns = 1 + np.sin(2 * np.pi * t)\nfig, ax = plt.subplots()\nax.plot(t, s)\n\n# Extract the plot as an array\nplt_array = canvas2rgb_array(fig.canvas)\nprint(plt_array.shape)\n</code></pre>\n<p>However as <code>canvas.get_width_height()</code> returns width and height in display coordinates, there are sometimes scaling issues that are resolved in this answer.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 1224114,
                        "reputation": 3020,
                        "user_id": 1190077,
                        "user_type": "registered",
                        "accept_rate": 87,
                        "display_name": "Hugues"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1671996803,
                    "creation_date": 1671996803,
                    "answer_id": 74915493,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/74915493#74915493",
                    "body": "<p>Cleaned up version of the answer by Jonan Gueorguiev:</p>\n<pre class=\"lang-py prettyprint-override\"><code>with io.BytesIO() as io_buf:\n  fig.savefig(io_buf, format='raw', dpi=dpi)\n  image = np.frombuffer(io_buf.getvalue(), np.uint8).reshape(\n      int(fig.bbox.bounds[3]), int(fig.bbox.bounds[2]), -1)\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 6543038,
                        "reputation": 1153,
                        "user_id": 5059838,
                        "user_type": "registered",
                        "display_name": "bedbad"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1705820391,
                    "creation_date": 1705820391,
                    "answer_id": 77853862,
                    "question_id": 7821518,
                    "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array/77853862#77853862",
                    "body": "<pre><code>import numpy as np \nimport cv2\nimport time\nimport justpyplot as jplt\n\nxs, ys = [], []\nwhile(cv2.waitKey(1) != 27):\n    xt = time.perf_counter() - t0\n    yx = np.sin(xt)\n    xs.append(xt)\n    ys.append(yx)\n    \n    frame = np.full((500,470,3), (255,255,255), dtype=np.uint8)\n    \n    vals = np.array(ys)\n\n    plotted_in_array = jplt.just_plot(frame, vals,title=&quot;sin() from Clock&quot;)\n    \n    cv2.imshow('np array plot', plotted_in_array)\n</code></pre>\n<p>The issues with all the matplotlib approaches is that matplotlib can still render and display plot even if you do plt.ioff() or return the figure and even if you do succeed while it behaves differently on a different platform(because matplotlib delegates it to backend depending on os) - you get a performance hit for getting plotted numpy array.\nI measured all previosly suggested matplotlib approaches and it rakes in milliseconds, most often dozens, sometimes even more milliseconds.</p>\n<p>I couldn't find a simple library that just does it, had to write the thing myself. A plot to numpy in fully vectorized numpy(not a single loop) for all the parts such as scatter, connected, axis, grid, including size of the points and thickness and it does it in microseconds</p>\n<p><a href=\"https://github.com/bedbad/justpyplot\" rel=\"nofollow noreferrer\">https://github.com/bedbad/justpyplot</a></p>\n"
                }
            ],
            "owner": {
                "account_id": 984217,
                "reputation": 851,
                "user_id": 1003146,
                "user_type": "registered",
                "display_name": "user1003146"
            },
            "comment_count": 1,
            "is_answered": true,
            "answer_count": 9,
            "score": 85,
            "last_activity_date": 1712933835,
            "creation_date": 1319028257,
            "last_edit_date": 1683689675,
            "question_id": 7821518,
            "link": "https://stackoverflow.com/questions/7821518/save-plot-to-numpy-array",
            "title": "Save plot to numpy array",
            "body": "<p>In Python and Matplotlib, it is easy to either display the plot as a popup window or save the plot as a PNG file. How can I instead save the plot to a numpy array in RGB format?</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 5480
}