{
    "items": [
        {
            "tags": [
                "python",
                "unit-testing",
                "mocking",
                "iteration",
                "python-mock"
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3853935,
                                "reputation": 2044,
                                "user_id": 3227133,
                                "user_type": "registered",
                                "display_name": "and"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1405579320,
                            "post_id": 24779923,
                            "comment_id": 38486449,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38486449_24779923",
                            "body": "Isn&#39;t it better to patch <code>module_under_test.open</code> than <code>builtins.open</code>?"
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 3853935,
                                "reputation": 2044,
                                "user_id": 3227133,
                                "user_type": "registered",
                                "display_name": "and"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1405583279,
                            "post_id": 24779923,
                            "comment_id": 38488666,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38488666_24779923",
                            "body": "This is based on the OP question and is also used in the <a href=\"https://docs.python.org/3/library/unittest.mock-examples.html#patch-decorators\" rel=\"nofollow noreferrer\"><code>unittest.mock</code> examples documentation</a>; I wanted to focus on the iterable aspect of the <code>mock_open()</code> return value. <code>module_under_test.open</code> would be slightly more specific, yes."
                        },
                        {
                            "owner": {
                                "account_id": 2801729,
                                "reputation": 1359,
                                "user_id": 2409868,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "lemi57ssss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1405591568,
                            "post_id": 24779923,
                            "comment_id": 38493713,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38493713_24779923",
                            "body": "<code>with unittest.mock.patch(&#39;impexpdemo.open&#39;, m):</code>   produces the error message: <code>AttributeError: &lt;module &#39;impexpdemo&#39; from &#39;E:\\\\...\\\\impexpdemo.py&#39;&gt; does not have the attribute &#39;open&#39;</code>"
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 2801729,
                                "reputation": 1359,
                                "user_id": 2409868,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "lemi57ssss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1405592603,
                            "post_id": 24779923,
                            "comment_id": 38494418,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38494418_24779923",
                            "body": "@lemi57ssss: right, so <code>mock.patch()</code> tests to see if the object already exists, in which case <code>builtins.open</code> is the way to go here. Does simply mocking <code>open()</code> to return the list or augmenting the <code>mock_open()</code> return value work for you?"
                        },
                        {
                            "owner": {
                                "account_id": 2801729,
                                "reputation": 1359,
                                "user_id": 2409868,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "lemi57ssss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1405593360,
                            "post_id": 24779923,
                            "comment_id": 38494930,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38494930_24779923",
                            "body": "Thank you for a most excellent answer which solves the problem. The program from which this is drawn opens the file, silently ignores a utf-8 byte order mark if present, and then reads a csv file. It was the byte order mark handling I was trying to test."
                        },
                        {
                            "owner": {
                                "account_id": 2801729,
                                "reputation": 1359,
                                "user_id": 2409868,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "lemi57ssss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1405594671,
                            "post_id": 24779923,
                            "comment_id": 38495728,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38495728_24779923",
                            "body": "@Martijn Pieters: I used mock_open exactly as your second example. I was unable to get anything with NagicMock although I&#39;ll continue to spend some time on trying to understand why this works. If I discover anything interesting I&#39;ll post it here."
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 2801729,
                                "reputation": 1359,
                                "user_id": 2409868,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "lemi57ssss"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1405594814,
                            "post_id": 24779923,
                            "comment_id": 38495825,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38495825_24779923",
                            "body": "@lemi57ssss: it could be that your actual code-under-test does more than just iterate. I&#39;ve updated the first snippet to return <code>iter(listobj)</code> instead to return an iterator, not just an iterable."
                        },
                        {
                            "owner": {
                                "account_id": 2801729,
                                "reputation": 1359,
                                "user_id": 2409868,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "lemi57ssss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1405687783,
                            "post_id": 24779923,
                            "comment_id": 38540432,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38540432_24779923",
                            "body": "I reported that <code>m.return_value = iter(self.TEST_TEXT) also works perfectly.</code> This was incorrect. In fact <code>with open...</code> fails with an <code>__exit__</code> error."
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 2801729,
                                "reputation": 1359,
                                "user_id": 2409868,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "lemi57ssss"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1405687951,
                            "post_id": 24779923,
                            "comment_id": 38540527,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment38540527_24779923",
                            "body": "@lemi57ssss: ah, yes, that&#39;s because you are using it as a context manager. I&#39;ll add a note."
                        },
                        {
                            "owner": {
                                "account_id": 457464,
                                "reputation": 8290,
                                "user_id": 856804,
                                "user_type": "registered",
                                "accept_rate": 73,
                                "display_name": "zyxue"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1437091500,
                            "post_id": 24779923,
                            "comment_id": 50899072,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment50899072_24779923",
                            "body": "+1 for pointing out that mock_open() object does indeed not implement iteration, this should&#39;ve been added to the documentation, <a href=\"http://www.voidspace.org.uk/python/mock/helpers.html#mock-open\" rel=\"nofollow noreferrer\">voidspace.org.uk/python/mock/helpers.html#mock-open</a>"
                        },
                        {
                            "owner": {
                                "account_id": 2152375,
                                "reputation": 425,
                                "user_id": 1908376,
                                "user_type": "registered",
                                "accept_rate": 4,
                                "display_name": "gwilymh"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1468355845,
                            "post_id": 24779923,
                            "comment_id": 64091208,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment64091208_24779923",
                            "body": "Can anyone explain the function of &#39;lambda self: self&#39; in the above code?"
                        },
                        {
                            "owner": {
                                "account_id": 2152375,
                                "reputation": 425,
                                "user_id": 1908376,
                                "user_type": "registered",
                                "accept_rate": 4,
                                "display_name": "gwilymh"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1468357830,
                            "post_id": 24779923,
                            "comment_id": 64092220,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment64092220_24779923",
                            "body": "I cannot get the mock_open code above to work. Does the code only work for python 3? I get the following error message:     TypeError: iter() returned non-iterator of type &#39;MagicMock&#39;"
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 2152375,
                                "reputation": 425,
                                "user_id": 1908376,
                                "user_type": "registered",
                                "accept_rate": 4,
                                "display_name": "gwilymh"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1468358328,
                            "post_id": 24779923,
                            "comment_id": 64092454,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment64092454_24779923",
                            "body": "@gwilymh in Python 2 iterations must have a <code>next()</code> method instead of <code>__next__()</code>. I can&#39;t test this right now but try that."
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 2152375,
                                "reputation": 425,
                                "user_id": 1908376,
                                "user_type": "registered",
                                "accept_rate": 4,
                                "display_name": "gwilymh"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1468358395,
                            "post_id": 24779923,
                            "comment_id": 64092486,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment64092486_24779923",
                            "body": "@gwilymh at any rate, on iterators the <code>__iter__()</code> <i>must</i> return <code>self</code> which is what that lambda does."
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 2152375,
                                "reputation": 425,
                                "user_id": 1908376,
                                "user_type": "registered",
                                "accept_rate": 4,
                                "display_name": "gwilymh"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1468408093,
                            "post_id": 24779923,
                            "comment_id": 64112358,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment64112358_24779923",
                            "body": "@gwilymh: updated with a work-around, if you <i>must</i> have <code>next(fileobj)</code> work then that&#39;ll not be enough though; you&#39;d have to subclass <code>MagicMock</code> and add support for <code>next</code> there."
                        },
                        {
                            "owner": {
                                "account_id": 188419,
                                "reputation": 37503,
                                "user_id": 427158,
                                "user_type": "registered",
                                "accept_rate": 67,
                                "display_name": "maxschlepzig"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1484432196,
                            "post_id": 24779923,
                            "comment_id": 70509832,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment70509832_24779923",
                            "body": "hm, what about <code>StopIteration()</code>? As-is your <code>__next__</code> lambda never raises it - i.e. the loop iterates endlessly. Fix: raise this exception if <code>readline()</code> returns the empty string (<code>StopIteration()</code> is part of the iterator protocol; <code>readline()</code> returns <code>&#39;\\n&#39;</code> for empty lines and <code>&#39;&#39;</code> for EOF)."
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 188419,
                                "reputation": 37503,
                                "user_id": 427158,
                                "user_type": "registered",
                                "accept_rate": 67,
                                "display_name": "maxschlepzig"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1484434195,
                            "post_id": 24779923,
                            "comment_id": 70510382,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment70510382_24779923",
                            "body": "@maxschlepzig: sorry, yes, fixed that now."
                        },
                        {
                            "owner": {
                                "account_id": 459761,
                                "reputation": 8154,
                                "user_id": 860421,
                                "user_type": "registered",
                                "accept_rate": 84,
                                "display_name": "0xc0de"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1484809667,
                            "post_id": 24779923,
                            "comment_id": 70665046,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment70665046_24779923",
                            "body": "This seems unrelated here, in my (python 2.7) test runs, the mock file object was missing <code>readline</code> method. In my tests in python console however, it worked as expected(<code>readline</code> worked as expected). I had to mock readline() (<code>lambda: next(iterator_created_from_test_data_list)</code>). It&#39;s working now, but just posted out of curiosity, as I haven&#39;t understood what caused the lack of that method, maybe you can throw some light. Also my attempt to help, if anyone gets bitten by the same strange behaviour."
                        },
                        {
                            "owner": {
                                "account_id": 35417,
                                "reputation": 1089172,
                                "user_id": 100297,
                                "user_type": "moderator",
                                "display_name": "Martijn Pieters"
                            },
                            "reply_to_user": {
                                "account_id": 459761,
                                "reputation": 8154,
                                "user_id": 860421,
                                "user_type": "registered",
                                "accept_rate": 84,
                                "display_name": "0xc0de"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1484810330,
                            "post_id": 24779923,
                            "comment_id": 70665360,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment70665360_24779923",
                            "body": "@0xc0de: the <code>mock_open()</code> call produces a rather minimal mock for file objects, you indeed have to add &#39;extra&#39; methods as needed."
                        },
                        {
                            "owner": {
                                "account_id": 459761,
                                "reputation": 8154,
                                "user_id": 860421,
                                "user_type": "registered",
                                "accept_rate": 84,
                                "display_name": "0xc0de"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1484811317,
                            "post_id": 24779923,
                            "comment_id": 70665811,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#comment70665811_24779923",
                            "body": "The same method was available in console tests, but unavailable in a running test suite. I literally copy-pasted the code to console to ensure code similarity, checked (with <code>is</code>) that my mocked method is the one being called in the actual code(being tested). The value of <code>opened_file_obj.readline</code> was something like <code>Mock().open() object at xxxxxxx</code>."
                        }
                    ],
                    "owner": {
                        "account_id": 35417,
                        "reputation": 1089172,
                        "user_id": 100297,
                        "user_type": "moderator",
                        "display_name": "Martijn Pieters"
                    },
                    "comment_count": 20,
                    "is_accepted": true,
                    "score": 38,
                    "last_activity_date": 1484434133,
                    "last_edit_date": 1484434133,
                    "creation_date": 1405510929,
                    "answer_id": 24779923,
                    "question_id": 24779893,
                    "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/24779923#24779923",
                    "body": "<p>The <code>mock_open()</code> object does indeed not implement iteration.</p>\n\n<p>If you are not using the file object as a context manager, you could use:</p>\n\n<pre><code>m = unittest.mock.MagicMock(name='open', spec=open)\nm.return_value = iter(self.TEST_TEXT)\n\nwith unittest.mock.patch('builtins.open', m):\n</code></pre>\n\n<p>Now <code>open()</code> returns an iterator, something that can be directly iterated over just like a file object can be, and it'll also work with <code>next()</code>. It can not, however, be used as a context manager.</p>\n\n<p>You can combine this with <code>mock_open()</code> then provide a <code>__iter__</code> and <code>__next__</code> method on the return value, with the added benefit that <code>mock_open()</code> also adds the prerequisites for use as a context manager:</p>\n\n<pre><code># Note: read_data must be a string!\nm = unittest.mock.mock_open(read_data=''.join(self.TEST_TEXT))\nm.return_value.__iter__ = lambda self: self\nm.return_value.__next__ = lambda self: next(iter(self.readline, ''))\n</code></pre>\n\n<p>The return value here is a <code>MagicMock</code> object specced from the <code>file</code> object (Python 2) or the <a href=\"https://docs.python.org/3/library/io.html#in-memory-streams\" rel=\"noreferrer\">in-memory file objects</a> (Python 3), but only the <code>read</code>, <code>write</code> and <code>__enter__</code> methods have been stubbed out.</p>\n\n<p>The above doesn't work in Python 2 because a) Python 2 expects <code>next</code> to exist, not <code>__next__</code> and b) <code>next</code> is not treated as a special method in Mock (rightly so), so even if you renamed <code>__next__</code> to <code>next</code> in the above example the <em>type</em> of the return value won't have a <code>next</code> method. For <em>most</em> cases it would be enough to make the file object produced an <em>iterable</em> rather than an iterator with:</p>\n\n<pre><code># Python 2!\nm = mock.mock_open(read_data=''.join(self.TEST_TEXT))\nm.return_value.__iter__ = lambda self: iter(self.readline, '')\n</code></pre>\n\n<p>Any code that uses <code>iter(fileobj)</code> will then work (including a <code>for</code> loop).</p>\n\n<p>There is a <a href=\"http://bugs.python.org/issue21258\" rel=\"noreferrer\">open issue in the Python tracker</a> that aims to remedy this gap.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 10906665,
                                "reputation": 2486,
                                "user_id": 8017204,
                                "user_type": "registered",
                                "display_name": "Luis Meraz"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1525242017,
                            "post_id": 41656192,
                            "comment_id": 87274223,
                            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/41656192#comment87274223_41656192",
                            "body": "Bug is still open as of 2018"
                        }
                    ],
                    "owner": {
                        "account_id": 188419,
                        "reputation": 37503,
                        "user_id": 427158,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "maxschlepzig"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 11,
                    "last_activity_date": 1484493518,
                    "last_edit_date": 1484493518,
                    "creation_date": 1484437042,
                    "answer_id": 41656192,
                    "question_id": 24779893,
                    "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/41656192#41656192",
                    "body": "<p>As of Python 3.6, the mocked file-like object returned by the <code>unittest.mock_open</code> method <a href=\"https://bugs.python.org/issue21258\" rel=\"noreferrer\">doesn't support iteration</a>. This bug was reported in 2014 and it is still open as of 2017.</p>\n\n<p>Thus code like this silently yields zero iterations:</p>\n\n<pre><code>f_open = unittest.mock.mock_open(read_data='foo\\nbar\\n')\nf = f_open('blah')\nfor line in f:\n  print(line)\n</code></pre>\n\n<p>You can work around this limitation via adding a method to the mocked object that returns a proper line iterator:</p>\n\n<pre><code>def mock_open(*args, **kargs):\n  f_open = unittest.mock.mock_open(*args, **kargs)\n  f_open.return_value.__iter__ = lambda self : iter(self.readline, '')\n  return f_open\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 10906665,
                        "reputation": 2486,
                        "user_id": 8017204,
                        "user_type": "registered",
                        "display_name": "Luis Meraz"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1525244117,
                    "creation_date": 1525244117,
                    "answer_id": 50128745,
                    "question_id": 24779893,
                    "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration/50128745#50128745",
                    "body": "<p>I found the following solution:</p>\n\n<pre><code>text_file_data = '\\n'.join([\"a line here\", \"the second line\", \"another \nline in the file\"])\nwith patch('__builtin__.open', mock_open(read_data=text_file_data), \ncreate=True) as m:\n    # mock_open doesn't properly handle iterating over the open file with for line in file:\n    # but if we set the return value like this, it works.\n    m.return_value.__iter__.return_value = text_file_data.splitlines()\n    with open('filename', 'rU') as f:\n        for line in f:\n            print line\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 2801729,
                "reputation": 1359,
                "user_id": 2409868,
                "user_type": "registered",
                "accept_rate": 88,
                "display_name": "lemi57ssss"
            },
            "comment_count": 0,
            "is_answered": true,
            "accepted_answer_id": 24779923,
            "answer_count": 3,
            "score": 28,
            "last_activity_date": 1525244117,
            "creation_date": 1405510827,
            "last_edit_date": 1504537488,
            "question_id": 24779893,
            "link": "https://stackoverflow.com/questions/24779893/customizing-unittest-mock-mock-open-for-iteration",
            "title": "Customizing unittest.mock.mock_open for iteration",
            "body": "<p>How should I customize unittest.mock.mock_open to handle this code?</p>\n\n<pre><code>file: impexpdemo.py\ndef import_register(register_fn):\n    with open(register_fn) as f:\n        return [line for line in f]\n</code></pre>\n\n<p>My first attempt tried <code>read_data</code>.</p>\n\n<pre><code>class TestByteOrderMark1(unittest.TestCase):\n    REGISTER_FN = 'test_dummy_path'\n    TEST_TEXT = ['test text 1\\n', 'test text 2\\n']\n\n    def test_byte_order_mark_absent(self):\n        m = unittest.mock.mock_open(read_data=self.TEST_TEXT)\n        with unittest.mock.patch('builtins.open', m):\n            result = impexpdemo.import_register(self.REGISTER_FN)\n            self.assertEqual(result, self.TEST_TEXT)\n</code></pre>\n\n<p>This failed, presumably because the code doesn't use read, readline, or readlines. \nThe <a href=\"http://docs.python.org/3.4/library/unittest.mock.html#mock-open\">documentation</a> for unittest.mock.mock_open says, \"read_data is a string for the read(), readline(), and readlines() methods of the file handle to return. Calls to those methods will take data from read_data until it is depleted. The mock of these methods is pretty simplistic. If you need more control over the data that you are feeding to the tested code you will need to customize this mock for yourself. read_data is an empty string by default.\"</p>\n\n<p>As the documentation gave no hint on what kind of customization would be required I tried <code>return_value</code> and <code>side_effect</code>. Neither worked.</p>\n\n<pre><code>class TestByteOrderMark2(unittest.TestCase):\n    REGISTER_FN = 'test_dummy_path'\n    TEST_TEXT = ['test text 1\\n', 'test text 2\\n']\n\n    def test_byte_order_mark_absent(self):\n        m = unittest.mock.mock_open()\n        m().side_effect = self.TEST_TEXT\n        with unittest.mock.patch('builtins.open', m):\n            result = impexpdemo.import_register(self.REGISTER_FN)\n            self.assertEqual(result, self.TEST_TEXT)\n</code></pre>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 9932
}