{
    "items": [
        {
            "tags": [
                "python",
                "cookies",
                "python-requests",
                "yahoo-finance"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 13900216,
                        "reputation": 191079,
                        "user_id": 10035985,
                        "user_type": "registered",
                        "display_name": "Andrej Kesely"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1682016291,
                    "post_id": 76065035,
                    "comment_id": 134153570,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python#comment134153570_76065035",
                    "body": "Running your code I get normal Json response <code>{&#39;quoteResponse&#39;: {&#39;result&#39;: [{&#39;language&#39;: &#39;en-US&#39;, &#39;region&#39;: &#39;US&#39;, &#39;quoteType&#39;: &#39;EQUITY&#39;, ...</code>"
                },
                {
                    "owner": {
                        "account_id": 3875541,
                        "reputation": 131,
                        "user_id": 3209683,
                        "user_type": "registered",
                        "accept_rate": 14,
                        "display_name": "Justin"
                    },
                    "reply_to_user": {
                        "account_id": 13900216,
                        "reputation": 191079,
                        "user_id": 10035985,
                        "user_type": "registered",
                        "display_name": "Andrej Kesely"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1682066702,
                    "post_id": 76065035,
                    "comment_id": 134160524,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python#comment134160524_76065035",
                    "body": "@AndrejKesely Yeah it seems they fixed it overnight. I guess my question now is should I be including cookies in my headers? If so, what is the best way to do that?"
                },
                {
                    "owner": {
                        "account_id": 370827,
                        "reputation": 1076,
                        "user_id": 719020,
                        "user_type": "registered",
                        "accept_rate": 53,
                        "display_name": "ChrisR"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1684010384,
                    "post_id": 76065035,
                    "comment_id": 134455116,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python#comment134455116_76065035",
                    "body": "Have you found a fix for this? I use an application that updates stock prices using that API, and it&#39;s been broken for a few weeks now."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3875541,
                                "reputation": 131,
                                "user_id": 3209683,
                                "user_type": "registered",
                                "accept_rate": 14,
                                "display_name": "Justin"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1684918778,
                            "post_id": 76320367,
                            "comment_id": 134586337,
                            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76320367#comment134586337_76320367",
                            "body": "Thanks, I was able to do this as well."
                        },
                        {
                            "owner": {
                                "account_id": 128890,
                                "reputation": 909,
                                "user_id": 327066,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "HBCondo"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1689818407,
                            "post_id": 76320367,
                            "comment_id": 135268435,
                            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76320367#comment135268435_76320367",
                            "body": "<code>set-cookie</code> isn&#39;t in the response headers anymore for step #1. Can anyone else verify?"
                        },
                        {
                            "owner": {
                                "account_id": 4853567,
                                "reputation": 785,
                                "user_id": 3915246,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "mahindar"
                            },
                            "reply_to_user": {
                                "account_id": 128890,
                                "reputation": 909,
                                "user_id": 327066,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "HBCondo"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1690920915,
                            "post_id": 76320367,
                            "comment_id": 135419596,
                            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76320367#comment135419596_76320367",
                            "body": "@HBCondo For me, the &quot;set-cookie&quot; is still present in the response headers."
                        }
                    ],
                    "owner": {
                        "account_id": 4853567,
                        "reputation": 785,
                        "user_id": 3915246,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "mahindar"
                    },
                    "comment_count": 3,
                    "is_accepted": true,
                    "score": 15,
                    "last_activity_date": 1684906730,
                    "creation_date": 1684906730,
                    "answer_id": 76320367,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76320367#76320367",
                    "body": "<p>This worked for me.</p>\n<ol>\n<li>Make HTTP GET call to URL <a href=\"https://fc.yahoo.com\" rel=\"noreferrer\">https://fc.yahoo.com</a>. Although this call result in a 404 error, we just need it to extract <code>set-cookie</code> from response headers which is then used in the subsequent calls</li>\n<li>Now make an HTTP GET call to the URL <a href=\"https://query2.finance.yahoo.com/v1/test/getcrumb\" rel=\"noreferrer\">https://query2.finance.yahoo.com/v1/test/getcrumb</a>, by including the obtained cookie from the previous response headers. This call will retrieve the crumb value.</li>\n<li>Replace <code>[crumb-value]</code> in the following URL and make a HTTP GET call with cookie <a href=\"https://query2.finance.yahoo.com/v7/finance/quote?symbols=TSLA&amp;crumb=%5Bcrumb-value%5D\" rel=\"noreferrer\">https://query2.finance.yahoo.com/v7/finance/quote?symbols=TSLA&amp;crumb=[crumb-value]</a></li>\n<li>Cache the cookie value and crumb value to skip first two steps going forward</li>\n</ol>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3629120,
                                "reputation": 7418,
                                "user_id": 3025856,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "Jeremy Caney"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1685429957,
                            "post_id": 76359759,
                            "comment_id": 134654385,
                            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76359759#comment134654385_76359759",
                            "body": "But the question is for Python."
                        }
                    ],
                    "owner": {
                        "account_id": 5134635,
                        "reputation": 21,
                        "user_id": 4113786,
                        "user_type": "registered",
                        "display_name": "Toni Jr"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1685386866,
                    "last_edit_date": 1685386866,
                    "creation_date": 1685386834,
                    "answer_id": 76359759,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76359759#76359759",
                    "body": "<p>I did in php, the code is:</p>\n<pre><code>\n&lt;?php\n\n/* 1 - Get cookie */\n//https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python\n$url_yahoo = &quot;https://fc.yahoo.com&quot;;\n$yahoo_headers = get_headers($url_yahoo, true);\n//print_r($yahoo_headers);\n$cookie_name = 'Set-Cookie';\n\n/* 2 - Get crumb , setting cookie */\n$url_yahoo2 = &quot;https://query2.finance.yahoo.com/v1/test/getcrumb&quot;;\n$c = curl_init($url_yahoo2);\ncurl_setopt($c, CURLOPT_VERBOSE, 1);\ncurl_setopt($c, CURLOPT_COOKIE, $yahoo_headers[$cookie_name]);\ncurl_setopt($c, CURLOPT_RETURNTRANSFER, 1);\n$crumb = curl_exec($c);\ncurl_close($c);\n//echo &quot;&lt;BR&gt;Crumb:&quot; . $crumb;\n\n/* 3 - Get quotes with crumb, setting cookie. Using sample tickets*/\n$tickets_list = &quot;AAPL,TSLA&quot;;\n$url_cotacao = &quot;https://query2.finance.yahoo.com/v7/finance/quote?symbols=&quot; . $tickets_list . &quot;&amp;crumb=&quot; . $crumb;\n$c = curl_init($url_cotacao);\ncurl_setopt($c, CURLOPT_VERBOSE, 1);\ncurl_setopt($c, CURLOPT_COOKIE, $yahoo_headers[$cookie_name]);\ncurl_setopt($c, CURLOPT_RETURNTRANSFER, 1);\n$data_quote = curl_exec($c);\ncurl_close($c);\n\n\n/* 4 - Get data from yahoo */\n$resJson_decode = json_decode($data_quote, false);\nif (!$resJson_decode-&gt;quoteResponse-&gt;result) {\n    $resultado = &quot;Ticket dont exists in yahoo!&quot;;\n} else {\n    foreach ($resJson_decode-&gt;quoteResponse-&gt;result as $ticket_result){\n        echo &quot;&lt;BR&gt;Ticket:&quot; . $ticket_result-&gt;symbol;\n        echo &quot;&lt;BR&gt;Price:&quot; . $ticket_result-&gt;regularMarketPrice;\n    }\n    \n}\n\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 8245710,
                        "reputation": 51,
                        "user_id": 6201871,
                        "user_type": "registered",
                        "display_name": "Brian"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1685722460,
                    "last_edit_date": 1685722460,
                    "creation_date": 1685722099,
                    "answer_id": 76391799,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76391799#76391799",
                    "body": "<p>Here's a sample Python code based on the answer from @mahindar to get the cookie and crumb:</p>\n<pre><code>import requests\n\n\ndef get_yahoo_cookie():\n    cookie = None\n\n    user_agent_key = &quot;User-Agent&quot;\n    user_agent_value = &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;\n\n    headers = {user_agent_key: user_agent_value}\n    response = requests.get(\n        &quot;https://fc.yahoo.com&quot;, headers=headers, allow_redirects=True\n    )\n\n    if not response.cookies:\n        raise Exception(&quot;Failed to obtain Yahoo auth cookie.&quot;)\n\n    cookie = list(response.cookies)[0]\n\n    return cookie\n\n\ndef get_yahoo_crumb(cookie):\n    crumb = None\n\n    user_agent_key = &quot;User-Agent&quot;\n    user_agent_value = &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;\n\n    headers = {user_agent_key: user_agent_value}\n\n    crumb_response = requests.get(\n        &quot;https://query1.finance.yahoo.com/v1/test/getcrumb&quot;,\n        headers=headers,\n        cookies={cookie.name: cookie.value},\n        allow_redirects=True,\n    )\n    crumb = crumb_response.text\n\n    if crumb is None:\n        raise Exception(&quot;Failed to retrieve Yahoo crumb.&quot;)\n\n    return crumb\n\n\n# Usage\ncookie = get_yahoo_cookie()\ncrumb = get_yahoo_crumb(cookie)\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 419218,
                                "reputation": 3696,
                                "user_id": 796259,
                                "user_type": "registered",
                                "display_name": "Friedrich"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1687857861,
                            "post_id": 76555529,
                            "comment_id": 134991931,
                            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76555529#comment134991931_76555529",
                            "body": "Could you please explain how OP would use your code in their Python script?"
                        },
                        {
                            "owner": {
                                "account_id": 28818025,
                                "reputation": 41,
                                "user_id": 22071201,
                                "user_type": "registered",
                                "display_name": "jsDev"
                            },
                            "reply_to_user": {
                                "account_id": 419218,
                                "reputation": 3696,
                                "user_id": 796259,
                                "user_type": "registered",
                                "display_name": "Friedrich"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1688038523,
                            "post_id": 76555529,
                            "comment_id": 135021644,
                            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76555529#comment135021644_76555529",
                            "body": "It&#39;s possible to call node from python, the code provided above is for Node.js. For use in Python just adapt the code. It turns out that Pyhton requests and responses have a cookies property which is convenient. Python version follows below:"
                        },
                        {
                            "owner": {
                                "account_id": 419218,
                                "reputation": 3696,
                                "user_id": 796259,
                                "user_type": "registered",
                                "display_name": "Friedrich"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1688038980,
                            "post_id": 76555529,
                            "comment_id": 135021741,
                            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76555529#comment135021741_76555529",
                            "body": "Thanks for writing an answer... and another answer. Usually it&#39;s best to answer in a way OP can use the code in the answer as a drop-in replacement. Explanations are a must for great answers. See <a href=\"https://stackoverflow.com/help/how-to-answer\">How do I write a good answer?</a>"
                        }
                    ],
                    "owner": {
                        "account_id": 28818025,
                        "reputation": 41,
                        "user_id": 22071201,
                        "user_type": "registered",
                        "display_name": "jsDev"
                    },
                    "comment_count": 3,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1687773088,
                    "creation_date": 1687773088,
                    "answer_id": 76555529,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76555529#76555529",
                    "body": "<p>For completion let me add a JavaScript version. I was researching this problem quite a bit and I am astonished how simple the solution finally is.\nAlternatively, cookie and crumb can also be obtained and extracted from finance.yahoo.com</p>\n<pre class=\"lang-js prettyprint-override\"><code>const API = 'https://query2.finance.yahoo.com'\n\nasync function getCredentials() {\n  // get the A3 cookie\n  const { headers } = await fetch('https://fc.yahoo.com')\n  const cookie = headers.get('set-cookie')\n  // now get the crumb\n  const url = new URL('/v1/test/getcrumb', API)\n  const request = new Request(url)\n  request.headers.set('cookie', cookie)\n  const response = await fetch(request)\n  const crumb = await response.text()\n  return { cookie, crumb } \n}\n\nasync function quote(symbols, cookie, crumb) {\n  const url = new URL('v7/finance/quote', API)\n  url.searchParams.set('symbols', symbols.join(','))\n  url.searchParams.set('crumb', crumb)\n  const request = new Request(url)\n  request.headers.set('cookie', cookie)\n  const response = await fetch(request)\n  const {quoteResponse} = await response.json()\n  return quoteResponse?.result || []\n}\n\n// main\nconst { cookie, crumb } = await getCredentials()\nconst quotes = await quote(['GOOG', 'TSLA'], cookie, crumb)\nif (quotes.length) {\n  for (const quote of quotes) {\n    console.log(`${quote.symbol} price is ${quote.currency} ${quote.regularMarketPrice}`)\n  }\n}\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 28818025,
                        "reputation": 41,
                        "user_id": 22071201,
                        "user_type": "registered",
                        "display_name": "jsDev"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1688038169,
                    "creation_date": 1688038169,
                    "answer_id": 76580610,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76580610#76580610",
                    "body": "<pre class=\"lang-py prettyprint-override\"><code>import requests\n\napiBase = 'https://query2.finance.yahoo.com'\nheaders = { \n  &quot;User-Agent&quot;: \n  &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64)&quot;\n}\n\ndef getCredentials(cookieUrl='https://fc.yahoo.com', crumbUrl=apiBase+'/v1/test/getcrumb'):\n  cookie = requests.get(cookieUrl).cookies\n  crumb = requests.get(url=crumbUrl, cookies=cookie, headers=headers).text\n  return {'cookie': cookie, 'crumb': crumb}\n\ndef quote(symbols, credentials):\n  url = apiBase + '/v7/finance/quote'\n  params = {'symbols': ','.join(symbols), 'crumb': credentials['crumb']}\n  response = requests.get(url, params=params, cookies=credentials['cookie'], headers=headers)\n  quotes = response.json()['quoteResponse']['result']\n  return quotes\n\ncredentials = getCredentials()\nquotes = quote(['GOOG', 'TSLA'], credentials)\nif quotes:\n  for quote in quotes:\n    print(f&quot;{quote['symbol']} price is {quote['currency']} {quote['regularMarketPrice']}&quot;)\n\n# GOOG price is USD 121.08\n# TSLA price is USD 256.24\n</code></pre>\n<p>I used <a href=\"https://www.codeconvert.ai/javascript-to-python-converter\" rel=\"nofollow noreferrer\">https://www.codeconvert.ai/javascript-to-python-converter</a> plus some modifications</p>\n"
                },
                {
                    "owner": {
                        "account_id": 948873,
                        "reputation": 669,
                        "user_id": 1012300,
                        "user_type": "registered",
                        "accept_rate": 11,
                        "display_name": "Etay Gudai     972-522-3322-47"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1689687999,
                    "creation_date": 1689687999,
                    "answer_id": 76713450,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76713450#76713450",
                    "body": "<p><strong>PowerShell Usage Example :</strong></p>\n<pre><code>    # \u25ba Create $session Object\n$session = New-Object Microsoft.PowerShell.Commands.WebRequestSession\n$Stock = &quot;MSFT&quot; \n\n    # \u25ba Call 1st Url ( Gain some headers and cookies stuff ) - using try &amp; catch to prevent 404 error ( as mentioned above )\ntry { Invoke-WebRequest -UseBasicParsing -Uri &quot;https://fc.yahoo.com/&quot; -SessionVariable session } catch {\n  $null}        \n        \n\n    # \u25ba Call 2nd Url ( Generate Crumb ) \n$crumb = Invoke-WebRequest -UseBasicParsing -Uri &quot;https://query2.finance.yahoo.com/v1/test/getcrumb&quot; -WebSession $session\n\n\n    # \u25ba Call 3rd Url ( Get Yahoo's Data ) \n$URL = $(&quot;https://query2.finance.yahoo.com/v10/finance/quoteSummary/&quot; + $Stock + &quot;?modules=price&amp;crumb=&quot; + $crumb)\n$ResponseText = Invoke-WebRequest -UseBasicParsing -Uri $URL -WebSession $session\n\n    \n    # \u25ba Print Result\n$ResponseText = $ResponseText.ToString()\n$ResponseText \n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 29179355,
                        "reputation": 1,
                        "user_id": 22353932,
                        "user_type": "registered",
                        "display_name": "Rafa"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1691431545,
                    "creation_date": 1691431545,
                    "answer_id": 76854166,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76854166#76854166",
                    "body": "<p>I did this for VBA macro:</p>\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"true\" data-console=\"true\" data-babel=\"true\">\r\n<div class=\"snippet-code snippet-currently-hidden\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>Public Function GetStockData() As String\n    Dim qurl As String\n    Dim cookie As String\n    Dim crumb As String\n    Dim req As Object\n    Dim cookieurl As String\n\n    cookieurl = \"https://fc.yahoo.com\" 'This page needs to return a cookie, query1.finance.yahoo does not return cookie.\n    \n    Set req = CreateObject(\"WinHttp.WinHttpRequest.5.1\")\n    \n    'get cookie\n    With req\n        .Open \"GET\", cookieurl, False\n        .setRequestHeader \"REFERER\", cookieurl\n        .setRequestHeader \"User-Agent\", \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\"\n        .Send\n        \n        cookie = .getResponseHeader(\"Set-Cookie\") 'gets cookie and saves it.\n    End With\n   \n    'get crumb\n    With req\n        .Open \"GET\", \"https://query2.finance.yahoo.com/v1/test/getcrumb\", False 'gets crumb, which must be attached to all quote calls\n        .setRequestHeader \"REFERER\", cookieurl\n        .setRequestHeader \"User-Agent\", \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\"\n        .setRequestHeader \"Cookie\", cookie 'applies cookie to header, currently working without this, but probably good practice to use it\n        .Send\n        \n        crumb = .responseText 'saves crumb\n    End With\n    \n    qurl = \"http://query1.finance.yahoo.com/v7/finance/quote?symbols=AAPL\"\n  \n    qurl = qurl &amp; \"&amp;crumb=\" &amp; crumb 'add crumb info from GetCookie sub\n    \n\n    'get data\n    With req\n        .Open \"GET\", qurl, False\n        'header is needed but not specific, could probbaly remove a couple lines without creating a problem\n        .setRequestHeader \"REFERER\", cookieurl\n        .setRequestHeader \"User-Agent\", \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\"\n        .setRequestHeader \"Cookie\", cookie\n        .Send\n        GetStockData = .responseText 'get data and return\n    End With\nEnd Function</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"
                },
                {
                    "owner": {
                        "account_id": 18844169,
                        "reputation": 154,
                        "user_id": 13744901,
                        "user_type": "registered",
                        "display_name": "Ultra Junkie"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1692354378,
                    "creation_date": 1692354378,
                    "answer_id": 76928481,
                    "question_id": 76065035,
                    "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python/76928481#76928481",
                    "body": "<p>Based on the other answers (a big thank you to the contributors!) I was able to update my Excel VBA code which now works again (question is: how long...).</p>\n<p>Here is the complete solution which also includes how to retrieve the cookie from the header as <code>http.getResponseHeader &quot;set-cookie&quot;</code> doesn't yield anything in VBA (question from @HBCondo). The cookie and crumb are requested only once and stored in global variables. No check for validity has been added so far although the cookie expires after a certain time. ParseJson is a function in the VBA-JSON project available on Github.</p>\n<pre><code>Public crumb As String\nPublic cookie As String\n\nPublic Sub YahooGetCrumb()\n    Dim http As MSXML2.XMLHTTP60\n    Dim strHeader As String\n    Dim strFields() As String\n    \n    Set http = New MSXML2.XMLHTTP60\n    \n    http.Open &quot;GET&quot;, &quot;https://fc.yahoo.com&quot;\n    http.setRequestHeader &quot;User-Agent&quot;, &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;\n    http.send\n    \n    strHeader = http.getAllResponseHeaders\n    strFields = Split(strHeader, vbCrLf)\n    cookie = Trim(Split(Split(strFields(5), &quot;;&quot;)(0), &quot;:&quot;)(1)) &amp; &quot;; &quot; &amp; Trim(Split(Split(strFields(6), &quot;;&quot;)(0), &quot;:&quot;)(1))\n\n    http.Open &quot;GET&quot;, &quot;https://query2.finance.yahoo.com/v1/test/getcrumb&quot;\n    http.setRequestHeader &quot;User-Agent&quot;, &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;\n    http.setRequestHeader &quot;Cookie&quot;, cookie\n    http.send\n    \n    crumb = http.responseText\n    \nEnd Sub\n\nPublic Function GetYahooData(sSymbol As String) As String\n    Dim http As MSXML2.XMLHTTP60\n    \n    If crumb = &quot;&quot; Then\n        YahooGetCrumb\n    End If\n    \n    Set http = New MSXML2.XMLHTTP60\n    \n    http.Open &quot;GET&quot;, &quot;https://query2.finance.yahoo.com/v7/finance/quote?symbols=&quot; &amp; sSymbol &amp; &quot;&amp;crumb=&quot; &amp; crumb, False\n    http.setRequestHeader &quot;User-Agent&quot;, &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&quot;\n    http.send\n    \n    GetYahooData = http.responseText\n    \nEnd Function\n\nPublic Sub test()\n    Dim JSON As Object\n\n    responseText = GetYahooData(&quot;AAPL&quot;)\n    \n    Set JSON = ParseJson(responseText)\nend Sub    \n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 3875541,
                "reputation": 131,
                "user_id": 3209683,
                "user_type": "registered",
                "accept_rate": 14,
                "display_name": "Justin"
            },
            "comment_count": 3,
            "is_answered": true,
            "accepted_answer_id": 76320367,
            "answer_count": 8,
            "score": 7,
            "last_activity_date": 1705666768,
            "creation_date": 1681999649,
            "question_id": 76065035,
            "link": "https://stackoverflow.com/questions/76065035/yahoo-finance-v7-api-now-requiring-cookies-python",
            "title": "Yahoo Finance V7 API now requiring cookies? (Python)",
            "body": "<pre><code>url = 'https://query2.finance.yahoo.com/v7/finance/quote?symbols=TSLA&amp;fields=regularMarketPreviousClose&amp;region=US&amp;lang=en-US'\nheaders = {\n    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36'\n}\ndata = requests.get(url,headers=headers)\nprepost_data = data.json()\n</code></pre>\n<p>It seems recently, Yahoo Finance changed their V7 API to require cookies for every request. Running the code above, I get the Invalid Crumb error</p>\n<p><code>{&quot;finance&quot;:{&quot;result&quot;:null,&quot;error&quot;:{&quot;code&quot;:&quot;Unauthorized&quot;,&quot;description&quot;:&quot;Invalid Crumb&quot;}}}</code></p>\n<p>This issue seems to also be known in this Github repo: <a href=\"https://github.com/joshuaulrich/quantmod/issues/382\" rel=\"noreferrer\">https://github.com/joshuaulrich/quantmod/issues/382</a></p>\n<p>They seem to have a patch that works: <a href=\"https://github.com/joshuaulrich/quantmod/pull/383/commits\" rel=\"noreferrer\">https://github.com/joshuaulrich/quantmod/pull/383/commits</a></p>\n<p>But the code is all written in R... Anyone know how to translate this to Python?</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 6663
}