{
    "items": [
        {
            "tags": [
                "pine-script",
                "tradingview-api",
                "pine-script-v4"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 7258775,
                        "reputation": 403,
                        "user_id": 5536388,
                        "user_type": "registered",
                        "display_name": "Krzysztof Maliszewski"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1613970232,
                    "post_id": 64019553,
                    "comment_id": 117230647,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript#comment117230647_64019553",
                    "body": "Have you created the function? Can you share the code?"
                },
                {
                    "owner": {
                        "account_id": 196751,
                        "reputation": 3135,
                        "user_id": 440362,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "Mayank Jain"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1629853972,
                    "post_id": 64019553,
                    "comment_id": 121794733,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript#comment121794733_64019553",
                    "body": "Were you able to create a more generic code which you could share? Thanks!"
                },
                {
                    "owner": {
                        "account_id": 9874227,
                        "reputation": 139,
                        "user_id": 7312622,
                        "user_type": "registered",
                        "display_name": "Frumda Grayforce"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1644585148,
                    "post_id": 64019553,
                    "comment_id": 125651794,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript#comment125651794_64019553",
                    "body": "Any updates there?"
                },
                {
                    "owner": {
                        "account_id": 6578687,
                        "reputation": 393,
                        "user_id": 5105995,
                        "user_type": "registered",
                        "display_name": "cyberspider789"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1671849944,
                    "post_id": 64019553,
                    "comment_id": 132188699,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript#comment132188699_64019553",
                    "body": "Please avoid using Pivothigh() and pivotlow() in strategy. They are good for indicator. If in strategy, you are going to have some decision based on pivothi or pivotlo then watchout because it &#39;kicks back&#39; e.g. instead of giving buy signal at current bar, you will get at previous bar if pivothi() / pivotlo() finds pivot at previous bar..."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3822817,
                                "reputation": 4804,
                                "user_id": 3170465,
                                "user_type": "registered",
                                "accept_rate": 69,
                                "display_name": "Birrel"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1611265861,
                            "post_id": 64103769,
                            "comment_id": 116403305,
                            "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/64103769#comment116403305_64103769",
                            "body": "Does this mean that a pivotHigh or Low will not be drawn on the chart until at least 10 bars later? Like, suuuper lagging indicator?"
                        },
                        {
                            "owner": {
                                "account_id": 18816067,
                                "reputation": 3673,
                                "user_id": 13723165,
                                "user_type": "registered",
                                "display_name": "e2e4"
                            },
                            "reply_to_user": {
                                "account_id": 3822817,
                                "reputation": 4804,
                                "user_id": 3170465,
                                "user_type": "registered",
                                "accept_rate": 69,
                                "display_name": "Birrel"
                            },
                            "edited": false,
                            "score": 8,
                            "creation_date": 1611273571,
                            "post_id": 64103769,
                            "comment_id": 116405538,
                            "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/64103769#comment116405538_64103769",
                            "body": "Correct, lag = rightbars+1, pattern = leftbars+rightbars+1"
                        }
                    ],
                    "owner": {
                        "account_id": 18816067,
                        "reputation": 3673,
                        "user_id": 13723165,
                        "user_type": "registered",
                        "display_name": "e2e4"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 16,
                    "last_activity_date": 1601301877,
                    "creation_date": 1601301877,
                    "answer_id": 64103769,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/64103769#64103769",
                    "body": "<p>Leftbars and rightbars are number of bars that the <code>pivot</code> functions looks when is searching for a pivot.\nFor example:\n<code>pivothigh(10,10)</code> will search for high price that was not exceeded during 10 bars to the left (past data) and 10 bars to the right (future data). Note that the function won't be able to determine the pivot if there is less than 10 bars to the right.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 196751,
                        "reputation": 3135,
                        "user_id": 440362,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "Mayank Jain"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1676465544,
                    "last_edit_date": 1676465544,
                    "creation_date": 1629853939,
                    "answer_id": 68915656,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/68915656#68915656",
                    "body": "<p>I've tried to create a simple version of it in Pine Script, which does not uses pivothigh/pivotlow - instead does the candlestick comparison.</p>\n<p><a href=\"https://www.tradingview.com/script/BYHsrYPG-Broken-Fractal-Someone-s-broken-dream-is-your-profit\" rel=\"nofollow noreferrer\">https://www.tradingview.com/script/BYHsrYPG-Broken-Fractal-Someone-s-broken-dream-is-your-profit</a></p>\n<p>I was also able to convert this into Ruby code (Python code should be as easy).</p>\n<pre class=\"lang-rb prettyprint-override\"><code>if (candles[i-1][:h] &gt; candles[i-2][:h]) and (candles[i-1][:h] &gt; candles[i][:h])\n    puts &quot;DownFractal&quot;\nend\n\nif (candles[i-1][:l] &lt; candles[i-2][:l]) and (candles[i-1][:l] &lt; candles[i][:l])\n    puts &quot;UpFractal&quot;\nend\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 17937936,
                        "reputation": 858,
                        "user_id": 13033901,
                        "user_type": "registered",
                        "display_name": "RRIL97"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": -1,
                    "last_activity_date": 1629894308,
                    "last_edit_date": 1629894308,
                    "creation_date": 1629893959,
                    "answer_id": 68922829,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/68922829#68922829",
                    "body": "<p>I had found this thread after I have searched for this kind of implementation.\nHere is my own implementation for those that have been utilizing the Binance API. (Written in java)</p>\n<p>From my own testings, it has the same results as the pine script.</p>\n<pre><code>private boolean checkHighOrLow(Candlestick candlestick , int lengthForCheck, int currentCandleIndex, boolean checkForHigh) {\n    double currentCandleStickClosePrice = Double.parseDouble(candlestick.getClose());\n    for (int i = 0; i &lt; lengthForCheck; i++) {\n        double afterCandleStick  = Double.parseDouble(candlestickList.get(currentCandleIndex + i + 1).getClose());\n        double beforeCandleStick = Double.parseDouble(candlestickList.get(currentCandleIndex - i - 1).getClose());\n        if(checkForHigh) {\n            if (afterCandleStick &gt; currentCandleStickClosePrice)\n                return false;\n            if (beforeCandleStick &gt; currentCandleStickClosePrice)\n                return false;\n        }else{\n            if(afterCandleStick &lt; currentCandleStickClosePrice)\n                return false;\n            if(beforeCandleStick &lt; currentCandleStickClosePrice)\n                return false;\n        }\n    }\n    return true;\n}\n\npublic void findHighsAndLows(){\n    int lengthForCheck = 1;\n    int numOfCandles   = candlestickList.size();\n    for(int i = lengthForCheck; i &lt; numOfCandles - lengthForCheck; i ++)\n    {\n         Candlestick currentCandle = candlestickList.get(i);\n         if(checkHighOrLow(currentCandle,numOfCandles,lengthForCheck,i,true))\n             highs.add(currentCandle);\n         if(checkHighOrLow(currentCandle,numOfCandles,lengthForCheck,i,false))\n             lows.add(currentCandle);\n    }\n}\n</code></pre>\n<p>Logic still applies.\nEnjoy</p>\n<p>Result:</p>\n<pre><code>FOUND LOW | Wed Aug 25 04:20:00 IDT 2021\nFOUND HIGH | Wed Aug 25 05:05:00 IDT 2021\nFOUND LOW | Wed Aug 25 05:20:00 IDT 2021\nFOUND HIGH | Wed Aug 25 05:30:00 IDT 2021\nFOUND LOW | Wed Aug 25 05:35:00 IDT 2021\nFOUND HIGH | Wed Aug 25 05:45:00 IDT 2021\nFOUND LOW | Wed Aug 25 06:15:00 IDT 2021\nFOUND HIGH | Wed Aug 25 06:25:00 IDT 2021\nFOUND LOW | Wed Aug 25 06:35:00 IDT 2021\nFOUND HIGH | Wed Aug 25 06:40:00 IDT 2021\nFOUND LOW | Wed Aug 25 06:55:00 IDT 2021\nFOUND HIGH | Wed Aug 25 07:05:00 IDT 2021\nFOUND LOW | Wed Aug 25 07:25:00 IDT 2021\nFOUND HIGH | Wed Aug 25 07:45:00 IDT 2021\nFOUND LOW | Wed Aug 25 07:50:00 IDT 2021\nFOUND HIGH | Wed Aug 25 08:20:00 IDT 2021\nFOUND LOW | Wed Aug 25 08:25:00 IDT 2021\nFOUND HIGH | Wed Aug 25 08:35:00 IDT 2021\nFOUND LOW | Wed Aug 25 08:45:00 IDT 2021\nFOUND HIGH | Wed Aug 25 08:50:00 IDT 2021\nFOUND LOW | Wed Aug 25 09:15:00 IDT 2021\nFOUND HIGH | Wed Aug 25 09:30:00 IDT 2021\nFOUND LOW | Wed Aug 25 09:35:00 IDT 2021\nFOUND HIGH | Wed Aug 25 09:40:00 IDT 2021\nFOUND LOW | Wed Aug 25 09:55:00 IDT 2021\nFOUND HIGH | Wed Aug 25 10:00:00 IDT 2021\nFOUND LOW | Wed Aug 25 10:05:00 IDT 2021\nFOUND HIGH | Wed Aug 25 10:15:00 IDT 2021\nFOUND LOW | Wed Aug 25 10:45:00 IDT 2021\nFOUND HIGH | Wed Aug 25 10:50:00 IDT 2021\nFOUND LOW | Wed Aug 25 11:15:00 IDT 2021\nFOUND HIGH | Wed Aug 25 11:20:00 IDT 2021\nFOUND LOW | Wed Aug 25 11:35:00 IDT 2021\nFOUND HIGH | Wed Aug 25 11:45:00 IDT 2021\nFOUND LOW | Wed Aug 25 11:55:00 IDT 2021\nFOUND HIGH | Wed Aug 25 12:15:00 IDT 2021\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3166428,
                                "reputation": 65,
                                "user_id": 4393857,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "MahdiAliz"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1671155711,
                            "post_id": 71096339,
                            "comment_id": 132043575,
                            "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/71096339#comment132043575_71096339",
                            "body": "I need your my_pivotlow function in python code. Who can do it?!"
                        }
                    ],
                    "owner": {
                        "account_id": 2866274,
                        "reputation": 171,
                        "user_id": 2460544,
                        "user_type": "registered",
                        "display_name": "lvinnyl"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 14,
                    "last_activity_date": 1644704391,
                    "creation_date": 1644704391,
                    "answer_id": 71096339,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/71096339#71096339",
                    "body": "<p>I too had a need to better understand how the <code>pivothigh()</code> and <code>pivotlow()</code> functions work internally so I made the effort to code a Pine Script version (using version 5 of Pine Script) for myself and tested it side-by-side with the <code>ta.pivotlow()</code> and <code>ta.pivothigh()</code> functions and it seems to work well. Maybe this will help you as well.</p>\n<pre><code>my_pivothigh(float _series = high, int _leftBars, int _rightBars) =&gt;\n    float _pivotHigh = na\n    int _pivotRange = ( _leftBars + _rightBars )\n    float _leftEdgeValue = nz(_series[_pivotRange], na)\n    if not na(_series) and _leftBars &gt; 0 and _rightBars &gt; 0 and not na(_leftEdgeValue)\n        float _possiblePivotHigh = _series[_rightBars]\n        float[] _arrayOfSeriesValues = array.new_float(0)\n        for _barIndex = _pivotRange to 0\n            array.push(_arrayOfSeriesValues, _series[_barIndex])\n        //end for\n        int _pivotHighRightBars = array.size(_arrayOfSeriesValues) - array.lastindexof(_arrayOfSeriesValues, array.max(_arrayOfSeriesValues)) - 1\n        _pivotHigh := ( _pivotHighRightBars == _rightBars ) ? _possiblePivotHigh : na\n    //end if\n    _pivotHigh\n</code></pre>\n<pre><code>my_pivotlow(float _series = low, int _leftBars, int _rightBars) =&gt;\n    float _pivotLow = na\n    int _pivotRange = ( _leftBars + _rightBars )\n    float _leftEdgeValue = nz(_series[_pivotRange], na)\n    if not na(_series) and _leftBars &gt; 0 and _rightBars &gt; 0 and not na(_leftEdgeValue)\n        float _possiblePivotLow = _series[_rightBars]\n        float[] _arrayOfSeriesValues = array.new_float(0)\n        for _barIndex = _pivotRange to 0\n            array.push(_arrayOfSeriesValues, _series[_barIndex])\n        //end for\n        int _pivotLowRightBars = array.size(_arrayOfSeriesValues) - array.lastindexof(_arrayOfSeriesValues, array.min(_arrayOfSeriesValues)) - 1\n        _pivotLow := ( _pivotLowRightBars == _rightBars ) ? _possiblePivotLow : na\n    //end if\n    _pivotLow\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 20040153,
                        "reputation": 165,
                        "user_id": 14691018,
                        "user_type": "registered",
                        "display_name": "Yugenswitch"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 9,
                    "last_activity_date": 1676295476,
                    "last_edit_date": 1676295476,
                    "creation_date": 1654262022,
                    "answer_id": 72490168,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/72490168#72490168",
                    "body": "<p>I know this is an old post but I've made a very simple python implementation that anyone can build on, it does the same thing as Pine Scripts ta.pivot functions.</p>\n<p>code:</p>\n<pre class=\"lang-py prettyprint-override\"><code>def pivots_high(data, LBR, LBL):\n    pivots = []\n    for i in range(len(data)-LBR):\n        pivots.append(0)\n        pivot = True\n        if i &gt; LBL:\n            for j in range(LBL + 1):\n                if data[i - j] &gt; data[I]:  # do if data[i - j] &lt; data[i] for pivot low\n                    pivot = False\n            for j in range(LBR + 1):\n                if data[i + j] &gt; data[I]:  # do if data[i + j] &lt; data[i] for pivot low\n                    pivot = False\n        if pivot is True:\n            pivots[len(pivots)-1] = data[i]\n    for p in range(LBR):\n        pivots.append(0)  # This is so the pivots length matches your data length\n    return pivots  # The Pivots will be any value that is not 0 and it will be where the lowest/highest value is\n</code></pre>\n<p>the lookback variables simply means that if you take one price point and look n(Looback left) candles left and n(lookback right) candles right, and still its the lowest/highest then that's the pivot</p>\n<h4>UPDATE</h4>\n<p>I ran into some problems with this code with different combinations of numbers on large datasets so I had to completely change it to always match up with tradingview.</p>\n<p>New Code:</p>\n<pre class=\"lang-py prettyprint-override\"><code>def checkhl(data_back, data_forward, hl):\n    if hl == 'high' or hl == 'High':\n        ref = data_back[len(data_back)-1]\n        for i in range(len(data_back)-1):\n            if ref &lt; data_back[i]:\n                return 0\n        for i in range(len(data_forward)):\n            if ref &lt;= data_forward[i]:\n                return 0\n        return 1\n    if hl == 'low' or hl == 'Low':\n        ref = data_back[len(data_back)-1]\n        for i in range(len(data_back)-1):\n            if ref &gt; data_back[i]:\n                return 0\n        for i in range(len(data_forward)):\n            if ref &gt;= data_forward[i]:\n                return 0\n        return 1\n\n\ndef pivot(osc, LBL, LBR, highlow)\n    left = []\n    right = []\n    for i in range(len(osc)):\n        pivots.append(0.0)\n        if i &lt; LBL + 1:\n            left.append(osc[i])\n        if i &gt; LBL:\n            right.append(osc[i])\n        if i &gt; LBL + LBR:\n            left.append(right[0])\n            left.pop(0)\n            right.pop(0)\n            if checkhl(left, right, highlow):\n                pivots[i - LBR] = osc[i - LBR]\n    return pivots\n</code></pre>\n<p>then just do:</p>\n<pre class=\"lang-py prettyprint-override\"><code>pivots_low = pivot(data, lbl, lbr, 'low')\npivots_high = pivot(data, lbl, lbr, 'high')\n</code></pre>\n<p>output is pivots in their actual location with 0.0s otherwise.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 299039,
                        "reputation": 988,
                        "user_id": 605399,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "Abdullah"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1676454949,
                    "last_edit_date": 1676454949,
                    "creation_date": 1656054765,
                    "answer_id": 72740229,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/72740229#72740229",
                    "body": "<p>This is my implementation of ta.pivotHigh for javascript, hope this helps.</p>\n<pre class=\"lang-js prettyprint-override\"><code>const pivotHigh = (series, period) =&gt; {\n  \n  let ph = 0;\n  let phIndex = 0;\n\n  // left + right bars + 1 pivot bar\n  for ( let i = period + period + 1, len = series.length; i--; ) {\n\n    const cur = series[len - i];\n    \n    // [!] &gt; -1 logic. can also checks: NaN\n    if ( cur &gt; -1 ) {} else {\n      break;\n    }\n\n    if ( cur &gt; ph ) {\n      ph = cur;\n      phIndex = len - i;\n    }\n  }\n  // found?\n  return phIndex === period\n    ? ph\n    : 0;\n};\n</code></pre>\n<p>usage:</p>\n<pre class=\"lang-js prettyprint-override\"><code>const series = [0,1,2,3,4,5,4,3,2,1,0];\nconst period = 5;\n\nconst ph = pivotHigh(series, period);\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 25600628,
                        "reputation": 51,
                        "user_id": 19375707,
                        "user_type": "registered",
                        "display_name": "sofex"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 5,
                    "last_activity_date": 1676326892,
                    "last_edit_date": 1676326892,
                    "creation_date": 1661169660,
                    "answer_id": 73444793,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/73444793#73444793",
                    "body": "<p>You could construct something similar with a one-liner with pandas:</p>\n<pre class=\"lang-py prettyprint-override\"><code>pivots = high_column.shift(-len_right, fill_value=0).rolling(len_left).max()\n</code></pre>\n<p>For 'High' pivots pd.Series 'high_column' and:</p>\n<pre class=\"lang-py prettyprint-override\"><code>pivots = low_column.shift(-len_right, fill_value=0).rolling(len_left).min()\n</code></pre>\n<p>for the 'Lows'. It avoids using loops and is a fast vectorized function.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 13176371,
                        "reputation": 11,
                        "user_id": 14897366,
                        "user_type": "registered",
                        "display_name": "patulincekxxx"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1677163085,
                    "last_edit_date": 1677163085,
                    "creation_date": 1664197287,
                    "answer_id": 73854561,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/73854561#73854561",
                    "body": "<p>Here's my Python implementation. Works exactly as <code>ta.pivothigh</code> and <code>ta.pivotlow</code>.</p>\n<p>Pivot high:</p>\n<pre class=\"lang-py prettyprint-override\"><code>def get_pivot_high(ohlcvs: List[OHLCV], left_bars: int, right_bars: int, key_name: str = 'high_price') -&gt; Optional[float]:\n    if len(ohlcvs) &lt; left_bars + right_bars:\n        return None\n    highest_value = max(ohlcv.get(key_name) for ohlcv in ohlcvs[-(left_bars + right_bars + 1):])\n    return highest_value if highest_value == ohlcvs[-right_bars].get(key_name) else None\n</code></pre>\n<p>Pivot low:</p>\n<pre class=\"lang-py prettyprint-override\"><code>def get_pivot_low(ohlcvs: List[OHLCV], left_bars: int, right_bars: int, key_name: str = 'low_price') -&gt; Optional[float]:\n    if len(ohlcvs) &lt; left_bars + right_bars:\n        return None\n    lowest_value = min(ohlcv.get(key_name) for ohlcv in ohlcvs[-(left_bars + right_bars + 1):])\n    return lowest_value if lowest_value == ohlcvs[-right_bars].get(key_name) else None\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 4856729,
                                "reputation": 4340,
                                "user_id": 3917465,
                                "user_type": "registered",
                                "accept_rate": 29,
                                "display_name": "Code_Worm"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1686095081,
                            "post_id": 76158925,
                            "comment_id": 134751437,
                            "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/76158925#comment134751437_76158925",
                            "body": "2 is not pivot, right ?? but it&#39;s returned as pivot."
                        }
                    ],
                    "owner": {
                        "account_id": 11310006,
                        "reputation": 66,
                        "user_id": 13289110,
                        "user_type": "registered",
                        "display_name": "kudos"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1683063975,
                    "last_edit_date": 1683063975,
                    "creation_date": 1683062123,
                    "answer_id": 76158925,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/76158925#76158925",
                    "body": "<p>Here is my humble approach</p>\n<pre class=\"lang-py prettyprint-override\"><code>import numpy as np\nfrom talib import MAX, MIN\n\ndef PIVOTHIGH(high: np.ndarray, left:int, right: int):\n    pivots = np.roll(MAX(high, left + 1 + right), -right)\n    pivots[pivots != high] = np.NaN\n    return pivots\n\ndef PIVOTLOW(low: np.ndarray, left:int, right: int):\n    pivots = np.roll(MIN(low, left + 1 + right), -right)\n    pivots[pivots != low] = np.NaN\n    return pivots\n</code></pre>\n<p>Use them like this:</p>\n<pre class=\"lang-py prettyprint-override\"><code>a = np.array([1, 1, 2., 2., 2., 3., 4., 5., 6., 7., 8., 9., 8., 7., 6., 7., 8., 9., 10, 9., 8., 9., 10])\n</code></pre>\n<pre class=\"lang-py prettyprint-override\"><code>PIVOTHIGH(a, 2, 2)\n\n#output\narray([nan, nan,  2., nan, nan, nan, nan, nan, nan, nan, nan,  9., nan,\n       nan, nan, nan, nan, nan, 10., nan, nan, nan, nan])\n</code></pre>\n<pre class=\"lang-py prettyprint-override\"><code>PIVOTLOW(a, 2, 2)\n\n#output\narray([nan, nan, nan, nan,  2., nan, nan, nan, nan, nan, nan, nan, nan,\n       nan,  6., nan, nan, nan, nan, nan,  8., nan, nan])\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 29278513,
                        "reputation": 11,
                        "user_id": 22431700,
                        "user_type": "unregistered",
                        "display_name": "simonedifu"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1692740580,
                    "creation_date": 1692740580,
                    "answer_id": 76957008,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/76957008#76957008",
                    "body": "<p>Oneliner same as the tradingview Pivots HL:</p>\n<pre><code>LEN = 50 #Lookback and Lookforward\nOHLC['PivotHigh'] = OHLC['high'] == OHLC['high'].rolling(2 * LEN + 1, center=True).max()\nOHLC['PivotLow'] = OHLC['low'] == OHLC['low'].rolling(2 * LEN + 1, center=True).min()\n</code></pre>\n<p>(Left and right will be the same length)</p>\n"
                },
                {
                    "owner": {
                        "account_id": 29308720,
                        "reputation": 11,
                        "user_id": 22455107,
                        "user_type": "registered",
                        "display_name": "Lexx"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1708036166,
                    "last_edit_date": 1708036166,
                    "creation_date": 1694020612,
                    "answer_id": 77054050,
                    "question_id": 64019553,
                    "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript/77054050#77054050",
                    "body": "<p>This Python function was designed to precisely match the logic of the pivotlow and pivothigh functions in Pine Script version 4. It has been successfully tested on large datasets. Previous answers in this thread did not provide me with an exact match to the Pine Script logic.</p>\n<pre class=\"lang-py prettyprint-override\"><code># This function is adapted to work with a pandas DataFrame.\n# The function takes as input a DataFrame with OHLCV data, the index\n# of the current candle - 1, and the window size for checking, prd.\n# The function returns the pivot value if found, otherwise None.\n# It is assumed that the DataFrame has columns &quot;high&quot; and &quot;low&quot;\n# which contain the highs and lows of the candle, respectively.\n\n\ndef find_pivot_highs(df, index, prd):\n    # Create a window of size (prd * 2 + 1) around the current index\n    # Extract values from the &quot;high&quot; column of DataFrame df\n    window = df[&quot;high&quot;].iloc[index - prd * 2 : index + 1].values\n\n    # Find the maximum value in the last prd elements of the window\n    high_max = max(window[-prd:])\n\n    # Find the maximum value in the entire window\n    max_value = max(window)\n\n    # Check if the current value is the maximum in the window\n    # and if it's greater than the maximum value in the last prd elements\n    if max_value == window[prd] and window[prd] &gt; high_max:\n        return window[prd]\n\n    return None\n\n\ndef find_pivot_lows(df, index, prd):\n    # Create a window of size (prd * 2 + 1) around the current index\n    # Extract values from the &quot;low&quot; column of DataFrame df\n    window = df[&quot;low&quot;].iloc[index - prd * 2 : index + 1].values\n\n    # Find the minimum value in the last prd elements of the window\n    low_min = min(window[-prd:])\n\n    # Find the minimum value in the entire window\n    min_value = min(window)\n\n    # Check if the current value is the minimum in the window\n    # and if it's less than the minimum value in the last prd elements\n    if min_value == window[prd] and window[prd] &lt; low_min:\n        return window[prd]\n\n    return None\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 7281216,
                "reputation": 857,
                "user_id": 5550912,
                "user_type": "registered",
                "display_name": "Inso"
            },
            "comment_count": 4,
            "is_answered": true,
            "answer_count": 11,
            "score": 10,
            "last_activity_date": 1708036166,
            "creation_date": 1600822633,
            "last_edit_date": 1649982354,
            "question_id": 64019553,
            "link": "https://stackoverflow.com/questions/64019553/how-pivothigh-and-pivotlow-function-work-on-tradingview-pinescript",
            "title": "How pivothigh() and pivotlow() function work on Tradingview Pinescript?",
            "body": "<p>I'm trying to rewrite a script to Python, but I can't figure out how pivothigh() and pivotlow() function work, and I can't find source code, I know how to calculate Pivot Points, but what leftbars and rightbars means in this two function? Please help.</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 5770
}