{
    "items": [
        {
            "tags": [
                "python",
                "deep-copy"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 67986,
                        "reputation": 112180,
                        "user_id": 198633,
                        "user_type": "registered",
                        "accept_rate": 88,
                        "display_name": "inspectorG4dget"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1353536843,
                    "post_id": 13503079,
                    "comment_id": 18481000,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481000_13503079",
                    "body": "Use <code>copy.deepcopy</code> if you really must. But I think there&#39;s a deeper design flaw somewhere. Why do you want to copy functions in the first place?"
                },
                {
                    "owner": {
                        "account_id": 559304,
                        "reputation": 518,
                        "user_id": 1839171,
                        "user_type": "registered",
                        "display_name": "jfaller"
                    },
                    "edited": false,
                    "score": 2,
                    "creation_date": 1353536902,
                    "post_id": 13503079,
                    "comment_id": 18481020,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481020_13503079",
                    "body": "Can you help us understand a bit about what you want to do -- your question is a little strange/vague.  In the thousands of lines of python I&#39;ve written, I&#39;ve never copied a function."
                },
                {
                    "owner": {
                        "account_id": 266426,
                        "reputation": 38092,
                        "user_id": 553995,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "Praveen Gollakota"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1353536955,
                    "post_id": 13503079,
                    "comment_id": 18481046,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481046_13503079",
                    "body": "If you need to maintain state, why not use classes and instances? Why functions that need to be <i>copied</i> somehow?"
                },
                {
                    "owner": {
                        "account_id": 115818,
                        "reputation": 11561,
                        "user_id": 303927,
                        "user_type": "registered",
                        "accept_rate": 71,
                        "display_name": "Peter Graham"
                    },
                    "edited": false,
                    "score": 3,
                    "creation_date": 1353537056,
                    "post_id": 13503079,
                    "comment_id": 18481083,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481083_13503079",
                    "body": "If you&#39;re changing attributes on a function you&#39;re probably better off wrapping the function in an object then changing attributes on the object.  It will make your code cleaner.  If you add a <code>__call__</code> method to your object it can be called just like a function."
                },
                {
                    "owner": {
                        "account_id": 67986,
                        "reputation": 112180,
                        "user_id": 198633,
                        "user_type": "registered",
                        "accept_rate": 88,
                        "display_name": "inspectorG4dget"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1353537072,
                    "post_id": 13503079,
                    "comment_id": 18481089,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481089_13503079",
                    "body": "The only application of this that I can think of off the top of my head is for use in evolutionary algorithms (genetic programming). And even there, you might want to go with a different approach - enoding and decoding, rather than function copying"
                },
                {
                    "owner": {
                        "account_id": 108981,
                        "reputation": 18143,
                        "user_id": 289011,
                        "user_type": "registered",
                        "accept_rate": 97,
                        "display_name": "Savir"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1353537283,
                    "post_id": 13503079,
                    "comment_id": 18481160,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481160_13503079",
                    "body": "Jeez... I had never thought about this... BTW, deepcopy returns, indeed, the same object (original function and &quot;copied&quot; function are both the same memory address)"
                },
                {
                    "owner": {
                        "account_id": 1163045,
                        "reputation": 24600,
                        "user_id": 1142167,
                        "user_type": "registered",
                        "accept_rate": 93,
                        "display_name": "Joel Cornett"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1353537609,
                    "post_id": 13503079,
                    "comment_id": 18481282,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481282_13503079",
                    "body": "If you want the same function with slightly different parameters, most likely, you either want to use closures or <code>functools.partial</code>. It&#39;s unlikely that you actually need to copy the code object."
                },
                {
                    "owner": {
                        "account_id": 115818,
                        "reputation": 11561,
                        "user_id": 303927,
                        "user_type": "registered",
                        "accept_rate": 71,
                        "display_name": "Peter Graham"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1353539084,
                    "post_id": 13503079,
                    "comment_id": 18481749,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment18481749_13503079",
                    "body": "If you want to reuse a function you don&#39;t need to copy it.  Just reference the one function object from everywhere you need it.  You only need to copy the function object if you&#39;re going to change its state.  Storing state on a function object (or an unbound method?) is unusual and likely to cause confusion.  It&#39;s far clearer to store state somewhere else."
                },
                {
                    "owner": {
                        "account_id": 1245419,
                        "reputation": 15078,
                        "user_id": 1206998,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "Juh_"
                    },
                    "edited": false,
                    "score": 5,
                    "creation_date": 1375875179,
                    "post_id": 13503079,
                    "comment_id": 26499352,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment26499352_13503079",
                    "body": "I don&#39;t see why treating function like any other object should be a problem, in python. I do have the same need: decorated functions are passed to internal <b>and external</b> code which expect a function object. Copying a function in order to change its decoration is thus useful and working around with objects that look-a-like function but are not is just overly complicated."
                },
                {
                    "owner": {
                        "account_id": 3758485,
                        "reputation": 2581,
                        "user_id": 3124256,
                        "user_type": "registered",
                        "display_name": "DylanYoung"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1606759439,
                    "post_id": 13503079,
                    "comment_id": 115053008,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment115053008_13503079",
                    "body": "Overly complicated and slow.  Function call overhead in python is huge, so &quot;using closures&quot; isn&#39;t really a solution."
                },
                {
                    "owner": {
                        "account_id": 3758485,
                        "reputation": 2581,
                        "user_id": 3124256,
                        "user_type": "registered",
                        "display_name": "DylanYoung"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1606759537,
                    "post_id": 13503079,
                    "comment_id": 115053062,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function#comment115053062_13503079",
                    "body": "A function factory is decent alternate solution though (if you have control of the code where the function is defined)."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 1245419,
                                "reputation": 15078,
                                "user_id": 1206998,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "Juh_"
                            },
                            "edited": false,
                            "score": 6,
                            "creation_date": 1375875375,
                            "post_id": 13503277,
                            "comment_id": 26499470,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment26499470_13503277",
                            "body": "The function dictionary should also be copied: <code>g.__dict__.update(f.__dict__)</code>"
                        },
                        {
                            "owner": {
                                "account_id": 223867,
                                "reputation": 7615,
                                "user_id": 483347,
                                "user_type": "registered",
                                "accept_rate": 71,
                                "display_name": "weberc2"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1461011261,
                            "post_id": 13503277,
                            "comment_id": 60995153,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment60995153_13503277",
                            "body": "Is <code>func_code</code> (and friends) the Python 2 equivalent of <code>__code__</code> (and friends)?"
                        },
                        {
                            "owner": {
                                "account_id": 64585,
                                "reputation": 864610,
                                "user_id": 190597,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "unutbu"
                            },
                            "reply_to_user": {
                                "account_id": 223867,
                                "reputation": 7615,
                                "user_id": 483347,
                                "user_type": "registered",
                                "accept_rate": 71,
                                "display_name": "weberc2"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1461012969,
                            "post_id": 13503277,
                            "comment_id": 60996149,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment60996149_13503277",
                            "body": "@weberc: Yes, that&#39;s right. I&#39;ve update the answer for Python3."
                        },
                        {
                            "owner": {
                                "account_id": 2647040,
                                "reputation": 21107,
                                "user_id": 2289509,
                                "user_type": "registered",
                                "display_name": "Elazar"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1466180579,
                            "post_id": 13503277,
                            "comment_id": 63227017,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment63227017_13503277",
                            "body": "The answer is incomplete. You should copy <code>f.__kwdefaults__</code> too."
                        },
                        {
                            "owner": {
                                "account_id": 7690869,
                                "reputation": 21169,
                                "user_id": 5827215,
                                "user_type": "registered",
                                "display_name": "Tadhg McDonald-Jensen"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1466190631,
                            "post_id": 13503277,
                            "comment_id": 63232080,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment63232080_13503277",
                            "body": "<a href=\"https://docs.python.org/3/library/functools.html?highlight=functools.update_wrapper#functools.update_wrapper\" rel=\"nofollow noreferrer\"><code>functools.update_wrapper</code></a> would update all the metadata other then <code>__kwdefaults__</code> like <code>__doc__</code> and <code>__module__</code>"
                        },
                        {
                            "owner": {
                                "account_id": 2647040,
                                "reputation": 21107,
                                "user_id": 2289509,
                                "user_type": "registered",
                                "display_name": "Elazar"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1466287242,
                            "post_id": 13503277,
                            "comment_id": 63256924,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment63256924_13503277",
                            "body": "Note that this is a shallow copy. If you want to do deepcopy you should call <code>copy.deepcopy</code> on all the writable attributes."
                        },
                        {
                            "owner": {
                                "account_id": 2647040,
                                "reputation": 21107,
                                "user_id": 2289509,
                                "user_type": "registered",
                                "display_name": "Elazar"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1466287411,
                            "post_id": 13503277,
                            "comment_id": 63256979,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment63256979_13503277",
                            "body": "Here&#39;s an <a href=\"https://gist.github.com/elazarg/99e6d1450c3c85aa74317c1b01767d86\" rel=\"nofollow noreferrer\">example</a> of why it is useful"
                        },
                        {
                            "owner": {
                                "account_id": 3580374,
                                "reputation": 111083,
                                "user_id": 2988730,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Mad Physicist"
                            },
                            "reply_to_user": {
                                "account_id": 2647040,
                                "reputation": 21107,
                                "user_id": 2289509,
                                "user_type": "registered",
                                "display_name": "Elazar"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1520023585,
                            "post_id": 13503277,
                            "comment_id": 85160028,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment85160028_13503277",
                            "body": "@Elazar. Here&#39;s another: <a href=\"https://stackoverflow.com/q/49076566/2988730\">stackoverflow.com/q/49076566/2988730</a>"
                        },
                        {
                            "owner": {
                                "account_id": 3580374,
                                "reputation": 111083,
                                "user_id": 2988730,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Mad Physicist"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1520026483,
                            "post_id": 13503277,
                            "comment_id": 85161415,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment85161415_13503277",
                            "body": "For consistency, I think you may want to do <code>copy.copy(f.__kwdefaults__)</code>."
                        },
                        {
                            "owner": {
                                "account_id": 14059264,
                                "reputation": 2029,
                                "user_id": 10155767,
                                "user_type": "registered",
                                "display_name": "Ben Mares"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1550573852,
                            "post_id": 13503277,
                            "comment_id": 96309439,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment96309439_13503277",
                            "body": "Currently, this answer is based on Glenn Maynard&#39;s answer to a similar question.  Under that same question, there is <a href=\"https://stackoverflow.com/a/30714299/10155767\">an updated answer by Aaron Hall</a> which is very similar to this answer. Aaron updates the new <b>dict</b> based on the old, while this answer uses <a href=\"https://github.com/python/cpython/blob/99e9c36b29a194d59ee4b0d8b82a72f5b0d409dd/Lib/functools.py#L59\" rel=\"nofollow noreferrer\">update_wrapper</a> to update the attributes individually. I am wondering (in the case of Python 3) whether or not the outcome is always the same."
                        },
                        {
                            "owner": {
                                "account_id": 14059264,
                                "reputation": 2029,
                                "user_id": 10155767,
                                "user_type": "registered",
                                "display_name": "Ben Mares"
                            },
                            "reply_to_user": {
                                "account_id": 2647040,
                                "reputation": 21107,
                                "user_id": 2289509,
                                "user_type": "registered",
                                "display_name": "Elazar"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1550574101,
                            "post_id": 13503277,
                            "comment_id": 96309573,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment96309573_13503277",
                            "body": "@Elazar Do you mean <code>getattr(wrapper, attr).update(copy.deepcopy(getattr(wrapped, attr, {})))</code> inside <a href=\"https://github.com/python/cpython/blob/99e9c36b29a194d59ee4b0d8b82a72f5b0d409dd/Lib/functools.py#L60\" rel=\"nofollow noreferrer\">update_wrapper</a> for deepcopy?"
                        },
                        {
                            "owner": {
                                "account_id": 64585,
                                "reputation": 864610,
                                "user_id": 190597,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "unutbu"
                            },
                            "reply_to_user": {
                                "account_id": 14059264,
                                "reputation": 2029,
                                "user_id": 10155767,
                                "user_type": "registered",
                                "display_name": "Ben Mares"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1550581601,
                            "post_id": 13503277,
                            "comment_id": 96314075,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment96314075_13503277",
                            "body": "@BenMares: With <code>g = functools.update_wrapper(g, f)</code>, you get <code>g.__wrapped__</code> which equals <code>f</code>. If you use <code>fn.__dict__.update(f.__dict__)</code> you do not get the <code>__wrapped__</code> attribute. I&#39;m not aware of any other difference due to <code>update_wrapper</code>."
                        },
                        {
                            "owner": {
                                "account_id": 64585,
                                "reputation": 864610,
                                "user_id": 190597,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "unutbu"
                            },
                            "reply_to_user": {
                                "account_id": 14059264,
                                "reputation": 2029,
                                "user_id": 10155767,
                                "user_type": "registered",
                                "display_name": "Ben Mares"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1550581612,
                            "post_id": 13503277,
                            "comment_id": 96314082,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment96314082_13503277",
                            "body": "@BenMares: A more dramatic difference is made by the <a href=\"https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277?noredirect=1#comment63227017_13503277\">inclusion of <code>g.__kwdefaults__ = f.__kwdefaults__</code></a>.  With this, <code>g(1,2,3)</code> returns <code>(1, 2, 3, (), &#39;FOO&#39;, &#39;BAR&#39;, &#39;BAZ&#39;)</code>. Without it, <code>g(1,2,3)</code> raises <code>TypeError: f() missing 3 required positional arguments: &#39;arg1&#39;, &#39;arg2&#39;, and &#39;arg3&#39;</code>."
                        },
                        {
                            "owner": {
                                "account_id": 9800827,
                                "reputation": 4858,
                                "user_id": 7262247,
                                "user_type": "registered",
                                "display_name": "smarie"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1633678947,
                            "post_id": 13503277,
                            "comment_id": 122828674,
                            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#comment122828674_13503277",
                            "body": "It would make sense to have such a function in a library, until there is a built-in version. It could fit in <code>makefun</code> : <a href=\"https://github.com/smarie/python-makefun/issues/74\" rel=\"nofollow noreferrer\">github.com/smarie/python-makefun/issues/74</a> , if anyone is interested to propose a PR."
                        }
                    ],
                    "owner": {
                        "account_id": 64585,
                        "reputation": 864610,
                        "user_id": 190597,
                        "user_type": "registered",
                        "accept_rate": 88,
                        "display_name": "unutbu"
                    },
                    "comment_count": 14,
                    "is_accepted": true,
                    "score": 53,
                    "last_activity_date": 1550581860,
                    "last_edit_date": 1550581860,
                    "creation_date": 1353537809,
                    "answer_id": 13503277,
                    "question_id": 13503079,
                    "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function/13503277#13503277",
                    "body": "<p>In <strong>Python3</strong>:</p>\n\n<pre><code>import types\nimport functools\n\ndef copy_func(f):\n    \"\"\"Based on http://stackoverflow.com/a/6528148/190597 (Glenn Maynard)\"\"\"\n    g = types.FunctionType(f.__code__, f.__globals__, name=f.__name__,\n                           argdefs=f.__defaults__,\n                           closure=f.__closure__)\n    g = functools.update_wrapper(g, f)\n    g.__kwdefaults__ = f.__kwdefaults__\n    return g\n\ndef f(arg1, arg2, arg3, kwarg1=\"FOO\", *args, kwarg2=\"BAR\", kwarg3=\"BAZ\"):\n    return (arg1, arg2, arg3, args, kwarg1, kwarg2, kwarg3)\nf.cache = [1,2,3]\ng = copy_func(f)\n\nprint(f(1,2,3,4,5))\nprint(g(1,2,3,4,5))\nprint(g.cache)\nassert f is not g\n</code></pre>\n\n<p>yields</p>\n\n<pre><code>(1, 2, 3, (5,), 4, 'BAR', 'BAZ')\n(1, 2, 3, (5,), 4, 'BAR', 'BAZ')\n[1, 2, 3]\n</code></pre>\n\n<hr>\n\n<p>In <strong>Python2</strong>:</p>\n\n<pre><code>import types\nimport functools\ndef copy_func(f):\n    \"\"\"Based on http://stackoverflow.com/a/6528148/190597 (Glenn Maynard)\"\"\"\n    g = types.FunctionType(f.func_code, f.func_globals, name=f.func_name,\n                           argdefs=f.func_defaults,\n                           closure=f.func_closure)\n    g = functools.update_wrapper(g, f)\n    return g\n\ndef f(x, y=2):\n    return x,y\nf.cache = [1,2,3]\ng = copy_func(f)\n\nprint(f(1))\nprint(g(1))\nprint(g.cache)\nassert f is not g\n</code></pre>\n\n<p>yields</p>\n\n<pre><code>(1, 2)\n(1, 2)\n[1, 2, 3]\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 38617,
                "reputation": 15640,
                "user_id": 110963,
                "user_type": "registered",
                "accept_rate": 68,
                "display_name": "Achim"
            },
            "comment_count": 11,
            "is_answered": true,
            "closed_date": 1412648822,
            "accepted_answer_id": 13503277,
            "answer_count": 1,
            "score": 35,
            "last_activity_date": 1550581860,
            "creation_date": 1353536779,
            "last_edit_date": 1353537997,
            "question_id": 13503079,
            "link": "https://stackoverflow.com/questions/13503079/how-to-create-a-copy-of-a-python-function",
            "closed_reason": "Duplicate",
            "title": "How to create a copy of a python function",
            "body": "<p>Is there a possibility to create real copies of python functions? The most obvious choice was <a href=\"http://docs.python.org/2/library/copy.html\">http://docs.python.org/2/library/copy.html</a> but there I read:</p>\n\n<blockquote>\n  <p>It does \u201ccopy\u201d functions and classes (shallow and deeply), by\n  returning the original object unchanged;</p>\n</blockquote>\n\n<p>I need a real copy, because I might change some attributes of the function.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I'm aware of all the possibilities which are mentioned in the comments. My use case is based on meta programming where I construct classes out of some declarative specifications. Complete details would be too long for SO, but basically I have a function like</p>\n\n<pre><code>def do_something_usefull(self,arg):\n    self.do_work()\n</code></pre>\n\n<p>I will add this method to various classes. Thoses classes can be completly unrelated. Using mixin classes is not an option: I will have many such functions and would end up adding a base class for each function. My current \"workaround\" would be to wrap this function in a \"factory\" like this:</p>\n\n<pre><code>def create_do_something():\n    def do_something_usefull(self,arg):\n        self.do_work()\n</code></pre>\n\n<p>That way I always get a new do_something_useful function, but I have to wrap all my functions like this.</p>\n\n<p>You can trust me, that I'm aware, that this is no \"normal\" OO programming. I know how to solve something like that \"normally\". But this is a dynamic code generator and I would like to keep everything as lightweight and simple as possible. And as python functions are quite normal objects, I don't think it's too strange to ask how to copy them!?</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 5786
}