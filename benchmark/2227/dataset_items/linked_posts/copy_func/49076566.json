{
    "items": [
        {
            "tags": [
                "python",
                "global-variables"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 11759084,
                        "reputation": 16284,
                        "user_id": 8605791,
                        "user_type": "registered",
                        "display_name": "llllllllll"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1520021351,
                    "post_id": 49076566,
                    "comment_id": 85159003,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module#comment85159003_49076566",
                    "body": "You want something like return reference in C++ ?"
                },
                {
                    "owner": {
                        "account_id": 3580374,
                        "reputation": 111083,
                        "user_id": 2988730,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Mad Physicist"
                    },
                    "reply_to_user": {
                        "account_id": 11759084,
                        "reputation": 16284,
                        "user_id": 8605791,
                        "user_type": "registered",
                        "display_name": "llllllllll"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1520021490,
                    "post_id": 49076566,
                    "comment_id": 85159065,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module#comment85159065_49076566",
                    "body": "@liliscent Not sure what that is, but I added an example of exactly what I want."
                },
                {
                    "owner": {
                        "account_id": 11759084,
                        "reputation": 16284,
                        "user_id": 8605791,
                        "user_type": "registered",
                        "display_name": "llllllllll"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1520021587,
                    "post_id": 49076566,
                    "comment_id": 85159113,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module#comment85159113_49076566",
                    "body": "If you only want to modify a variable in another module, just use <code>a.value</code> to access it. I don&#39;t know why you mention that function <code>x()</code>."
                },
                {
                    "owner": {
                        "account_id": 3580374,
                        "reputation": 111083,
                        "user_id": 2988730,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Mad Physicist"
                    },
                    "reply_to_user": {
                        "account_id": 11759084,
                        "reputation": 16284,
                        "user_id": 8605791,
                        "user_type": "registered",
                        "display_name": "llllllllll"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1520021642,
                    "post_id": 49076566,
                    "comment_id": 85159148,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module#comment85159148_49076566",
                    "body": "Because I want to make a copy of the function object in <code>b</code> that refers to <code>b</code>&#39;s globals instead of <code>a</code>&#39;s."
                },
                {
                    "owner": {
                        "account_id": 3580374,
                        "reputation": 111083,
                        "user_id": 2988730,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Mad Physicist"
                    },
                    "reply_to_user": {
                        "account_id": 11759084,
                        "reputation": 16284,
                        "user_id": 8605791,
                        "user_type": "registered",
                        "display_name": "llllllllll"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1520021854,
                    "post_id": 49076566,
                    "comment_id": 85159236,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module#comment85159236_49076566",
                    "body": "@liliscent. Perhaps it is more clear now?"
                },
                {
                    "owner": {
                        "account_id": 11759084,
                        "reputation": 16284,
                        "user_id": 8605791,
                        "user_type": "registered",
                        "display_name": "llllllllll"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1520021913,
                    "post_id": 49076566,
                    "comment_id": 85159259,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module#comment85159259_49076566",
                    "body": "I think you need a class instead of global variable. Essentially you want 2 identical function operating on different <code>value</code>. This <code>value</code> should be a class member."
                },
                {
                    "owner": {
                        "account_id": 3580374,
                        "reputation": 111083,
                        "user_id": 2988730,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Mad Physicist"
                    },
                    "reply_to_user": {
                        "account_id": 11759084,
                        "reputation": 16284,
                        "user_id": 8605791,
                        "user_type": "registered",
                        "display_name": "llllllllll"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1520021982,
                    "post_id": 49076566,
                    "comment_id": 85159290,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module#comment85159290_49076566",
                    "body": "@liliscent. I can do it for a class. However, I have a case where I can not avoid using globals as shown, but I would like to replace the source of them. An explanation of why that is not possible would answer my question as well. I suspect, however, that since this is Python, there is a way to do it."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3580374,
                                "reputation": 111083,
                                "user_id": 2988730,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Mad Physicist"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1520023618,
                            "post_id": 49077126,
                            "comment_id": 85160050,
                            "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/49077126#comment85160050_49077126",
                            "body": "I found something much more straightorward, but def +1 for this."
                        },
                        {
                            "owner": {
                                "account_id": 4258097,
                                "reputation": 50870,
                                "user_id": 3483203,
                                "user_type": "registered",
                                "accept_rate": 78,
                                "display_name": "user3483203"
                            },
                            "reply_to_user": {
                                "account_id": 3580374,
                                "reputation": 111083,
                                "user_id": 2988730,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Mad Physicist"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1520023704,
                            "post_id": 49077126,
                            "comment_id": 85160081,
                            "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/49077126#comment85160081_49077126",
                            "body": "Mind sharing what you came up with? I have run into similar issues before and would be interested in your approach."
                        },
                        {
                            "owner": {
                                "account_id": 3580374,
                                "reputation": 111083,
                                "user_id": 2988730,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Mad Physicist"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1520023993,
                            "post_id": 49077126,
                            "comment_id": 85160239,
                            "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/49077126#comment85160239_49077126",
                            "body": "I&#39;ve added an answer. It&#39;s a bit longer than what you have, but it is more correct for the purpose I have in mind. Perhaps it will work for you too."
                        }
                    ],
                    "owner": {
                        "account_id": 4258097,
                        "reputation": 50870,
                        "user_id": 3483203,
                        "user_type": "registered",
                        "accept_rate": 78,
                        "display_name": "user3483203"
                    },
                    "comment_count": 3,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1520023621,
                    "last_edit_date": 1520023621,
                    "creation_date": 1520023574,
                    "answer_id": 49077126,
                    "question_id": 49076566,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/49077126#49077126",
                    "body": "<p>So I found a way to (sort of) do this, although I don't think it entirely solves your problems.  Using inspect, you can access the global variables of the file calling your function.  So if you set up your files like so:</p>\n\n<p><strong>a.py</strong></p>\n\n<pre><code>import inspect\n\nvalue = 3\n\ndef a():\n    return inspect.stack()[1][0].f_globals['value']\n</code></pre>\n\n<p><strong>b.py</strong></p>\n\n<pre><code>from a import a\n\nvalue = 5\n\nprint(a())\n</code></pre>\n\n<p>The output is 5, instead of 3.  However, if you imported both of these into a third file, it would look for the globals of the third file.  Just wanted to share this snippet however.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3580374,
                                "reputation": 111083,
                                "user_id": 2988730,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Mad Physicist"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1520025001,
                            "post_id": 49077211,
                            "comment_id": 85160748,
                            "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/49077211#comment85160748_49077211",
                            "body": "@chrisz. I&#39;ve added an option to even fake the module that the function is defined in"
                        }
                    ],
                    "owner": {
                        "account_id": 3580374,
                        "reputation": 111083,
                        "user_id": 2988730,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Mad Physicist"
                    },
                    "comment_count": 1,
                    "is_accepted": true,
                    "score": 5,
                    "last_activity_date": 1666723219,
                    "last_edit_date": 1666723219,
                    "creation_date": 1520023928,
                    "answer_id": 49077211,
                    "question_id": 49076566,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/49077211#49077211",
                    "body": "<p>I've come up with a solution through a mixture of guess-and-check and research. You can do pretty much exactly what I proposed in the question: <a href=\"https://stackoverflow.com/q/13503079/2988730\">copy a function object</a> and replace its <code>__globals__</code> attribute.</p>\n<p>I am using Python 3, so here is a modified version of the <a href=\"https://stackoverflow.com/a/13503277/2988730\">answer</a> to the question linked above, with an added option to override the globals:</p>\n<pre><code>import copy\nimport types\nimport functools\n\ndef copy_func(f, globals=None, module=None):\n    &quot;&quot;&quot;Based on https://stackoverflow.com/a/13503277/2988730 (@unutbu)&quot;&quot;&quot;\n    if globals is None:\n        globals = f.__globals__\n    g = types.FunctionType(f.__code__, globals, name=f.__name__,\n                           argdefs=f.__defaults__, closure=f.__closure__)\n    g = functools.update_wrapper(g, f)\n    if module is not None:\n        g.__module__ = module\n    g.__kwdefaults__ = copy.copy(f.__kwdefaults__)\n    return g\n</code></pre>\n<p><strong>b.py</strong></p>\n<pre><code>from a import x\nvalue = 4\nx = copy_func(x, globals(), __name__)\n</code></pre>\n<p>The <code>__globals__</code> attribute is read-only, which is why it must be passed to the constructor of <code>FunctionType</code>. The <code>__globals__</code> reference of an existing function object can not be changed.</p>\n<p><strong>Postscript</strong></p>\n<p>I've used this enough times now that it's implemented in a utility library I wrote and maintain called <code>haggis</code>. See <a href=\"https://haggis.readthedocs.io/en/stable/api.html#haggis.objects.copy_func\" rel=\"nofollow noreferrer\"><code>haggis.objects.copy_func</code></a>.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3580374,
                                "reputation": 111083,
                                "user_id": 2988730,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Mad Physicist"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1589468625,
                            "post_id": 61800492,
                            "comment_id": 109312531,
                            "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/61800492#comment109312531_61800492",
                            "body": "This assumes a much more specific interface than what I had in mind, but it certainly works in some cases. Also, this is better use of <code>eval</code> than usual."
                        }
                    ],
                    "owner": {
                        "account_id": 8313357,
                        "reputation": 94,
                        "user_id": 6247625,
                        "user_type": "registered",
                        "display_name": "Mk Km"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1589468035,
                    "creation_date": 1589468035,
                    "answer_id": 61800492,
                    "question_id": 49076566,
                    "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module/61800492#61800492",
                    "body": "<p>I had the same problem. But then I remembered <code>eval</code> was a thing.<br>\nHere's a much shorter version(if you don't need arguments):<br>\n<strong>b.py:</strong></p>\n\n<pre><code>from a import x as xx\n\n# Define globals for the function here\nglob = {'value': 4}\ndef x():\n    return eval(xx.__code__, glob)\n\n</code></pre>\n\n<p>Hopefully after 2 years it'll still be helpful</p>\n"
                }
            ],
            "owner": {
                "account_id": 3580374,
                "reputation": 111083,
                "user_id": 2988730,
                "user_type": "registered",
                "accept_rate": 96,
                "display_name": "Mad Physicist"
            },
            "comment_count": 7,
            "is_answered": true,
            "accepted_answer_id": 49077211,
            "answer_count": 3,
            "score": 4,
            "last_activity_date": 1666723219,
            "creation_date": 1520021236,
            "last_edit_date": 1520022503,
            "question_id": 49076566,
            "link": "https://stackoverflow.com/questions/49076566/override-globals-in-function-imported-from-another-module",
            "title": "Override globals in function imported from another module",
            "body": "<p>Let's say I have two modules:</p>\n\n<p><strong>a.py</strong></p>\n\n<pre><code>value = 3\ndef x()\n    return value\n</code></pre>\n\n<p><strong>b.py</strong></p>\n\n<pre><code>from a import x\nvalue = 4\n</code></pre>\n\n<p>My goal is to use the functionality of <code>a.x</code> in <code>b</code>, but change the value returned by the function. Specifically, <code>value</code> will be looked up with <code>a</code> as the source of global names even when I run <code>b.x()</code>. I am basically trying to create a copy of the function object in <code>b.x</code> that is identical to <code>a.x</code> but uses <code>b</code> to get its globals. Is there a reasonably straightforward way to do that?</p>\n\n<p>Here is an example:</p>\n\n<pre><code>import a, b\n\nprint(a.x(), b.x())\n</code></pre>\n\n<p>The result is currently <code>3 3</code>, but I want it to be <code>3 4</code>.</p>\n\n<p>I have come up with two convoluted methods that work, but I am not happy with either one:</p>\n\n<ol>\n<li>Re-define <code>x</code> in module <code>b</code> using copy-and paste. The real function is much more complex than shown, so this doesn't sit right with me.</li>\n<li><p>Define a parameter that can be passed in to x and just use the module's value:</p>\n\n<pre><code>def x(value):\n    return value\n</code></pre>\n\n<p>This adds a burden on the user that I want to avoid, and does not really solve the problem.</p></li>\n</ol>\n\n<p>Is there a way to modify where the function gets its globals somehow?</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 5785
}