{
    "items": [
        {
            "tags": [
                "python",
                "numpy",
                "sliding-window"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 17872358,
                        "reputation": 1714,
                        "user_id": 12983399,
                        "user_type": "registered",
                        "display_name": "amzon-ex"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656063564,
                    "post_id": 72741431,
                    "comment_id": 128485477,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128485477_72741431",
                    "body": "Question: why shouldn&#39;t <code>92</code> return <code>(0, 0)</code>?"
                },
                {
                    "owner": {
                        "account_id": 6631447,
                        "reputation": 10889,
                        "user_id": 5120049,
                        "user_type": "registered",
                        "display_name": "Vishnudev Krishnadas"
                    },
                    "reply_to_user": {
                        "account_id": 17872358,
                        "reputation": 1714,
                        "user_id": 12983399,
                        "user_type": "registered",
                        "display_name": "amzon-ex"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1656064710,
                    "post_id": 72741431,
                    "comment_id": 128485851,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128485851_72741431",
                    "body": "I want the position of the value <code>92</code> in the original array, not the max array. @amzon-ex"
                },
                {
                    "owner": {
                        "account_id": 6631447,
                        "reputation": 10889,
                        "user_id": 5120049,
                        "user_type": "registered",
                        "display_name": "Vishnudev Krishnadas"
                    },
                    "reply_to_user": {
                        "account_id": 19514517,
                        "reputation": 4987,
                        "user_id": 14277722,
                        "user_type": "registered",
                        "display_name": "Michael Szczesny"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656064749,
                    "post_id": 72741431,
                    "comment_id": 128485866,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128485866_72741431",
                    "body": "@MichaelSzczesny First index in the window should be fine. The max value should be related to the window."
                },
                {
                    "owner": {
                        "account_id": 6631447,
                        "reputation": 10889,
                        "user_id": 5120049,
                        "user_type": "registered",
                        "display_name": "Vishnudev Krishnadas"
                    },
                    "reply_to_user": {
                        "account_id": 19514517,
                        "reputation": 4987,
                        "user_id": 14277722,
                        "user_type": "registered",
                        "display_name": "Michael Szczesny"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656064902,
                    "post_id": 72741431,
                    "comment_id": 128485913,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128485913_72741431",
                    "body": "@MichaelSzczesny I&#39;m not adding new requirements. I thought it was clear from the question as I&#39;m doing the <code>sliding_window_view</code>. Even the <code>87</code> example indicates the same. Sorry if it wasn&#39;t clear. Added it anyways."
                },
                {
                    "owner": {
                        "account_id": 18388391,
                        "reputation": 2786,
                        "user_id": 13394817,
                        "user_type": "registered",
                        "display_name": "Ali_Sh"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656068359,
                    "post_id": 72741431,
                    "comment_id": 128487128,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128487128_72741431",
                    "body": "The expected result is continuously changing and is wrong in the time of writing this comment. The OP makes the code difficult to answer by changing that. e.g. now, why the eight element is changed to twelve element by <code>5,2</code>????"
                },
                {
                    "owner": {
                        "account_id": 17872358,
                        "reputation": 1714,
                        "user_id": 12983399,
                        "user_type": "registered",
                        "display_name": "amzon-ex"
                    },
                    "reply_to_user": {
                        "account_id": 18388391,
                        "reputation": 2786,
                        "user_id": 13394817,
                        "user_type": "registered",
                        "display_name": "Ali_Sh"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656068725,
                    "post_id": 72741431,
                    "comment_id": 128487258,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128487258_72741431",
                    "body": "@Ali_Sh His previous example had a degeneracy in results. This one makes it clearer."
                },
                {
                    "owner": {
                        "account_id": 18388391,
                        "reputation": 2786,
                        "user_id": 13394817,
                        "user_type": "registered",
                        "display_name": "Ali_Sh"
                    },
                    "reply_to_user": {
                        "account_id": 17872358,
                        "reputation": 1714,
                        "user_id": 12983399,
                        "user_type": "registered",
                        "display_name": "amzon-ex"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656069148,
                    "post_id": 72741431,
                    "comment_id": 128487402,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128487402_72741431",
                    "body": "@amzon-ex Did you run the code? index of <code>(0, 4)</code> of <code>np.amax</code> is <code>87</code> not <code>99</code>. I could not understand why the 3rd and 7th elements are <code>(4, 1)</code> but twelve become <code>(5, 2)</code>. what about 4th and 8th elements (that are <code>87</code> too)??"
                },
                {
                    "owner": {
                        "account_id": 17872358,
                        "reputation": 1714,
                        "user_id": 12983399,
                        "user_type": "registered",
                        "display_name": "amzon-ex"
                    },
                    "reply_to_user": {
                        "account_id": 18388391,
                        "reputation": 2786,
                        "user_id": 13394817,
                        "user_type": "registered",
                        "display_name": "Ali_Sh"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656069610,
                    "post_id": 72741431,
                    "comment_id": 128487581,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128487581_72741431",
                    "body": "@Ali_Sh you&#39;re right about the first one. That&#39;s a mistake indeed. The twelfth window has the max value at <code>(2, 5)</code> and that&#39;s why it gets that value (I&#39;m using numpy ordering)"
                },
                {
                    "owner": {
                        "account_id": 6631447,
                        "reputation": 10889,
                        "user_id": 5120049,
                        "user_type": "registered",
                        "display_name": "Vishnudev Krishnadas"
                    },
                    "reply_to_user": {
                        "account_id": 18388391,
                        "reputation": 2786,
                        "user_id": 13394817,
                        "user_type": "registered",
                        "display_name": "Ali_Sh"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656086912,
                    "post_id": 72741431,
                    "comment_id": 128493968,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128493968_72741431",
                    "body": "Sorry about the change in the expected answer. I wanted to add an example that shows how the position changes with the window.  @Ali_Sh Please consider the sliding window part and the output will be more clear."
                },
                {
                    "owner": {
                        "account_id": 6631447,
                        "reputation": 10889,
                        "user_id": 5120049,
                        "user_type": "registered",
                        "display_name": "Vishnudev Krishnadas"
                    },
                    "reply_to_user": {
                        "account_id": 17872358,
                        "reputation": 1714,
                        "user_id": 12983399,
                        "user_type": "registered",
                        "display_name": "amzon-ex"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1656086967,
                    "post_id": 72741431,
                    "comment_id": 128493983,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array#comment128493983_72741431",
                    "body": "@amzon-ex You have understood correctly."
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 6631447,
                                "reputation": 10889,
                                "user_id": 5120049,
                                "user_type": "registered",
                                "display_name": "Vishnudev Krishnadas"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1656065969,
                            "post_id": 72742009,
                            "comment_id": 128486296,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742009#comment128486296_72742009",
                            "body": "Thanks for the answer. But, you are not considering the window while getting the position. I have extended the expected output. @amzon-ex"
                        },
                        {
                            "owner": {
                                "account_id": 17872358,
                                "reputation": 1714,
                                "user_id": 12983399,
                                "user_type": "registered",
                                "display_name": "amzon-ex"
                            },
                            "reply_to_user": {
                                "account_id": 6631447,
                                "reputation": 10889,
                                "user_id": 5120049,
                                "user_type": "registered",
                                "display_name": "Vishnudev Krishnadas"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1656066983,
                            "post_id": 72742009,
                            "comment_id": 128486654,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742009#comment128486654_72742009",
                            "body": "@Vishnudev In any case, your eighth element belongs to a window in which two <code>87</code> values are present: both at <code>(1, 4)</code> and <code>(2, 5)</code>."
                        },
                        {
                            "owner": {
                                "account_id": 17872358,
                                "reputation": 1714,
                                "user_id": 12983399,
                                "user_type": "registered",
                                "display_name": "amzon-ex"
                            },
                            "reply_to_user": {
                                "account_id": 6631447,
                                "reputation": 10889,
                                "user_id": 5120049,
                                "user_type": "registered",
                                "display_name": "Vishnudev Krishnadas"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1656068655,
                            "post_id": 72742009,
                            "comment_id": 128487238,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742009#comment128487238_72742009",
                            "body": "@Vishnudev I improved upon my answer. Check."
                        },
                        {
                            "owner": {
                                "account_id": 6631447,
                                "reputation": 10889,
                                "user_id": 5120049,
                                "user_type": "registered",
                                "display_name": "Vishnudev Krishnadas"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1656087118,
                            "post_id": 72742009,
                            "comment_id": 128494030,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742009#comment128494030_72742009",
                            "body": "Great answer. But how will I know which index is for which value?"
                        },
                        {
                            "owner": {
                                "account_id": 17872358,
                                "reputation": 1714,
                                "user_id": 12983399,
                                "user_type": "registered",
                                "display_name": "amzon-ex"
                            },
                            "reply_to_user": {
                                "account_id": 6631447,
                                "reputation": 10889,
                                "user_id": 5120049,
                                "user_type": "registered",
                                "display_name": "Vishnudev Krishnadas"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1656091628,
                            "post_id": 72742009,
                            "comment_id": 128495405,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742009#comment128495405_72742009",
                            "body": "@Vishnudev You can use the first two rows of <code>indx</code> to get the index of the window."
                        }
                    ],
                    "owner": {
                        "account_id": 17872358,
                        "reputation": 1714,
                        "user_id": 12983399,
                        "user_type": "registered",
                        "display_name": "amzon-ex"
                    },
                    "comment_count": 5,
                    "is_accepted": true,
                    "score": 3,
                    "last_activity_date": 1656068630,
                    "last_edit_date": 1656068630,
                    "creation_date": 1656063470,
                    "answer_id": 72742009,
                    "question_id": 72741431,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742009#72742009",
                    "body": "<p>This solution gives indices per-window but does not give unique indices if a max-value appears twice in some window:</p>\n<pre><code>maxvals = np.amax(windows, axis=(2, 3))\n# array([[92, 92, 87, 87],\n#        [86, 86, 87, 87],\n#        [75, 75, 83, 87]])\n\nindx = np.array((windows == np.expand_dims(maxvals, axis = (2, 3)).nonzero())\n</code></pre>\n<p>which gives you back one array for each of the four axes in the <code>windows</code> array. Now we use some math with the relative index positions in each window to get back the indices at which max values occur in the original array:</p>\n<pre><code>np.sum(indx.reshape(2, 2, -1), axis = 0)\n# array([[0, 0, 1, 1, 2, 1, 1, 1, 1, 2, 4, 4, 4, 2],\n#        [1, 1, 4, 4, 5, 1, 1, 4, 4, 5, 1, 1, 4, 5]])\n</code></pre>\n<p>The reshaping is done to faciliate adding of indices. The first two array give the window position. the second two arrays are positions relative to the window. So we just add them up.\nYou can check that each pair of value along the second axis is the pair of indices you require.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 19514517,
                                "reputation": 4987,
                                "user_id": 14277722,
                                "user_type": "registered",
                                "display_name": "Michael Szczesny"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1656066187,
                            "post_id": 72742405,
                            "comment_id": 128486377,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742405#comment128486377_72742405",
                            "body": "This (nice) solution finds the first occuance in the entire array, not in the corresponding window. Might be the desired result. Reproducible with <code>np.random.seed(21)</code>."
                        },
                        {
                            "owner": {
                                "account_id": 18388391,
                                "reputation": 2786,
                                "user_id": 13394817,
                                "user_type": "registered",
                                "display_name": "Ali_Sh"
                            },
                            "reply_to_user": {
                                "account_id": 19514517,
                                "reputation": 4987,
                                "user_id": 14277722,
                                "user_type": "registered",
                                "display_name": "Michael Szczesny"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1656067314,
                            "post_id": 72742405,
                            "comment_id": 128486770,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742405#comment128486770_72742405",
                            "body": "@MichaelSzczesny, right. From the expected result by the OP it seems refer to <code>a</code>, not the <code>window</code>!!? Am I wrong?"
                        },
                        {
                            "owner": {
                                "account_id": 19514517,
                                "reputation": 4987,
                                "user_id": 14277722,
                                "user_type": "registered",
                                "display_name": "Michael Szczesny"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1656067657,
                            "post_id": 72742405,
                            "comment_id": 128486871,
                            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742405#comment128486871_72742405",
                            "body": "Well, yes. But I think only regarding the current indicies of the corresponding window."
                        }
                    ],
                    "owner": {
                        "account_id": 18388391,
                        "reputation": 2786,
                        "user_id": 13394817,
                        "user_type": "registered",
                        "display_name": "Ali_Sh"
                    },
                    "comment_count": 3,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1656065913,
                    "last_edit_date": 1656065913,
                    "creation_date": 1656065269,
                    "answer_id": 72742405,
                    "question_id": 72741431,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/72742405#72742405",
                    "body": "<p>Without loops, it could be achieved with use of <a href=\"https://stackoverflow.com/a/72280741/13394817\">another SO post</a>:</p>\n<pre><code>unique_values, index = np.unique(a, return_index=True)\nresult = index[np.searchsorted(unique_values, np.amax(windows, axis=(2, 3)))]\nind = np.dstack((result % a.shape[1], result // a.shape[1]))\n\nind.reshape(12, 2)\n# [[1 0]\n#  [1 0]\n#  [4 1]\n#  [5 1]\n#  [1 1]\n#  [1 1]\n#  [4 1]\n#  [5 1]\n#  [1 4]\n#  [1 4]\n#  [4 4]\n#  [4 4]]\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 5220980,
                        "reputation": 732,
                        "user_id": 4174466,
                        "user_type": "registered",
                        "display_name": "Scott Staniewicz"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1678215687,
                    "creation_date": 1678215687,
                    "answer_id": 75666149,
                    "question_id": 72741431,
                    "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array/75666149#75666149",
                    "body": "<p>In case others want to have a sliding, <em>non-overlapping</em> window, there's a couple alterations I made to get the selected answer to work:</p>\n<ul>\n<li><p>Adjust the sliding window call to do <code>windows = np.lib.stride_tricks.sliding_window_view(arr, (row_window, col_window))[ ::row_window, ::col_window ]</code></p>\n</li>\n<li><p>The <code>sum</code> at the end to get the absolute position doesnt work if you're skipping windows from the <code>sliding_window_view</code></p>\n</li>\n</ul>\n<p>Here's what I got</p>\n<pre class=\"lang-py prettyprint-override\"><code>def get_max_idxs(arr, row_window, col_window):\n    &quot;&quot;&quot;Get the indices of the maximum value in each window.&quot;&quot;&quot;\n    windows = np.lib.stride_tricks.sliding_window_view(arr, (row_window, col_window))[\n        ::row_window, ::col_window\n    ]\n    maxvals = np.nanmax(windows, axis=(2, 3))\n    indx = np.array((windows == np.expand_dims(maxvals, axis=(2, 3))).nonzero())\n\n    # In [82]: (windows == np.expand_dims(maxvals, axis = (2, 3))).nonzero()\n    # This gives 4 arrays:\n    # First two are the window indices, e.g.\n    # (array([0, 0, 0, 1, 1, 1]),\n    # array([0, 1, 2, 0, 1, 2]),\n    # last two are the relative indices (within each window)\n    # array([0, 0, 1, 1, 1, 1]),\n    # array([1, 1, 1, 1, 1, 0]))\n    window_positions, relative_positions = indx.reshape((2, 2, -1))\n    # Multiply the first two by the window size to get the absolute indices\n    # of the top lefts of the windows\n    window_offsets = np.array([row_window, col_window]).reshape((2, 1))\n    # Then add the last two to get the relative indices\n    rows, cols = relative_positions + window_positions * window_offsets\n    return rows, cols\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 6631447,
                "reputation": 10889,
                "user_id": 5120049,
                "user_type": "registered",
                "display_name": "Vishnudev Krishnadas"
            },
            "comment_count": 10,
            "is_answered": true,
            "accepted_answer_id": 72742009,
            "answer_count": 3,
            "score": 2,
            "last_activity_date": 1678215687,
            "creation_date": 1656060749,
            "last_edit_date": 1656073994,
            "question_id": 72741431,
            "link": "https://stackoverflow.com/questions/72741431/how-to-get-matrix-position-of-the-max-element-in-sliding-window-view-of-an-array",
            "title": "How to get matrix position of the max element in sliding window view of an array?",
            "body": "<p>I have successfully found the maximum of the array in each sliding window view using <code>amax</code> and <code>sliding_window_view</code> functions from NumPy as follows:</p>\n<pre><code>import numpy as np\n\n\na = np.random.randint(0, 100, (5, 6))  # 2D array\n\narray([[51, 92, 14, 71, 60, 20],\n       [82, 86, 74, 74, 87, 66],\n       [23,  2, 21, 52,  1, 87],\n       [29, 37,  1, 63, 59, 20],\n       [32, 75, 57, 21, 83, 48]])\n\nwindows = np.lib.stride_tricks.sliding_window_view(a, (3, 3))\nnp.amax(windows, axis=(2, 3))\n\narray([[92, 92, 87, 87],\n       [86, 86, 87, 87],\n       [75, 75, 83, 87]])\n</code></pre>\n<p>Now, I'm trying to find the position of the max values in the original array considering the windows.</p>\n<p>Expected Output</p>\n<pre><code>The first element i.e. `92` should give position `(1, 0)`.\nThe second element i.e. `92` should give position `(1, 0)`.\nThe third element i.e. `87` should give position `(4, 1)`.\n.\n.\nThe seventh element i.e. `87` should give position `(4, 1)`.\nThe twelveth element i.e. `87` should give position `(5, 2)`.\n.\nso on\n</code></pre>\n<p>NOTE: Only one position per value is needed. Hence, if there are multiple positions inside a window, return only the first.</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 7498
}