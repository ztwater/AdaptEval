{
    "items": [
        {
            "tags": [
                "python",
                "pytest"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 289196,
                        "reputation": 11612,
                        "user_id": 590028,
                        "user_type": "registered",
                        "accept_rate": 90,
                        "display_name": "user590028"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1407431475,
                    "post_id": 25188119,
                    "comment_id": 39222374,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session#comment39222374_25188119",
                    "body": "Need more details. py.test, database? These are somewhat generic."
                },
                {
                    "owner": {
                        "account_id": 74079,
                        "reputation": 6152,
                        "user_id": 213042,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "Laizer"
                    },
                    "reply_to_user": {
                        "account_id": 289196,
                        "reputation": 11612,
                        "user_id": 590028,
                        "user_type": "registered",
                        "accept_rate": 90,
                        "display_name": "user590028"
                    },
                    "edited": false,
                    "score": 2,
                    "creation_date": 1407432115,
                    "post_id": 25188119,
                    "comment_id": 39222720,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session#comment39222720_25188119",
                    "body": "py.test is the testing system (pytest.org).  My DB here in Mongo, but it could be any DB, methinks."
                },
                {
                    "owner": {
                        "account_id": 289196,
                        "reputation": 11612,
                        "user_id": 590028,
                        "user_type": "registered",
                        "accept_rate": 90,
                        "display_name": "user590028"
                    },
                    "edited": false,
                    "score": 0,
                    "creation_date": 1407432235,
                    "post_id": 25188119,
                    "comment_id": 39222786,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session#comment39222786_25188119",
                    "body": "Ahh.. Sorry I couldn&#39;t be more helpful. Glad you found the answer."
                },
                {
                    "owner": {
                        "account_id": 454252,
                        "reputation": 12944,
                        "user_id": 851699,
                        "user_type": "registered",
                        "accept_rate": 41,
                        "display_name": "Peter"
                    },
                    "edited": false,
                    "score": 3,
                    "creation_date": 1428946635,
                    "post_id": 25188119,
                    "comment_id": 47368573,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session#comment47368573_25188119",
                    "body": "This question is getting negative votes because it&#39;s considered &quot;bad practice&quot;.  For me, I have a lot of experiments where I just want to test if they run without error.  Running things to completion takes way too long, so I&#39;ve been passing around a &quot;test_mode&quot; argument to every experiment I want to test this way, which just does various things to shorten the experiment while still running through all the code.   This approach is very repetitive, and kind of sloppy, I&#39;d prefer just to ask the system if I&#39;m in a test.  Does anybody have a nicer solution than the one accepted below?"
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 69691,
                                "reputation": 14482,
                                "user_id": 202645,
                                "user_type": "registered",
                                "display_name": "Bruno Oliveira"
                            },
                            "edited": false,
                            "score": 5,
                            "creation_date": 1407447399,
                            "post_id": 25188424,
                            "comment_id": 39230664,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188424#comment39230664_25188424",
                            "body": "If you found an error in the manual code, please submit a patch. The community will thank you. :)"
                        },
                        {
                            "owner": {
                                "account_id": 74079,
                                "reputation": 6152,
                                "user_id": 213042,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "Laizer"
                            },
                            "reply_to_user": {
                                "account_id": 69691,
                                "reputation": 14482,
                                "user_id": 202645,
                                "user_type": "registered",
                                "display_name": "Bruno Oliveira"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1407449336,
                            "post_id": 25188424,
                            "comment_id": 39231476,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188424#comment39231476_25188424",
                            "body": "Done. <a href=\"https://bitbucket.org/LevIsrael/pytest/pull-request/1/fix-example-code-in-detect-if-running-from/diff\" rel=\"nofollow noreferrer\">bitbucket.org/LevIsrael/pytest/pull-request/1/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 155319,
                                "reputation": 4160,
                                "user_id": 371908,
                                "user_type": "registered",
                                "display_name": "boxed"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1539674787,
                            "post_id": 25188424,
                            "comment_id": 92576490,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188424#comment92576490_25188424",
                            "body": "The docs are now updated, even if the PR linked above is not closed. This is probably due to pytest being on GitHub now, not bitbucket."
                        },
                        {
                            "owner": {
                                "account_id": 8878495,
                                "reputation": 1371,
                                "user_id": 6629672,
                                "user_type": "registered",
                                "display_name": "Almenon"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1592437230,
                            "post_id": 25188424,
                            "comment_id": 110428949,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188424#comment110428949_25188424",
                            "body": "This may not work - in certain cases conftest.py is loaded too late. See <a href=\"https://github.com/pytest-dev/pytest-django/issues/333\" rel=\"nofollow noreferrer\">github.com/pytest-dev/pytest-django/issues/333</a>"
                        },
                        {
                            "owner": {
                                "account_id": 6636781,
                                "reputation": 182,
                                "user_id": 5123730,
                                "user_type": "registered",
                                "display_name": "evgeni tsvetanov"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1661505108,
                            "post_id": 25188424,
                            "comment_id": 129793107,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188424#comment129793107_25188424",
                            "body": "What happens if it crashes before <code>pytest_unconfigure</code> is called?"
                        }
                    ],
                    "owner": {
                        "account_id": 74079,
                        "reputation": 6152,
                        "user_id": 213042,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "Laizer"
                    },
                    "comment_count": 5,
                    "is_accepted": true,
                    "score": 53,
                    "last_activity_date": 1564048038,
                    "last_edit_date": 1564048038,
                    "creation_date": 1407431689,
                    "answer_id": 25188424,
                    "question_id": 25188119,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188424#25188424",
                    "body": "<p>A solution came from <a href=\"http://doc.pytest.org/en/latest/example/simple.html#detect-if-running-from-within-a-pytest-run\" rel=\"noreferrer\">RTFM</a>, although not in an obvious place.  The manual also had an error in code, corrected below.</p>\n\n<blockquote>\n  <p><strong>Detect if running from within a pytest run</strong></p>\n  \n  <p>Usually it is a bad idea to make application code behave differently\n  if called from a test. But if you absolutely must find out if your\n  application code is running from a test you can do something like\n  this:</p>\n\n<pre><code># content of conftest.py\ndef pytest_configure(config):\n    import sys\n    sys._called_from_test = True\n\ndef pytest_unconfigure(config):\n    import sys  # This was missing from the manual\n    del sys._called_from_test\n</code></pre>\n  \n  <p>and then check for the sys._called_from_test flag:</p>\n\n<pre><code>if hasattr(sys, '_called_from_test'):\n    # called from within a test run\nelse:\n    # called \"normally\"\n</code></pre>\n  \n  <p>accordingly in your application. It\u2019s also a good idea to use your own\n  application module rather than sys for handling flag.</p>\n</blockquote>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3343278,
                                "reputation": 10053,
                                "user_id": 2809027,
                                "user_type": "registered",
                                "display_name": "Cecil Curry"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1547594777,
                            "post_id": 25188895,
                            "comment_id": 95243205,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188895#comment95243205_25188895",
                            "body": "The <a href=\"http://pytest.org/latest/example/simple.html#detect-if-running-from-within-a-pytest-run\" rel=\"nofollow noreferrer\">py.test documentation</a> you referenced is hardly a hack; it&#39;s the official solution to a common complaint. That said, the <a href=\"https://stackoverflow.com/a/44595269/2809027\">trivial one-liner proposed by ramnes</a> is dramatically superior for most use cases. Regardless, <b>What You Want To Do Is Considered Harmful\u2122</b> is <i>never</i> a valid solution. If that was the best you could do, why bother responding at all? There are demonstrable architectural reasons for a codebase to detect <code>py.test</code> at runtime."
                        },
                        {
                            "owner": {
                                "account_id": 86435,
                                "reputation": 1710,
                                "user_id": 1252386,
                                "user_type": "registered",
                                "accept_rate": 67,
                                "display_name": "macetw"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1621969698,
                            "post_id": 25188895,
                            "comment_id": 119653641,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188895#comment119653641_25188895",
                            "body": "I agree with this concern. In general, if you&#39;re writing your code to behave different when run in test, are you really testing your code? Or are you just testing your test code? As you branch your code in different directions when in test, you&#39;ll get farther and farther from the spirit of why tests work. #meta"
                        },
                        {
                            "owner": {
                                "account_id": 309464,
                                "reputation": 5308,
                                "user_id": 621917,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Timo"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1687867652,
                            "post_id": 25188895,
                            "comment_id": 134994029,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188895#comment134994029_25188895",
                            "body": "I&#39;ve found this trick useful for overriding delay times in retry logic when I expect something to fail in my tests. Unit tests should execute fast."
                        }
                    ],
                    "owner": {
                        "account_id": 1721929,
                        "reputation": 6191,
                        "user_id": 1577530,
                        "user_type": "registered",
                        "display_name": "flub"
                    },
                    "comment_count": 3,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1495116345,
                    "last_edit_date": 1495116345,
                    "creation_date": 1407433528,
                    "answer_id": 25188895,
                    "question_id": 25188119,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/25188895#25188895",
                    "body": "<p>While the hack explained in the other answer (<a href=\"http://pytest.org/latest/example/simple.html#detect-if-running-from-within-a-pytest-run\" rel=\"nofollow noreferrer\">http://pytest.org/latest/example/simple.html#detect-if-running-from-within-a-pytest-run</a>) does indeed work, you could probably design the code in such a way you would not need to do this.</p>\n\n<p>If you design the code to take the database to connect to as an argument somehow, via a connection or something else, then you can simply inject a different argument when you're running the tests then when the application drives this.  Your code will end up with less global state and more modulare and reusable.  So to me it sounds like an example where testing drives you to design the code better.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 1123617,
                                "reputation": 3300,
                                "user_id": 1146713,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "NirIzr"
                            },
                            "edited": false,
                            "score": 11,
                            "creation_date": 1532564706,
                            "post_id": 44595269,
                            "comment_id": 90027000,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment90027000_44595269",
                            "body": "Seems like a cleaner / more pythonic solution if you ask me"
                        },
                        {
                            "owner": {
                                "account_id": 492980,
                                "reputation": 7818,
                                "user_id": 992887,
                                "user_type": "registered",
                                "display_name": "RichVel"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1539764316,
                            "post_id": 44595269,
                            "comment_id": 92616151,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment92616151_44595269",
                            "body": "Much nicer answer that could be used for other test frameworks like <code>nose</code> as well"
                        },
                        {
                            "owner": {
                                "account_id": 3343278,
                                "reputation": 10053,
                                "user_id": 2809027,
                                "user_type": "registered",
                                "display_name": "Cecil Curry"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1547595129,
                            "post_id": 44595269,
                            "comment_id": 95243280,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment95243280_44595269",
                            "body": "Likewise, this is the <a href=\"https://github.com/pytest-dev/pytest-django/issues/333#issuecomment-302429237\" rel=\"nofollow noreferrer\">recommended approach for detecting py.test under Django</a>."
                        },
                        {
                            "owner": {
                                "account_id": 216253,
                                "reputation": 6571,
                                "user_id": 471376,
                                "user_type": "registered",
                                "accept_rate": 6,
                                "display_name": "JamesThomasMoon"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1551252083,
                            "post_id": 44595269,
                            "comment_id": 96567720,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment96567720_44595269",
                            "body": "Used as a workaround for <a href=\"https://github.com/pytest-dev/pytest/issues/4843\" rel=\"nofollow noreferrer\">pytest Issue #4843</a>  Thanks!"
                        },
                        {
                            "owner": {
                                "account_id": 1914531,
                                "reputation": 26686,
                                "user_id": 1727392,
                                "user_type": "registered",
                                "accept_rate": 91,
                                "display_name": "duhaime"
                            },
                            "edited": false,
                            "score": 5,
                            "creation_date": 1559695832,
                            "post_id": 44595269,
                            "comment_id": 99498902,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment99498902_44595269",
                            "body": "Warning: I&#39;m getting false positives from this approach. In a non-pytest environment, I&#39;m seeing pytest in <code>sys.modules.keys()</code>."
                        },
                        {
                            "owner": {
                                "account_id": 11134061,
                                "reputation": 2100,
                                "user_id": 8173153,
                                "user_type": "registered",
                                "display_name": "ramnes"
                            },
                            "reply_to_user": {
                                "account_id": 1914531,
                                "reputation": 26686,
                                "user_id": 1727392,
                                "user_type": "registered",
                                "accept_rate": 91,
                                "display_name": "duhaime"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1559807612,
                            "post_id": 44595269,
                            "comment_id": 99536833,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment99536833_44595269",
                            "body": "@duhaime The only way that it is in <code>sys.modules</code> is that it has been imported, in a way or another, directly in your code or through another import (there might be one of the libraries you use that does import it). And as I said, &quot;this solution only works if the code you&#39;re trying to test does not use <code>pytest</code> itself&quot;."
                        },
                        {
                            "owner": {
                                "account_id": 1914531,
                                "reputation": 26686,
                                "user_id": 1727392,
                                "user_type": "registered",
                                "accept_rate": 91,
                                "display_name": "duhaime"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1559826812,
                            "post_id": 44595269,
                            "comment_id": 99547019,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment99547019_44595269",
                            "body": "Ah, sorry, I didn&#39;t see that. I only call <code>pytest</code> to run my tests"
                        },
                        {
                            "owner": {
                                "account_id": 7301980,
                                "reputation": 1613,
                                "user_id": 5564345,
                                "user_type": "registered",
                                "display_name": "shuaibird"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1648631672,
                            "post_id": 44595269,
                            "comment_id": 126671173,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment126671173_44595269",
                            "body": "This is clearly the easiest method"
                        },
                        {
                            "owner": {
                                "account_id": 11134061,
                                "reputation": 2100,
                                "user_id": 8173153,
                                "user_type": "registered",
                                "display_name": "ramnes"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1709043519,
                            "post_id": 44595269,
                            "comment_id": 137628166,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#comment137628166_44595269",
                            "body": "That&#39;s already written in the answer."
                        }
                    ],
                    "owner": {
                        "account_id": 11134061,
                        "reputation": 2100,
                        "user_id": 8173153,
                        "user_type": "registered",
                        "display_name": "ramnes"
                    },
                    "comment_count": 9,
                    "is_accepted": false,
                    "score": 145,
                    "last_activity_date": 1497635597,
                    "creation_date": 1497635597,
                    "answer_id": 44595269,
                    "question_id": 25188119,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/44595269#44595269",
                    "body": "<p>A simpler solution I came to:</p>\n\n<pre><code>import sys\n\nif \"pytest\" in sys.modules:\n    ...\n</code></pre>\n\n<p>Pytest runner will always load the <code>pytest</code> module, making it available in <code>sys.modules</code>.</p>\n\n<p>Of course, this solution only works if the code you're trying to test does not use <code>pytest</code> itself.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 11736793,
                                "reputation": 940,
                                "user_id": 8751739,
                                "user_type": "registered",
                                "display_name": "naaman"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1576387632,
                            "post_id": 56452981,
                            "comment_id": 104880366,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/56452981#comment104880366_56452981",
                            "body": "If you&#39;re using &#39;py.test&#39;, this will test for both <code>any(re.findall(r&#39;pytest|py.test&#39;, sys.argv[0]))</code>"
                        },
                        {
                            "owner": {
                                "account_id": 9800827,
                                "reputation": 4858,
                                "user_id": 7262247,
                                "user_type": "registered",
                                "display_name": "smarie"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1617811701,
                            "post_id": 56452981,
                            "comment_id": 118413289,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/56452981#comment118413289_56452981",
                            "body": "It seems that the env variable was introduced in 3.2: <a href=\"https://docs.pytest.org/en/stable/changelog.html#pytest-3-2-0-2017-07-30\" rel=\"nofollow noreferrer\">docs.pytest.org/en/stable/&hellip;</a>  but maybe it was temporarily removed in some versions ?"
                        },
                        {
                            "owner": {
                                "account_id": 9028,
                                "reputation": 3423,
                                "user_id": 16501,
                                "user_type": "registered",
                                "accept_rate": 73,
                                "display_name": "Ted Elliott"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1634573515,
                            "post_id": 56452981,
                            "comment_id": 123055820,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/56452981#comment123055820_56452981",
                            "body": "I found that this is not always reliable.  If you use pytest-xdist package this does not work.  The module check works in that scenario though"
                        },
                        {
                            "owner": {
                                "account_id": 1914531,
                                "reputation": 26686,
                                "user_id": 1727392,
                                "user_type": "registered",
                                "accept_rate": 91,
                                "display_name": "duhaime"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1634656093,
                            "post_id": 56452981,
                            "comment_id": 123081056,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/56452981#comment123081056_56452981",
                            "body": "Yes, you should definitely use the module approach unless you get the false positives I describe in a comment on that answer suggestion!"
                        }
                    ],
                    "owner": {
                        "account_id": 1914531,
                        "reputation": 26686,
                        "user_id": 1727392,
                        "user_type": "registered",
                        "accept_rate": 91,
                        "display_name": "duhaime"
                    },
                    "comment_count": 4,
                    "is_accepted": false,
                    "score": 13,
                    "last_activity_date": 1666533047,
                    "last_edit_date": 1666533047,
                    "creation_date": 1559695809,
                    "answer_id": 56452981,
                    "question_id": 25188119,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/56452981#56452981",
                    "body": "<p>Working with <code>pytest==4.3.1</code> the methods above failed, so I just went old school and checked with:</p>\n<pre class=\"lang-py prettyprint-override\"><code>script_name = os.path.basename(sys.argv[0])\nif script_name in ['pytest', 'py.test']:\n  print('Running with pytest!')\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 4297033,
                        "reputation": 12585,
                        "user_id": 3511819,
                        "user_type": "registered",
                        "accept_rate": 70,
                        "display_name": "Alex"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1570386693,
                    "last_edit_date": 1570386693,
                    "creation_date": 1570386173,
                    "answer_id": 58260112,
                    "question_id": 25188119,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/58260112#58260112",
                    "body": "<p>This could be done by setting an environment variable inside the testing code. For example, given a project</p>\n\n<pre><code>conftest.py\nmypkg/\n    __init__.py\n    app.py\ntests/\n    test_app.py\n</code></pre>\n\n<p>In <code>test_app.py</code> you can add</p>\n\n<pre><code>import os\nos.environ['PYTEST_RUNNING'] = 'true'\n</code></pre>\n\n<p>And then you can check inside <code>app.py</code>:</p>\n\n<pre><code>import os\nif os.environ.get('PYTEST_RUNNING', '') == 'true':\n    print('pytest is running')\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 2789900,
                                "reputation": 151,
                                "user_id": 2400328,
                                "user_type": "registered",
                                "display_name": "techniao"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1585447048,
                            "post_id": 58866220,
                            "comment_id": 107761595,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/58866220#comment107761595_58866220",
                            "body": "Works for me. (in <code>env.py</code> for Flask-Migrate==2.5.2 alembic==1.3.3 Flask-SQLAlchemy==2.4.1 SQLAlchemy==1.3.13 pytest==5.3.5)"
                        },
                        {
                            "owner": {
                                "account_id": 45721,
                                "reputation": 33677,
                                "user_id": 134904,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "kolypto"
                            },
                            "edited": false,
                            "score": 26,
                            "creation_date": 1635460784,
                            "post_id": 58866220,
                            "comment_id": 123312024,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/58866220#comment123312024_58866220",
                            "body": "Note that this method works only when some actual test is being run! This detection will not work when modules are imported during pytest collection!"
                        },
                        {
                            "owner": {
                                "account_id": 472347,
                                "reputation": 5274,
                                "user_id": 880783,
                                "user_type": "registered",
                                "accept_rate": 57,
                                "display_name": "bers"
                            },
                            "reply_to_user": {
                                "account_id": 45721,
                                "reputation": 33677,
                                "user_id": 134904,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "kolypto"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1643809552,
                            "post_id": 58866220,
                            "comment_id": 125437420,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/58866220#comment125437420_58866220",
                            "body": "Thanks, @kolypto! That explains why module-level &quot;constants&quot; were set incorrectly for me (as if no test was being run). The answer should include this important fact."
                        },
                        {
                            "owner": {
                                "account_id": 2042669,
                                "reputation": 18437,
                                "user_id": 1823469,
                                "user_type": "registered",
                                "display_name": "Konstantin Smolyanin"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1670603121,
                            "post_id": 58866220,
                            "comment_id": 131919031,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/58866220#comment131919031_58866220",
                            "body": "As I found out from my short investigation, this variable is not available during the execution of fixtures. Thus, you cannot make a decision about choosing a test database to initialize it."
                        },
                        {
                            "owner": {
                                "account_id": 1403029,
                                "reputation": 4903,
                                "user_id": 1331446,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "dsz"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1673995616,
                            "post_id": 58866220,
                            "comment_id": 132620051,
                            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/58866220#comment132620051_58866220",
                            "body": "Nice, as prod code can avoid a <code>pytest</code> import dependancy"
                        }
                    ],
                    "owner": {
                        "account_id": 10904159,
                        "reputation": 1279,
                        "user_id": 8015555,
                        "user_type": "registered",
                        "display_name": "cgons"
                    },
                    "comment_count": 5,
                    "is_accepted": false,
                    "score": 113,
                    "last_activity_date": 1667921126,
                    "last_edit_date": 1667921126,
                    "creation_date": 1573764290,
                    "answer_id": 58866220,
                    "question_id": 25188119,
                    "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session/58866220#58866220",
                    "body": "<p>There's also another way documented in the manual:\n<a href=\"https://docs.pytest.org/en/latest/example/simple.html#pytest-current-test-environment-variable\" rel=\"noreferrer\">https://docs.pytest.org/en/latest/example/simple.html#pytest-current-test-environment-variable</a></p>\n<p>Pytest will set the following environment variable <code>PYTEST_CURRENT_TEST</code>.</p>\n<p>Checking the existence of said variable should reliably allow one to detect if code is being executed from within the umbrella of pytest.</p>\n<pre><code>import os\nif &quot;PYTEST_CURRENT_TEST&quot; in os.environ:\n    # We are running under pytest, act accordingly...\n</code></pre>\n<p><strong>Note</strong></p>\n<ul>\n<li>This method works only when an <strong>actual test is being run</strong>.</li>\n<li>This detection will <strong>not work</strong> when modules are imported during <code>pytest</code> collection.</li>\n</ul>\n"
                }
            ],
            "owner": {
                "account_id": 74079,
                "reputation": 6152,
                "user_id": 213042,
                "user_type": "registered",
                "accept_rate": 80,
                "display_name": "Laizer"
            },
            "comment_count": 4,
            "is_answered": true,
            "accepted_answer_id": 25188424,
            "answer_count": 6,
            "score": 125,
            "last_activity_date": 1667921126,
            "creation_date": 1407430597,
            "last_edit_date": 1407433181,
            "question_id": 25188119,
            "link": "https://stackoverflow.com/questions/25188119/test-if-code-is-executed-from-within-a-py-test-session",
            "title": "Test if code is executed from within a py.test session",
            "body": "<p>I'd like to connect to a different database if my code is running under py.test.  Is there a function to call or an environment variable that I can test that will tell me if I'm running under a py.test session?  What's the best way to handle this? </p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 7961
}