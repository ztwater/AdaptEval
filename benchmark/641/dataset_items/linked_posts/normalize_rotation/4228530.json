{
    "items": [
        {
            "tags": [
                "python",
                "python-imaging-library"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 1844797,
                        "reputation": 57743,
                        "user_id": 1673391,
                        "user_type": "registered",
                        "accept_rate": 88,
                        "display_name": "Grijesh Chauhan"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1625257583,
                    "post_id": 4228530,
                    "comment_id": 120588844,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image#comment120588844_4228530",
                    "body": "Adding a note for other:  I think <code>.thumbnail()</code> do not rotating \u2013 I validated myself using <code>img.show()</code>. It is actually the <code>.save()</code> method which write to file. What I tried is: \u2013 instead of writing to disk-file try writing to in-memory file <code>from io import BytesIO; buffer = BytesIO; img.save(buffer, &quot;JPEG&quot;); Image.open(buffer).show()</code>"
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 10930,
                                "reputation": 788893,
                                "user_id": 20862,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "Ignacio Vazquez-Abrams"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1290196767,
                            "post_id": 4228725,
                            "comment_id": 4577027,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment4577027_4228725",
                            "body": "Or to read the EXIF data beforehand and apply the transformation manually."
                        },
                        {
                            "owner": {
                                "account_id": 223309,
                                "reputation": 4023,
                                "user_id": 482425,
                                "user_type": "registered",
                                "accept_rate": 61,
                                "display_name": "Hoopes"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1290461865,
                            "post_id": 4228725,
                            "comment_id": 4604133,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment4604133_4228725",
                            "body": "Thanks to both of you for your answers. I&#39;m trying to strip all EXIF data, but then add back the data if it has to be rotated. This is turning into much more of a PITA than I originally assumed it would be. Just a matter of working out the script to do it now. Thanks again!"
                        },
                        {
                            "owner": {
                                "account_id": 39780,
                                "reputation": 19931,
                                "user_id": 114917,
                                "user_type": "registered",
                                "accept_rate": 95,
                                "display_name": "Paul McMillan"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1302469348,
                            "post_id": 4228725,
                            "comment_id": 6395981,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment6395981_4228725",
                            "body": "Since you&#39;re resizing, you probably don&#39;t care, but don&#39;t forget that even a simple rotation is sometimes a lossy operation on jpegs."
                        },
                        {
                            "owner": {
                                "account_id": 206547,
                                "reputation": 1911,
                                "user_id": 455905,
                                "user_type": "registered",
                                "accept_rate": 86,
                                "display_name": "Robert Mao"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1316647391,
                            "post_id": 4228725,
                            "comment_id": 9091838,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment9091838_4228725",
                            "body": "Storm_to&#39;s answer is better. orientation has multiple value need to handle differently."
                        },
                        {
                            "owner": {
                                "account_id": 392464,
                                "reputation": 1777,
                                "user_id": 753738,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "Maik Hoepfel"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1343215665,
                            "post_id": 4228725,
                            "comment_id": 15433121,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment15433121_4228725",
                            "body": "Please check the answers below, several improvements have been made. I suggest a community wiki."
                        },
                        {
                            "owner": {
                                "account_id": 632109,
                                "reputation": 596,
                                "user_id": 1527197,
                                "user_type": "registered",
                                "display_name": "Scott Lawton"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1434049215,
                            "post_id": 4228725,
                            "comment_id": 49627999,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment49627999_4228725",
                            "body": "I upvoted the version that handles all 8 orientations. Also, here&#39;s a great set of test images <a href=\"https://github.com/recurser/exif-orientation-examples\" rel=\"nofollow noreferrer\">github.com/recurser/exif-orientation-examples</a> from Dave Perrett."
                        },
                        {
                            "owner": {
                                "account_id": 7251934,
                                "reputation": 596,
                                "user_id": 5531879,
                                "user_type": "registered",
                                "display_name": "Dinh Phong"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1550743143,
                            "post_id": 4228725,
                            "comment_id": 96384874,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment96384874_4228725",
                            "body": "you save my day &lt;3"
                        },
                        {
                            "owner": {
                                "account_id": 66005,
                                "reputation": 24615,
                                "user_id": 193892,
                                "user_type": "registered",
                                "accept_rate": 91,
                                "display_name": "Prof. Falken"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1609201513,
                            "post_id": 4228725,
                            "comment_id": 115776334,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#comment115776334_4228725",
                            "body": "This works, just paste it into your answer, please <a href=\"https://stackoverflow.com/a/63798032/193892\">stackoverflow.com/a/63798032/193892</a>"
                        }
                    ],
                    "owner": {
                        "account_id": 64585,
                        "reputation": 864612,
                        "user_id": 190597,
                        "user_type": "registered",
                        "accept_rate": 88,
                        "display_name": "unutbu"
                    },
                    "comment_count": 8,
                    "is_accepted": true,
                    "score": 21,
                    "last_activity_date": 1351539431,
                    "last_edit_date": 1351539431,
                    "creation_date": 1290195482,
                    "answer_id": 4228725,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/4228725#4228725",
                    "body": "<p><strong>Please note that there are better answers below.</strong></p>\n\n<hr>\n\n<p>When a picture is taller than it is wide, it means the camera was rotated. Some cameras can detect this and write that info in the picture's EXIF metadata. Some viewers take note of this metadata and display the image appropriately.</p>\n\n<p>PIL can read the picture's metadata, but it does not write/copy metadata when you save an Image. Consequently, your smart image viewer will not rotate the image as it did before.</p>\n\n<p>Following up on @Ignacio Vazquez-Abrams's comment, you can read the metadata using PIL this way, and rotate if necessary:</p>\n\n<pre><code>import ExifTags\nimport Image\n\nimg = Image.open(filename)\nprint(img._getexif().items())\nexif=dict((ExifTags.TAGS[k], v) for k, v in img._getexif().items() if k in ExifTags.TAGS)\nif not exif['Orientation']:\n    img=img.rotate(90, expand=True)\nimg.thumbnail((1000,1000), Image.ANTIALIAS)\nimg.save(output_fname, \"JPEG\")\n</code></pre>\n\n<p>But be aware that the above code may not work for all cameras.</p>\n\n<p>The easiest solution maybe to use some other program to make thumbnails.</p>\n\n<p><a href=\"http://photobatch.stani.be/\" rel=\"noreferrer\">phatch</a> is a batch photo editor written in Python which can handle/preserve EXIF metadata. You could either use this program to make your thumbnails, or look at its source code to see how to do this in Python. I believe it uses the <a href=\"http://tilloy.net/dev/pyexiv2/api.html\" rel=\"noreferrer\">pyexiv2</a> to handle the EXIF metadata. pyexiv2 may be able to handle EXIF better than the PIL's ExifTags module.</p>\n\n<p><a href=\"http://www.imagemagick.org/script/index.php\" rel=\"noreferrer\">imagemagick</a> is another possibility for making batch thumbnails.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 392464,
                                "reputation": 1777,
                                "user_id": 753738,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "Maik Hoepfel"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1357298580,
                            "post_id": 6218425,
                            "comment_id": 19608328,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#comment19608328_6218425",
                            "body": "Please not that this results in a stracktrace if used for non-JPEGs or if EXIF data is not present."
                        },
                        {
                            "owner": {
                                "account_id": 94480,
                                "reputation": 14809,
                                "user_id": 257944,
                                "user_type": "registered",
                                "accept_rate": 93,
                                "display_name": "Bibhas Debnath"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1371414532,
                            "post_id": 6218425,
                            "comment_id": 24801708,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#comment24801708_6218425",
                            "body": "Is something wrong with the indentation of this piece of code?"
                        },
                        {
                            "owner": {
                                "account_id": 40113,
                                "reputation": 14000,
                                "user_id": 116095,
                                "user_type": "registered",
                                "accept_rate": 72,
                                "display_name": "Jim"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1414274099,
                            "post_id": 6218425,
                            "comment_id": 41754234,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#comment41754234_6218425",
                            "body": "What&#39;s the purpose of the &quot;for orientation... break&quot; logic block?"
                        },
                        {
                            "owner": {
                                "account_id": 164915,
                                "reputation": 1565,
                                "user_id": 387992,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "storm_to"
                            },
                            "reply_to_user": {
                                "account_id": 40113,
                                "reputation": 14000,
                                "user_id": 116095,
                                "user_type": "registered",
                                "accept_rate": 72,
                                "display_name": "Jim"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1420460575,
                            "post_id": 6218425,
                            "comment_id": 43968725,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#comment43968725_6218425",
                            "body": "@Robert It grabs the &quot;Orientation&quot; tag from the ExifTags collection and later uses it for testing the orientation value"
                        },
                        {
                            "owner": {
                                "account_id": 373452,
                                "reputation": 19420,
                                "user_id": 723090,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Mark"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1446848045,
                            "post_id": 6218425,
                            "comment_id": 54931043,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#comment54931043_6218425",
                            "body": "Note that rotating resets <code>image.format</code>; set it back after rotating if you&#39;re relying on it."
                        },
                        {
                            "owner": {
                                "account_id": 481791,
                                "reputation": 7405,
                                "user_id": 895810,
                                "user_type": "registered",
                                "accept_rate": 56,
                                "display_name": "dangelsaurus"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1566167590,
                            "post_id": 6218425,
                            "comment_id": 101560589,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#comment101560589_6218425",
                            "body": "why iterate through all the tags, isn&#39;t it always going to be the same key?"
                        },
                        {
                            "owner": {
                                "account_id": 5530375,
                                "reputation": 352,
                                "user_id": 4390532,
                                "user_type": "registered",
                                "display_name": "yangsiyu"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1617664845,
                            "post_id": 6218425,
                            "comment_id": 118361917,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#comment118361917_6218425",
                            "body": "According to <a href=\"https://www.media.mit.edu/pia/Research/deepview/exif.html\" rel=\"nofollow noreferrer\">media.mit.edu/pia/Research/deepview/exif.html</a> the tag for Orientation is 274 (0x0112) once you call image._getexif(), so you can just use 274 as the key for that dict to locate the Orientation field&#39;s value"
                        }
                    ],
                    "owner": {
                        "account_id": 164915,
                        "reputation": 1565,
                        "user_id": 387992,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "storm_to"
                    },
                    "comment_count": 7,
                    "is_accepted": false,
                    "score": 85,
                    "last_activity_date": 1307037944,
                    "creation_date": 1307037944,
                    "answer_id": 6218425,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/6218425#6218425",
                    "body": "<p>I agree with almost everything as answered by \"unutbu\" and Ignacio Vazquez-Abrams, however...</p>\n\n<p>EXIF Orientation flag can have a value between 1 and 8 depending on how the camera was held.</p>\n\n<p>Portrait photo can be taken with top of the camera on the left, or right edge, landscape photo could be taken upside down.</p>\n\n<p>Here is code that takes this into account (Tested with DSLR Nikon D80)</p>\n\n<pre><code>    import Image, ExifTags\n\n    try :\n        image=Image.open(os.path.join(path, fileName))\n        for orientation in ExifTags.TAGS.keys() : \n            if ExifTags.TAGS[orientation]=='Orientation' : break \n        exif=dict(image._getexif().items())\n\n        if   exif[orientation] == 3 : \n            image=image.rotate(180, expand=True)\n        elif exif[orientation] == 6 : \n            image=image.rotate(270, expand=True)\n        elif exif[orientation] == 8 : \n            image=image.rotate(90, expand=True)\n\n        image.thumbnail((THUMB_WIDTH , THUMB_HIGHT), Image.ANTIALIAS)\n        image.save(os.path.join(path,fileName))\n\n    except:\n        traceback.print_exc()\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 29534,
                                "reputation": 6631,
                                "user_id": 79883,
                                "user_type": "registered",
                                "accept_rate": 60,
                                "display_name": "Trey Stout"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1335978120,
                            "post_id": 9628040,
                            "comment_id": 13442609,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/9628040#comment13442609_9628040",
                            "body": "you can smash that conditional down to be &lt;code&gt;     if exif[orientation] in [3,6,8]:         image = image.transpose(Image.ROTATE_180) &lt;/code&gt;"
                        }
                    ],
                    "owner": {
                        "account_id": 1310239,
                        "reputation": 61,
                        "user_id": 1258372,
                        "user_type": "registered",
                        "display_name": "xilvar"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 6,
                    "last_activity_date": 1331259261,
                    "creation_date": 1331259261,
                    "answer_id": 9628040,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/9628040#9628040",
                    "body": "<p>Hoopes answer is great, but it is a lot more efficient to use the transpose method rather than rotate. Rotate does an actual filtered calculation for each pixel, effectively a complex resize of the whole image. Also, the current PIL library seems to have a bug in which a black line is added to the edges of rotated images. Transpose is a LOT faster and lacks that bug. I just tweaked hoopes answer to use transpose instead.</p>\n\n<pre><code>import Image, ExifTags\n\ntry :\n    image=Image.open(os.path.join(path, fileName))\n    for orientation in ExifTags.TAGS.keys() : \n        if ExifTags.TAGS[orientation]=='Orientation' : break \n    exif=dict(image._getexif().items())\n\n    if   exif[orientation] == 3 : \n        image=image.transpose(Image.ROTATE_180)\n    elif exif[orientation] == 6 : \n        image=image.rotate(Image.ROTATE_180)\n    elif exif[orientation] == 8 : \n        image=image.rotate(Image.ROTATE_180)\n\n    image.thumbnail((THUMB_WIDTH , THUMB_HIGHT), Image.ANTIALIAS)\n    image.save(os.path.join(path,fileName))\n\nexcept:\n    traceback.print_exc()\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 2514638,
                                "reputation": 1860,
                                "user_id": 2186344,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "Bartosz Dabrowski"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1385739057,
                            "post_id": 11543365,
                            "comment_id": 30269807,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/11543365#comment30269807_11543365",
                            "body": "I would use <code>orientation = exif.get(orientation, None)</code> and then <code>if orientation is None: return</code> and add some logs that image exif possibly invalid. I am not saying it may cause error to everybody but it happened to me and it may be very rare."
                        },
                        {
                            "owner": {
                                "account_id": 419919,
                                "reputation": 4666,
                                "user_id": 797334,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "kirpit"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1504525000,
                            "post_id": 11543365,
                            "comment_id": 79032412,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/11543365#comment79032412_11543365",
                            "body": "I would use <code>orientation = next(k for k, v in ExifTags.TAGS.items() if v == &#39;Orientation&#39;)</code> since this script depends on this tag and PIL&#39;s <code>ExifTags.py</code>seems to have it."
                        }
                    ],
                    "owner": {
                        "account_id": 392464,
                        "reputation": 1777,
                        "user_id": 753738,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "Maik Hoepfel"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 38,
                    "last_activity_date": 1458582608,
                    "last_edit_date": 1458582608,
                    "creation_date": 1342620728,
                    "answer_id": 11543365,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/11543365#11543365",
                    "body": "<p>xilvar's answer is very nice, but had two minor shortcomings that I wanted to fix in a rejected edit, so I'll post it as an answer.</p>\n\n<p>For one, xilvar's solution fails if the file isn't a JPEG or if there is no exif data present. And for the other, it always rotated 180 degrees instead of the appropriate amount.</p>\n\n<pre><code>import Image, ExifTags\n\ntry:\n    image=Image.open(os.path.join(path, fileName))\n    if hasattr(image, '_getexif'): # only present in JPEGs\n        for orientation in ExifTags.TAGS.keys(): \n            if ExifTags.TAGS[orientation]=='Orientation':\n                break \n        e = image._getexif()       # returns None if no EXIF data\n        if e is not None:\n            exif=dict(e.items())\n            orientation = exif[orientation] \n\n            if orientation == 3:   image = image.transpose(Image.ROTATE_180)\n            elif orientation == 6: image = image.transpose(Image.ROTATE_270)\n            elif orientation == 8: image = image.transpose(Image.ROTATE_90)\n\n    image.thumbnail((THUMB_WIDTH , THUMB_HIGHT), Image.ANTIALIAS)\n    image.save(os.path.join(path,fileName))\n\nexcept:\n    traceback.print_exc()\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 156685,
                                "reputation": 3290,
                                "user_id": 374110,
                                "user_type": "registered",
                                "accept_rate": 29,
                                "display_name": "Tatsh"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1474867674,
                            "post_id": 20982363,
                            "comment_id": 66689193,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/20982363#comment66689193_20982363",
                            "body": "This works, but I am wondering if there is something more OOP style that can be done here, like adding to the Image class from PIL instead. Also, I do not think it&#39;s a good idea to have that much code in a try block. You have several things that can fail and it would be nice to know which IMHO."
                        },
                        {
                            "owner": {
                                "account_id": 156685,
                                "reputation": 3290,
                                "user_id": 374110,
                                "user_type": "registered",
                                "accept_rate": 29,
                                "display_name": "Tatsh"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1474870134,
                            "post_id": 20982363,
                            "comment_id": 66690116,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/20982363#comment66690116_20982363",
                            "body": "Using the plugin system, you can replace the JPEG plugin&#39;s save function with one that automatically rotates on save. Maybe not always wanted, as this tends to get rid of EXIF data, but can be handy and one less line to write. <a href=\"https://gist.github.com/Tatsh/9f713edc102df99fc612486a2c571a6e\" rel=\"nofollow noreferrer\">gist.github.com/Tatsh/9f713edc102df99fc612486a2c571a6e</a>"
                        }
                    ],
                    "owner": {
                        "account_id": 171988,
                        "reputation": 8690,
                        "user_id": 399738,
                        "user_type": "registered",
                        "accept_rate": 68,
                        "display_name": "Dobes Vandermeer"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 21,
                    "last_activity_date": 1389136254,
                    "last_edit_date": 1389136254,
                    "creation_date": 1389130418,
                    "answer_id": 20982363,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/20982363#20982363",
                    "body": "<p>Here's a version that works for all 8 orientations:</p>\n\n<pre><code>def flip_horizontal(im): return im.transpose(Image.FLIP_LEFT_RIGHT)\ndef flip_vertical(im): return im.transpose(Image.FLIP_TOP_BOTTOM)\ndef rotate_180(im): return im.transpose(Image.ROTATE_180)\ndef rotate_90(im): return im.transpose(Image.ROTATE_90)\ndef rotate_270(im): return im.transpose(Image.ROTATE_270)\ndef transpose(im): return rotate_90(flip_horizontal(im))\ndef transverse(im): return rotate_90(flip_vertical(im))\norientation_funcs = [None,\n                 lambda x: x,\n                 flip_horizontal,\n                 rotate_180,\n                 flip_vertical,\n                 transpose,\n                 rotate_270,\n                 transverse,\n                 rotate_90\n                ]\ndef apply_orientation(im):\n    \"\"\"\n    Extract the oritentation EXIF tag from the image, which should be a PIL Image instance,\n    and if there is an orientation tag that would rotate the image, apply that rotation to\n    the Image instance given to do an in-place rotation.\n\n    :param Image im: Image instance to inspect\n    :return: A possibly transposed image instance\n    \"\"\"\n\n    try:\n        kOrientationEXIFTag = 0x0112\n        if hasattr(im, '_getexif'): # only present in JPEGs\n            e = im._getexif()       # returns None if no EXIF data\n            if e is not None:\n                #log.info('EXIF data found: %r', e)\n                orientation = e[kOrientationEXIFTag]\n                f = orientation_funcs[orientation]\n                return f(im)\n    except:\n        # We'd be here with an invalid orientation value or some random error?\n        pass # log.exception(\"Error applying EXIF Orientation tag\")\n    return im\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 2514638,
                        "reputation": 1860,
                        "user_id": 2186344,
                        "user_type": "registered",
                        "accept_rate": 75,
                        "display_name": "Bartosz Dabrowski"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1391616002,
                    "creation_date": 1391616002,
                    "answer_id": 21582100,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/21582100#21582100",
                    "body": "<p>Hello I was trying to achieve rotation of image and thanks to previous answers in this post I did it. But I upgraded solution and would like to share it. I hope someone will find this useful. </p>\n\n<pre><code>def get_rotation_code(img):\n    \"\"\"\n    Returns rotation code which say how much photo is rotated.\n    Returns None if photo does not have exif tag information. \n    Raises Exception if cannot get Orientation number from python \n    image library.\n    \"\"\"\n    if not hasattr(img, '_getexif') or img._getexif() is None:\n        return None\n\n    for code, name in ExifTags.TAGS.iteritems():\n        if name == 'Orientation':\n            orientation_code = code\n            break\n    else:\n        raise Exception('Cannot get orientation code from library.')\n\n    return img._getexif().get(orientation_code, None)\n\n\nclass IncorrectRotationCode(Exception):\n    pass\n\n\ndef rotate_image(img, rotation_code):\n    \"\"\"\n    Returns rotated image file.\n\n    img: PIL.Image file.\n    rotation_code: is rotation code retrieved from get_rotation_code.\n    \"\"\"\n    if rotation_code == 1:\n        return img\n    if rotation_code == 3:\n        img = img.transpose(Image.ROTATE_180)\n    elif rotation_code == 6:\n        img = img.transpose(Image.ROTATE_270)\n    elif rotation_code == 8:\n        img = img.transpose(Image.ROTATE_90)\n    else:\n        raise IncorrectRotationCode('{} is unrecognized '\n                                    'rotation code.'\n                                    .format(rotation_code))\n    return img\n</code></pre>\n\n<p>Use:</p>\n\n<pre><code>&gt;&gt;&gt; img = Image.open('/path/to/image.jpeg')\n&gt;&gt;&gt; rotation_code = get_rotation_code(img)\n&gt;&gt;&gt; if rotation_code is not None:\n...     img = rotate_image(img, rotation_code)\n...     img.save('/path/to/image.jpeg')\n...\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3406132,
                                "reputation": 2476,
                                "user_id": 2857135,
                                "user_type": "registered",
                                "display_name": "Richard"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1523728150,
                            "post_id": 27717378,
                            "comment_id": 86684071,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/27717378#comment86684071_27717378",
                            "body": "This worked for me as far as rotating the image, but the aspect ratio was also inverted. Another problem I had was that when I saved over the original file, I lost the EXIF data completely."
                        }
                    ],
                    "owner": {
                        "account_id": 4541713,
                        "reputation": 1065,
                        "user_id": 3689399,
                        "user_type": "registered",
                        "display_name": "FeFiFoFu"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 8,
                    "last_activity_date": 1420008764,
                    "creation_date": 1420008764,
                    "answer_id": 27717378,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/27717378#27717378",
                    "body": "<p>I'm a noob to programming, Python and PIL so the code examples in the previous answers seem complicated to me.  Instead of iterating through the tags, I just went straight to it the tag's key.  In the python shell, you can see that orientation's key is 274. </p>\n\n<pre><code>&gt;&gt;&gt;from PIL import ExifTags\n&gt;&gt;&gt;ExifTags.TAGS\n</code></pre>\n\n<p>I use the <code>image._getexif()</code> function to grab what ExifTags are in the image.  If orientation tag is not present, it throws an error, so I use try/except.</p>\n\n<p>Pillow's documentation says there is no difference in performance or results between rotate and transpose.  I have confirmed it by timing both functions.  I use rotate because it's more concise.</p>\n\n<p><code>rotate(90)</code> rotates counter-clockwise.  The function seems to accept negative degrees.</p>\n\n<pre><code>from PIL import Image, ExifTags\n\n# Open file with Pillow\nimage = Image.open('IMG_0002.jpg')\n\n#If no ExifTags, no rotating needed.\ntry:\n# Grab orientation value.\n    image_exif = image._getexif()\n    image_orientation = image_exif[274]\n\n# Rotate depending on orientation.\n    if image_orientation == 3:\n        rotated = image.rotate(180)\n    if image_orientation == 6:\n        rotated = image.rotate(-90)\n    if image_orientation == 8:\n        rotated = image.rotate(90)\n\n# Save rotated image.\n    rotated.save('rotated.jpg')\nexcept:\n    pass\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 2526176,
                                "reputation": 998,
                                "user_id": 2195518,
                                "user_type": "registered",
                                "display_name": "Kapitein Witbaard"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1463428964,
                            "post_id": 30462851,
                            "comment_id": 62051183,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment62051183_30462851",
                            "body": "only <code>import functools</code> is missing, still should have been the accepted answer works out of the box in Python 2.7"
                        },
                        {
                            "owner": {
                                "account_id": 1828307,
                                "reputation": 3074,
                                "user_id": 1660459,
                                "user_type": "registered",
                                "accept_rate": 45,
                                "display_name": "OdraEncoded"
                            },
                            "edited": false,
                            "score": 6,
                            "creation_date": 1465184644,
                            "post_id": 30462851,
                            "comment_id": 62778432,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment62778432_30462851",
                            "body": "Kudos to you. This is the most complete answer, using the most proper tools. Other answers either use <code>rotate</code> instead of <code>transpose</code> or lack all eight possible states. The JPEG exit orientation is for transposing, not for rotating. <a href=\"http://jpegclub.org/exif_orientation.html\" rel=\"nofollow noreferrer\">jpegclub.org/exif_orientation.html</a>"
                        },
                        {
                            "owner": {
                                "account_id": 6361551,
                                "reputation": 15533,
                                "user_id": 4936905,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Hassan Baig"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1518108997,
                            "post_id": 30462851,
                            "comment_id": 84379760,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment84379760_30462851",
                            "body": "Indeed plugs right in. But does it reliably work? Please confirm that, because I&#39;m getting mixed results at the moment. Here&#39;s an image (with orientation <code>0</code>) I tested it on: <a href=\"https://imgur.com/a/053MR\" rel=\"nofollow noreferrer\">imgur.com/a/053MR</a>"
                        },
                        {
                            "owner": {
                                "account_id": 52630,
                                "reputation": 4576,
                                "user_id": 157280,
                                "user_type": "registered",
                                "display_name": "Chris Sattinger"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1523460884,
                            "post_id": 30462851,
                            "comment_id": 86573649,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment86573649_30462851",
                            "body": "I just fixed a bug  in the code where orientation is: Unknown (0). That resulted in an index of -1 which means that python returns the last item in the array which is ROTATE_90 which makes users very cross indeed."
                        },
                        {
                            "owner": {
                                "account_id": 11007,
                                "reputation": 2881,
                                "user_id": 21055,
                                "user_type": "registered",
                                "display_name": "Roman Odaisky"
                            },
                            "reply_to_user": {
                                "account_id": 52630,
                                "reputation": 4576,
                                "user_id": 157280,
                                "user_type": "registered",
                                "display_name": "Chris Sattinger"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1523486721,
                            "post_id": 30462851,
                            "comment_id": 86586310,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment86586310_30462851",
                            "body": "@Felix Well, the spec disallows the orientation to be 0. But the case still has to be handled. I fixed your fix by adding an entry to the list instead of an extra <code>if</code>, and added some comments while I was at it."
                        },
                        {
                            "owner": {
                                "account_id": 298380,
                                "reputation": 4165,
                                "user_id": 604382,
                                "user_type": "registered",
                                "display_name": "declension"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1545218983,
                            "post_id": 30462851,
                            "comment_id": 94547976,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment94547976_30462851",
                            "body": "Love the functional style :)"
                        },
                        {
                            "owner": {
                                "account_id": 2692234,
                                "reputation": 1577,
                                "user_id": 2325279,
                                "user_type": "registered",
                                "display_name": "Petr Vep\u0159ek"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1608604997,
                            "post_id": 30462851,
                            "comment_id": 115629035,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment115629035_30462851",
                            "body": "<a href=\"http://www.cipa.jp/std/documents/e/DC-008-2012_E.pdf\" rel=\"nofollow noreferrer\">Spec</a>"
                        },
                        {
                            "owner": {
                                "account_id": 4060,
                                "reputation": 304570,
                                "user_id": 5987,
                                "user_type": "registered",
                                "accept_rate": 55,
                                "display_name": "Mark Ransom"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1651580384,
                            "post_id": 30462851,
                            "comment_id": 127392507,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment127392507_30462851",
                            "body": "Where&#39;d the code go?  This answer is almost useless without it."
                        },
                        {
                            "owner": {
                                "account_id": 11007,
                                "reputation": 2881,
                                "user_id": 21055,
                                "user_type": "registered",
                                "display_name": "Roman Odaisky"
                            },
                            "reply_to_user": {
                                "account_id": 4060,
                                "reputation": 304570,
                                "user_id": 5987,
                                "user_type": "registered",
                                "accept_rate": 55,
                                "display_name": "Mark Ransom"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1651674869,
                            "post_id": 30462851,
                            "comment_id": 127419882,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment127419882_30462851",
                            "body": "@MarkRansom <a href=\"https://pillow.readthedocs.io/en/latest/_modules/PIL/ImageOps.html#exif_transpose\" rel=\"nofollow noreferrer\">pillow.readthedocs.io/en/latest/_modules/PIL/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 4060,
                                "reputation": 304570,
                                "user_id": 5987,
                                "user_type": "registered",
                                "accept_rate": 55,
                                "display_name": "Mark Ransom"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1651676261,
                            "post_id": 30462851,
                            "comment_id": 127420498,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment127420498_30462851",
                            "body": "This answer originally had code in it, which made it useful. It was edited out, leaving only a link which would have been better just as a comment instead of an answer."
                        },
                        {
                            "owner": {
                                "account_id": 11007,
                                "reputation": 2881,
                                "user_id": 21055,
                                "user_type": "registered",
                                "display_name": "Roman Odaisky"
                            },
                            "reply_to_user": {
                                "account_id": 4060,
                                "reputation": 304570,
                                "user_id": 5987,
                                "user_type": "registered",
                                "accept_rate": 55,
                                "display_name": "Mark Ransom"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1651695058,
                            "post_id": 30462851,
                            "comment_id": 127427159,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment127427159_30462851",
                            "body": "@MarkRansom Why should it be a comment when it directly answers the question. And I\u2019m flattered by your high opinion of my code, but the one from Pillow is better for reasons stated in the answer. If someone really wants to copy-paste some code instead of using the library, they can copy-paste the code from the library and not from here, the license is permissive enough."
                        },
                        {
                            "owner": {
                                "account_id": 18542983,
                                "reputation": 96,
                                "user_id": 13511039,
                                "user_type": "registered",
                                "display_name": "foske"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1698655907,
                            "post_id": 30462851,
                            "comment_id": 136428141,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment136428141_30462851",
                            "body": "Good answer! More details are here: <a href=\"https://github.com/python-pillow/Pillow/issues/4703#issuecomment-645219973\" rel=\"nofollow noreferrer\">github.com/python-pillow/Pillow/issues/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 1892898,
                                "reputation": 477,
                                "user_id": 1713366,
                                "user_type": "registered",
                                "accept_rate": 97,
                                "display_name": "Jcorretjer"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1715035797,
                            "post_id": 30462851,
                            "comment_id": 138286901,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#comment138286901_30462851",
                            "body": "If you&#39;re using this library in a raspberry pi, remember to update/upgrade your OS. Was throwing an error that there weren&#39;t any references for <code>exif_transpose</code>. After updating, the error was gone."
                        }
                    ],
                    "owner": {
                        "account_id": 11007,
                        "reputation": 2881,
                        "user_id": 21055,
                        "user_type": "registered",
                        "display_name": "Roman Odaisky"
                    },
                    "comment_count": 13,
                    "is_accepted": false,
                    "score": 76,
                    "last_activity_date": 1619906242,
                    "last_edit_date": 1619906242,
                    "creation_date": 1432654214,
                    "answer_id": 30462851,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/30462851#30462851",
                    "body": "<h1>Just use <a href=\"https://pillow.readthedocs.io/en/latest/reference/ImageOps.html#PIL.ImageOps.exif_transpose\" rel=\"noreferrer\">PIL.ImageOps.exif_transpose</a> from Pillow.</h1>\n<p>Unlike every single function proposed in answers to this question, including my original one, it takes care to remove the orientation field from EXIF (as the image is no longer oriented in a strange way) and also to ensure the return value is a brand new Image object so changes to it can\u2019t affect the original one.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 1425254,
                        "reputation": 415,
                        "user_id": 1348960,
                        "user_type": "registered",
                        "display_name": "orion11"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1492115113,
                    "creation_date": 1492115113,
                    "answer_id": 43401128,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/43401128#43401128",
                    "body": "<p>There are some good answers here, I just wanted to post a cleaned up version...\nThe function assumes you've already done Image.open() somewhere, and will do image.save() elsewhere and just want a function you can drop in to fix rotation. </p>\n\n<pre><code>def _fix_image_rotation(image):\n orientation_to_rotation_map = {\n     3: Image.ROTATE_180,\n     6: Image.ROTATE_270,\n     8: Image.ROTATE_90,\n }\n try:\n     exif = _get_exif_from_image(image)\n     orientation = _get_orientation_from_exif(exif)\n     rotation = orientation_to_rotation_map.get(orientation)\n     if rotation:\n         image = image.transpose(rotation)\n\n except Exception as e:\n     # Would like to catch specific exceptions, but PIL library is poorly documented on Exceptions thrown\n     # Log error here\n\n finally:\n     return image\n\n\ndef _get_exif_from_image(image):\n exif = {}\n\n if hasattr(image, '_getexif'):  # only jpegs have _getexif\n     exif_or_none = image._getexif()\n     if exif_or_none is not None:\n         exif = exif_or_none\n\n return exif\n\n\ndef _get_orientation_from_exif(exif):\n ORIENTATION_TAG = 'Orientation'\n orientation_iterator = (\n     exif.get(tag_key) for tag_key, tag_value in ExifTags.TAGS.items()\n     if tag_value == ORIENTATION_TAG\n )\n orientation = next(orientation_iterator, None)\n return orientation\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 1009632,
                                "reputation": 2168,
                                "user_id": 1224068,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "WhiteHotLoveTiger"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1570208135,
                            "post_id": 48691518,
                            "comment_id": 102853241,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/48691518#comment102853241_48691518",
                            "body": "This is the clean, complete, modern Python3 answer."
                        },
                        {
                            "owner": {
                                "account_id": 7228526,
                                "reputation": 2503,
                                "user_id": 5516267,
                                "user_type": "registered",
                                "accept_rate": 63,
                                "display_name": "jkhadka"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1630322073,
                            "post_id": 48691518,
                            "comment_id": 121916265,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/48691518#comment121916265_48691518",
                            "body": "nice. most complete answer. one small thing in <code>PIL==6.2.2</code>, im does not have <code>_getexif()</code> but has <code>getexif()</code>"
                        }
                    ],
                    "owner": {
                        "account_id": 6361551,
                        "reputation": 15533,
                        "user_id": 4936905,
                        "user_type": "registered",
                        "accept_rate": 96,
                        "display_name": "Hassan Baig"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 10,
                    "last_activity_date": 1518111262,
                    "creation_date": 1518111262,
                    "answer_id": 48691518,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/48691518#48691518",
                    "body": "<p>I needed a solution that takes care of all orientations, not just <code>3</code>, <code>6</code> and <code>8</code>. </p>\n\n<p>I tried Roman Odaisky's <a href=\"https://stackoverflow.com/a/30462851/4936905\">solution</a> - it looked comprehensive and clean. However, testing it with actual images with various orientation values sometimes led to erroneous results (e.g. <a href=\"https://i.stack.imgur.com/ZpC0V.jpg\" rel=\"noreferrer\">this one</a> with orientation set to <code>0</code>).</p>\n\n<p>Another <a href=\"https://stackoverflow.com/a/20982363/4936905\">viable solution</a> could be Dobes Vandermeer's. But I haven't tried it, because I feel one can write the logic more simply (which I prefer). </p>\n\n<p>So without further ado, here's a simpler, more maintainable (in my opinion) version:</p>\n\n<pre><code>from PIL import Image\n\ndef reorient_image(im):\n    try:\n        image_exif = im._getexif()\n        image_orientation = image_exif[274]\n        if image_orientation in (2,'2'):\n            return im.transpose(Image.FLIP_LEFT_RIGHT)\n        elif image_orientation in (3,'3'):\n            return im.transpose(Image.ROTATE_180)\n        elif image_orientation in (4,'4'):\n            return im.transpose(Image.FLIP_TOP_BOTTOM)\n        elif image_orientation in (5,'5'):\n            return im.transpose(Image.ROTATE_90).transpose(Image.FLIP_TOP_BOTTOM)\n        elif image_orientation in (6,'6'):\n            return im.transpose(Image.ROTATE_270)\n        elif image_orientation in (7,'7'):\n            return im.transpose(Image.ROTATE_270).transpose(Image.FLIP_TOP_BOTTOM)\n        elif image_orientation in (8,'8'):\n            return im.transpose(Image.ROTATE_90)\n        else:\n            return im\n    except (KeyError, AttributeError, TypeError, IndexError):\n        return im\n</code></pre>\n\n<p>Tested, and found to work on images with all the mentioned exif orientations. However, please also do your own tests too.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 3968692,
                        "reputation": 807,
                        "user_id": 3273806,
                        "user_type": "registered",
                        "accept_rate": 60,
                        "display_name": "raphaelrk"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 3,
                    "last_activity_date": 1534380537,
                    "creation_date": 1534380537,
                    "answer_id": 51868237,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/51868237#51868237",
                    "body": "<p>Adding to the other answers, I was having issues because I would use <code>im.copy()</code> before running the functions -- this would strip the necessary exif data. Make sure before you run <code>im.copy()</code> you save the exif data:</p>\n\n<pre><code>try:\n    exif = im._getexif()\nexcept Exception:\n    exif = None\n\n# ...\n# im = im.copy() somewhere\n# ...\n\nif exif:\n    im = transpose_im(im, exif)\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 16865345,
                        "reputation": 63,
                        "user_id": 12195175,
                        "user_type": "registered",
                        "display_name": "Ignacio Bares"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1582021786,
                    "creation_date": 1582021786,
                    "answer_id": 60278774,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/60278774#60278774",
                    "body": "<p>There is an easier approach to all this:                                </p>\n\n<pre><code>    from PIL import image\n    im1 = Image.open(path_to_image)\n    im1.thumbnail(size1, Image.ANTIALIAS)\n    y, z = im1.size\n    d = z * 1.5\n    if y &gt; d:\n         im1.rotate(90, expand=1)\n</code></pre>\n\n<p>I hope it helps :)</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 12717222,
                                "reputation": 692,
                                "user_id": 9238815,
                                "user_type": "registered",
                                "display_name": "Antti A"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1606383311,
                            "post_id": 63798032,
                            "comment_id": 114949431,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/63798032#comment114949431_63798032",
                            "body": "I tested some other solutions before this. This is the most simplest and my problem was solved, because it checks the input format too. Only valid PIL Image inputs are accepted.  In my case, I destroyed exif information before with line: image = numpy.array(image)"
                        },
                        {
                            "owner": {
                                "account_id": 423318,
                                "reputation": 1899,
                                "user_id": 802642,
                                "user_type": "registered",
                                "accept_rate": 92,
                                "display_name": "MassDefect_"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1611096905,
                            "post_id": 63798032,
                            "comment_id": 116340103,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/63798032#comment116340103_63798032",
                            "body": "This was the only solution that worked for me. But in my case I was using ImageReader to read the image instead of Image. So I had to save the file into memory and open with Image() then exif_transpose, then use ImageReader()."
                        },
                        {
                            "owner": {
                                "account_id": 115360,
                                "reputation": 1732,
                                "user_id": 302959,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "cheng yang"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1630061076,
                            "post_id": 63798032,
                            "comment_id": 121858720,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/63798032#comment121858720_63798032",
                            "body": "thanks, this is the most elegant solution without switch to a different library"
                        },
                        {
                            "owner": {
                                "account_id": 16477131,
                                "reputation": 588,
                                "user_id": 11904786,
                                "user_type": "registered",
                                "display_name": "Data_sniffer"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1675228676,
                            "post_id": 63798032,
                            "comment_id": 132881233,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/63798032#comment132881233_63798032",
                            "body": "This is most efficient solution. Works perfectly fine! Thanks!"
                        },
                        {
                            "owner": {
                                "account_id": 3640382,
                                "reputation": 165,
                                "user_id": 3034629,
                                "user_type": "registered",
                                "accept_rate": 25,
                                "display_name": "alitaleg"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1702879726,
                            "post_id": 63798032,
                            "comment_id": 136942420,
                            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/63798032#comment136942420_63798032",
                            "body": "I am not sure this occurs of anyone else, but after calling exif_transpose fixed_image.format is empty because the resulting copy does not maintain the extension info. One needs to save the format before calling exif_transpose."
                        }
                    ],
                    "owner": {
                        "account_id": 189910,
                        "reputation": 12185,
                        "user_id": 429533,
                        "user_type": "registered",
                        "accept_rate": 91,
                        "display_name": "Jace Browning"
                    },
                    "comment_count": 5,
                    "is_accepted": false,
                    "score": 37,
                    "last_activity_date": 1609212666,
                    "last_edit_date": 1609212666,
                    "creation_date": 1599582616,
                    "answer_id": 63798032,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/63798032#63798032",
                    "body": "<p>Pillow has <a href=\"https://pillow.readthedocs.io/en/latest/reference/ImageOps.html#PIL.ImageOps.exif_transpose\" rel=\"noreferrer\">an API</a> to handle EXIF orientation tags automatically:</p>\n<pre><code>from PIL import Image, ImageOps\n\noriginal_image = Image.open(filename)\n\nfixed_image = ImageOps.exif_transpose(original_image)\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 21994326,
                        "reputation": 124,
                        "user_id": 16267122,
                        "user_type": "registered",
                        "display_name": "Radek Roj&#237;k"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1648443814,
                    "creation_date": 1648443814,
                    "answer_id": 71642614,
                    "question_id": 4228530,
                    "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image/71642614#71642614",
                    "body": "<p>I fix the same issue with <code>ImageOps</code>:</p>\n<pre><code>from PIL import Image, ImageOps\n\nimg = Image.open(filename)\nimg = ImageOps.exif_transpose(img)\nimg.thumbnail((1000,1000), Image.ANTIALIAS)\nimg.save(output_fname, &quot;JPEG&quot;)\n</code></pre>\n<p>More: <a href=\"https://pillow.readthedocs.io/en/stable/reference/ImageOps.html#PIL.ImageOps.exif_transpose\" rel=\"nofollow noreferrer\">https://pillow.readthedocs.io/en/stable/reference/ImageOps.html#PIL.ImageOps.exif_transpose</a></p>\n"
                }
            ],
            "owner": {
                "account_id": 223309,
                "reputation": 4023,
                "user_id": 482425,
                "user_type": "registered",
                "accept_rate": 61,
                "display_name": "Hoopes"
            },
            "comment_count": 1,
            "is_answered": true,
            "accepted_answer_id": 4228725,
            "answer_count": 14,
            "score": 87,
            "last_activity_date": 1648443814,
            "creation_date": 1290194067,
            "question_id": 4228530,
            "link": "https://stackoverflow.com/questions/4228530/pil-thumbnail-is-rotating-my-image",
            "title": "PIL thumbnail is rotating my image?",
            "body": "<p>I'm attempting to take large (huge) images (from a digital camera), and convert them into something that I can display on the web. This seems straightforward, and probably should be. However, when I attempt to use PIL to create thumbnail versions, if my source image is taller than it is wide, the resulting image is rotated 90 degrees, such that the top of the source image is on the left of the resulting image. If the source image is wider than it is tall, the resulting image is the correct (original) orientation. Could it have to do with the 2-tuple I send in as the size? I'm using thumbnail, because it appears it was meant to preserve the aspect ratio. Or am I just being completely blind, and doing something dumb? The size tuple is 1000,1000 because I want the longest side to be shrunk to 1000 pixels, while keeping AR preserved.</p>\n\n<p>Code seems simple</p>\n\n<pre><code>img = Image.open(filename)\nimg.thumbnail((1000,1000), Image.ANTIALIAS)\nimg.save(output_fname, \"JPEG\")\n</code></pre>\n\n<p>Thanks in advance for any help.</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 8889
}