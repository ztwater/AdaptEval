{
    "items": [
        {
            "tags": [
                "python",
                "vector",
                "angle"
            ],
            "comments": [
                {
                    "owner": {
                        "account_id": 9429389,
                        "reputation": 2651,
                        "user_id": 7013419,
                        "user_type": "registered",
                        "display_name": "PilouPili"
                    },
                    "edited": false,
                    "score": 1,
                    "creation_date": 1535798312,
                    "post_id": 2827393,
                    "comment_id": 91205077,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python#comment91205077_2827393",
                    "body": "This is the best answer is @MK83&#39;s as it is exactly the mathematical expression theta = atan2(u^v, u.v). even the case where u=[0 0] or v=[0 0] is covered because this is only time atan2 will produce the NaN in the other answers NaN will be produced by the / norm(u) or / norm(v)"
                }
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 130461,
                                "reputation": 1775,
                                "user_id": 329749,
                                "user_type": "registered",
                                "accept_rate": 92,
                                "display_name": "BandGap"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1327662645,
                            "post_id": 2827466,
                            "comment_id": 11328488,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827466#comment11328488_2827466",
                            "body": "The last line can result in an error as I&#39;ve found out because of rounding errors. Thus if you to dot(u,u)/norm(u)**2 it results in 1.0000000002 and the arccos then fails (also &#39;works&#39; for antiparallel vectors)"
                        },
                        {
                            "owner": {
                                "account_id": 130461,
                                "reputation": 1775,
                                "user_id": 329749,
                                "user_type": "registered",
                                "accept_rate": 92,
                                "display_name": "BandGap"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1327663206,
                            "post_id": 2827466,
                            "comment_id": 11328646,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827466#comment11328646_2827466",
                            "body": "I&#39;ve tested with u=[1,1,1]. u=[1,1,1,1] works fine but every dimension added returns slightly larger or smaler values than 1..."
                        },
                        {
                            "owner": {
                                "account_id": 27199,
                                "reputation": 152220,
                                "user_id": 71522,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "David Wolever"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1355349163,
                            "post_id": 2827466,
                            "comment_id": 19065762,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827466#comment19065762_2827466",
                            "body": "Note: <b>this will fail</b> (yield <code>nan</code>) when the direction of the two vectors is either identical or opposite. See my answer for a more correct version."
                        },
                        {
                            "owner": {
                                "account_id": 553185,
                                "reputation": 10144,
                                "user_id": 918558,
                                "user_type": "registered",
                                "accept_rate": 46,
                                "display_name": "Tim Tisdall"
                            },
                            "reply_to_user": {
                                "account_id": 27199,
                                "reputation": 152220,
                                "user_id": 71522,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "David Wolever"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1419954045,
                            "post_id": 2827466,
                            "comment_id": 43828383,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827466#comment43828383_2827466",
                            "body": "adding neo&#39;s comment to this, the last line should be <code>angle = arccos(clip(c, -1, 1))</code> to avoid rounding issues.  This solves @DavidWolever &#39;s issue."
                        },
                        {
                            "owner": {
                                "account_id": 2684104,
                                "reputation": 904,
                                "user_id": 2318834,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "Liam Deacon"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1434643880,
                            "post_id": 2827466,
                            "comment_id": 49878133,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827466#comment49878133_2827466",
                            "body": "For the folks using the code snippet above: <code>clip</code> should be added to the list of numpy imports."
                        }
                    ],
                    "owner": {
                        "account_id": 96686,
                        "reputation": 48184,
                        "user_id": 262667,
                        "user_type": "registered",
                        "accept_rate": 86,
                        "display_name": "Olivier Verdier"
                    },
                    "comment_count": 5,
                    "is_accepted": false,
                    "score": 53,
                    "last_activity_date": 1673550109,
                    "last_edit_date": 1673550109,
                    "creation_date": 1273760008,
                    "answer_id": 2827466,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827466#2827466",
                    "body": "<p>Using <a href=\"https://numpy.org/\" rel=\"nofollow noreferrer\">numpy</a> (highly recommended), you would do:</p>\n<pre><code>from numpy import (array, dot, arccos, clip)\nfrom numpy.linalg import norm\n\nu = array([1.,2,3,4])\nv = ...\nc = dot(u,v)/norm(u)/norm(v) # -&gt; cosine of the angle\nangle = arccos(clip(c, -1, 1)) # if you really want the angle\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 11304,
                                "reputation": 10571,
                                "user_id": 21727,
                                "user_type": "registered",
                                "accept_rate": 75,
                                "display_name": "mbeckish"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1273760248,
                            "post_id": 2827475,
                            "comment_id": 2868276,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment2868276_2827475",
                            "body": "Also, if you only need cos, sin, tan of angle, and not the angle itself, then you can skip the math.acos to get cosine, and use cross product to get sine."
                        },
                        {
                            "owner": {
                                "account_id": 55190,
                                "reputation": 63123,
                                "user_id": 165216,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "PaulMcG"
                            },
                            "edited": false,
                            "score": 11,
                            "creation_date": 1273821068,
                            "post_id": 2827475,
                            "comment_id": 2873806,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment2873806_2827475",
                            "body": "Given that <code>math.sqrt(x)</code> is equivalent to <code>x**0.5</code> and <code>math.pow(x,y)</code> is equivalent to <code>x**y</code>, I&#39;m surprised these survived the redundancy axe wielded during the Python 2.x-&gt;3.0 transition.  In practice, I&#39;m usually doing these kinds of numeric things as part of a larger compute-intensive process, and the interpreter&#39;s support for &#39;**&#39; going directly to the bytecode BINARY_POWER, vs. the lookup of &#39;math&#39;, the access to its attribute &#39;sqrt&#39;, and then the painfully slow bytecode CALL_FUNCTION, can make a measurable improvement in speed at no coding or readability cost."
                        },
                        {
                            "owner": {
                                "account_id": 130461,
                                "reputation": 1775,
                                "user_id": 329749,
                                "user_type": "registered",
                                "accept_rate": 92,
                                "display_name": "BandGap"
                            },
                            "edited": false,
                            "score": 5,
                            "creation_date": 1327662901,
                            "post_id": 2827475,
                            "comment_id": 11328568,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment11328568_2827475",
                            "body": "As in the answer with numpy: This can fail if the rounding error comes into play! This can happen for parallel and anti-parallel vectors!"
                        },
                        {
                            "owner": {
                                "account_id": 27199,
                                "reputation": 152220,
                                "user_id": 71522,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "David Wolever"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1355348494,
                            "post_id": 2827475,
                            "comment_id": 19065464,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment19065464_2827475",
                            "body": "Note: <b>this will fail</b> if the vectors are identical (ex, <code>angle((1., 1., 1.), (1., 1., 1.))</code>). See my answer for a slightly more correct version."
                        },
                        {
                            "owner": {
                                "account_id": 27199,
                                "reputation": 152220,
                                "user_id": 71522,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "David Wolever"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1355349182,
                            "post_id": 2827475,
                            "comment_id": 19065771,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment19065771_2827475",
                            "body": "(err, and &quot;by identical&quot; I mean &quot;have the same or opposite directions&quot;)"
                        },
                        {
                            "owner": {
                                "account_id": 69707,
                                "reputation": 42599,
                                "user_id": 202694,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Pace"
                            },
                            "reply_to_user": {
                                "account_id": 27199,
                                "reputation": 152220,
                                "user_id": 71522,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "David Wolever"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1363129661,
                            "post_id": 2827475,
                            "comment_id": 21726157,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment21726157_2827475",
                            "body": "@DavidWolever This tripped me up so I&#39;m going to have to clarify.  The only time this is undefined is when the magnitude of one of the vectors is 0.  Any other time an the cauchy-schwarz inequality states that the input to acos will be between -1 and 1."
                        },
                        {
                            "owner": {
                                "account_id": 27199,
                                "reputation": 152220,
                                "user_id": 71522,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "David Wolever"
                            },
                            "reply_to_user": {
                                "account_id": 69707,
                                "reputation": 42599,
                                "user_id": 202694,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Pace"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1363130940,
                            "post_id": 2827475,
                            "comment_id": 21726589,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment21726589_2827475",
                            "body": "@Pace uuhh\u2026 I don&#39;t believe that&#39;s true\u2026 As the vectors <code>(1., 1., 1.)</code>, <code>(1., 1., 1.)</code> obviously have non-zero magnitudes, but the calculation results in <code>nan</code>\u2026"
                        },
                        {
                            "owner": {
                                "account_id": 69707,
                                "reputation": 42599,
                                "user_id": 202694,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Pace"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1363133410,
                            "post_id": 2827475,
                            "comment_id": 21727345,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment21727345_2827475",
                            "body": "norm(1,1,1)*norm(1,1,1) = 3.  dot((1,1,1),(1,1,1)) = 3. acos(3/3) = 0."
                        },
                        {
                            "owner": {
                                "account_id": 69707,
                                "reputation": 42599,
                                "user_id": 202694,
                                "user_type": "registered",
                                "accept_rate": 88,
                                "display_name": "Pace"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1363133768,
                            "post_id": 2827475,
                            "comment_id": 21727460,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment21727460_2827475",
                            "body": "If you&#39;re talking about the implementation above then it fails because of rounding errors, not because the vectors are parallel."
                        },
                        {
                            "owner": {
                                "account_id": 7702282,
                                "reputation": 474,
                                "user_id": 5834394,
                                "user_type": "registered",
                                "display_name": "Priyank Pathak"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1522270873,
                            "post_id": 2827475,
                            "comment_id": 86095897,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment86095897_2827475",
                            "body": "Simply use  <b><i>sklearn.metrics.pairwise import cosine_similarity</i></b> and then acos"
                        },
                        {
                            "owner": {
                                "account_id": 9163677,
                                "reputation": 4364,
                                "user_id": 6814154,
                                "user_type": "registered",
                                "display_name": "Khalil Al Hooti"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1525915489,
                            "post_id": 2827475,
                            "comment_id": 87546367,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment87546367_2827475",
                            "body": "you are genius,"
                        },
                        {
                            "owner": {
                                "account_id": 9429389,
                                "reputation": 2651,
                                "user_id": 7013419,
                                "user_type": "registered",
                                "display_name": "PilouPili"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1535797769,
                            "post_id": 2827475,
                            "comment_id": 91204952,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment91204952_2827475",
                            "body": "The most general answer was given by @MK83. Mathematically the angle is given by theta = atan2(u^v, u.v) is python terms angle = np.math.atan2(np.linalg.det([v0,v1]),np.dot(v0,v1))"
                        },
                        {
                            "owner": {
                                "account_id": 3701675,
                                "reputation": 829,
                                "user_id": 3081198,
                                "user_type": "registered",
                                "display_name": "HackerBoss"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1550686606,
                            "post_id": 2827475,
                            "comment_id": 96363657,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#comment96363657_2827475",
                            "body": "Also, it is best to use the approach given by PilouPili, since <code>acos</code> and <code>asin</code> are not numerically stable for some values. Why does nobody teach this anymore?"
                        }
                    ],
                    "owner": {
                        "account_id": 34048,
                        "reputation": 869830,
                        "user_id": 95810,
                        "user_type": "registered",
                        "accept_rate": 80,
                        "display_name": "Alex Martelli"
                    },
                    "comment_count": 13,
                    "is_accepted": true,
                    "score": 78,
                    "last_activity_date": 1459265510,
                    "last_edit_date": 1495535479,
                    "creation_date": 1273760068,
                    "answer_id": 2827475,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/2827475#2827475",
                    "body": "<pre><code>import math\n\ndef dotproduct(v1, v2):\n  return sum((a*b) for a, b in zip(v1, v2))\n\ndef length(v):\n  return math.sqrt(dotproduct(v, v))\n\ndef angle(v1, v2):\n  return math.acos(dotproduct(v1, v2) / (length(v1) * length(v2)))\n</code></pre>\n\n<p><strong>Note</strong>: this will fail when the vectors have either the same or the opposite direction. The correct implementation is here: <a href=\"https://stackoverflow.com/a/13849249/71522\">https://stackoverflow.com/a/13849249/71522</a></p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 90604,
                                "reputation": 86580,
                                "user_id": 249341,
                                "user_type": "registered",
                                "accept_rate": 96,
                                "display_name": "Hooked"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1373903579,
                            "post_id": 13849249,
                            "comment_id": 25718029,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment25718029_13849249",
                            "body": "Wouldn&#39;t it be better to use <code>np.isnan</code> instead of the one from the math library? In theory they should be identical, but I&#39;m not quite sure in practice. Either way I&#39;d imagine it would be safer."
                        },
                        {
                            "owner": {
                                "account_id": 27199,
                                "reputation": 152220,
                                "user_id": 71522,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "David Wolever"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1373904182,
                            "post_id": 13849249,
                            "comment_id": 25718389,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment25718389_13849249",
                            "body": "The only difference is that <code>np.isnan</code> will do something sensible if the input is an array, which will never be the case here. However, using <code>np.isnan</code> would definitely be cleaner (not sure why I used <code>math.isnan</code>\u2026), so I&#39;ll switch that up."
                        },
                        {
                            "owner": {
                                "account_id": 3117612,
                                "reputation": 267,
                                "user_id": 2638048,
                                "user_type": "registered",
                                "display_name": "ene"
                            },
                            "edited": false,
                            "score": 4,
                            "creation_date": 1502957051,
                            "post_id": 13849249,
                            "comment_id": 78416883,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment78416883_13849249",
                            "body": "My numpy (version==1.12.1) can use <code>arccos</code> directly and safely. : In [140]: np.arccos(np.dot(np.array([1,0,0]),np.array([-1,0,0]) )) Out[140]: 3.1415926535897931  In [141]: np.arccos(np.dot(np.array([1,0,0]),np.array([1,0,0]) )) Out[141]: 0.0"
                        },
                        {
                            "owner": {
                                "account_id": 1458764,
                                "reputation": 2860,
                                "user_id": 1373669,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "kafman"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1508328405,
                            "post_id": 13849249,
                            "comment_id": 80566646,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment80566646_13849249",
                            "body": "The special case where at least one input vector is the zero vector is omitted, which is problematic for the division in <code>unit_vector</code>. One possibility is to just return the input vector in this function when this is the case."
                        },
                        {
                            "owner": {
                                "account_id": 1252993,
                                "reputation": 525,
                                "user_id": 1213014,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "DrTchocky"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1558642909,
                            "post_id": 13849249,
                            "comment_id": 99178749,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment99178749_13849249",
                            "body": "If you apply this to an array of vectors that are all positive (including zero), the maximum angle between two vectors is 90 degrees. i&#39;ve tried scaling my data from -1 to 1, but i&#39;m still getting angles strictly between 0 and 90 (instead of 0 and 180)"
                        },
                        {
                            "owner": {
                                "account_id": 10068342,
                                "reputation": 790,
                                "user_id": 7442782,
                                "user_type": "registered",
                                "display_name": "FabioSpaghetti"
                            },
                            "edited": false,
                            "score": 7,
                            "creation_date": 1559640843,
                            "post_id": 13849249,
                            "comment_id": 99475692,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment99475692_13849249",
                            "body": "angle_between((0, 0, 0), (0, 1, 0)) will give nan as result, and not 90"
                        },
                        {
                            "owner": {
                                "account_id": 5300934,
                                "reputation": 5546,
                                "user_id": 4230591,
                                "user_type": "registered",
                                "accept_rate": 61,
                                "display_name": "user"
                            },
                            "reply_to_user": {
                                "account_id": 1458764,
                                "reputation": 2860,
                                "user_id": 1373669,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "kafman"
                            },
                            "edited": false,
                            "score": 5,
                            "creation_date": 1559767295,
                            "post_id": 13849249,
                            "comment_id": 99526924,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment99526924_13849249",
                            "body": "@kafman 0-vectors&#39; angle is undefined (in math). So the fact it raises an error is good."
                        },
                        {
                            "owner": {
                                "account_id": 5300934,
                                "reputation": 5546,
                                "user_id": 4230591,
                                "user_type": "registered",
                                "accept_rate": 61,
                                "display_name": "user"
                            },
                            "reply_to_user": {
                                "account_id": 3117612,
                                "reputation": 267,
                                "user_id": 2638048,
                                "user_type": "registered",
                                "display_name": "ene"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1559767805,
                            "post_id": 13849249,
                            "comment_id": 99527144,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment99527144_13849249",
                            "body": "@ene it can still return <code>nan</code> if you use random unit vectors that happen to have a product of 1. Due to <i>floating-point precision</i> <code>dot()</code> would return <code>1.0000000000000002</code>.  This is true even for version 1.16.1."
                        },
                        {
                            "owner": {
                                "account_id": 3454212,
                                "reputation": 1398,
                                "user_id": 2893053,
                                "user_type": "registered",
                                "accept_rate": 85,
                                "display_name": "zkytony"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1659977554,
                            "post_id": 13849249,
                            "comment_id": 129418436,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment129418436_13849249",
                            "body": "I tried this out, but for v1=np.array([0,0,-1]) and v2=np.array([0,2,-4]), the output is 0. However, the angle between these two vectors is clearly not 0. Am I missing something?"
                        },
                        {
                            "owner": {
                                "account_id": 1172394,
                                "reputation": 313,
                                "user_id": 1149282,
                                "user_type": "registered",
                                "accept_rate": 83,
                                "display_name": "Markus von Broady"
                            },
                            "reply_to_user": {
                                "account_id": 3454212,
                                "reputation": 1398,
                                "user_id": 2893053,
                                "user_type": "registered",
                                "accept_rate": 85,
                                "display_name": "zkytony"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1670891625,
                            "post_id": 13849249,
                            "comment_id": 131974013,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#comment131974013_13849249",
                            "body": "@zkytony I get <code>0.46364760900080615</code> as a result."
                        }
                    ],
                    "owner": {
                        "account_id": 27199,
                        "reputation": 152220,
                        "user_id": 71522,
                        "user_type": "registered",
                        "accept_rate": 62,
                        "display_name": "David Wolever"
                    },
                    "comment_count": 10,
                    "is_accepted": false,
                    "score": 221,
                    "last_activity_date": 1459265441,
                    "last_edit_date": 1459265441,
                    "creation_date": 1355348858,
                    "answer_id": 13849249,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/13849249#13849249",
                    "body": "<p><strong>Note</strong>: all of the other answers here will fail if the two vectors have either the same direction (ex, <code>(1, 0, 0)</code>, <code>(1, 0, 0)</code>) or opposite directions (ex, <code>(-1, 0, 0)</code>, <code>(1, 0, 0)</code>).</p>\n\n<p>Here is a function which will correctly handle these cases:</p>\n\n<pre><code>import numpy as np\n\ndef unit_vector(vector):\n    \"\"\" Returns the unit vector of the vector.  \"\"\"\n    return vector / np.linalg.norm(vector)\n\ndef angle_between(v1, v2):\n    \"\"\" Returns the angle in radians between vectors 'v1' and 'v2'::\n\n            &gt;&gt;&gt; angle_between((1, 0, 0), (0, 1, 0))\n            1.5707963267948966\n            &gt;&gt;&gt; angle_between((1, 0, 0), (1, 0, 0))\n            0.0\n            &gt;&gt;&gt; angle_between((1, 0, 0), (-1, 0, 0))\n            3.141592653589793\n    \"\"\"\n    v1_u = unit_vector(v1)\n    v2_u = unit_vector(v2)\n    return np.arccos(np.clip(np.dot(v1_u, v2_u), -1.0, 1.0))\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 69707,
                        "reputation": 42599,
                        "user_id": 202694,
                        "user_type": "registered",
                        "accept_rate": 88,
                        "display_name": "Pace"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1363130206,
                    "creation_date": 1363130206,
                    "answer_id": 15374115,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/15374115#15374115",
                    "body": "<p>Using numpy and taking care of BandGap's rounding errors:</p>\n\n<pre><code>from numpy.linalg import norm\nfrom numpy import dot\nimport math\n\ndef angle_between(a,b):\n  arccosInput = dot(a,b)/norm(a)/norm(b)\n  arccosInput = 1.0 if arccosInput &gt; 1.0 else arccosInput\n  arccosInput = -1.0 if arccosInput &lt; -1.0 else arccosInput\n  return math.acos(arccosInput)\n</code></pre>\n\n<p>Note, this function will throw an exception if one of the vectors has zero magnitude (divide by 0).</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 9429389,
                                "reputation": 2651,
                                "user_id": 7013419,
                                "user_type": "registered",
                                "display_name": "PilouPili"
                            },
                            "edited": false,
                            "score": 9,
                            "creation_date": 1535797958,
                            "post_id": 35134034,
                            "comment_id": 91205003,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/35134034#comment91205003_35134034",
                            "body": "This is the best answer as it is exactly the mathematical expression theta = atan2(u^v, u.v). And this never fails !"
                        },
                        {
                            "owner": {
                                "account_id": 4131028,
                                "reputation": 9356,
                                "user_id": 3388962,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "normanius"
                            },
                            "edited": false,
                            "score": 5,
                            "creation_date": 1574035147,
                            "post_id": 35134034,
                            "comment_id": 104075430,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/35134034#comment104075430_35134034",
                            "body": "This is for 2-D. The OP was asking for n-D"
                        },
                        {
                            "owner": {
                                "account_id": 2864316,
                                "reputation": 1711,
                                "user_id": 2458922,
                                "user_type": "registered",
                                "accept_rate": 0,
                                "display_name": "user2458922"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1678550878,
                            "post_id": 35134034,
                            "comment_id": 133556088,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/35134034#comment133556088_35134034",
                            "body": "I used Right Angle Triangle as  &gt;&gt;&gt; p0, p1, p2 = [0, 0], [0, 3], [4, 0] &gt;&gt;&gt; v1 = np.array(p2) - np.array(p1) &gt;&gt;&gt; v0 = np.array(p0) - np.array(p1) &gt;&gt;&gt; angle = np.math.atan2(np.linalg.det([v0,v1]),np.dot(v0,v1)) &gt;&gt;&gt; angle 0.9272952180016122 &gt;&gt;&gt; np.degrees(angle) 53.13010235415598 .. Expected Angles in the triangles as 30,60,90 , not 53 &gt;&gt;&gt;"
                        },
                        {
                            "owner": {
                                "account_id": 1164731,
                                "reputation": 1429,
                                "user_id": 1143539,
                                "user_type": "registered",
                                "accept_rate": 25,
                                "display_name": "Roobie Nuby"
                            },
                            "reply_to_user": {
                                "account_id": 2864316,
                                "reputation": 1711,
                                "user_id": 2458922,
                                "user_type": "registered",
                                "accept_rate": 0,
                                "display_name": "user2458922"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1689965027,
                            "post_id": 35134034,
                            "comment_id": 135292352,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/35134034#comment135292352_35134034",
                            "body": "@user2458922 a 3,4,5 right triangle is NOT a 30-60-90 triangle. The 30-60-90 triangle has sides 1, sqrt(3) and hypotenuse 2."
                        },
                        {
                            "owner": {
                                "account_id": 2864316,
                                "reputation": 1711,
                                "user_id": 2458922,
                                "user_type": "registered",
                                "accept_rate": 0,
                                "display_name": "user2458922"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1689970409,
                            "post_id": 35134034,
                            "comment_id": 135293144,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/35134034#comment135293144_35134034",
                            "body": "Given X,Y as [0,0],[0,3],[4,0] .. If would form a Triangle of Angles 30,60,90. Since one of the angle is 90, its right angle triangle. I am sorry, I didt understand  why &#39;a 3,4,5 right triangle is NOT a 30-60-90 triangle&#39; ?"
                        },
                        {
                            "owner": {
                                "account_id": 15422087,
                                "reputation": 593,
                                "user_id": 12131616,
                                "user_type": "registered",
                                "display_name": "Puco4"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1712927716,
                            "post_id": 35134034,
                            "comment_id": 138070103,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/35134034#comment138070103_35134034",
                            "body": "<a href=\"https://stackoverflow.com/a/78316216/12131616\">Below</a> I have posted an answer that vectorizes this solution for any n-dimensional array."
                        }
                    ],
                    "owner": {
                        "account_id": 7642424,
                        "reputation": 1902,
                        "user_id": 5794123,
                        "user_type": "registered",
                        "display_name": "MK83"
                    },
                    "comment_count": 6,
                    "is_accepted": false,
                    "score": 44,
                    "last_activity_date": 1454339868,
                    "creation_date": 1454339868,
                    "answer_id": 35134034,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/35134034#35134034",
                    "body": "<p>The other possibility is using just <code>numpy</code> and it gives you the interior angle</p>\n\n<pre><code>import numpy as np\n\np0 = [3.5, 6.7]\np1 = [7.9, 8.4]\np2 = [10.8, 4.8]\n\n''' \ncompute angle (in degrees) for p0p1p2 corner\nInputs:\n    p0,p1,p2 - points in the form of [x,y]\n'''\n\nv0 = np.array(p0) - np.array(p1)\nv1 = np.array(p2) - np.array(p1)\n\nangle = np.math.atan2(np.linalg.det([v0,v1]),np.dot(v0,v1))\nprint np.degrees(angle)\n</code></pre>\n\n<p>and here is the output:</p>\n\n<pre><code>In [2]: p0, p1, p2 = [3.5, 6.7], [7.9, 8.4], [10.8, 4.8]\n\nIn [3]: v0 = np.array(p0) - np.array(p1)\n\nIn [4]: v1 = np.array(p2) - np.array(p1)\n\nIn [5]: v0\nOut[5]: array([-4.4, -1.7])\n\nIn [6]: v1\nOut[6]: array([ 2.9, -3.6])\n\nIn [7]: angle = np.math.atan2(np.linalg.det([v0,v1]),np.dot(v0,v1))\n\nIn [8]: angle\nOut[8]: 1.8802197318858924\n\nIn [9]: np.degrees(angle)\nOut[9]: 107.72865519428085\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 480090,
                        "reputation": 17100,
                        "user_id": 893113,
                        "user_type": "registered",
                        "accept_rate": 81,
                        "display_name": "paulmelnikow"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 10,
                    "last_activity_date": 1554384588,
                    "creation_date": 1554384588,
                    "answer_id": 55517239,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/55517239#55517239",
                    "body": "<p>If you're working with 3D vectors, you can do this concisely using the toolbelt <a href=\"https://github.com/lace/vg\" rel=\"noreferrer\">vg</a>. It's a light layer on top of numpy.</p>\n\n<pre><code>import numpy as np\nimport vg\n\nvec1 = np.array([1, 2, 3])\nvec2 = np.array([7, 8, 9])\n\nvg.angle(vec1, vec2)\n</code></pre>\n\n<p>You can also specify a viewing angle to compute the angle via projection:</p>\n\n<pre><code>vg.angle(vec1, vec2, look=vg.basis.z)\n</code></pre>\n\n<p>Or compute the signed angle via projection:</p>\n\n<pre><code>vg.signed_angle(vec1, vec2, look=vg.basis.z)\n</code></pre>\n\n<p>I created the library at my last startup, where it was motivated by uses like this: simple ideas which are verbose or opaque in NumPy.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 11279676,
                        "reputation": 2366,
                        "user_id": 8272600,
                        "user_type": "registered",
                        "display_name": "Julio Cezar Silva"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1558821830,
                    "last_edit_date": 1558821830,
                    "creation_date": 1555808033,
                    "answer_id": 55779008,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/55779008#55779008",
                    "body": "<p>For the few who may have (due to SEO complications) ended here trying to calculate the angle between two <em>lines</em> in python, as in <code>(x0, y0), (x1, y1)</code> geometrical lines, there is the below <em>minimal</em> solution (uses the <code>shapely</code> module, but can be easily modified not to):</p>\n\n<pre><code>from shapely.geometry import LineString\nimport numpy as np\n\nninety_degrees_rad = 90.0 * np.pi / 180.0\n\ndef angle_between(line1, line2):\n    coords_1 = line1.coords\n    coords_2 = line2.coords\n\n    line1_vertical = (coords_1[1][0] - coords_1[0][0]) == 0.0\n    line2_vertical = (coords_2[1][0] - coords_2[0][0]) == 0.0\n\n    # Vertical lines have undefined slope, but we know their angle in rads is = 90\u00b0 * \u03c0/180\n    if line1_vertical and line2_vertical:\n        # Perpendicular vertical lines\n        return 0.0\n    if line1_vertical or line2_vertical:\n        # 90\u00b0 - angle of non-vertical line\n        non_vertical_line = line2 if line1_vertical else line1\n        return abs((90.0 * np.pi / 180.0) - np.arctan(slope(non_vertical_line)))\n\n    m1 = slope(line1)\n    m2 = slope(line2)\n\n    return np.arctan((m1 - m2)/(1 + m1*m2))\n\ndef slope(line):\n    # Assignments made purely for readability. One could opt to just one-line return them\n    x0 = line.coords[0][0]\n    y0 = line.coords[0][1]\n    x1 = line.coords[1][0]\n    y1 = line.coords[1][1]\n    return (y1 - y0) / (x1 - x0)\n</code></pre>\n\n<p>And the use would be</p>\n\n<pre><code>&gt;&gt;&gt; line1 = LineString([(0, 0), (0, 1)]) # vertical\n&gt;&gt;&gt; line2 = LineString([(0, 0), (1, 0)]) # horizontal\n&gt;&gt;&gt; angle_between(line1, line2)\n1.5707963267948966\n&gt;&gt;&gt; np.degrees(angle_between(line1, line2))\n90.0\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 6834291,
                        "reputation": 564,
                        "user_id": 5256923,
                        "user_type": "registered",
                        "display_name": "sgt pepper"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 5,
                    "last_activity_date": 1560093874,
                    "creation_date": 1560093874,
                    "answer_id": 56515845,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/56515845#56515845",
                    "body": "<p><a href=\"https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python#answer-13849249\">David Wolever's solution</a> is good, but</p>\n\n<p>If you want to have <strong>signed angles</strong> you have to determine if a given pair is right or left handed (see <a href=\"https://en.wikipedia.org/wiki/Orientation_(vector_space)\" rel=\"noreferrer\">wiki</a> for further info).</p>\n\n<p>My solution for this is:</p>\n\n<pre><code>def unit_vector(vector):\n    \"\"\" Returns the unit vector of the vector\"\"\"\n    return vector / np.linalg.norm(vector)\n\ndef angle(vector1, vector2):\n    \"\"\" Returns the angle in radians between given vectors\"\"\"\n    v1_u = unit_vector(vector1)\n    v2_u = unit_vector(vector2)\n    minor = np.linalg.det(\n        np.stack((v1_u[-2:], v2_u[-2:]))\n    )\n    if minor == 0:\n        raise NotImplementedError('Too odd vectors =(')\n    return np.sign(minor) * np.arccos(np.clip(np.dot(v1_u, v2_u), -1.0, 1.0))\n</code></pre>\n\n<p>It's not perfect because of this <code>NotImplementedError</code> but for my case it works well. This behaviour could be fixed (cause handness is determined for any given pair) but it takes more code that I want and have to write.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 45487,
                        "reputation": 8737,
                        "user_id": 134077,
                        "user_type": "registered",
                        "accept_rate": 30,
                        "display_name": "crizCraig"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1578957969,
                    "last_edit_date": 1578957969,
                    "creation_date": 1578953135,
                    "answer_id": 59724848,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/59724848#59724848",
                    "body": "<p>Building on sgt pepper's <a href=\"https://stackoverflow.com/a/56515845/134077\">great answer</a> and adding support for aligned vectors plus adding a speedup of over 2x using Numba</p>\n\n<pre><code>@njit(cache=True, nogil=True)\ndef angle(vector1, vector2):\n    \"\"\" Returns the angle in radians between given vectors\"\"\"\n    v1_u = unit_vector(vector1)\n    v2_u = unit_vector(vector2)\n    minor = np.linalg.det(\n        np.stack((v1_u[-2:], v2_u[-2:]))\n    )\n    if minor == 0:\n        sign = 1\n    else:\n        sign = -np.sign(minor)\n    dot_p = np.dot(v1_u, v2_u)\n    dot_p = min(max(dot_p, -1.0), 1.0)\n    return sign * np.arccos(dot_p)\n\n@njit(cache=True, nogil=True)\ndef unit_vector(vector):\n    \"\"\" Returns the unit vector of the vector.  \"\"\"\n    return vector / np.linalg.norm(vector)\n\ndef test_angle():\n    def npf(x):\n        return np.array(x, dtype=float)\n    assert np.isclose(angle(npf((1, 1)), npf((1,  0))),  pi / 4)\n    assert np.isclose(angle(npf((1, 0)), npf((1,  1))), -pi / 4)\n    assert np.isclose(angle(npf((0, 1)), npf((1,  0))),  pi / 2)\n    assert np.isclose(angle(npf((1, 0)), npf((0,  1))), -pi / 2)\n    assert np.isclose(angle(npf((1, 0)), npf((1,  0))),  0)\n    assert np.isclose(angle(npf((1, 0)), npf((-1, 0))),  pi)\n</code></pre>\n\n<p><code>%%timeit</code> results without Numba</p>\n\n<ul>\n<li>359 \u00b5s \u00b1 2.86 <strong>\u00b5s</strong> per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)</li>\n</ul>\n\n<p>And with</p>\n\n<ul>\n<li>151 \u00b5s \u00b1 820 <strong>ns</strong> per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)</li>\n</ul>\n"
                },
                {
                    "owner": {
                        "account_id": 9321858,
                        "reputation": 624,
                        "user_id": 6920365,
                        "user_type": "registered",
                        "display_name": "Kevin Patel"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 8,
                    "last_activity_date": 1586092522,
                    "creation_date": 1586092522,
                    "answer_id": 61043203,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/61043203#61043203",
                    "body": "<p>Easy way to find angle between two vectors(works for n-dimensional vector),</p>\n\n<p>Python code:</p>\n\n<pre><code>import numpy as np\n\nvector1 = [1,0,0]\nvector2 = [0,1,0]\n\nunit_vector1 = vector1 / np.linalg.norm(vector1)\nunit_vector2 = vector2 / np.linalg.norm(vector2)\n\ndot_product = np.dot(unit_vector1, unit_vector2)\n\nangle = np.arccos(dot_product) #angle in radian\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 21398120,
                        "reputation": 21,
                        "user_id": 15760818,
                        "user_type": "registered",
                        "display_name": "Eugenio X"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 2,
                    "last_activity_date": 1619356106,
                    "last_edit_date": 1619356106,
                    "creation_date": 1619354104,
                    "answer_id": 67253470,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/67253470#67253470",
                    "body": "<p>Use some functions from numpy.</p>\n<pre><code>import numpy as np\n\ndef dot_product_angle(v1,v2):\n\n    if np.linalg.norm(v1) == 0 or np.linalg.norm(v2) == 0:\n        print(&quot;Zero magnitude vector!&quot;)\n    else:\n        vector_dot_product = np.dot(v1,v2)\n        arccos = np.arccos(vector_dot_product / (np.linalg.norm(v1) * np.linalg.norm(v2)))\n        angle = np.degrees(arccos)\n        return angle\n    return 0\n</code></pre>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 3454212,
                                "reputation": 1398,
                                "user_id": 2893053,
                                "user_type": "registered",
                                "accept_rate": 85,
                                "display_name": "zkytony"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1659977544,
                            "post_id": 70789545,
                            "comment_id": 129418434,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/70789545#comment129418434_70789545",
                            "body": "I tried this out, but for v1=np.array([0,0,-1]) and v2=np.array([0,2,-4]), the output is 0. However, the angle between these two vectors is clearly not 0. Am I missing something?"
                        },
                        {
                            "owner": {
                                "account_id": 299281,
                                "reputation": 6772,
                                "user_id": 605790,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "faken"
                            },
                            "reply_to_user": {
                                "account_id": 3454212,
                                "reputation": 1398,
                                "user_id": 2893053,
                                "user_type": "registered",
                                "accept_rate": 85,
                                "display_name": "zkytony"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1660066620,
                            "post_id": 70789545,
                            "comment_id": 129443494,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/70789545#comment129443494_70789545",
                            "body": "@zkytony I tested the values you suggested for v1 and v2, and the function is returning the correct result. Check here: <a href=\"https://imgur.com/a/EKTnBny\" rel=\"nofollow noreferrer\">imgur.com/a/EKTnBny</a> Maybe you passed the incorrect variables to the function?"
                        },
                        {
                            "owner": {
                                "account_id": 299281,
                                "reputation": 6772,
                                "user_id": 605790,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "faken"
                            },
                            "reply_to_user": {
                                "account_id": 3454212,
                                "reputation": 1398,
                                "user_id": 2893053,
                                "user_type": "registered",
                                "accept_rate": 85,
                                "display_name": "zkytony"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1660067187,
                            "post_id": 70789545,
                            "comment_id": 129443669,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/70789545#comment129443669_70789545",
                            "body": "@zkytony here&#39;s the notebook: <a href=\"https://gist.github.com/nunofachada/8cbe6ab7f856ae492a7587f3bbdc96f1\" rel=\"nofollow noreferrer\">gist.github.com/nunofachada/8cbe6ab7f856ae492a7587f3bbdc96f1</a>"
                        }
                    ],
                    "owner": {
                        "account_id": 299281,
                        "reputation": 6772,
                        "user_id": 605790,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "faken"
                    },
                    "comment_count": 3,
                    "is_accepted": false,
                    "score": 4,
                    "last_activity_date": 1642694793,
                    "creation_date": 1642694793,
                    "answer_id": 70789545,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/70789545#70789545",
                    "body": "<p>The traditional approach to obtaining an angle between two vectors (i.e. <code>arccos(dot(u, v) / (norm(u) * norm(v)))</code>, as presented in the other answers) suffers from numerical instability in several corner cases. The following code works for <em>n</em>-dimensions and in all corner cases (it doesn't check for zero length vectors, but that's easy to add, as shown in some of the other answers). See notes below.</p>\n<pre class=\"lang-py prettyprint-override\"><code>from numpy import arctan, pi, signbit\nfrom numpy.linalg import norm\n\n\ndef angle_btw(v1, v2):\n    u1 = v1 / norm(v1)\n    u2 = v2 / norm(v2)\n\n    y = u1 - u2\n    x = u1 + u2\n\n    a0 = 2 * arctan(norm(y) / norm(x))\n\n    if (not signbit(a0)) or signbit(pi - a0):\n        return a0\n    elif signbit(a0):\n        return 0.0\n    else:\n        return pi\n</code></pre>\n<p>This code is adapted from a <a href=\"https://github.com/JeffreySarnoff/AngleBetweenVectors.jl\" rel=\"nofollow noreferrer\">Julia implementation</a> by Jeffrey Sarnoff (MIT license), in turn based on <a href=\"https://people.eecs.berkeley.edu/%7Ewkahan/MathH110/Cross.pdf\" rel=\"nofollow noreferrer\">these notes</a> by Prof. W. Kahan (page 15).</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": -1,
                                "reputation": 1,
                                "user_id": -1,
                                "user_type": "moderator",
                                "display_name": "Community"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1679127039,
                            "post_id": 75729949,
                            "comment_id": 133668341,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/75729949#comment133668341_75729949",
                            "body": "Your answer could be improved with additional supporting information. Please <a href=\"https://stackoverflow.com/posts/75729949/edit\">edit</a> to add further details, such as citations or documentation, so that others can confirm that your answer is correct. You can find more information on how to write good answers <a href=\"/help/how-to-answer\">in the help center</a>."
                        }
                    ],
                    "owner": {
                        "account_id": 5749689,
                        "reputation": 35,
                        "user_id": 4539785,
                        "user_type": "registered",
                        "accept_rate": 25,
                        "display_name": "Ahmad Kandil"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1678777550,
                    "last_edit_date": 1678777550,
                    "creation_date": 1678777240,
                    "answer_id": 75729949,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/75729949#75729949",
                    "body": "<pre><code>import math\n</code></pre>\n<p>ax, ay = input('Enter x and y of vector a: ').split()</p>\n<p>ax, ay = float(ax), float(ay)</p>\n<p>bx, by = input('Enter x and y of vector b: ').split()</p>\n<p>bx, by = float(bx), float(by)</p>\n<p>ab = ax * bx + ay * by</p>\n<p>a = math.sqrt(ax * ax + ay * ay)</p>\n<p>b = math.sqrt(bx * bx + by * by)</p>\n<p>cos = ab / (a*b)</p>\n<p>rad = math.acos(cos)</p>\n<p>deg = math.degrees(rad)</p>\n<p>print (f'\u03b8 = {deg}')</p>\n"
                },
                {
                    "owner": {
                        "account_id": 1164731,
                        "reputation": 1429,
                        "user_id": 1143539,
                        "user_type": "registered",
                        "accept_rate": 25,
                        "display_name": "Roobie Nuby"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1689969230,
                    "last_edit_date": 1689969230,
                    "creation_date": 1689968665,
                    "answer_id": 76740833,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/76740833#76740833",
                    "body": "<p>The OP was asking for n-dimensions n&gt;2, but many people will end up here for a two dimensional problem, so I want to clarify the best solution for that special case.</p>\n<p>The proposed solutions all use the arccosine function (other than MK83 and faken) and so, are all very inaccurate and prone to error for angles near 0 or 180 degrees. That is because very large changes in angle cause almost no change in the cosine of the angle at those values.</p>\n<p>A second problem with <code>arccos</code> (for the two dimensional case) is that it can not distinguish between a positive angle and a negative angle. So the angle between (0,1) and (1,0) will be the same as that between (1,0) and (0,1) although the first angle should be 90 and the second -90 degrees.</p>\n<p>faken has an excellent answer to to OPs multidimensional problem that avoids the use of <code>arccos</code>, and so is accurate over the whole range.</p>\n<p>MK83 solves the 2 dimensional problem using <code>atan2</code>which is a function that is provided for this exact problem. The answers range from -180 degrees to 180 degrees. I propose a solution here only for two dimensions, which is simpler and faster than MK83</p>\n<pre><code>def angle(a, b, c=None):\n    &quot;&quot;&quot; This function computes angle between vector A and vector B when C is None\n        and the angle between AC and CB, when C is a vector as well.\n        All vectors must be two dimensional.\n    &quot;&quot;&quot;\n    if c is None:\n        angles = np.arctan2([a[1], b[1]], [a[0], b[0]]])\n    else:\n        angles = np.arctan2([a[1]-c[1], b[1]-c[1]], [a[0]-c[0], b[0]-c[0]])\n    return np.degrees(angles[1] - angles[0])\n</code></pre>\n<p>This is about three times faster than MK83's solution.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 354839,
                                "reputation": 379,
                                "user_id": 693429,
                                "user_type": "registered",
                                "display_name": "markgalassi"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1708100573,
                            "post_id": 76970618,
                            "comment_id": 137525179,
                            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/76970618#comment137525179_76970618",
                            "body": "Nice succinct way of putting it, but you might want to fix a couple of typos: (a) second line should be _nv; (b) line 3 you should multiply the result by 2"
                        }
                    ],
                    "owner": {
                        "account_id": 11381172,
                        "reputation": 25942,
                        "user_id": 8344060,
                        "user_type": "registered",
                        "display_name": "kvantour"
                    },
                    "comment_count": 1,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1708103938,
                    "last_edit_date": 1708103938,
                    "creation_date": 1692889321,
                    "answer_id": 76970618,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/76970618#76970618",
                    "body": "<p>Given two vectors <code>vec(u)</code> and <code>vec(v)</code>, then it can be shown that the following formul is the most numerically stable solution:</p>\n<pre><code>2 * atan ( norm(norm(u) * v - norm(v) * u)/norm(norm(u) * v + norm(v) * u) )\n</code></pre>\n<p>The benefits of this formula over any of:</p>\n<pre><code>acos(dot_product(u,v)/(norm(u)*norm(v)))\nasin(norm(cross_product(u,v))/(norm(u)*norm(v)))\n</code></pre>\n<p>are:</p>\n<ol>\n<li><code>atan</code> is numerically stable for small angles. The <code>acos</code> function is not as <code>cos(th) ~ 1 - 0.5*th^2</code> for small angles</li>\n<li><code>atan</code> is numerically stable for angles around Pi/2. As the formula computes the half-angle, it corresponds to the angle Pi for the formula using the cross-product. Under these conditions, the cross-product computation is unstable and hence then formula using <code>asin</code> is unstable.</li>\n</ol>\n<p>One could pre-normalize the vectors <code>u</code> and <code>v</code> and use the form:</p>\n<pre><code>2 * atan ( norm(v - u)/norm(v + u) )\n</code></pre>\n<p>however, a division actually looses numeric accuracy. In this case this loss of precision would appear in the normalizations and the final division.</p>\n<p>Hence, implementation wise, we should use the classic <code>atan2</code> function which avoids another division. Hence, we achieve the best numeric stable solution.</p>\n<p>So, using numpy, the implementation is straightforward:</p>\n<pre><code>_nu = numpy.linalg.norm(u)\n_nv = numpy.linalg.norm(v)\n2.0 * numpy.arctan2( numpy.linalg.norm( u * _nv - v * _nu),\n                     numpy.linalg.norm( u * _nv + v * _nu))\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 15422087,
                        "reputation": 593,
                        "user_id": 12131616,
                        "user_type": "registered",
                        "display_name": "Puco4"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1712927576,
                    "last_edit_date": 1712927576,
                    "creation_date": 1712924192,
                    "answer_id": 78316216,
                    "question_id": 2827393,
                    "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python/78316216#78316216",
                    "body": "<p>There are numerous solutions to this question, yet none employ a <strong>simple expression using <code>numpy</code> capable of handling n-dimensional arrays across any axis</strong>, as given by:</p>\n<pre class=\"lang-py prettyprint-override\"><code>import numpy as np\ndef angle(vec_0, vec_1, axis):\n    return np.arctan2(np.cross(vec_0, vec_1, axis = axis), np.sum(vec_0*vec_1, axis = axis))\n</code></pre>\n<hr />\n<p><strong>Example</strong></p>\n<p>We select points on a grid and draw two vectors at each point: one in black and the other in grey. Then, we calculate the angle between the black and grey vectors, and plot the points colored according to this angle.</p>\n<pre class=\"lang-py prettyprint-override\"><code>#Define grid of N*N\nN = 4\nrng = np.random.default_rng(10)\n\npos =  np.array(np.meshgrid(np.linspace(0,1,N),np.linspace(0,1,N), indexing = 'ij')).T\nvec_black = rng.uniform(-1, 1, (N*N, 2))\nvec_grey = rng.uniform(-1, 1, (N*N, 2))\ntheta_black_grey = angle(vec_black, vec_grey, axis=-1)\n\nimport matplotlib.pyplot as plt\nwidth = 0.008\nscale = 8\nplt.figure()\nplt.quiver(*pos.T, *vec_black.T, color = 'k', width = width, scale = scale)\nplt.quiver(*pos.T, *vec_grey.T, color = 'grey', width = width, scale = scale)\nplt.scatter(*pos.T, c=theta_black_grey,  cmap ='hsv', vmin=-np.pi, vmax = np.pi)\nplt.xlim([-0.3,1.3])\nplt.ylim([-0.3,1.3])\nplt.colorbar(label='Angle (black arrow, grey arrow)')\n</code></pre>\n<p>Output:\n<a href=\"https://i.stack.imgur.com/PolMB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PolMB.png\" alt=\"enter image description here\" /></a></p>\n"
                }
            ],
            "owner": {
                "account_id": 612743,
                "reputation": 1223,
                "user_id": 340342,
                "user_type": "unregistered",
                "display_name": "Peter"
            },
            "comment_count": 1,
            "is_answered": true,
            "accepted_answer_id": 2827475,
            "answer_count": 16,
            "score": 122,
            "last_activity_date": 1712927576,
            "creation_date": 1273759581,
            "last_edit_date": 1453862704,
            "question_id": 2827393,
            "link": "https://stackoverflow.com/questions/2827393/angles-between-two-n-dimensional-vectors-in-python",
            "title": "Angles between two n-dimensional vectors in Python",
            "body": "<p>I need to determine the angle(s) between two n-dimensional vectors in Python. For example, the input can be two lists like the following: <code>[1,2,3,4]</code> and <code>[6,7,8,9]</code>.</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 8455
}