{
    "items": [
        {
            "tags": [
                "python",
                "http",
                "progress-bar",
                "urllib2",
                "httpclient"
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 128587,
                                "reputation": 5985,
                                "user_id": 326544,
                                "user_type": "registered",
                                "accept_rate": 97,
                                "display_name": "Zac Brown"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1287865471,
                            "post_id": 2028704,
                            "comment_id": 4291840,
                            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2028704#comment4291840_2028704",
                            "body": "Only thing is, I think the last line  should be <i>print &quot;Read %s bytes&quot;%len(<b>data_list</b>)</i>"
                        },
                        {
                            "owner": {
                                "account_id": 4581,
                                "reputation": 87548,
                                "user_id": 6946,
                                "user_type": "registered",
                                "accept_rate": 89,
                                "display_name": "Anurag Uniyal"
                            },
                            "reply_to_user": {
                                "account_id": 128587,
                                "reputation": 5985,
                                "user_id": 326544,
                                "user_type": "registered",
                                "accept_rate": 97,
                                "display_name": "Zac Brown"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1287890573,
                            "post_id": 2028704,
                            "comment_id": 4293365,
                            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2028704#comment4293365_2028704",
                            "body": "@Zachary Brown , No because I am just printing how much data is being read each time, though better would be to print total data read, but still it wouldn&#39;t be len(data_list)"
                        }
                    ],
                    "owner": {
                        "account_id": 4581,
                        "reputation": 87548,
                        "user_id": 6946,
                        "user_type": "registered",
                        "accept_rate": 89,
                        "display_name": "Anurag Uniyal"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 12,
                    "last_activity_date": 1262966144,
                    "last_edit_date": 1262966144,
                    "creation_date": 1262965684,
                    "answer_id": 2028704,
                    "question_id": 2028517,
                    "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2028704#2028704",
                    "body": "<p>Why not just read data in chunks and do whatever you want to do in between, e.g. run in a thread, hook into a UI, etc etc</p>\n\n<pre><code>import urllib2\n\nurlfile = urllib2.urlopen(\"http://www.google.com\")\n\ndata_list = []\nchunk = 4096\nwhile 1:\n    data = urlfile.read(chunk)\n    if not data:\n        print \"done.\"\n        break\n    data_list.append(data)\n    print \"Read %s bytes\"%len(data)\n</code></pre>\n\n<p><strong>output</strong>:</p>\n\n<pre><code>Read 4096 bytes\nRead 3113 bytes\ndone.\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 10930,
                        "reputation": 788893,
                        "user_id": 20862,
                        "user_type": "registered",
                        "accept_rate": 50,
                        "display_name": "Ignacio Vazquez-Abrams"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 5,
                    "last_activity_date": 1297127453,
                    "last_edit_date": 1297127453,
                    "creation_date": 1262965982,
                    "answer_id": 2028745,
                    "question_id": 2028517,
                    "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2028745#2028745",
                    "body": "<p><a href=\"http://urlgrabber.baseurl.org/\" rel=\"noreferrer\">urlgrabber</a> has built-in support for progress notification.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 83606,
                                "reputation": 15918,
                                "user_id": 234270,
                                "user_type": "registered",
                                "accept_rate": 70,
                                "display_name": "speedplane"
                            },
                            "edited": false,
                            "score": 3,
                            "creation_date": 1263189214,
                            "post_id": 2030027,
                            "comment_id": 1965804,
                            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2030027#comment1965804_2030027",
                            "body": "Thats great, for downloading. Is there something similar for uploading? (i.e. writing large amounts of post data?)"
                        },
                        {
                            "owner": {
                                "account_id": 128587,
                                "reputation": 5985,
                                "user_id": 326544,
                                "user_type": "registered",
                                "accept_rate": 97,
                                "display_name": "Zac Brown"
                            },
                            "reply_to_user": {
                                "account_id": 18698,
                                "reputation": 209948,
                                "user_id": 43089,
                                "user_type": "registered",
                                "accept_rate": 50,
                                "display_name": "Kenan Banks"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1291305631,
                            "post_id": 2030027,
                            "comment_id": 4714516,
                            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2030027#comment4714516_2030027",
                            "body": "where exactly does this download your file to? I can&#39;t seem to find it."
                        },
                        {
                            "owner": {
                                "account_id": 98473,
                                "reputation": 23691,
                                "user_id": 266535,
                                "user_type": "registered",
                                "accept_rate": 91,
                                "display_name": "styfle"
                            },
                            "reply_to_user": {
                                "account_id": 128587,
                                "reputation": 5985,
                                "user_id": 326544,
                                "user_type": "registered",
                                "accept_rate": 97,
                                "display_name": "Zac Brown"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1305864839,
                            "post_id": 2030027,
                            "comment_id": 7025502,
                            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2030027#comment7025502_2030027",
                            "body": "@Zachary As far as I can tell, this isn&#39;t &#39;saving&#39; a file; it&#39;s opening a url. To save the file you would do <code>file = open(&#39;myfile.html&#39;, &#39;wb&#39;)</code> then <code>file.write(response.read())</code>"
                        },
                        {
                            "owner": {
                                "account_id": 89800,
                                "reputation": 63305,
                                "user_id": 247542,
                                "user_type": "registered",
                                "accept_rate": 59,
                                "display_name": "Cerin"
                            },
                            "edited": false,
                            "score": 2,
                            "creation_date": 1387034793,
                            "post_id": 2030027,
                            "comment_id": 30794962,
                            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2030027#comment30794962_2030027",
                            "body": "Note, a response doesn&#39;t always include the &quot;Content-Length&quot; header. This will fail for servers that don&#39;t support it."
                        },
                        {
                            "owner": {
                                "account_id": 310851,
                                "reputation": 13200,
                                "user_id": 624066,
                                "user_type": "registered",
                                "accept_rate": 100,
                                "display_name": "MestreLion"
                            },
                            "reply_to_user": {
                                "account_id": 98473,
                                "reputation": 23691,
                                "user_id": 266535,
                                "user_type": "registered",
                                "accept_rate": 91,
                                "display_name": "styfle"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1402138407,
                            "post_id": 2030027,
                            "comment_id": 37166580,
                            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2030027#comment37166580_2030027",
                            "body": "@styfle: actually, it&#39;s opening an URL and <i>discarding</i> its bytes. And a <code>responde.read()</code> would defeat the whole point of a periodic progress report."
                        }
                    ],
                    "owner": {
                        "account_id": 18698,
                        "reputation": 209948,
                        "user_id": 43089,
                        "user_type": "registered",
                        "accept_rate": 50,
                        "display_name": "Kenan Banks"
                    },
                    "comment_count": 5,
                    "is_accepted": true,
                    "score": 42,
                    "last_activity_date": 1262993136,
                    "last_edit_date": 1262993136,
                    "creation_date": 1262977883,
                    "answer_id": 2030027,
                    "question_id": 2028517,
                    "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/2030027#2030027",
                    "body": "<p>Here's a fully working example that builds on Anurag's approach of chunking in a response. My version allows you to set the the chunk size, and attach an arbitrary reporting function:</p>\n\n<pre><code>import urllib2, sys\n\ndef chunk_report(bytes_so_far, chunk_size, total_size):\n   percent = float(bytes_so_far) / total_size\n   percent = round(percent*100, 2)\n   sys.stdout.write(\"Downloaded %d of %d bytes (%0.2f%%)\\r\" % \n       (bytes_so_far, total_size, percent))\n\n   if bytes_so_far &gt;= total_size:\n      sys.stdout.write('\\n')\n\ndef chunk_read(response, chunk_size=8192, report_hook=None):\n   total_size = response.info().getheader('Content-Length').strip()\n   total_size = int(total_size)\n   bytes_so_far = 0\n\n   while 1:\n      chunk = response.read(chunk_size)\n      bytes_so_far += len(chunk)\n\n      if not chunk:\n         break\n\n      if report_hook:\n         report_hook(bytes_so_far, chunk_size, total_size)\n\n   return bytes_so_far\n\nif __name__ == '__main__':\n   response = urllib2.urlopen('http://www.ebay.com');\n   chunk_read(response, report_hook=chunk_report)\n</code></pre>\n"
                },
                {
                    "owner": {
                        "user_type": "does_not_exist",
                        "display_name": "user4459011"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1421349738,
                    "creation_date": 1421349738,
                    "answer_id": 27971337,
                    "question_id": 2028517,
                    "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/27971337#27971337",
                    "body": "<h2>Simplified version:</h2>\n\n<pre><code>temp_filename = \"/tmp/\" + file_url.split('/')[-1]\nf = open(temp_filename, 'wb')\nremote_file = urllib2.urlopen(file_url)\n\ntry:\n    total_size = remote_file.info().getheader('Content-Length').strip()\n    header = True\nexcept AttributeError:\n    header = False # a response doesn't always include the \"Content-Length\" header\n\nif header:\n    total_size = int(total_size)\n\nbytes_so_far = 0\n\nwhile True:\n    buffer = remote_file.read(8192)\n    if not buffer:\n        sys.stdout.write('\\n')\n        break\n\n    bytes_so_far += len(buffer)\n    f.write(buffer)\n    if not header:\n        total_size = bytes_so_far # unknown size\n\n    percent = float(bytes_so_far) / total_size\n    percent = round(percent*100, 2)\n    sys.stdout.write(\"Downloaded %d of %d bytes (%0.2f%%)\\r\" % (bytes_so_far, total_size, percent))\n</code></pre>\n"
                },
                {
                    "owner": {
                        "account_id": 2809220,
                        "reputation": 21,
                        "user_id": 2415824,
                        "user_type": "registered",
                        "display_name": "Geoff"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1560695263,
                    "creation_date": 1560695263,
                    "answer_id": 56619744,
                    "question_id": 2028517,
                    "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook/56619744#56619744",
                    "body": "<p>Minor modification to Triptych's response to allow for actually writing out the file (python3):</p>\n\n<pre><code>from urllib.request import urlopen\n\ndef chunk_report(bytes_so_far, chunk_size, total_size):\n    percent = float(bytes_so_far) / total_size\n    percent = round(percent*100, 2)\n    sys.stdout.write(\"Downloaded %d of %d bytes (%0.2f%%)\\r\" %\n                     (bytes_so_far, total_size, percent))\n\n    if bytes_so_far &gt;= total_size:\n        sys.stdout.write('\\n')\n\n\ndef chunk_read(response, chunk_size=8192, report_hook=None):\n    total_size = response.info().get(\"Content-Length\").strip()\n    total_size = int(total_size)\n    bytes_so_far = 0\n    data = b\"\"\n\n    while 1:\n        chunk = response.read(chunk_size)\n        bytes_so_far += len(chunk)\n\n        if not chunk:\n            break\n\n        if report_hook:\n            report_hook(bytes_so_far, chunk_size, total_size)\n\n        data += chunk\n\n    return data\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>with open(out_path, \"wb\") as f:\n    response = urlopen(filepath)\n    data_read = chunk_read(response, report_hook=chunk_report)\n\n    f.write(data_read)\n</code></pre>\n"
                }
            ],
            "owner": {
                "account_id": 83606,
                "reputation": 15918,
                "user_id": 234270,
                "user_type": "registered",
                "accept_rate": 70,
                "display_name": "speedplane"
            },
            "comment_count": 0,
            "is_answered": true,
            "accepted_answer_id": 2030027,
            "answer_count": 5,
            "score": 29,
            "last_activity_date": 1560695263,
            "creation_date": 1262964170,
            "question_id": 2028517,
            "link": "https://stackoverflow.com/questions/2028517/python-urllib2-progress-hook",
            "title": "Python urllib2 Progress Hook",
            "body": "<p>I am trying to create a download progress bar in python using the urllib2 http client. I've looked through the API (and on google) and it seems that urllib2 does not allow you to register progress hooks. However the older deprecated urllib does have this functionality.</p>\n\n<p>Does anyone know how to create a progress bar or reporting hook using urllib2? Or are there some other hacks to get similar functionality?</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 9449
}