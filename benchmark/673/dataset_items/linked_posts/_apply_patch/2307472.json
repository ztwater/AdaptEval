{
    "items": [
        {
            "tags": [
                "python",
                "diff",
                "revision",
                "difflib"
            ],
            "answers": [
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 79280,
                                "reputation": 5813,
                                "user_id": 224949,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "noio"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1266837888,
                            "post_id": 2307489,
                            "comment_id": 2277696,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307489#comment2277696_2307489",
                            "body": "It would have to be a pure python solution because I&#39;d like to deploy it in AppEngine. <code>diff</code>/<code>patch</code> would be ideal, but then in python."
                        },
                        {
                            "owner": {
                                "account_id": 218311,
                                "reputation": 19721,
                                "user_id": 474563,
                                "user_type": "registered",
                                "accept_rate": 48,
                                "display_name": "Pithikos"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1476126328,
                            "post_id": 2307489,
                            "comment_id": 67209840,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307489#comment67209840_2307489",
                            "body": "Notice that this kind of computations are generally slow so probably sticking with something lower level would scale better!"
                        }
                    ],
                    "owner": {
                        "account_id": 4638,
                        "reputation": 3090,
                        "user_id": 7055,
                        "user_type": "registered",
                        "accept_rate": 50,
                        "display_name": "Simon Callan"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1266787086,
                    "creation_date": 1266787086,
                    "answer_id": 2307489,
                    "question_id": 2307472,
                    "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307489#2307489",
                    "body": "<p>Does it have to be a python solution?<br>\nMy first thoughts as to a solution would be to use either a Version Control System (Subversion, Git, etc.) or the <code>diff</code> / <code>patch</code> utilities that are standard with a unix system, or are part of <code>cygwin</code> for a windows based system.</p>\n"
                },
                {
                    "owner": {
                        "account_id": 87612,
                        "reputation": 39,
                        "user_id": 242850,
                        "user_type": "registered",
                        "display_name": "jai"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 1,
                    "last_activity_date": 1266788097,
                    "creation_date": 1266788097,
                    "answer_id": 2307541,
                    "question_id": 2307472,
                    "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307541#2307541",
                    "body": "<p>AFAIK most diff algorithms use a simple <a href=\"http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\" rel=\"nofollow noreferrer\">Longest Common Subsequence</a> match, to find the common part between two texts and whatever is left is considered the difference. It shouldn't be too difficult to code up your own dynamic programming algorithm to accomplish that in python, the wikipedia page above provides the algorithm too.</p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 79280,
                                "reputation": 5813,
                                "user_id": 224949,
                                "user_type": "registered",
                                "accept_rate": 94,
                                "display_name": "noio"
                            },
                            "edited": false,
                            "score": 1,
                            "creation_date": 1266844116,
                            "post_id": 2307741,
                            "comment_id": 2278257,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307741#comment2278257_2307741",
                            "body": "Exactly what I was looking for! I tried googling for different combinations of &quot;python&quot;,&quot;diff&quot;,&quot;patch&quot;,&quot;revision&quot;, but hadn&#39;t found this yet."
                        },
                        {
                            "owner": {
                                "account_id": 333773,
                                "reputation": 2712,
                                "user_id": 659816,
                                "user_type": "registered",
                                "accept_rate": 83,
                                "display_name": "Paragon"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1336179245,
                            "post_id": 2307741,
                            "comment_id": 13505369,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307741#comment13505369_2307741",
                            "body": "google-diff-match-patch does seem store the entire file. It saves everything in tuples: (0, &#39;stuff&#39;) represents that &#39;stuff&#39; is present in both strings. The system is simple enough that it stores literally every character so that it can iterate through them and modify the text as need be."
                        },
                        {
                            "owner": {
                                "account_id": 954622,
                                "reputation": 5950,
                                "user_id": 980153,
                                "user_type": "registered",
                                "accept_rate": 62,
                                "display_name": "qre0ct"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1368593252,
                            "post_id": 2307741,
                            "comment_id": 23786224,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307741#comment23786224_2307741",
                            "body": "how can i use this API with Python&gt;? Would be great if it could be illustrated with an example"
                        },
                        {
                            "owner": {
                                "user_type": "does_not_exist",
                                "display_name": "user4155172"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1417338448,
                            "post_id": 2307741,
                            "comment_id": 42904301,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307741#comment42904301_2307741",
                            "body": "it still stores the entire text in form of tuples mixed with deleted and inserted text.. too verbose and bulky when you have to fit that in ram..."
                        }
                    ],
                    "owner": {
                        "account_id": 70055,
                        "reputation": 1930,
                        "user_id": 203535,
                        "user_type": "registered",
                        "accept_rate": 100,
                        "display_name": "Density 21.5"
                    },
                    "comment_count": 4,
                    "is_accepted": true,
                    "score": 31,
                    "last_activity_date": 1266791968,
                    "creation_date": 1266791968,
                    "answer_id": 2307741,
                    "question_id": 2307472,
                    "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307741#2307741",
                    "body": "<p>Did you have a look at diff-match-patch from google? Apparantly google Docs uses this set of algoritms. It includes not only a diff module, but also a patch module, so you can generate the newest file from older files and diffs.</p>\n\n<p>A python version is included.</p>\n\n<p><a href=\"http://code.google.com/p/google-diff-match-patch/\" rel=\"noreferrer\">http://code.google.com/p/google-diff-match-patch/</a></p>\n"
                },
                {
                    "comments": [
                        {
                            "owner": {
                                "account_id": 53590,
                                "reputation": 17761,
                                "user_id": 160245,
                                "user_type": "registered",
                                "accept_rate": 80,
                                "display_name": "NealWalters"
                            },
                            "edited": false,
                            "score": 0,
                            "creation_date": 1295627901,
                            "post_id": 2307743,
                            "comment_id": 5267353,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307743#comment5267353_2307743",
                            "body": "Voted your answer up.  The built in difflib seems powerful, yet somewhat confusing, just a matter of getting over the learning curve.  See my similar post here: <a href=\"http://stackoverflow.com/questions/4743359/python-difflib-deltas-and-compare-ndiff/4743621#4743621\" title=\"python difflib deltas and compare ndiff\">stackoverflow.com/questions/4743359/&hellip;</a>"
                        },
                        {
                            "owner": {
                                "account_id": 99165,
                                "reputation": 5704,
                                "user_id": 268006,
                                "user_type": "registered",
                                "accept_rate": 73,
                                "display_name": "Fake Name"
                            },
                            "edited": false,
                            "score": 10,
                            "creation_date": 1452144232,
                            "post_id": 2307743,
                            "comment_id": 57041289,
                            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307743#comment57041289_2307743",
                            "body": "The library has no way to apply the output of <code>difflib.unified_diff</code>. It has <code>diff</code>, but no <code>patch</code>. As such, if you&#39;re trying to stay within python, ` difflib.unified_diff ` is useless."
                        }
                    ],
                    "owner": {
                        "account_id": 98722,
                        "reputation": 1177,
                        "user_id": 267048,
                        "user_type": "registered",
                        "display_name": "pwdyson"
                    },
                    "comment_count": 2,
                    "is_accepted": false,
                    "score": 12,
                    "last_activity_date": 1674827200,
                    "last_edit_date": 1674827200,
                    "creation_date": 1266791975,
                    "answer_id": 2307743,
                    "question_id": 2307472,
                    "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/2307743#2307743",
                    "body": "<p>Does difflib.unified_diff do want you want? There is an example <a href=\"http://www.doughellmann.com/PyMOTW/difflib/index.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>The original link is broken. There is an example <a href=\"https://pymotw.com/3/difflib/\" rel=\"nofollow noreferrer\">here</a></p>\n"
                },
                {
                    "owner": {
                        "account_id": 7850640,
                        "reputation": 15,
                        "user_id": 5934201,
                        "user_type": "registered",
                        "accept_rate": 67,
                        "display_name": "Karthik Hegde"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 0,
                    "last_activity_date": 1457521995,
                    "creation_date": 1457521995,
                    "answer_id": 35889979,
                    "question_id": 2307472,
                    "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/35889979#35889979",
                    "body": "<p>Probably you can use <a href=\"https://docs.python.org/2/library/difflib.html\" rel=\"nofollow\">unified_diff</a> to generate the list of difference in a file. Only the changed texts in your file can be written it into a new text file where you can use it for your future reference. \nThis is the code which helps you to write only the difference to your new file.\nI hope this is what you are asking for !</p>\n\n<pre><code>diff = difflib.unified_diff(old_file, new_file, lineterm='')\n    lines = list(diff)[2:]\n    # linesT = list(diff)[0:3]\n    print (lines[0])\n    added = [lineA for lineA in lines if lineA[0] == '+']\n\n\n    with open(\"output.txt\", \"w\") as fh1:\n     for line in added:\n       fh1.write(line)\n    print '+',added\n    removed = [lineB for lineB in lines if lineB[0] == '-']\n    with open(\"output.txt\", \"a\") as fh1:\n     for line in removed:\n       fh1.write(line)\n    print '-',removed \n</code></pre>\n\n<p>Use this in your code to save only the difference output !</p>\n"
                },
                {
                    "owner": {
                        "account_id": 190878,
                        "reputation": 2773,
                        "user_id": 431087,
                        "user_type": "registered",
                        "display_name": "Isaac Turner"
                    },
                    "comment_count": 0,
                    "is_accepted": false,
                    "score": 5,
                    "last_activity_date": 1480913709,
                    "creation_date": 1480913709,
                    "answer_id": 40967337,
                    "question_id": 2307472,
                    "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python/40967337#40967337",
                    "body": "<p>I've implemented a pure python function to apply diff patches to recover either of the input strings, I hope someone finds it useful. It uses parses the <a href=\"https://en.wikipedia.org/wiki/Diff_utility#Unified_format\" rel=\"noreferrer\">Unified diff format</a>.</p>\n\n<pre><code>import re\n\n_hdr_pat = re.compile(\"^@@ -(\\d+),?(\\d+)? \\+(\\d+),?(\\d+)? @@$\")\n\ndef apply_patch(s,patch,revert=False):\n  \"\"\"\n  Apply unified diff patch to string s to recover newer string.\n  If revert is True, treat s as the newer string, recover older string.\n  \"\"\"\n  s = s.splitlines(True)\n  p = patch.splitlines(True)\n  t = ''\n  i = sl = 0\n  (midx,sign) = (1,'+') if not revert else (3,'-')\n  while i &lt; len(p) and p[i].startswith((\"---\",\"+++\")): i += 1 # skip header lines\n  while i &lt; len(p):\n    m = _hdr_pat.match(p[i])\n    if not m: raise Exception(\"Cannot process diff\")\n    i += 1\n    l = int(m.group(midx))-1 + (m.group(midx+1) == '0')\n    t += ''.join(s[sl:l])\n    sl = l\n    while i &lt; len(p) and p[i][0] != '@':\n      if i+1 &lt; len(p) and p[i+1][0] == '\\\\': line = p[i][:-1]; i += 2\n      else: line = p[i]; i += 1\n      if len(line) &gt; 0:\n        if line[0] == sign or line[0] == ' ': t += line[1:]\n        sl += (line[0] != sign)\n  t += ''.join(s[sl:])\n  return t\n</code></pre>\n\n<p>If there are header lines <code>(\"--- ...\\n\",\"+++ ...\\n\")</code> it skips over them. If we have a unified diff string <code>diffstr</code> representing the diff between <code>oldstr</code> and <code>newstr</code>:</p>\n\n<pre><code># recreate `newstr` from `oldstr`+patch\nnewstr = apply_patch(oldstr, diffstr)\n# recreate `oldstr` from `newstr`+patch\noldstr = apply_patch(newstr, diffstr, True)\n</code></pre>\n\n<p>In Python you can generate a unified diff of two strings using <em>difflib</em> (part of the standard library):</p>\n\n<pre><code>import difflib\n_no_eol = \"\\ No newline at end of file\"\n\ndef make_patch(a,b):\n  \"\"\"\n  Get unified string diff between two strings. Trims top two lines.\n  Returns empty string if strings are identical.\n  \"\"\"\n  diffs = difflib.unified_diff(a.splitlines(True),b.splitlines(True),n=0)\n  try: _,_ = next(diffs),next(diffs)\n  except StopIteration: pass\n  return ''.join([d if d[-1] == '\\n' else d+'\\n'+_no_eol+'\\n' for d in diffs])\n</code></pre>\n\n<p>On unix: <code>diff -U0 a.txt b.txt</code></p>\n\n<p>Code is on GitHub here along with tests using ASCII and random unicode characters: <a href=\"https://gist.github.com/noporpoise/16e731849eb1231e86d78f9dfeca3abc\" rel=\"noreferrer\">https://gist.github.com/noporpoise/16e731849eb1231e86d78f9dfeca3abc</a></p>\n"
                }
            ],
            "owner": {
                "account_id": 79280,
                "reputation": 5813,
                "user_id": 224949,
                "user_type": "registered",
                "accept_rate": 94,
                "display_name": "noio"
            },
            "comment_count": 0,
            "is_answered": true,
            "accepted_answer_id": 2307741,
            "answer_count": 6,
            "score": 35,
            "last_activity_date": 1674827200,
            "creation_date": 1266786789,
            "last_edit_date": 1266787461,
            "question_id": 2307472,
            "link": "https://stackoverflow.com/questions/2307472/generating-and-applying-diffs-in-python",
            "title": "Generating and applying diffs in python",
            "body": "<p>Is there an 'out-of-the-box' way in python to generate a list of differences between two texts, and then applying this diff to one file to obtain the other, later? </p>\n\n<p>I want to keep the revision history of a text, but I don't want to save the entire text for each revision if there is just a single edited line. I looked at <a href=\"http://docs.python.org/library/difflib.html\" rel=\"noreferrer\">difflib</a>, but I couldn't see how to generate a list of just the edited lines that can still be used to modify one text to obtain the other.</p>\n"
        }
    ],
    "has_more": false,
    "quota_max": 10000,
    "quota_remaining": 8817
}